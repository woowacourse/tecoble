---
layout: post
title: 'SWR, ì„œë²„ ë°ì´í„°ë¥¼ ì•± ë°ì´í„°ì²˜ëŸ¼ ê´€ë¦¬í•´ë³´ì'
author: [3ê¸°_ë¯¸í‚¤]
tags: ['refactoring']
date: '2021-05-23T12:00:00.000Z'
draft: false
image: ../teaser/swr.jpg
---

í”„ë¡ íŠ¸ì—”ë“œëŠ” ì›¹ê³¼ ì‚¬ìš©ìê°€ ë§ë‹¿ì•„ ìˆëŠ” ë¶€ë¶„ì„ ê°œë°œí•˜ëŠ” ì˜ì—­ì´ë‹¤.
ë”°ë¼ì„œ í”„ë¡ íŠ¸ ê°œë°œìì—ê²Œ `ì„œë²„ì˜ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ê²ƒì¸ê°€?`ë¼ëŠ” ë¬¸ì œëŠ” ì •ë§ ì¤‘ìš”í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

ê·¸ëŸ°ë° ì„œë²„ì˜ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ê¸° ì „ì— ê´€ë¦¬ë¶€í„° í•´ì•¼ í•  í…ë° ë‹¤ë“¤ ì–´ë–»ê²Œ ê´€ë¦¬í•´ì™”ì„ê¹Œ?
ì„œë²„ ë°ì´í„°ë¥¼ ì•±ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ë§ì€ ê°œë°œìê°€ ê³ ë¯¼í•˜ì˜€ê³ ,
ê·¸ì¤‘ ì¼ë¶€ëŠ” ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ Reduxë¥¼ ì‚¬ìš©í•˜ê¸°ë„ í•˜ì˜€ë‹¤.

í•˜ì§€ë§Œ Reduxë¡œ ì„œë²„ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸°ì—ëŠ” ë¶ˆí¸í•¨ì´ ì»¸ë‹¤.
ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ ë°ì´í„°ë¥¼ ê´€ë¦¬í•¨ì— ìˆì–´ ê¸°ì¡´ `Reduxì˜ ë‹¨ì `ê³¼
ì´ë¥¼ í•´ì†Œí•  ìˆ˜ ìˆëŠ” `SWR`ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ì.

## ğŸ˜­ Redux. ì„œë²„ ë°ì´í„° ê´€ë¦¬ê°€ ë¶ˆí¸í•´ìš”

### ğŸ‘ fetch í›„ Redux ìƒíƒœì— ë‹´ëŠ” ì½”ë“œê°€ ë³µì¡í•˜ë‹¤.

fetch í›„ ë°ì´í„°ë¥¼ ì–´ë”˜ê°€ì— ì €ì¥í•´ì•¼ í•˜ë¯€ë¡œ Reduxë¥¼ í™œìš©í•´ ì „ì—­ìœ¼ë¡œ
ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ìƒí™©ì´ ë§ì´ ë°œìƒí•œë‹¤.

ë‹¤ìŒì€ í•´ë‹¹ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” Hookì´ë‹¤.

```js
//action.js
export const GET_USER_DATA = 'user/GET_USER_DATA';
export const GET_USER_DATA_SUCCESS = 'user/GET_USER_DATA_SUCCESS';
export const GET_USER_DATA_ERROR = 'user/GET_USER_DATA_ERROR';

export const thunkLoadUserData = () => async (dispatch) => {
  dispatch({ type: GET_USER_DATA });

  try {
    const items = await fetch(...);

    dispatch({ type: GET_USER_DATA_SUCCESS, payload: items });
  } catch (error) {
    dispatch({ type: GET_USER_DATA_ERROR, payload: error });
  }
};

//reducer.js
const reducer = (state = initialState, action) => {
  switch (action.type) {
    case GET_USER_DATA:
      return {
        ...state,
        isLoading: true,
        error: null,
      };
    case GET_USER_DATA_SUCCESS:
      return {
        ...state,
        items: [...action.payload],
        isLoading: false,
      };
    case GET_USER_DATA_ERROR:
      return {
        ...state,
        error: action.payload,
      };

      ...
  }
}

```

ì •ë³´ë¥¼ fetchí•˜ì—¬ ì „ì—­ ìƒíƒœì— ë‹´ëŠ” í•˜ë‚˜ì˜ ë™ì‘ë§Œì„ ê°„ë‹¨íˆ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ
ì•¡ì…˜ íƒ€ì…ì„ ì‘ì„±í•˜ê³ , ê·¸ì— ëŒ€ì‘ë˜ëŠ” thunk í•¨ìˆ˜ì™€ reducer ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.

ì—¬ê¸°ì„œ requestì™€ ê´€ë ¨ëœ ë™ì‘ì„ ì¶”ê°€ë¡œ êµ¬í˜„í•  ë•Œë§ˆë‹¤
ìœ„ì™€ ë¹„ìŠ·í•œ ì½”ë“œë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤.
ì´ëŸ° ì‘ì—…ì„ ë°˜ë³µí•˜ë©´ì„œ ê°œë°œìëŠ” ë²ˆê±°ë¡œì›€ì„ ëŠë¼ê³  ì½”ë“œëŠ” ì ì  ë³µì¡í•´ì§„ë‹¤.

### ğŸ‘ ìƒíƒœ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ì½”ë“œê°€ ë°˜ë³µëœë‹¤.

ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ì„ 3ê°œì˜ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•œë‹¤ë©´
ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•  ê²ƒì´ë‹¤.

```js
// Page1.jsx
const Page1 = () => {
  useEffect(() => {
    dispatch(thunkLoadUserData());
  }, []); // ìœ ì € ë°ì´í„° ì´ˆê¸°í™”

  return <Profile />;
};

const Profile = () => {
  const userData = useSelector(({ user }) => user);
  // ìœ ì € ë°ì´í„°ë¥¼ ë¦¬ë•ìŠ¤ì—ì„œ ê°€ì ¸ì˜´

  return (
    <div>
      <h2>userData.name</h2>
      <p>userData.age</p>
    </div>
  );
};
```

ì—¬ê¸°ì„œ ë¬¸ì œì ì€ ìœ ì € ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì½”ë“œì™€ í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´
ê°€ì ¸ì˜¤ëŠ” ì½”ë“œê°€ ë¶„ë¦¬ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

í˜„ì¬ ì˜ˆì œëŠ” ê°„ë‹¨í•˜ì—¬ Profileì—ì„œ ìœ ì € ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ë„ ë˜ì§€ë§Œ
Page1ì´ ì»¤ì§€ë©´ ì»¤ì§ˆìˆ˜ë¡ page í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ì—¬ê¸°ì €ê¸°ì—ì„œ ìœ ì € ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ì¼ì´
ë§ì•„ì§€ë¯€ë¡œ ê²°êµ­ì—ëŠ” Page1ì—ì„œ ìœ ì € ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ì•¼ í•œë‹¤.

ì´ë ‡ê²Œ ë°ì´í„° ì´ˆê¸°í™” ì½”ë“œì™€ ì‚¬ìš© ì½”ë“œê°€ ë¶„ë¦¬ë˜ì—ˆì„ ë•Œì˜ ë¬¸ì œì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ or ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°˜ë“œì‹œ ë°ì´í„° ì´ˆê¸°í™” ì½”ë“œê°€ ê°•ì œëœë‹¤.
2. ë§Œì•½ ìœ ì € ë°ì´í„°ë¥¼ Page1, Page2, Page3ì—ì„œ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ì‚¬ìš©ìê°€ ì–´ë–¤ í˜ì´ì§€ urlë¡œ ê°€ì¥ ë¨¼ì € ì ‘ê·¼í• ì§€ ê°œë°œìëŠ” ì•Œ ìˆ˜ ì—†ìœ¼ë‹ˆ, ëª¨ë“  í˜ì´ì§€ì—ì„œ ìƒíƒœ ì´ˆê¸°í™” ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ì•¼ í•œë‹¤.

ì´ë ‡ë“¯ ê°œë°œìê°€ ìƒíƒœ ì´ˆê¸°í™”ì— ëŒ€í•´ ê´€ì‹¬ì„ ê°€ì ¸ì•¼ í•˜ë©° ì´ˆê¸°í™” ì½”ë“œê°€ ë°˜ë³µëœë‹¤.
ì—¬ê¸°ì„œ ì¶”ê°€ë¡œ 1ë¶„ë§ˆë‹¤, ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ê°€ ì¬ì—°ê²°ë˜ì—ˆì„ ë•Œ ë°ì´í„°ë¥¼ ê°±ì‹ ì‹œì¼œì£¼ì–´ì•¼ í•œë‹¤ë©´?
ì´ì œ ì½”ë“œëŠ” ì ì  ë³µì¡í•´ì§€ê¸° ì‹œì‘í•œë‹¤.

ì´ëŸ° ë¬¸ì œë“¤ì´ ë°œìƒí•˜ëŠ” ê±´ íƒœìƒë¶€í„° Reduxê°€ ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë‹¤.
ReduxëŠ” ì¶”ì  ê°€ëŠ¥í•œ `ì•±` ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.
ê·¸ë˜ì„œ ë¹„ë™ê¸°ì ì¸ ì‘ì—…ì— ì•½í•œ ReduxëŠ” ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë¥¼ í•´ê²°í•˜ëŠ” ë“± ì—¬ëŸ¬ ê°€ì§€ ëŒ€ì•ˆì´ ë‚˜ì˜¤ê³  ìˆì§€ë§Œ, ì—¬ì „íˆ ë¶ˆí¸í•˜ë‹¤.
ê·¸ëŸ¼ SWRì€ ì–´ë–¤ ë…€ì„ì´ê¸¸ë˜ ì´ ë¬¸ì œë¥¼ í•´ê²°í•´ ì¤€ë‹¤ëŠ” ê²ƒì¼ê¹Œ?

## ğŸ˜ SWR. ë„Œ ëˆ„êµ¬ëƒ!

SWRì€ `stale-while-revalidate`ì˜ ì•½ìë‹¤.
ì´ëŠ” [HTTP ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ëª…ì„¸ - RFC 5861](https://datatracker.ietf.org/doc/html/rfc5861)ì—ì„œ ì •ì˜í•œ
'stale-while-revalidate' ì „ëµì—ì„œ ë”°ì˜¨ ê²ƒì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´ 'stale-while-revalidate'ì€ ë¬´ì—‡ì¼ê¹Œ?
[mdn](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control)ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„í•˜ê³  ìˆë‹¤.

> stale-while-revalidate=\<seconds\>
>
> ë¹„ë™ê¸°ì ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì²´í¬ì¸í•˜ëŠ” ë™ì•ˆ í´ë¼ì´ì–¸íŠ¸ê°€ **ìµœì‹ ì´ ì•„ë‹Œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ê²ƒ**ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
> ì´ˆ ê°’ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ìµœì‹ ì´ ì•„ë‹Œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ì‹œê°„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

'stale-while-revalidate' ì´ë¼ëŠ” ì´ë¦„ì²˜ëŸ¼
SWRëŠ” ë‚´ë¶€ì ìœ¼ë¡œ requestë¥¼ ë³´ëƒˆì„ ë•Œ ìš°ì„ ì€ ìºì‹œë¡œë¶€í„° stale(ì˜¤ë˜ëœ) ì •ë³´ë¥¼ ë¨¼ì € ë¦¬í„´í•˜ê³ 
ë°±ê·¸ë¼ìš´ë“œì—ì„œ fetch request(revalidate)ë¥¼ ë³´ë‚´ëŠ” ì „ëµì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ì¢€ ì–´ë µê²Œ ë‹¤ê°€ì˜¬ ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ° ì˜ë¬¸ì´ ë“¤ ìˆ˜ ìˆë‹¤.

`SWRì´ ê·¸ë˜ì„œ ëŒ€ì²´ ë­ê°€ ì¢‹ì€ë°?`

ì‚¬ìš©í•˜ëŠ” ê°œë°œì ì…ì¥ì—ì„œ ì™€ë‹¿ëŠ” ê²ƒì€ ê²°êµ­ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **í¸ì˜ì„±**ì´ê¸° ë•Œë¬¸ì—
ë¹ ë¥´ê²Œ **SWRì„ ì™œ ì‚¬ìš©í•˜ëŠ”ì§€**ì— ëŒ€í•œ ì£¼ì œë¡œ ë„˜ì–´ê°€ ë³´ì.

## ğŸ™„ SWR. ê·¸ë˜ì„œ ì™œ ì‚¬ìš©í•˜ë‚˜ìš”?

### 1. ì„œë²„ ë°ì´í„°ë¥¼ ì•± ë°ì´í„°ì²˜ëŸ¼ ì‚¬ìš©

SWRë„ ìºì‹±ì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ì—­ ìƒíƒœë¡œ ê´€ë¦¬í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.
í•˜ì§€ë§Œ Reduxì™€ ë‹¤ë¥¸ ì ì€ ì„œë²„ ë°ì´í„°ë¥¼ ì•± ë°ì´í„°ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. (Reduxì˜ ìƒíƒœ ì¶”ì ì€ SWR ë‹¨ë…ìœ¼ë¡œëŠ” ë¶ˆê°€)

```js
const fetcher = url => fetch(url).then(r => r.json());

function App() {
  const { data, error } = useSWR('/api/data', fetcher);
  // ...
}
```

useSWRì€ ì²« ë²ˆì§¸ ì¸ìë¡œ `key`, ë‘ ë²ˆì§¸ ì¸ìë¡œ `fetcher`ë¥¼ ë°›ëŠ”ë‹¤.
ì—¬ê¸°ì„œ keyëŠ” ê° fetchì˜ ìºì‹œ ë°ì´í„°ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ê³ ìœ í•œ ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ”ë° ì¼ë°˜ì ìœ¼ë¡œ `APIì˜ endpoint`ê°€ ì‚¬ìš©ëœë‹¤.
ê·¸ ì´ìœ ëŠ” key ê°’ì´ ê¸°ë³¸ì ìœ¼ë¡œ fetcherì˜ ì²« ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ë˜ì–´ ì‚¬ìš©ì´ í¸ë¦¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
ìœ„ ê²½ìš°ë¡œ ì˜ˆë¥¼ ë“¤ìë©´ fetcherì˜ ì²« ë²ˆì§¸ ì¸ìë¡œ `/api/data`ê°€ ì „ë‹¬ë˜ëŠ” ì…ˆì´ë‹¤.

keyë§Œ ì•Œê³  ìˆë‹¤ë©´ ì•± ì–´ë””ì„œë“ ì§€ `/api/data` ì— ëŒ€í•œ ìºì‹œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
ì´ëŠ” ìºì‹œ ë°ì´í„°ë¥¼ ì „ì—­ ìƒíƒœë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ì–´ ë§¤ìš° í¸ë¦¬í•˜ë‹¤.

### 2. ë°ì´í„° ê°±ì‹ ì„ ìœ„í•œ re-fetchingì„ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```js
const { data, error } = useSWR('https://api.github.com/repos/vercel/swr', fetchCurrentTime, {
  refreshInterval: 1000,
});
```

ì´ë ‡ê²Œ ì‘ì„±ë§Œ í•˜ë©´ 1ì´ˆë§ˆë‹¤ í•œ ë²ˆì”© ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆë‹¤.

ë˜í•œ, ë¸Œë¼ìš°ì €ì— Focusë¥¼ í•˜ë©´ ì •ë³´ë¥¼ ê°±ì‹ í•˜ëŠ” ê²ƒì´ default ì„¤ì •ìœ¼ë¡œ ë“¤ì–´ê°€ ìˆê³ 
ì´ ì™¸ì—ë„ `íŠ¹ì • ìƒí™©`ì— ì •ë³´ë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ë“¤ì´ ë§¤ìš° ë§ë‹¤. [(ì°¸ê³ )](https://swr.vercel.app/docs/options)

ì§ì ‘ êµ¬í˜„í–ˆë‹¤ë©´ ìƒë‹¹íˆ ë³µì¡í–ˆì„ ê¸°ëŠ¥ì„ í•œ ì¤„ì˜ ì˜µì…˜ìœ¼ë¡œ ë°”ë¡œ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹ˆ
êµ‰ì¥í•œ ì´ì ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

### 3. fetch dataê°€ ìºì‰¬, ê³µìœ ë˜ê¸° ë•Œë¬¸ì— ë¶ˆí•„ìš”í•œ requestë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```jsx
function useUser(id) {
  const { data, error } = useSWR(`/api/user/${id}`, fetcher);

  return {
    user: data,
    isLoading: !error && !data,
    isError: error,
  };
}

function Content() {
  const { user, isLoading } = useUser(1);
  if (isLoading) return <Spinner />;
  return <h1>Welcome back, {user.name}</h1>;
}

function Avatar() {
  const { user, isLoading } = useUser(1);
  if (isLoading) return <Spinner />;
  return <img src={user.avatar} alt={user.name} />;
}
```

ìœ„ëŠ” SWRë¥¼ ì‚¬ìš©í•´ responseë¥¼ ë°›ì•„ì˜¤ëŠ” ì˜ˆì‹œ ì½”ë“œì´ë‹¤.
ì½”ë“œë¥¼ ë³´ë©´ SWRì„ í†µí•´ requestë¥¼ ë³´ë‚´ê³  userì˜ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ”
useUser()ê°€ ì—¬ê¸°ì €ê¸°ì„œ í˜¸ì¶œë˜ê³  ìˆë‹¤.
í•˜ì§€ë§Œ SWRì€ requestì˜ ì¤‘ë³µì„ ìë™ìœ¼ë¡œ ì œê±°í•´ì£¼ê¸° ë•Œë¬¸ì—
useUser()ê°€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œëœë‹¤ í•´ë„ í•œ ë²ˆë§Œ requestê°€ ì´ë£¨ì–´ì§„ë‹¤.
ì´ëŠ” ì˜ë¯¸ ì—†ëŠ” requestë¥¼ ì¤„ì—¬ ì„œë²„ì˜ ë¶€í•˜ë¥¼ ì¤„ì—¬ì¤€ë‹¤.

ê·¸ë¦¬ê³  ì •ë³´ì— ëŒ€í•œ ê°±ì‹ ì´ í•„ìš”í•˜ë‹¤ë©´ `mutate(key)` ë©”ì„œë“œë¥¼
ì‚¬ìš©í•´ ì¶”ê°€ì ì¸ requestë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

## ì¶œì²˜

[REDUXë¥¼ ë„˜ì–´ SWRë¡œ(1)](https://tech.madup.com/swr-intro1/)

[Redux ë§ê³  SWR](https://snyung.com/content/2021-01-09--SWR)

[Keeping things fresh with stale-while-revalidate](https://web.dev/stale-while-revalidate/)
