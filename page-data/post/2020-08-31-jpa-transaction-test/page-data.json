{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2020-08-31-jpa-transaction-test/","result":{"data":{"logo":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png 400w","sizes":"400px"},"sources":[{"srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/65935/tecoble.webp 400w","type":"image/webp","sizes":"400px"}]},"width":500,"height":110}}},"markdownRemark":{"html":"<p>서비스 레이어(<code class=\"language-text\">@Service</code>)에 대해 테스트를 한다면 보통 DB와 관련된 테스트 코드를 작성하게 된다. 이러면 테스트 메서드 내부에서 사용했던 데이터들이 그대로 남아있게 되어서 실제 서비스에 영향을 미칠 수 있기 때문에 테스트가 끝나면 지워야 할 필요가 있다. 이러한 문제를 해결하기 위해 <code class=\"language-text\">@Sql</code> 애너테이션을 이용해서 직접 DB를 Truncate하는 Query를 직접 작성하는 방법도 있고, 테스트 메서드에 <code class=\"language-text\">@Transactional</code> 애너테이션을 이용해서 테스트 메서드가 종료될 때 테스트 메서드 내부에서 생성했던 데이터를 rollback하는 방법도 있다.</p>\n<p><code class=\"language-text\">@Sql</code> 작성은 관련된 DB의 Truncate Query를 직접 작성해야하고 관련된 Table이 증가할 때마다 Query도 같이 수정해야 하는 번거로움이 있다. 반면 <code class=\"language-text\">@Transactional</code> 은 클래스 혹은 메서드에 명시하는 것 만으로 손쉽게 관련된 Table의 데이터를 rollback 할 수 있기 때문에 굉장히 편리하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2ff0aad2f3ac514b94c87823ac7ce58/ce491/2020-08-31-jpa-transactional-test-definition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoklEQVR42k2J6w6CMBhDef/nQ8bGbdw2QILABiqM1A9MjD9O2tN6aZqCMwYehpBZhow8FgIhbafv24bD7YS70u3U9+1ydxw4/nC0efdEoI8YOhGgCW8/Wv51FfgEp5+h8m/QgUDHGXQSQTcN2raF1hoNdaUUvLjuIfUAqQYUeYGyyJFLeVFXJVa7Yny8sNgFZl4xj2/qT8zTBGstjDFXTuQnH+QT38lWRGofAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 08 31 jpa transactional test definition\"\n        title=\"\"\n        src=\"/static/d2ff0aad2f3ac514b94c87823ac7ce58/f97d7/2020-08-31-jpa-transactional-test-definition.png\"\n        srcset=\"/static/d2ff0aad2f3ac514b94c87823ac7ce58/0eb09/2020-08-31-jpa-transactional-test-definition.png 500w,\n/static/d2ff0aad2f3ac514b94c87823ac7ce58/1263b/2020-08-31-jpa-transactional-test-definition.png 1000w,\n/static/d2ff0aad2f3ac514b94c87823ac7ce58/f97d7/2020-08-31-jpa-transactional-test-definition.png 2000w,\n/static/d2ff0aad2f3ac514b94c87823ac7ce58/ce491/2020-08-31-jpa-transactional-test-definition.png 2830w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><a href=\"https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#testcontext-tx-rollback-and-commit-behavior\">Transcation Rollback and Commit Behavior</a></p>\n</blockquote>\n<p>위와 같이 테스트에 <code class=\"language-text\">@Transactional</code>을 이용한다면 쉽게 rollback이 돼서 테스트 코드에 사용한 데이터를 관리하기 쉽다.</p>\n<p>하지만 JPA를 사용하는 환경에서 단순히 rollback을 위해서 테스트 코드를 작성한다면 주의해야 할 점이 있다.</p>\n<h2>예제</h2>\n<p>예시를 위한 코드를 먼저 살펴보도록 하자.<br>\n아래는 1:N 관계를 가진 Member(사용자), CellPhone(핸드폰) Entity이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1612px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 71.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVR42pWTW08aURSFfReZO7TKcAkOUKIMYokBhRnud4e7MdJK0zTpQ///69czmDRVodCHldnn5Jwva68950jTdN5JUVEkBVl+keKv32jrPaGjtxuqOByOJjDTaVKWhWWliMcTrxSLxQmFQqjqHqBuGMiBE6xajerzlPFoyL03xnFdqo7zR45QJGJudfoKaOgGgYBKrZLg57JMszWi7LiUKlXKVZeb2ztavT7j2Zxz09x082+gcHh8rNKuJ/n1VGI6WzGaTqm3OjS7fQEbMJkvmSweiJrR/Q51XScoaeRzUe6bRUplh1any11VtOrWcWsN2t0ebr0hMgyLDLX9Q9GFJFnHjMQwNrUiXAc2bgIiX1NkF/ZhOyb9DqiJHFVZJlm8oVi5JXdxiW3bFAoFstksuVyO04+nSAKoHgrUggr2ckRj2ccbeniTCYPhUEzYpd3ukDy3SGoaH0Tm6t6WRY4BKcRqEGPtubjNPpVaHafRotHpMX94xEpnMEQU/l+hHQQMGqzmKX4smjx++c7T8xpvthD1V1brb6Qzn8TwZHHWOGwoiqKTv4xxbWex8wVydh4rlSF/VeDq+jNnZ5Gdz+9o26YPDQZVToKy+EpIQrL8UvtS/+ct/92639I27brjA38DeYF/ub0IMjYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2020 08 31 jpa transactional test class diagram\" title=\"\" src=\"/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png\" srcset=\"/static/a7df90bfb99e70319162362aab609c69/0eb09/2020-08-31-jpa-transactional-test-class-diagram.png 500w,\n/static/a7df90bfb99e70319162362aab609c69/1263b/2020-08-31-jpa-transactional-test-class-diagram.png 1000w,\n/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png 1612w\" sizes=\"(max-width: 1612px) 100vw, 1612px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CellPhone</span><span class=\"token punctuation\">></span></span> cellPhones <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">buyCellphone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">CellPhone</span> cellPhone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cellPhones<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>cellPhone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        cellPhone<span class=\"token punctuation\">.</span><span class=\"token function\">placeMember</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CellPhone</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CellPhone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phoneNumber <span class=\"token operator\">=</span> phoneNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">placeMember</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>member <span class=\"token operator\">=</span> member<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>그리고 서비스 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PhoneService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRepository</span> memberRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">CellPhoneRepository</span> cellPhoneRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">buyNewCellPhone</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        cellPhoneRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByPhoneNumber</span><span class=\"token punctuation\">(</span>phoneNumber<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">ifPresent</span><span class=\"token punctuation\">(</span>cellPhone <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미 존재하는 휴대전화 번호입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">CellPhone</span> cellPhone <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CellPhone</span><span class=\"token punctuation\">(</span>phoneNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        member<span class=\"token punctuation\">.</span><span class=\"token function\">buyCellphone</span><span class=\"token punctuation\">(</span>cellPhone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        cellPhoneRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>cellPhone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>마지막으로 테스트 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PhoneServiceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PhoneService</span> phoneService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MemberRepository</span> memberRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">buyNewCellPhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//given</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"비밥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> phoneNumber <span class=\"token operator\">=</span> <span class=\"token string\">\"010-1234-5678\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//when</span>\n        phoneService<span class=\"token punctuation\">.</span><span class=\"token function\">buyNewCellPhone</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> phoneNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//then</span>\n        <span class=\"token class-name\">Member</span> buyMember <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">CellPhone</span> cellPhone <span class=\"token operator\">=</span> buyMember<span class=\"token punctuation\">.</span><span class=\"token function\">getCellPhones</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>cellPhone<span class=\"token punctuation\">.</span><span class=\"token function\">getPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span>phoneNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트 코드에는 rollback을 위해 <code class=\"language-text\">@Transactional</code> 애너테이션이 사용되고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2e26aad5a8ff297f128b2855e28665b/9c658/2020-08-31-jpa-transactional-test-test-roll-back.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVR42jWP226CUBREASUSLkVFBEFUruGgNFobr22a9Pbc9gf6/1+xeiTpw2TtTCaT2cq9+OJ0+KUVP6zzb7bTVw7LN/bhE9vwmWZ8pHL2kic23pnz9MqL9C/eiXf/zGd45UPqOHykdvcowztB5F+YOA+Y2hbPrVlkMVm5IKtWJKuYcB4QL2dESUiaLyikn2Zz1tWSRubWRcIsHDOZeiimaaEoCqqqduxpGsk8QdSCPMvJ05yiKDulq5RGNPKuyPOCWt6ZZDiLsEybKIpRDGMgi1RZqElq9Hp9yrJkt9vRti1CCDabDU3TdLypruvOX0uvktlbPggCWRih6H2nW/YvTS50HAfP8/B9n9FoxHgs35lMOrqui2VZ2LaNYRgMBgNM00TX9S77B7sJhSV4LNVcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 08 31 jpa transactional test test roll back\"\n        title=\"\"\n        src=\"/static/d2e26aad5a8ff297f128b2855e28665b/f97d7/2020-08-31-jpa-transactional-test-test-roll-back.png\"\n        srcset=\"/static/d2e26aad5a8ff297f128b2855e28665b/0eb09/2020-08-31-jpa-transactional-test-test-roll-back.png 500w,\n/static/d2e26aad5a8ff297f128b2855e28665b/1263b/2020-08-31-jpa-transactional-test-test-roll-back.png 1000w,\n/static/d2e26aad5a8ff297f128b2855e28665b/f97d7/2020-08-31-jpa-transactional-test-test-roll-back.png 2000w,\n/static/d2e26aad5a8ff297f128b2855e28665b/49142/2020-08-31-jpa-transactional-test-test-roll-back.png 3000w,\n/static/d2e26aad5a8ff297f128b2855e28665b/9c658/2020-08-31-jpa-transactional-test-test-roll-back.png 3212w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위 테스트 코드는 정상적으로 통과한다. 또한 테스트에서 생성되었던 데이터들도 성공적으로 rollback이 되는 것을 확인할 수 있다.</p>\n<p>하지만 개발자의 서비스 코드의 메서드에서 <code class=\"language-text\">@Transactional</code> 을 깜빡하고 사용하지 않고 테스트 코드에서만 <code class=\"language-text\">@Transactional</code>을 사용한다면 어떻게 될까?</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1448px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEUklEQVR42o1VaXPiRhQUvitZG9A9ug/EJRASYFj5BGfXVandijeV/P+/0ukR4F0nriQfWnNUTU+/9/qNFNt1kWY2ykpDmqiIIgtRbCMIbZimAV3fQ3sLTdPfhWKlAYLAwcC34FsGQi9A2hsgjlJYXLfbHXS63Ve0u1yrXaia9j6h74XoaiZCQZVUNvF1TPsJrtcfUdc1lqtrlKM51lndYJWtkboJbFPsSYw3UFxPwLV09BwDeeRgHAlM4hj9OEMSZUxDygg8BLaH2AmRuBEi4cPSdSptk6QLTf8OxdC36Km3uLXWqKMn1OFn3M1jjMpz6PkJROzD1rbwvS1s6wFCbOEQUfAZkf8JaqfG5U83uNpDcZ0Cupqhp8XI4hL93gKz1RRl3cd6VeB+eY96+gWr6hnz8hesZzcoi0cMsiVcMYbGs932dyhB4EI1NGSWisCyETKsQThCns7Qj0aY5DnynOM0x4C5zTMWLQ5hmRo6HYbMAv0YtuK6PkxLwDctDIVHwhR5L8e6WKIYjqhyhapaoD+cIEkSRFmKdJjBoTM0m4UQBN2g6fuiOI5LQhuCSHQVH9ptGNI+QkfqmLRPhDTN6M0EHi11Zbdx5VNNbMLoWdAzIuDc2HmTIYc0sAXNsDB26ce0R3PHiEngksCzTQS+zz1WNwrRS2X1Y5issqrSNgccfCgJDcOkUQ0U/T4erxcYTyZYLBYoihwl81fNiiZvQRAw7BRRSBHGjkD/u7FlyJJQp0rfdFA6MY1LFSKFb4dUSu9RbY/5M3QNV23ZMSoF/JNs1yl+QF+xb23mgu7PhYttmKD2I1QM+SGOcBfuR8/BPdNSO6JByTP3HCUC5rC7U+hAsOy2ylvZt37nCgGxopVqotJULIWF0jKxcQW2JL3l+EA87tehyQiZU41Qrid3SGcbzB6+oiQ+bn7D48OvmG9esH76htHiiXYaY+hMiCkywZHoi5yYILNz9PbIuMfXxsf05Q9cv/yJcvOM/s0G5XwFf7LA6PEZ409fsWK3BHGKoipxs75jxyxQDSJMBxnyUYEkZKGCBKEfM2TbQRAFmNcVnrfPuKkfcD+Zom+7ECySZTgoBjFmJBiMRqz+vEFZVajmnC+lGwrM6Yol54rGd01RFLROW0yq2uRBYz4vTk+bfYmzIwUfzk/ZABZNnjaQXSNtJP3p06cxvSn3lC4fzaOjI7RarVeC5gKuD1CUFs7OzmmhmG1YoSzLRtWEfp3NZhiPx5hTrdxXLi8vG8I3JD8Qv6o8O4PL38V0OsVwOGxU9tkIWZY1F+V8RCRxYxvlHYL3CD3Paw6H7BQ5l5CXSI7DWmk+/4PwlDmVRDLMEYsj1RzmMneDwWCn8OL8AsfHxwyz9a+EJycnTREOIcvDEkKIxtS2bTdqFRnKIYf/pVAelKSyqruHImnm8umSxBLKrfWN/fk71toX/Hzc2RO03iWUuZKFkESyKLIgcq/dlj8rrcFfRDaWPvVcw1YAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2020 08 31 jpa transactional test service except transactional\" title=\"\" src=\"/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png\" srcset=\"/static/a66dfa2ffeb742c693aa736c8a9c22c8/0eb09/2020-08-31-jpa-transactional-test-service-except-transactional.png 500w,\n/static/a66dfa2ffeb742c693aa736c8a9c22c8/1263b/2020-08-31-jpa-transactional-test-service-except-transactional.png 1000w,\n/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png 1448w\" sizes=\"(max-width: 1448px) 100vw, 1448px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>테스트 코드는 통과하지만</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1bfd2a0dbe28fe49987ea3fef36661a2/fa486/2020-08-31-jpa-transactional-test-runtimeexception.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVR42mWQ227CMAxAO6ColSbRe0p6SUMupREb0/7/385SHsfDkW3ZOracDOOIXhS6F8xth7z2yGGgaFtE26D6jqmuMHWNFR1tVdHEXhPrpmnouo465nvM85ykl5LfsPG8LdzHK3qQiKtkHmfMoFiEZIqLxC4oS7Is43w+v5GmKcfjkaS4XDDWRCzaWLzTBFVilEDdPNY6zDygtcY6jxCCw+HwIkmSd8q4NYQQRY7tfidEVm94WMlzyvmeMh7TJ24WOO9RStH3PUVRcjqd3oVV/Mm2bbgoXNeVsOd+ZfOa55zzIz/4kiledXEusCzLi/0IGd/1X/gHZJt+LrgqS/0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 08 31 jpa transactional test runtimeexception\"\n        title=\"\"\n        src=\"/static/1bfd2a0dbe28fe49987ea3fef36661a2/f97d7/2020-08-31-jpa-transactional-test-runtimeexception.png\"\n        srcset=\"/static/1bfd2a0dbe28fe49987ea3fef36661a2/0eb09/2020-08-31-jpa-transactional-test-runtimeexception.png 500w,\n/static/1bfd2a0dbe28fe49987ea3fef36661a2/1263b/2020-08-31-jpa-transactional-test-runtimeexception.png 1000w,\n/static/1bfd2a0dbe28fe49987ea3fef36661a2/f97d7/2020-08-31-jpa-transactional-test-runtimeexception.png 2000w,\n/static/1bfd2a0dbe28fe49987ea3fef36661a2/49142/2020-08-31-jpa-transactional-test-runtimeexception.png 3000w,\n/static/1bfd2a0dbe28fe49987ea3fef36661a2/fa486/2020-08-31-jpa-transactional-test-runtimeexception.png 3130w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>실제로 프로덕션이 서비스 될 때는 <strong>런타임에 <code class=\"language-text\">LazyInitializationException</code>이 발생</strong>하는 것을 볼 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1010px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 88.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAADTElEQVR42p1TTXPbNhT0tU1jkQAIguIH+CWSMi1RkinJqpPG6UzadOK4aRNPmmuP/f/37ZJSEnd6y2GFJwF62Le7OFv1Am3nIrYSJpAIpgrGKEj5bTi73LhoVw7KxoUtBNJ8giiewHW/seFVq7GsPRShRm58zKoGVTVHyO9KeSOGg5/r/0EOeNSwCAwWjYcy0SgCH0VRsWEDXysIV5CpgBByXP8DIeAId1yH/S8NhdS4WE1Qtg5s6SKvniArvsd8nmG17rHsOiSJxXa7w2azwXq1Rr/t0c4vcV0e0Jd7zLgvpTg1FAqrPMCz2qCbxTj8eMCuX6PKMhgd0CADz9PQvg+tjzAmgO8b7hv4XgDt6S/SkKFCNTVYxQazOMFF22HeXKCNFyjDDI7jwKNBihcLjjeZOHAdd/x9qAc4rjtibDh8hFZgmgpE1kEUilHHWVUhIBPHSDxJJb7T/APZpFnBaMVIbMpzJbI8h50WNLUgS3kceTn3sGs9LOl43zd4/uwGL1/+jA01LOsIn+4t/r5L8c9vMzzvL1GnCTbdArv9Na4PB2wuWvR1SmlOI8d6iIxGSE2SJEUcTxFHMTKyyZMIt22IX9YJXl1ZZJHheQkb8gzNOJ7XCHxnjNCZpJhN7OMyYXwqgd3SwaJUWKcGdWbRLjqkZY2LxRphEmLCsVxO5bhy1PIYo0HfkylKKQTMX0NT1nR7V/eY2xrLRYt9v4HxNaZBgHBKx+m08j6HmkbR3SEBynsU7GHT0R6e8sZz3vSDI3DuKDw9HyDHegT3Jo746izZfa2ZQXFqOIycBxpV5COljnXEV2MnaIoJ5oWLJnNQ0/nSl9TToqnnqOua+uZcGz6AlnUMqR8xTEOD33OFP0uN+3KGh7bBX4sG77oMH64tHuj8h22H9zdb3F/myGmWTbMxNkUxg7URXI+ajg354SqNfZHiTd/hzfYavy6v8Hq1w/3+gD9uDni9LNjI4rYM0XkO5MkMwTAL1opveUpiIXE2PBvXeLiKItzlGe7KFC9sjE+zFLd0+S2DexMFeEVJXvBF/TSd4i4O8Zb4SGZDfUPDHhivd0zBmfFpOVn6krcQIeGL4yrJQhF63FfwThjqkG7HZGQITcf9YZUK/wKO7+LR+u1hXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2020 08 31 jpa transactional test lazyload point\" title=\"\" src=\"/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png\" srcset=\"/static/3542755036e74e484dbc2684255d3798/0eb09/2020-08-31-jpa-transactional-test-lazyload-point.png 500w,\n/static/3542755036e74e484dbc2684255d3798/1263b/2020-08-31-jpa-transactional-test-lazyload-point.png 1000w,\n/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png 1010w\" sizes=\"(max-width: 1010px) 100vw, 1010px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p><code class=\"language-text\">LazyInitailizationException</code>이 발생하는 이유는 실제 <strong>서비스 코드에서는 <code class=\"language-text\">@Transactional</code> 이 없기 때문에 영속성 컨텍스트가 존재하지 않아서 Lazy Loading이 불가능</strong>하지만, <strong>테스트 코드는 <code class=\"language-text\">@Transactional</code> 이 존재하기 때문에 영속성 컨텍스트가 존재하면서 Lazy Loading이 가능</strong>했기 때문이다.</p>\n<p>따라서 서비스 코드에는 <code class=\"language-text\">@Transactional</code> 을 이용하지 않고 테스트 코드에만 <code class=\"language-text\">@Transactional</code> 을 이용한다면 <strong>개발자의 실수로 런타임에서만 <code class=\"language-text\">LazyInitailizationException</code>이 발생</strong>하는 문제가 생길수 있다.</p>\n<p>그렇다면 서비스 코드에만 <code class=\"language-text\">@Transactional</code> 을 이용하고 테스트에서는 어떻게 하는 게 좋을까?</p>\n<p>필자는 테스트 코드에 <code class=\"language-text\">@AfterEach</code> 메서드를 만들고 직접 연관된 <code class=\"language-text\">JpaRepository</code>를 이용해서 <code class=\"language-text\">deleteAll()</code> 하는 것을 추천한다.<br>\n이렇게 하면 테스트 코드에서는 영속성 컨텍스트를 직접 관리하지 않기 때문에 위와 같은 오류를 방지할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@AfterEach</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">tearDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cellPhoneRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 테스트 코드에서 <code class=\"language-text\">@Transactional</code> 을 제거하고 난 뒤 한 가지 더 주의할 점이 남아있다.</p>\n<p>위 테스트 코드에서 <code class=\"language-text\">@Transactional</code> 을 제거하고 테스트를 수행하면 테스트가 통과하지 못한다.</p>\n<p>이는 테스트 코드에서 Lazy loading 을 사용했기 때문이다. 이전 코드에서는 <code class=\"language-text\">@Transactional</code> 로 인해 테스트 코드 전체에 영속성 컨텍스트가 존재하면서 Lazy loading 이 가능했지만 이제 <code class=\"language-text\">@Transactional</code> 이 불가능해졌기 때문이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d8686355294eab65c0932ae228efa36/c822d/2020-08-31-jpa-transactional-test-testfail-lazyload.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVR42n2S2W7TUBCGncRrHMexHe9rYsdxllalDQUBQkjcIR6B93+Nj4kbKlEkLj7NnPGZ/8xiJUtT6k3JcOwosoQoEsKQOEmJ4oggWP/Feh2OvI3/QbkmplnBvh/Y1C1FU5MVKVWzIStzfN8XAoIrN8Hwf4JlLBVmFfumpy1r9vWWTsR2IpynGaFUHCfZWHngr/GDcMQT/y2BxJUuDenyhMt5z2O/42nX87BruAxbzm3Brkjoq5RBbJsENHFAl6xpIp9a/I2wvVk/9FHumk/c1x8Yond09TPD8IVT/4199ZmT954H94HD8pGj+/SCd+Es8dNoL9z7z9wJp9WFwb+g9NFXPva/6NKfxIsf7PPvHLuDtL2Ttg9s8pYh31JEFXlcEwc5gRuP+MuI1WLNcu6ztDyMqYUyt1zU6QJNdZkoNqbh0kvrVVXKYkpZUEYch+ShJzPyWPkrmdeKpevgCLqpo+oqmq6hKAqKbdujM5lMRqtpGkWeE0cRpdhErGVamLqOK0m2aY53xpwb01dEYzabvSjfUFWV0gu4k1+gM0xaQyeQO9Z0xmKmjr6jaiy06wMGS7ljy3ku303hH8GZphLZDq3tUmlzGlunciZsZIPHrieXh1zLxpkvZH4OK09mZxivGr8Bfor5GGfDTGwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 08 31 jpa transactional test testfail lazyload\"\n        title=\"\"\n        src=\"/static/3d8686355294eab65c0932ae228efa36/f97d7/2020-08-31-jpa-transactional-test-testfail-lazyload.png\"\n        srcset=\"/static/3d8686355294eab65c0932ae228efa36/0eb09/2020-08-31-jpa-transactional-test-testfail-lazyload.png 500w,\n/static/3d8686355294eab65c0932ae228efa36/1263b/2020-08-31-jpa-transactional-test-testfail-lazyload.png 1000w,\n/static/3d8686355294eab65c0932ae228efa36/f97d7/2020-08-31-jpa-transactional-test-testfail-lazyload.png 2000w,\n/static/3d8686355294eab65c0932ae228efa36/49142/2020-08-31-jpa-transactional-test-testfail-lazyload.png 3000w,\n/static/3d8686355294eab65c0932ae228efa36/c822d/2020-08-31-jpa-transactional-test-testfail-lazyload.png 3194w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>해결 방법은 간단하다.</p>\n<p>Lazy loading 하도록 Entity를 가져오던 쿼리를 fetch join으로 바꿔주면 더 이상 Lazy loading이 필요하지 않게 되면서 정상적으로 테스트 코드가 통과할 것이다.</p>\n<h2>그렇다면 테스트 코드에서는 <code class=\"language-text\">@Transactional</code> 은 사용하지 말아야 하는가?</h2>\n<p>결론부터 말하자면 ’<strong>그렇지 않다.</strong>‘이다.</p>\n<p>실제로 <code class=\"language-text\">@DataJpaTest</code> 와 같은 테스트 의존성 주입 메서드를 보면 <code class=\"language-text\">@Transactional</code> 가 이미 같이 붙어있는 것을 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 888px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSklEQVR42oVT23aaUBDlCxI4HG5GbUiiyP2OiDHte9un/v+37O5Bk67WpHmYNbNENvsyY6SFxi67RZ57GPo9DocDuq5H07ZIwwKH7YDAs2ArB67jQmsHtq0/LKNoTWSVhV1qoSgX+Pb1iHF/wDgezuBthyIV4COm6IR6E0PZJl9+H9jIahNJrpAUFruJIHDhOB6LjFx214Xn+nA1Z81nZKiUPZcAqH8BUwKlpYU4s7DZKf6o+JL99get9Qxu63PJx0S61Ntzfe4XydbMLs4U6t5EWijKjCn5iOfnE/bDiIEl0vuuwzRN9HhAVTd4Pr0gjnZo7j10G59KCJhTcppbKAmclzfo2wT7/Z5/ngjUE7hH17fIwyVekhUe1y7lanhk5LnXPhoJA3lKFSKCyhzRz7g8e1o1LruHur5jUCOOZBcnGaJwjZc0RPUUzFK92YoL4FSamBoTQ2Zi5DwWJupY4Wl7S5nZLF1kt5QsyZdlNfeqavjBDtv7FcZHH8k9PaX3xi/K/NHc4Gd9g+8ys04rc/6yZUk4kqj6k+olYctSfyX9mrYx0MOBKbdMeaDkngxb7qZI9gMBfX+BP1pwI774tqWPMRPe0su0Oq+SlOfr2Z+PgK8XW14kSMxLkVl6IqBkKBckqyRXFCxsLrqeE/4vYN7w7HI5PcpkKDLHlx4xnG3CgCLFe1cz6KeAbemiLWxk2YLdQ5Vo1KmDjDYIQ2G7uLPhU7rnXJ/a9R4uGfnSwyZ8QPZliZRzsQ4Qrh08bGR9yJJMwweFhf85w9+FtJeFpI93uwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2020 08 31 jpa transactional test datajpatest\" title=\"\" src=\"/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png\" srcset=\"/static/9dff0d93bec7fa9df7cca61db2ba0303/0eb09/2020-08-31-jpa-transactional-test-datajpatest.png 500w,\n/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png 888w\" sizes=\"(max-width: 888px) 100vw, 888px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>지금까지 서비스 레이어에 대한 테스트 코드에서 <code class=\"language-text\">@Transactional</code> 을 사용하지 말라는 식으로 이야기를 했는데 스프링에서 제공하는 <code class=\"language-text\">@DataJpaTest</code> 애너테이션은 <code class=\"language-text\">@Transactional</code> 을 제공하고 있는 모습을 보인다.</p>\n<p><code class=\"language-text\">@DataJpaTest</code> 애너테이션은 서비스 레이어를 위한 테스트 애너테이션이 아니다. 단순히 JPA 구성요소들을 위한 테스트이다.</p>\n<blockquote>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/orm/jpa/DataJpaTest.html\">Spring @DataJpaTest docs</a></p>\n<p>…</p>\n<p>Annotation for a JPA test that focuses <strong>only</strong> on JPA components.</p>\n<p>Using this annotation will disable full auto-configuration and instead apply only configuration relevant to JPA tests.</p>\n<p>By default, tests annotated with <code class=\"language-text\">@DataJpaTest</code> are transactional and roll back at the end of each test. They also use an embedded in-memory database (replacing any explicit or usually auto-configured DataSource). The <a href=\"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/jdbc/AutoConfigureTestDatabase.html\"><code class=\"language-text\">@AutoConfigureTestDatabase</code></a> annotation can be used to override these settings.</p>\n<p>…</p>\n</blockquote>\n<p>단순히 <code class=\"language-text\">JpaRepository</code> 의 기능을 테스트 하기 위해서라면 <code class=\"language-text\">@DataJpaTest</code> 를 이용하여 <code class=\"language-text\">@Transactional</code> 의 rollback 기능을 사용하는 것은 큰 문제가 없다.</p>\n<h2>결론</h2>\n<p>테스트 코드를 작성하면서 일일이 생성되었던 데이터를 지우는 것은 여간 귀찮은 작업이 아니다. 하지만 그러한 귀찮음을 해결하기 위해 <code class=\"language-text\">@Transactional</code> 을 사용했다가 더 큰 문제를 발생하게 되는 경우가 생길 수 있으니 언제나 상황에 맞게 올바르게 사용하는 것이 중요하다.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스 레이어("},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":")에 대해 테스트를 한다면 보통 DB와 관련된 테스트 코드를 작성하게 된다. 이러면 테스트 메서드 내부에서 사용했던 데이터들이 그대로 남아있게 되어서 실제 서비스에 영향을 미칠 수 있기 때문에 테스트가 끝나면 지워야 할 필요가 있다. 이러한 문제를 해결하기 위해 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Sql"}]},{"type":"text","value":" 애너테이션을 이용해서 직접 DB를 Truncate하는 Query를 직접 작성하는 방법도 있고, 테스트 메서드에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 애너테이션을 이용해서 테스트 메서드가 종료될 때 테스트 메서드 내부에서 생성했던 데이터를 rollback하는 방법도 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Sql"}]},{"type":"text","value":" 작성은 관련된 DB의 Truncate Query를 직접 작성해야하고 관련된 Table이 증가할 때마다 Query도 같이 수정해야 하는 번거로움이 있다. 반면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 은 클래스 혹은 메서드에 명시하는 것 만으로 손쉽게 관련된 Table의 데이터를 rollback 할 수 있기 때문에 굉장히 편리하다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d2ff0aad2f3ac514b94c87823ac7ce58/ce491/2020-08-31-jpa-transactional-test-definition.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 12.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoklEQVR42k2J6w6CMBhDef/nQ8bGbdw2QILABiqM1A9MjD9O2tN6aZqCMwYehpBZhow8FgIhbafv24bD7YS70u3U9+1ydxw4/nC0efdEoI8YOhGgCW8/Wv51FfgEp5+h8m/QgUDHGXQSQTcN2raF1hoNdaUUvLjuIfUAqQYUeYGyyJFLeVFXJVa7Yny8sNgFZl4xj2/qT8zTBGstjDFXTuQnH+QT38lWRGofAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test definition","title":"","src":"/static/d2ff0aad2f3ac514b94c87823ac7ce58/f97d7/2020-08-31-jpa-transactional-test-definition.png","srcSet":["/static/d2ff0aad2f3ac514b94c87823ac7ce58/0eb09/2020-08-31-jpa-transactional-test-definition.png 500w","/static/d2ff0aad2f3ac514b94c87823ac7ce58/1263b/2020-08-31-jpa-transactional-test-definition.png 1000w","/static/d2ff0aad2f3ac514b94c87823ac7ce58/f97d7/2020-08-31-jpa-transactional-test-definition.png 2000w","/static/d2ff0aad2f3ac514b94c87823ac7ce58/ce491/2020-08-31-jpa-transactional-test-definition.png 2830w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#testcontext-tx-rollback-and-commit-behavior"},"children":[{"type":"text","value":"Transcation Rollback and Commit Behavior"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같이 테스트에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"을 이용한다면 쉽게 rollback이 돼서 테스트 코드에 사용한 데이터를 관리하기 쉽다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 JPA를 사용하는 환경에서 단순히 rollback을 위해서 테스트 코드를 작성한다면 주의해야 할 점이 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"예제"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"예시를 위한 코드를 먼저 살펴보도록 하자."},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n아래는 1:N 관계를 가진 Member(사용자), CellPhone(핸드폰) Entity이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1612px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 71.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVR42pWTW08aURSFfReZO7TKcAkOUKIMYokBhRnud4e7MdJK0zTpQ///69czmDRVodCHldnn5Jwva68950jTdN5JUVEkBVl+keKv32jrPaGjtxuqOByOJjDTaVKWhWWliMcTrxSLxQmFQqjqHqBuGMiBE6xajerzlPFoyL03xnFdqo7zR45QJGJudfoKaOgGgYBKrZLg57JMszWi7LiUKlXKVZeb2ztavT7j2Zxz09x082+gcHh8rNKuJ/n1VGI6WzGaTqm3OjS7fQEbMJkvmSweiJrR/Q51XScoaeRzUe6bRUplh1any11VtOrWcWsN2t0ebr0hMgyLDLX9Q9GFJFnHjMQwNrUiXAc2bgIiX1NkF/ZhOyb9DqiJHFVZJlm8oVi5JXdxiW3bFAoFstksuVyO04+nSAKoHgrUggr2ckRj2ccbeniTCYPhUEzYpd3ukDy3SGoaH0Tm6t6WRY4BKcRqEGPtubjNPpVaHafRotHpMX94xEpnMEQU/l+hHQQMGqzmKX4smjx++c7T8xpvthD1V1brb6Qzn8TwZHHWOGwoiqKTv4xxbWex8wVydh4rlSF/VeDq+jNnZ5Gdz+9o26YPDQZVToKy+EpIQrL8UvtS/+ct/92639I27brjA38DeYF/ub0IMjYAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test class diagram","title":"","src":"/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png","srcSet":["/static/a7df90bfb99e70319162362aab609c69/0eb09/2020-08-31-jpa-transactional-test-class-diagram.png 500w","/static/a7df90bfb99e70319162362aab609c69/1263b/2020-08-31-jpa-transactional-test-class-diagram.png 1000w","/static/a7df90bfb99e70319162362aab609c69/f0f3e/2020-08-31-jpa-transactional-test-class-diagram.png 1612w"],"sizes":"(max-width: 1612px) 100vw, 1612px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" name"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@OneToMany"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"mappedBy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"member\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" fetch "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FetchType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"LAZY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"List"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" cellPhones "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ArrayList"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" name"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"name "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" name"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"buyCellphone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"text","value":" cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"cellPhones"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"add"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"placeMember"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ManyToOne"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"fetch "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FetchType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"LAZY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"phoneNumber "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"placeMember"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"member "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그리고 서비스 코드이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequiredArgsConstructor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PhoneService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"MemberRepository"}]},{"type":"text","value":" memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhoneRepository"}]},{"type":"text","value":" cellPhoneRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"buyNewCellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" memberId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" member "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findById"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"memberId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"RuntimeException"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"::"}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        cellPhoneRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByPhoneNumber"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ifPresent"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"cellPhone "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throw"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"RuntimeException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"이미 존재하는 휴대전화 번호입니다.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"text","value":" cellPhone "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"buyCellphone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        cellPhoneRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"마지막으로 테스트 코드이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@SpringBootTest"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PhoneServiceTest"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PhoneService"}]},{"type":"text","value":" phoneService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"MemberRepository"}]},{"type":"text","value":" memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Test"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"buyNewCellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//given"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" member "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"비밥\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" phoneNumber "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"010-1234-5678\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//when"}]},{"type":"text","value":"\n        phoneService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"buyNewCellPhone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//then"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Member"}]},{"type":"text","value":" buyMember "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findById"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"member"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"RuntimeException"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"::"}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CellPhone"}]},{"type":"text","value":" cellPhone "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" buyMember"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getCellPhones"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"get"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"assertThat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"cellPhone"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getPhoneNumber"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"isEqualTo"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"phoneNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테스트 코드에는 rollback을 위해 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 애너테이션이 사용되고 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d2e26aad5a8ff297f128b2855e28665b/9c658/2020-08-31-jpa-transactional-test-test-roll-back.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 25.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVR42jWP226CUBREASUSLkVFBEFUruGgNFobr22a9Pbc9gf6/1+xeiTpw2TtTCaT2cq9+OJ0+KUVP6zzb7bTVw7LN/bhE9vwmWZ8pHL2kic23pnz9MqL9C/eiXf/zGd45UPqOHykdvcowztB5F+YOA+Y2hbPrVlkMVm5IKtWJKuYcB4QL2dESUiaLyikn2Zz1tWSRubWRcIsHDOZeiimaaEoCqqqduxpGsk8QdSCPMvJ05yiKDulq5RGNPKuyPOCWt6ZZDiLsEybKIpRDGMgi1RZqElq9Hp9yrJkt9vRti1CCDabDU3TdLypruvOX0uvktlbPggCWRih6H2nW/YvTS50HAfP8/B9n9FoxHgs35lMOrqui2VZ2LaNYRgMBgNM00TX9S77B7sJhSV4LNVcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test test roll back","title":"","src":"/static/d2e26aad5a8ff297f128b2855e28665b/f97d7/2020-08-31-jpa-transactional-test-test-roll-back.png","srcSet":["/static/d2e26aad5a8ff297f128b2855e28665b/0eb09/2020-08-31-jpa-transactional-test-test-roll-back.png 500w","/static/d2e26aad5a8ff297f128b2855e28665b/1263b/2020-08-31-jpa-transactional-test-test-roll-back.png 1000w","/static/d2e26aad5a8ff297f128b2855e28665b/f97d7/2020-08-31-jpa-transactional-test-test-roll-back.png 2000w","/static/d2e26aad5a8ff297f128b2855e28665b/49142/2020-08-31-jpa-transactional-test-test-roll-back.png 3000w","/static/d2e26aad5a8ff297f128b2855e28665b/9c658/2020-08-31-jpa-transactional-test-test-roll-back.png 3212w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 테스트 코드는 정상적으로 통과한다. 또한 테스트에서 생성되었던 데이터들도 성공적으로 rollback이 되는 것을 확인할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 개발자의 서비스 코드의 메서드에서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 깜빡하고 사용하지 않고 테스트 코드에서만 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"을 사용한다면 어떻게 될까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1448px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEUklEQVR42o1VaXPiRhQUvitZG9A9ug/EJRASYFj5BGfXVandijeV/P+/0ukR4F0nriQfWnNUTU+/9/qNFNt1kWY2ykpDmqiIIgtRbCMIbZimAV3fQ3sLTdPfhWKlAYLAwcC34FsGQi9A2hsgjlJYXLfbHXS63Ve0u1yrXaia9j6h74XoaiZCQZVUNvF1TPsJrtcfUdc1lqtrlKM51lndYJWtkboJbFPsSYw3UFxPwLV09BwDeeRgHAlM4hj9OEMSZUxDygg8BLaH2AmRuBEi4cPSdSptk6QLTf8OxdC36Km3uLXWqKMn1OFn3M1jjMpz6PkJROzD1rbwvS1s6wFCbOEQUfAZkf8JaqfG5U83uNpDcZ0Cupqhp8XI4hL93gKz1RRl3cd6VeB+eY96+gWr6hnz8hesZzcoi0cMsiVcMYbGs932dyhB4EI1NGSWisCyETKsQThCns7Qj0aY5DnynOM0x4C5zTMWLQ5hmRo6HYbMAv0YtuK6PkxLwDctDIVHwhR5L8e6WKIYjqhyhapaoD+cIEkSRFmKdJjBoTM0m4UQBN2g6fuiOI5LQhuCSHQVH9ptGNI+QkfqmLRPhDTN6M0EHi11Zbdx5VNNbMLoWdAzIuDc2HmTIYc0sAXNsDB26ce0R3PHiEngksCzTQS+zz1WNwrRS2X1Y5issqrSNgccfCgJDcOkUQ0U/T4erxcYTyZYLBYoihwl81fNiiZvQRAw7BRRSBHGjkD/u7FlyJJQp0rfdFA6MY1LFSKFb4dUSu9RbY/5M3QNV23ZMSoF/JNs1yl+QF+xb23mgu7PhYttmKD2I1QM+SGOcBfuR8/BPdNSO6JByTP3HCUC5rC7U+hAsOy2ylvZt37nCgGxopVqotJULIWF0jKxcQW2JL3l+EA87tehyQiZU41Qrid3SGcbzB6+oiQ+bn7D48OvmG9esH76htHiiXYaY+hMiCkywZHoi5yYILNz9PbIuMfXxsf05Q9cv/yJcvOM/s0G5XwFf7LA6PEZ409fsWK3BHGKoipxs75jxyxQDSJMBxnyUYEkZKGCBKEfM2TbQRAFmNcVnrfPuKkfcD+Zom+7ECySZTgoBjFmJBiMRqz+vEFZVajmnC+lGwrM6Yol54rGd01RFLROW0yq2uRBYz4vTk+bfYmzIwUfzk/ZABZNnjaQXSNtJP3p06cxvSn3lC4fzaOjI7RarVeC5gKuD1CUFs7OzmmhmG1YoSzLRtWEfp3NZhiPx5hTrdxXLi8vG8I3JD8Qv6o8O4PL38V0OsVwOGxU9tkIWZY1F+V8RCRxYxvlHYL3CD3Paw6H7BQ5l5CXSI7DWmk+/4PwlDmVRDLMEYsj1RzmMneDwWCn8OL8AsfHxwyz9a+EJycnTREOIcvDEkKIxtS2bTdqFRnKIYf/pVAelKSyqruHImnm8umSxBLKrfWN/fk71toX/Hzc2RO03iWUuZKFkESyKLIgcq/dlj8rrcFfRDaWPvVcw1YAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test service except transactional","title":"","src":"/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png","srcSet":["/static/a66dfa2ffeb742c693aa736c8a9c22c8/0eb09/2020-08-31-jpa-transactional-test-service-except-transactional.png 500w","/static/a66dfa2ffeb742c693aa736c8a9c22c8/1263b/2020-08-31-jpa-transactional-test-service-except-transactional.png 1000w","/static/a66dfa2ffeb742c693aa736c8a9c22c8/e7c3c/2020-08-31-jpa-transactional-test-service-except-transactional.png 1448w"],"sizes":"(max-width: 1448px) 100vw, 1448px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테스트 코드는 통과하지만"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/1bfd2a0dbe28fe49987ea3fef36661a2/fa486/2020-08-31-jpa-transactional-test-runtimeexception.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 25.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVR42mWQ227CMAxAO6ColSbRe0p6SUMupREb0/7/385SHsfDkW3ZOracDOOIXhS6F8xth7z2yGGgaFtE26D6jqmuMHWNFR1tVdHEXhPrpmnouo465nvM85ykl5LfsPG8LdzHK3qQiKtkHmfMoFiEZIqLxC4oS7Is43w+v5GmKcfjkaS4XDDWRCzaWLzTBFVilEDdPNY6zDygtcY6jxCCw+HwIkmSd8q4NYQQRY7tfidEVm94WMlzyvmeMh7TJ24WOO9RStH3PUVRcjqd3oVV/Mm2bbgoXNeVsOd+ZfOa55zzIz/4kiledXEusCzLi/0IGd/1X/gHZJt+LrgqS/0AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test runtimeexception","title":"","src":"/static/1bfd2a0dbe28fe49987ea3fef36661a2/f97d7/2020-08-31-jpa-transactional-test-runtimeexception.png","srcSet":["/static/1bfd2a0dbe28fe49987ea3fef36661a2/0eb09/2020-08-31-jpa-transactional-test-runtimeexception.png 500w","/static/1bfd2a0dbe28fe49987ea3fef36661a2/1263b/2020-08-31-jpa-transactional-test-runtimeexception.png 1000w","/static/1bfd2a0dbe28fe49987ea3fef36661a2/f97d7/2020-08-31-jpa-transactional-test-runtimeexception.png 2000w","/static/1bfd2a0dbe28fe49987ea3fef36661a2/49142/2020-08-31-jpa-transactional-test-runtimeexception.png 3000w","/static/1bfd2a0dbe28fe49987ea3fef36661a2/fa486/2020-08-31-jpa-transactional-test-runtimeexception.png 3130w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실제로 프로덕션이 서비스 될 때는 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"런타임에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"LazyInitializationException"}]},{"type":"text","value":"이 발생"}]},{"type":"text","value":"하는 것을 볼 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1010px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 88.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAADTElEQVR42p1TTXPbNhT0tU1jkQAIguIH+CWSMi1RkinJqpPG6UzadOK4aRNPmmuP/f/37ZJSEnd6y2GFJwF62Le7OFv1Am3nIrYSJpAIpgrGKEj5bTi73LhoVw7KxoUtBNJ8giiewHW/seFVq7GsPRShRm58zKoGVTVHyO9KeSOGg5/r/0EOeNSwCAwWjYcy0SgCH0VRsWEDXysIV5CpgBByXP8DIeAId1yH/S8NhdS4WE1Qtg5s6SKvniArvsd8nmG17rHsOiSJxXa7w2azwXq1Rr/t0c4vcV0e0Jd7zLgvpTg1FAqrPMCz2qCbxTj8eMCuX6PKMhgd0CADz9PQvg+tjzAmgO8b7hv4XgDt6S/SkKFCNTVYxQazOMFF22HeXKCNFyjDDI7jwKNBihcLjjeZOHAdd/x9qAc4rjtibDh8hFZgmgpE1kEUilHHWVUhIBPHSDxJJb7T/APZpFnBaMVIbMpzJbI8h50WNLUgS3kceTn3sGs9LOl43zd4/uwGL1/+jA01LOsIn+4t/r5L8c9vMzzvL1GnCTbdArv9Na4PB2wuWvR1SmlOI8d6iIxGSE2SJEUcTxFHMTKyyZMIt22IX9YJXl1ZZJHheQkb8gzNOJ7XCHxnjNCZpJhN7OMyYXwqgd3SwaJUWKcGdWbRLjqkZY2LxRphEmLCsVxO5bhy1PIYo0HfkylKKQTMX0NT1nR7V/eY2xrLRYt9v4HxNaZBgHBKx+m08j6HmkbR3SEBynsU7GHT0R6e8sZz3vSDI3DuKDw9HyDHegT3Jo746izZfa2ZQXFqOIycBxpV5COljnXEV2MnaIoJ5oWLJnNQ0/nSl9TToqnnqOua+uZcGz6AlnUMqR8xTEOD33OFP0uN+3KGh7bBX4sG77oMH64tHuj8h22H9zdb3F/myGmWTbMxNkUxg7URXI+ajg354SqNfZHiTd/hzfYavy6v8Hq1w/3+gD9uDni9LNjI4rYM0XkO5MkMwTAL1opveUpiIXE2PBvXeLiKItzlGe7KFC9sjE+zFLd0+S2DexMFeEVJXvBF/TSd4i4O8Zb4SGZDfUPDHhivd0zBmfFpOVn6krcQIeGL4yrJQhF63FfwThjqkG7HZGQITcf9YZUK/wKO7+LR+u1hXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test lazyload point","title":"","src":"/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png","srcSet":["/static/3542755036e74e484dbc2684255d3798/0eb09/2020-08-31-jpa-transactional-test-lazyload-point.png 500w","/static/3542755036e74e484dbc2684255d3798/1263b/2020-08-31-jpa-transactional-test-lazyload-point.png 1000w","/static/3542755036e74e484dbc2684255d3798/08990/2020-08-31-jpa-transactional-test-lazyload-point.png 1010w"],"sizes":"(max-width: 1010px) 100vw, 1010px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"LazyInitailizationException"}]},{"type":"text","value":"이 발생하는 이유는 실제 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"서비스 코드에서는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 이 없기 때문에 영속성 컨텍스트가 존재하지 않아서 Lazy Loading이 불가능"}]},{"type":"text","value":"하지만, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"테스트 코드는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 이 존재하기 때문에 영속성 컨텍스트가 존재하면서 Lazy Loading이 가능"}]},{"type":"text","value":"했기 때문이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"따라서 서비스 코드에는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 이용하지 않고 테스트 코드에만 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 이용한다면 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"개발자의 실수로 런타임에서만 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"LazyInitailizationException"}]},{"type":"text","value":"이 발생"}]},{"type":"text","value":"하는 문제가 생길수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그렇다면 서비스 코드에만 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 이용하고 테스트에서는 어떻게 하는 게 좋을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"필자는 테스트 코드에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@AfterEach"}]},{"type":"text","value":" 메서드를 만들고 직접 연관된 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"JpaRepository"}]},{"type":"text","value":"를 이용해서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"deleteAll()"}]},{"type":"text","value":" 하는 것을 추천한다."},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n이렇게 하면 테스트 코드에서는 영속성 컨텍스트를 직접 관리하지 않기 때문에 위와 같은 오류를 방지할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"text","value":"    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@AfterEach"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tearDown"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        cellPhoneRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"deleteAll"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        memberRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"deleteAll"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 테스트 코드에서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 제거하고 난 뒤 한 가지 더 주의할 점이 남아있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 테스트 코드에서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 제거하고 테스트를 수행하면 테스트가 통과하지 못한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이는 테스트 코드에서 Lazy loading 을 사용했기 때문이다. 이전 코드에서는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 로 인해 테스트 코드 전체에 영속성 컨텍스트가 존재하면서 Lazy loading 이 가능했지만 이제 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 이 불가능해졌기 때문이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3d8686355294eab65c0932ae228efa36/c822d/2020-08-31-jpa-transactional-test-testfail-lazyload.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVR42n2S2W7TUBCGncRrHMexHe9rYsdxllalDQUBQkjcIR6B93+Nj4kbKlEkLj7NnPGZ/8xiJUtT6k3JcOwosoQoEsKQOEmJ4oggWP/Feh2OvI3/QbkmplnBvh/Y1C1FU5MVKVWzIStzfN8XAoIrN8Hwf4JlLBVmFfumpy1r9vWWTsR2IpynGaFUHCfZWHngr/GDcMQT/y2BxJUuDenyhMt5z2O/42nX87BruAxbzm3Brkjoq5RBbJsENHFAl6xpIp9a/I2wvVk/9FHumk/c1x8Yond09TPD8IVT/4199ZmT954H94HD8pGj+/SCd+Es8dNoL9z7z9wJp9WFwb+g9NFXPva/6NKfxIsf7PPvHLuDtL2Ttg9s8pYh31JEFXlcEwc5gRuP+MuI1WLNcu6ztDyMqYUyt1zU6QJNdZkoNqbh0kvrVVXKYkpZUEYch+ShJzPyWPkrmdeKpevgCLqpo+oqmq6hKAqKbdujM5lMRqtpGkWeE0cRpdhErGVamLqOK0m2aY53xpwb01dEYzabvSjfUFWV0gu4k1+gM0xaQyeQO9Z0xmKmjr6jaiy06wMGS7ljy3ku303hH8GZphLZDq3tUmlzGlunciZsZIPHrieXh1zLxpkvZH4OK09mZxivGr8Bfor5GGfDTGwAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test testfail lazyload","title":"","src":"/static/3d8686355294eab65c0932ae228efa36/f97d7/2020-08-31-jpa-transactional-test-testfail-lazyload.png","srcSet":["/static/3d8686355294eab65c0932ae228efa36/0eb09/2020-08-31-jpa-transactional-test-testfail-lazyload.png 500w","/static/3d8686355294eab65c0932ae228efa36/1263b/2020-08-31-jpa-transactional-test-testfail-lazyload.png 1000w","/static/3d8686355294eab65c0932ae228efa36/f97d7/2020-08-31-jpa-transactional-test-testfail-lazyload.png 2000w","/static/3d8686355294eab65c0932ae228efa36/49142/2020-08-31-jpa-transactional-test-testfail-lazyload.png 3000w","/static/3d8686355294eab65c0932ae228efa36/c822d/2020-08-31-jpa-transactional-test-testfail-lazyload.png 3194w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해결 방법은 간단하다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lazy loading 하도록 Entity를 가져오던 쿼리를 fetch join으로 바꿔주면 더 이상 Lazy loading이 필요하지 않게 되면서 정상적으로 테스트 코드가 통과할 것이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"그렇다면 테스트 코드에서는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 은 사용하지 말아야 하는가?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"결론부터 말하자면 ’"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"그렇지 않다."}]},{"type":"text","value":"‘이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실제로 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@DataJpaTest"}]},{"type":"text","value":" 와 같은 테스트 의존성 주입 메서드를 보면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 가 이미 같이 붙어있는 것을 확인할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 888px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 73.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSklEQVR42oVT23aaUBDlCxI4HG5GbUiiyP2OiDHte9un/v+37O5Bk67WpHmYNbNENvsyY6SFxi67RZ57GPo9DocDuq5H07ZIwwKH7YDAs2ArB67jQmsHtq0/LKNoTWSVhV1qoSgX+Pb1iHF/wDgezuBthyIV4COm6IR6E0PZJl9+H9jIahNJrpAUFruJIHDhOB6LjFx214Xn+nA1Z81nZKiUPZcAqH8BUwKlpYU4s7DZKf6o+JL99get9Qxu63PJx0S61Ntzfe4XydbMLs4U6t5EWijKjCn5iOfnE/bDiIEl0vuuwzRN9HhAVTd4Pr0gjnZo7j10G59KCJhTcppbKAmclzfo2wT7/Z5/ngjUE7hH17fIwyVekhUe1y7lanhk5LnXPhoJA3lKFSKCyhzRz7g8e1o1LruHur5jUCOOZBcnGaJwjZc0RPUUzFK92YoL4FSamBoTQ2Zi5DwWJupY4Wl7S5nZLF1kt5QsyZdlNfeqavjBDtv7FcZHH8k9PaX3xi/K/NHc4Gd9g+8ys04rc/6yZUk4kqj6k+olYctSfyX9mrYx0MOBKbdMeaDkngxb7qZI9gMBfX+BP1pwI774tqWPMRPe0su0Oq+SlOfr2Z+PgK8XW14kSMxLkVl6IqBkKBckqyRXFCxsLrqeE/4vYN7w7HI5PcpkKDLHlx4xnG3CgCLFe1cz6KeAbemiLWxk2YLdQ5Vo1KmDjDYIQ2G7uLPhU7rnXJ/a9R4uGfnSwyZ8QPZliZRzsQ4Qrh08bGR9yJJMwweFhf85w9+FtJeFpI93uwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 08 31 jpa transactional test datajpatest","title":"","src":"/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png","srcSet":["/static/9dff0d93bec7fa9df7cca61db2ba0303/0eb09/2020-08-31-jpa-transactional-test-datajpatest.png 500w","/static/9dff0d93bec7fa9df7cca61db2ba0303/8dc7d/2020-08-31-jpa-transactional-test-datajpatest.png 888w"],"sizes":"(max-width: 888px) 100vw, 888px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지금까지 서비스 레이어에 대한 테스트 코드에서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 사용하지 말라는 식으로 이야기를 했는데 스프링에서 제공하는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@DataJpaTest"}]},{"type":"text","value":" 애너테이션은 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 제공하고 있는 모습을 보인다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@DataJpaTest"}]},{"type":"text","value":" 애너테이션은 서비스 레이어를 위한 테스트 애너테이션이 아니다. 단순히 JPA 구성요소들을 위한 테스트이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/orm/jpa/DataJpaTest.html"},"children":[{"type":"text","value":"Spring @DataJpaTest docs"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"…"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Annotation for a JPA test that focuses "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":" on JPA components."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Using this annotation will disable full auto-configuration and instead apply only configuration relevant to JPA tests."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default, tests annotated with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@DataJpaTest"}]},{"type":"text","value":" are transactional and roll back at the end of each test. They also use an embedded in-memory database (replacing any explicit or usually auto-configured DataSource). The "},{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/jdbc/AutoConfigureTestDatabase.html"},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@AutoConfigureTestDatabase"}]}]},{"type":"text","value":" annotation can be used to override these settings."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"…"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"단순히 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"JpaRepository"}]},{"type":"text","value":" 의 기능을 테스트 하기 위해서라면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@DataJpaTest"}]},{"type":"text","value":" 를 이용하여 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 의 rollback 기능을 사용하는 것은 큰 문제가 없다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"결론"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테스트 코드를 작성하면서 일일이 생성되었던 데이터를 지우는 것은 여간 귀찮은 작업이 아니다. 하지만 그러한 귀찮음을 해결하기 위해 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" 을 사용했다가 더 큰 문제를 발생하게 되는 경우가 생길 수 있으니 언제나 상황에 맞게 올바르게 사용하는 것이 중요하다."}]}],"data":{"quirksMode":false}},"excerpt":"서비스 레이어()에 대해 테스트를 한다면 보통 DB…","timeToRead":4,"frontmatter":{"title":"JPA 사용시 테스트 코드에서 @Transactional 주의하기","userDate":"31 August 2020","date":"2020-08-31T12:00:00.000Z","tags":["jpa","transaction","test"],"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdElEQVR42mNgOJ9LEDGdz2M4m2F8s+vol3uL3p5a8u608fUuhit5DMRoBqMczgtFateaeS6VCF4sYbyWy7QkHKvmHIazOQznUAXPZTGcTmI4k8xwLJnhUDzjmUyG1aEYmoF6LuUz3CxiuF4EYpzLZQS6+VyW1JWajEcrTG92G17vdL09Re1qg+ODKaiaz+UwXM5n2JnI0OHOMDOQYW8KUD8zUPOZVM+70+/9fLPq/bnOl7vXfrx47NXNne+vYWi+VsDQ5saQbMKQYsrQ581wq5j5bC5Qs9fd6Ve+P5vz5ljni92L3p9ecHXP7c/Psfn5eCbIwUDG6WyGC0Bngzwse7VO/0ab2a0ei9t9QCR/o87iVi82zRfzoIwLMAbY24wn0hiOpzIcjWc4msBwNI3hVBqxUQW0nwno/tMZypfrFC/XM5zOYjpHdDyD0sm5dPNbvds/XSt6uh7oHZA4kZqZL+QDIzn50dKprw8tfHtS8ko1w7ksAB5fKoQsWUSsAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/806a28d15ff4c5569087f88920d1f19c/afa5c/jpa.png","srcSet":"/static/806a28d15ff4c5569087f88920d1f19c/0dee1/jpa.png 750w,\n/static/806a28d15ff4c5569087f88920d1f19c/8beaa/jpa.png 1080w,\n/static/806a28d15ff4c5569087f88920d1f19c/d079a/jpa.png 1366w,\n/static/806a28d15ff4c5569087f88920d1f19c/afa5c/jpa.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/806a28d15ff4c5569087f88920d1f19c/ba386/jpa.avif 750w,\n/static/806a28d15ff4c5569087f88920d1f19c/8adb1/jpa.avif 1080w,\n/static/806a28d15ff4c5569087f88920d1f19c/dc6b3/jpa.avif 1366w,\n/static/806a28d15ff4c5569087f88920d1f19c/031aa/jpa.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/806a28d15ff4c5569087f88920d1f19c/a66aa/jpa.webp 750w,\n/static/806a28d15ff4c5569087f88920d1f19c/65dd5/jpa.webp 1080w,\n/static/806a28d15ff4c5569087f88920d1f19c/4fad6/jpa.webp 1366w,\n/static/806a28d15ff4c5569087f88920d1f19c/c512e/jpa.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5625}}},"author":[{"name":"2기_비밥","bio":"우아한테크코스 2기 비밥(박찬인)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#482818","images":{"fallback":{"src":"/static/8c8a115e552db482996c8d9290335965/73bb6/bebob.jpg","srcSet":"/static/8c8a115e552db482996c8d9290335965/2f28c/bebob.jpg 40w,\n/static/8c8a115e552db482996c8d9290335965/499f6/bebob.jpg 80w,\n/static/8c8a115e552db482996c8d9290335965/73bb6/bebob.jpg 120w","sizes":"100vw"},"sources":[{"srcSet":"/static/8c8a115e552db482996c8d9290335965/e73fe/bebob.webp 40w,\n/static/8c8a115e552db482996c8d9290335965/61ca6/bebob.webp 80w,\n/static/8c8a115e552db482996c8d9290335965/507b0/bebob.webp 120w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}],"source":null}},"relatedPosts":{"totalCount":9,"edges":[{"node":{"id":"5ca7006a-db24-5be4-ab7b-c266396039b5","timeToRead":5,"excerpt":"JPA…","frontmatter":{"title":"JPA CascadeType.REMOVE vs orphanRemoval = true","date":"2021-08-15T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-15-jpa-cascadetype-remove-vs-orphanremoval-true/"}}},{"node":{"id":"e9c89353-6bd4-5c77-ae9d-f4985eedec42","timeToRead":5,"excerpt":"Spring Data JPA에서 Pageable 를 활용한 Pagination 의 개념과 방법을 알아본다. Pageable을 활용한 Pagination…","frontmatter":{"title":"Pageable을 이용한 Pagination을 처리하는 다양한 방법","date":"2021-08-15T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-15-pageable/"}}},{"node":{"id":"f5ad1928-7bd1-5ffd-8236-456b90bfaa40","timeToRead":6,"excerpt":"1. QueryDSL PostRepository.java Spring Data JPA가 기본적으로 제공해주는 CRUD 메서드 및 쿼리 메서드 기능을 사용하더라도, 원하는 조건의 데이터를 수집하기 위해서는 필연적으로 JPQL…","frontmatter":{"title":"Spring Boot에 QueryDSL을 사용해보자","date":"2021-08-08T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-08-basic-querydsl/"}}},{"node":{"id":"b36ac8ed-2f7a-5c86-922e-8cfced80305e","timeToRead":7,"excerpt":"1. Pagination 게시판 기능을 제공하는 웹 어플리케이션에 접속하여 게시물 목록을 요청하는 경우를 상상해봅시다. DB…","frontmatter":{"title":"JPA Pagination, 그리고 N + 1 문제","date":"2021-07-26T12:00:00.000Z"},"fields":{"slug":"/post/2021-07-26-jpa-pageable/"}}},{"node":{"id":"4c39987f-6043-59b5-b2b4-dce7f791bfbc","timeToRead":3,"excerpt":"이번 포스팅은 OSIV(Open Session In View)와 관련해서 개발 중 발생한 예외에 관해서 이야기 하고자 한다. 제목에서 있듯 OSIV와 HandlerInterceptor…","frontmatter":{"title":"OSIV와 Custom Interceptor를 같이 사용하기!","date":"2020-11-03T12:00:00.000Z"},"fields":{"slug":"/post/2020-11-03-osiv_with_interceptor/"}}}]}},"pageContext":{"slug":"/post/2020-08-31-jpa-transaction-test/","prev":{"excerpt":"…","timeToRead":3,"frontmatter":{"title":"자바 반복문 알고 쓰자!","tags":["loop"],"date":"2020-08-31T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABYUlEQVR42q2T23KCQAyGff+n6AP0LXpRqz1QrQLtSItatQqsoiIq+DfZcFg7Tq9k5p+ETPYjyYYGrvw0SueYA2EKzLbAlDRLgHkiMbUHVnuxi53kfG+A4RrwSWPyNwcDeCDYYAX0IlE/OvdZNltFVtWxvpHrLoWjgfOdBO0ggx1m6GubEyTXMSc6SZxkLXJ0FhJzCF7KJaVZARyt5UvNQYDWZ4T7jzkeh0tY1HvTC9D9SfE8jnFnT3BjKdx2KUYzsQson/Vi4FS27McSdKii12mioS0vwtMoRvtL4cEL0faVrrgXniiXQXWFfJbnWs3QLyrkNjuzVENYLzR5AQZU8Uq36RptmkC+vArIt9UjmDXZ4p0up5Rr+CxHXRYDeSMqIK/IW4hqJtKO6Yt1i+G7F4Bc1NnacIATbWNl/pMekarPnFVYPnztvMA8j2BXi9+jP1pS3pqWOTkC++zCn3KtX+8XSAKWHbpXSgUAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/d36d9359100fb8c088903b6b33899310/7fd08/loop.png","srcSet":"/static/d36d9359100fb8c088903b6b33899310/02626/loop.png 750w,\n/static/d36d9359100fb8c088903b6b33899310/bd00f/loop.png 1080w,\n/static/d36d9359100fb8c088903b6b33899310/fbd3b/loop.png 1366w,\n/static/d36d9359100fb8c088903b6b33899310/7fd08/loop.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/d36d9359100fb8c088903b6b33899310/bf0cd/loop.webp 750w,\n/static/d36d9359100fb8c088903b6b33899310/15fc6/loop.webp 1080w,\n/static/d36d9359100fb8c088903b6b33899310/2e603/loop.webp 1366w,\n/static/d36d9359100fb8c088903b6b33899310/24451/loop.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5802083333333333}}},"author":[{"name":"2기_둔덩","bio":"우아한테크코스 2기 둔덩(홍준성)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAgHAQn/xAAYAQADAQEAAAAAAAAAAAAAAAAEBQYAAv/aAAwDAQACEAMQAAAByu8fPPcVerlnDoaFbvArDgZSP//EABoQAQACAwEAAAAAAAAAAAAAAAUEBgIDBwH/2gAIAQEAAQUCHvlmrkw/ql6HSS7CpjMWYQHP5ir5axkaTp1SulPIE3mwWWWbhihP2Y//xAAnEQACAQIEBAcAAAAAAAAAAAABAgMEEQASE1EhIjEyBQYjJEFDcv/aAAgBAwEBPwGGiipKCSSIszyaaxBWk0IMmfVf1buc3Kp5B23sgLBtCuPELUEHiCFFiDbpa3DbHl9Ebw0llViCgBZQTYyG/Xf53xLWVmrJ7qp7j98u/wCsf//EACcRAAICAQIDCQEAAAAAAAAAAAECAxEEABITI1EFITEyQ2FxcqGx/9oACAECAQE/AcAZQxkeFYkSTeiRzSSkCiBFKA0Y2fUXuUAkm+45GSCQ02KGBo80D84i/wAB6jXbDsskG1mW0e6JF/NeOooYeHHyovIvpr0Htr//xAAnEAACAgEDAwQCAwAAAAAAAAACAwEEBRITIhEUIQAGMUEjJDIzUf/aAAgBAQAGPwKmVecvG6O5crIVYbMEkeC7FdVa1SYRGsokyDVuxwMkytpVE+8MFSZiMjXEsfcpQ1Nx7ZCDFZjoIFWJ69GVbKUmv5/HHy6MdgETQ6/qtum3ubC48S41JeEV9TIOBQcboiMEc8o9YxNITpxkAvElonbWe0nbkpS223ueJPX+QdK44rSXHpDne7Mhey+Zo5vI49FZuQkFS0YqWe+Ma+3zWlprtW3bnzrEZtMDUes8gW9psLicRNsFqdGtakNYJFFcBmNoJMyEf7TJ0sn17ByVYlG/HtrNSuyoX1j7jLgl63IPixTVDCyGenjyMiYgQ5u5jqGCo2w7l/dVcJjlWDaMeGNfCN1p+f5sMin7mfPoTfdtWGkIETXPYRlMjE/UwMR/giIjH1Hr/8QAGhABAQEBAAMAAAAAAAAAAAAAAREhADFBUf/aAAgBAQABPyFC7Rj65F30fNBIYyZgz5RErE5LllwFtqxdQJFxdiYFOrSuUTsnHkREwmm0Hr+HgBZcYATz2MfbE0SjMzUJ7BCEUlNsq9X6DqRLs5n1GlYRwe//2gAMAwEAAgADAAAAEIAXfv/EABsRAQEAAwADAAAAAAAAAAAAAAERACFBMVFh/9oACAEDAQE/ELimIO23kaRdZ4kpsyCsIaDRdA0FrVBmABLkQoIEDEFuesRnAEB8gAHAmf/EABoRAQEBAAMBAAAAAAAAAAAAAAERIQBBUTH/2gAIAQIBAT8QiXzCEC+V2FlbwuSAghEEEwawSEAfpQJLNhyEEVlsrz1Ur2qyvtdXt3n/xAAXEAEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEBAAE/EG8lQadNQkGXVok/qibwBMyqMfkVELeTUeVarTwcBygopgCmlII4/wB2uLURNVpH94bpOMS7jIZIVVfNEOZM3YvObAWV6FrcST9JgshRd3//2Q=="},"images":{"fallback":{"src":"/static/bf066f4bbef9e9297e8f2a6e551f4748/37851/dundung.jpg","srcSet":"/static/bf066f4bbef9e9297e8f2a6e551f4748/37851/dundung.jpg 460w","sizes":"100vw"},"sources":[{"srcSet":"/static/bf066f4bbef9e9297e8f2a6e551f4748/b5c5b/dundung.webp 460w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}]},"fields":{"layout":"post","slug":"/post/2020-08-31-java-loop/"}},"next":{"excerpt":"Spring REST Docs 같이 테스트 코드 작성하면서 문서화하는게 지겹다고요? 문서 화면을 알록달록 이쁘게 만들고 싶다고요? 간단한 코드로 컬러풀한 문서를 만든다!! Swagger가 있습니다. Swagger…","timeToRead":5,"frontmatter":{"title":"API 문서 자동화 - Swagger 팔아보겠습니다","tags":["spring","docs"],"date":"2020-08-31T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVklEQVR42mWSyWtTURTGA060zfTypkwWRBxAxLVQF1qtoMtaGtM2eWmSlzc0Q1ttRC1tQWhpSkOVQjd1E0VEXOpCUBSpsSJupCtB/5Sf9yUqiosf59zF/e537nd8elwnmoh20GOiT3arh6zIJJJJckae66kJRkbSXBtOMZY2GB0dJyVIp7PkciZTbo0pp4bPu6ioCoriISPLXbw+EpGIxeLkJ01sy8Us2hQLFkVRS6aDZZWxbYE1Jc4uVsntCmq6iqqpQkhBCgshyUMhFJSI6nHhsISRccmMO6K3MLIWGUHWMMlNdh8o5EviMRufJ6Rq4nJA4dKERHUrjLkWoLDmx2oGKa0HuNs6wvyjY8y3jrLw+DiLT06y0DpNebqAY013xxW43siarqFHFQJ9KplFia09P7efnmJm+ywrr3W2viTZ3O3nwW6MzU+H2WirrH04yOrbELV6Dqc0g+tWhFi1g8/7P00Xgr0KY3ckGu/9lJtXqTRyzLVO8PzrMC/2Kux8b9L+scHD3QGW3/Sw8kqjOicELSHo/CXYSTSq4u9RyC6F2f4WYOlllFvP+mm2w9z/3EdDOGp+DLLe7qWxc4C1tnD4LiAcGv871GIaqgglIqmcGYh0/vFiOsTliRAXUiGGxjVmlgep3Dsn6nlmVwa52RiivnqFcsXBtWt/xCyRuE8T7vSo1kk62KfQs1/+hcqhfRJhfwIjXcbM3aCYnaVozGLn69iFuhCr/jOuI/rOyL+TVvXuf6qq3EGWJRKJOIVCEdO0OpRK3g52qyMcecnaYh+9HfT28Cf4uoJ6AsbCYgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/fd7d9449d69592ee42cd86ec7b6a97c1/59a44/swagger.png","srcSet":"/static/fd7d9449d69592ee42cd86ec7b6a97c1/6e959/swagger.png 750w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/087ae/swagger.png 1080w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/1a47c/swagger.png 1366w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/59a44/swagger.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/fd7d9449d69592ee42cd86ec7b6a97c1/0b6f1/swagger.webp 750w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/24f7d/swagger.webp 1080w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/f02d8/swagger.webp 1366w,\n/static/fd7d9449d69592ee42cd86ec7b6a97c1/9ecc0/swagger.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.4760416666666667}}},"author":[{"name":"2기_티거","bio":"우아한테크코스 2기 티거(김준석)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAUHCP/EABYBAQEBAAAAAAAAAAAAAAAAAAUGB//aAAwDAQACEAMQAAABhq70FC69j9zosAxkPGZP1NlhcD//xAAbEAEAAwEAAwAAAAAAAAAAAAAFAwQGBwERE//aAAgBAQABBQI/k4SNJTitehaI4gHRpG73x7QdgR0VzrrH0GRQm0i230VePMLoRB//xAAjEQACAQQBAwUAAAAAAAAAAAABAgMEBRESIQAxQRQiM1FS/9oACAEDAQE/AbW93mukkMVVVLFtO6Coi2gGvMcKNMSqhmGqBM42JOVGQlkuMiq8l3pVdhl1kZ9wx7htIWTP2FYgdVACXIogCItS+qL7VXAkPCjgdh2HgdVCr6ifgfNJ4H76/8QAKBEAAgAEBAQHAAAAAAAAAAAAAQIDBBEiABITIQUUMUEVMjNCUVOR/9oACAECAQE/AeJGRMnXlpR3VIYcy8QrEK5sjxn00RmoGDOzHsKANs3iv1yC5PbvS3t5mB/RjhpLS0w7El+Sg3E1a7SDXHe4Eg/NTXriEq6cO1fTQ9B1KiuP/8QAJRAAAgIBAwQBBQAAAAAAAAAAAgMBBAUREyEAEiMxFAYVQVFh/9oACAEBAAY/ArYW8eVa+GTySmWaDmViUW4J7EpGZrkFYmSkQ29O0NNY6XFfMvJJo3pTbq1ps6Mv0sYGwSjEG7T762tk0DqtZBBAZiYhXYIWWDM99h+IxNlrS4iTJl9F50a6cALhUEcAseZK9tZWk1h5nKkYJrRbMzm4epiFRb52z9rL0Q8xx1VvW6rvuNCkmom5CZqR8Y71bJ/HbScoS3d5QylhiPgY6O2d1ZAM445bWIJ8isA22omi1inQuwpBqaK2LJUysyDvAo11ienfTKrjqOO+Wx5TT2gcbLdiGvKRct9QZI3HPiqrmOrVcLsyyMjeCLpyybg9paLJZbkIWau3xktAyOsz79UYiyc90PMiLkiM7TpIp/HM/qIj+df/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAMUH/2gAIAQEAAT8hDZzBJ00xzCAkLAHHFlrw08Kcnq9zvHHlAS7Vo24hqghAGxWdYq5pBPFv8Ir1DTqTNq3EMDYBNQJgZBJLUgMNsc4YuUJDfovDxYynflGA6Ja3S3//2gAMAwEAAgADAAAAEEMQ/v/EABkRAQEBAQEBAAAAAAAAAAAAAAERIQAxUf/aAAgBAwEBPxDfWRtg543kLv5Eo4imITi+gAByAJCQggiUhQAihochF2dUYMDTwMPhnf/EABgRAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAECAQE/EC0mGFAKhYSD2OM4AsJIEAAZBkFo+R5aKdcq2KLdNyFCtfsqdlJLNVVV1VXXv//EABcQAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQEAAT8QLPwgIgTvPf1cKmfK8qKd0RN4GWKuI/krTeqkVoyXeHgGHKr4V8NyUMQ8v38QhTnhB0vDMm0YQ1oFsD2IBCGk9KB/GAVF9XZRKizIdSAif//Z"},"images":{"fallback":{"src":"/static/dc549e08fc27699127f47060a32e80ca/37851/tigger.jpg","srcSet":"/static/dc549e08fc27699127f47060a32e80ca/37851/tigger.jpg 460w","sizes":"100vw"},"sources":[{"srcSet":"/static/dc549e08fc27699127f47060a32e80ca/b5c5b/tigger.webp 460w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}]},"fields":{"layout":"post","slug":"/post/2020-08-31-spring-swagger/"}},"primaryTag":"jpa"}},"staticQueryHashes":["2337738035"],"slicesMap":{}}