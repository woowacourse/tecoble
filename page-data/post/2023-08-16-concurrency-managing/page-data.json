{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2023-08-16-concurrency-managing/","result":{"data":{"logo":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png 400w","sizes":"400px"},"sources":[{"srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/65935/tecoble.webp 400w","type":"image/webp","sizes":"400px"}]},"width":500,"height":110}}},"markdownRemark":{"html":"<h1>들어가며</h1>\n<p>대학 축제 티케팅 서비스 <a href=\"https://github.com/woowacourse-teams/2023-festa-go\">페스타고</a>를 개발하면서 아래와 같은 고민을 하게 되었다.</p>\n<p>티켓 오픈 시간에 많은 사용자가 동시에 티켓 예매를 요청하면 어떠한 문제가 발생할까? 그리고 그 문제를 어떻게 해결할 수 있을까?</p>\n<p>여기서 가장 중요한 것은 요청 순서에 따라 티켓을 발급하되, 준비된 수량만큼만 발급하는 것이다.</p>\n<br>\n<p>이번 글에서는 위와 같이 ‘동시성’에 대한 고민을 한 경험을 공유하고자 한다.</p>\n<p>참고로, 이번 글에서는 개념에 대한 깊은 설명은 따로 하지 않는다. 모르는 개념이 있다면 아래 참고자료에서 개념을 익히도록 하자.</p>\n<h1>예제 코드</h1>\n<p>아래는 티켓 예매 상황을 간략하게 구현한 예제 코드이다. (실제로는 더 복잡한 요구사항이 존재하나, 이를 단순화하여 작성하였다.)</p>\n<p>아래 예제 코드는 MySQL 8.0 innoDB 스토리지 엔진 기반으로 동작한다.</p>\n<p>먼저 사용자가 “티켓 예매” 요청 시 호출되는 TicketingService의 ticketing 메서드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> ticketId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>ticketId<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Ticket Not Found.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ticket<span class=\"token punctuation\">.</span><span class=\"token function\">increaseReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> ticketNumber <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">,</span> ticketNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아래는 Ticket 도메인 코드 중 일부이다. increaseReservedAmount 메서드 호출 시 예매 수량과 총수량을 비교해 예매 가능 여부를 판단하고, 불가능할 시 예외가 발생한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Ticket</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> totalAmount<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> reservedAmount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">/***/</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increaseReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>reservedAmount <span class=\"token operator\">>=</span> totalAmount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sold out.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        reservedAmount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>순차적 예매</h1>\n<p>모든 사용자가 순차적으로 요청한다고 가정하자.</p>\n<p>해당 테스트에서는 10장의 티켓을 30명의 사용자가 예매하는 상황을 가정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> 티켓_순차적_예매_테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// given</span>\n    <span class=\"token keyword\">int</span> memberCount <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> ticketAmount <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Ticket</span><span class=\"token punctuation\">(</span>ticketAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AtomicInteger</span> successCount <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">AtomicInteger</span> failCount <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// when</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> memberCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            ticketingService<span class=\"token punctuation\">.</span><span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            successCount<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            failCount<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"successCount = \"</span> <span class=\"token operator\">+</span> successCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failCount = \"</span> <span class=\"token operator\">+</span> failCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// then</span>\n    <span class=\"token keyword\">long</span> reservationCount <span class=\"token operator\">=</span> reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>reservationCount<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>memberCount<span class=\"token punctuation\">,</span> ticketAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>실행 결과</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 334px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.74251497005988%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVR42m2QVwqEQBBEPY05B0ygiIg5gR+i3v8avVSDbmA/inHKmpp+I8iyTKIosj6/JUkiwzB4vaWqKgs5XdcfaZr2SKjrmuZ5pnEcqWkamqaJ1nWlbdtoWRb2hmHgfdu2ZJomZVnGlx3HwVlFUd6FeZ5T13WE4rIsWfju+56KouA9SquqojRNeaIwDHlFDuWY+il0HIcNBCzL4glwI7ARgA9cYML3fZ9wBv9u/wsZiNd1MTYQgbDvO+MAE75t2zwhis7zZP2+3VOIt4jjmJIkoSAIGCeKIsbzPI9c1+XDyEF37l8ZCl+pX8U+VCSsoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"순차 예매 테스트 실행 결과\" title=\"\" src=\"/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png\" srcset=\"/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png 334w\" sizes=\"(max-width: 334px) 100vw, 334px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>해당 테스트는 당연하게도 성공했다. 예상한 수량인 10장만 정확하게 예매되었다.</p>\n<p>티켓 예매 내역을 기록하는 Reservation 테이블을 조회해보니, 1~10번 티켓이 각각 한 장씩 예매된 것을 확인할 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 902px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVR42o1SS08bMRjkt5SkWb/t3c1uNg1leQQUccgpNK+26qVSe2orVXDgvw/jzYISFAKHkeXvG49n7O/oIUvws7C4m1zg/1WNf+Maf88/4Z77P3WF+0zg6vQzptMJ6rNzVMMKZVUhn85wObnB+HqCs8sxRicnMMbgaJkZHIcMflDBFINnWEL0S9ymFnWeYTAs0S8KZHkfIQS44Qh5wVq/QE7EXiP41Qt0hYQWAuoJMq4JhFJYO4FC9NDtCVhrCQcROUkCyTVCkOuc3wiug0JXaRitoXegII3Fgv1KCyTkeB8ID8WLtrlxH0K6EVx5iY4kgUX1AkIbzJ1EqShITnRnnYOUcocX9/Gytx0y4pL9UknG1427ePCgw29BNoL2NUEmGNDh24Ktw2UU3BtZbiJTsGgjO8Z174nceUVQkrBIdSsoG4eOB/cKhm1B1VrfAT+FkVfNG24E42g4ih50+IORP7Jg2TDbYM3wV79z8OMbJqyladbg4Kf8th3MxAfM5TEWRFxXxBfWFqaHXz6B56CL1sU+h/F54khF8UcdJHhNOSAN2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"순차 예매 테스트 DB\" title=\"\" src=\"/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png\" srcset=\"/static/4b5dab5c9305ad0001a24f1ffd807e7d/0eb09/2023-08-16-ash-1.png 500w,\n/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png 902w\" sizes=\"(max-width: 902px) 100vw, 902px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>아주 성공적이다.</p>\n<p>하지만, 티케팅 상황에서는 다수의 사용자가 순차적으로 요청하기보다, 동시에 요청을 하는 상황이 더 일반적이다.</p>\n<h1>동시 예매</h1>\n<p>동시에 여러 요청이 발생한 상황을 테스트한 코드는 아래와 같다.</p>\n<p>순차 요청 테스트와 같이 10장의 티켓을 30명의 사용자가 예매하는 상황을 가정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> 티켓_동시_예매_테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// given</span>\n    <span class=\"token keyword\">int</span> memberCount <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> ticketAmount <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Ticket</span><span class=\"token punctuation\">(</span>ticketAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">CountDownLatch</span> latch <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CountDownLatch</span><span class=\"token punctuation\">(</span>memberCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AtomicInteger</span> successCount <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">AtomicInteger</span> failCount <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// when</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> memberCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        executorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                ticketingService<span class=\"token punctuation\">.</span><span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                successCount<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                failCount<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n                latch<span class=\"token punctuation\">.</span><span class=\"token function\">countDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    latch<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"successCount = \"</span> <span class=\"token operator\">+</span> successCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failCount = \"</span> <span class=\"token operator\">+</span> failCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// then</span>\n    <span class=\"token keyword\">long</span> reservationCount <span class=\"token operator\">=</span> reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>reservationCount<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>memberCount<span class=\"token punctuation\">,</span> ticketAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>실행 결과</h2>\n<p>정확히 10장의 티켓이 예매되는 것을 기대했으나, 테스트 결과는 그렇지 않았다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.16883116883117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVR42l1RSY6DQAzkNSwJhH1TEIk4cQAECBIgBw7h/1+oUVlqNDMHyy53eam2dr1eYds2LMuCiumVua4Lx3HOd8/zBF8ulz88ZZppmmiaBu/3G9M0oW1bDMOA1+uFZVmwbRu6rpMc8bquCMMQVVUhjmPhPx4PGIYhy2iclGUZns8nyrLE/X4XI4m5oiiQ57lgxmmayoZKCblRFJ0KpCEnKbl8DIJAsK7rQrzdbuKphkYOa8gnVs3Ohn3f4/v9ipxxHDHPMz6fD47jEE/ZSZKcMuu6xr7voogNf/+7pgJO5d/4vi8bMmYxYx6GRdyUnodR+f/H+QFGtcVxH36U6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"동시 예매 테스트 실행 결과\" title=\"\" src=\"/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png\" srcset=\"/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png 308w\" sizes=\"(max-width: 308px) 100vw, 308px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>10장보다 적은 6장만 예매되었음을 확인할 수 있었다.</p>\n<p>티켓의 수량보다 많은 요청이 있었는데, 왜 더 적게 예매되었을까?</p>\n<br>\n<p>출력문을 보니 아래와 같이 <code class=\"language-text\">Deadlock found when trying to get lock; try restarting transaction</code>이라는 문구와 함께 SQL Error가 발생했음을 확인할 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1926px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdUlEQVR42jWO1w0AIQxDWYhD9N72H8onR+LDshWcR1TvHa01lFIw55TM2d5b3Dknznc6VWuVuTFG3FoL7z201lBjDFAsnXMkr7Vw75XMhfcRnTNCCSAohCA5xojv+6BYJCznLOV3IaHMXHpXvS5F0ANSKSUB/vPdYxA3yEwTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"동시 예매 테스트 데드락\" title=\"\" src=\"/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png\" srcset=\"/static/cc8410f88d230a4487d366c5b8f39c71/0eb09/2023-08-16-ash-3.png 500w,\n/static/cc8410f88d230a4487d366c5b8f39c71/1263b/2023-08-16-ash-3.png 1000w,\n/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png 1926w\" sizes=\"(max-width: 1926px) 100vw, 1926px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>lock을 얻어오는 과정에서 Deadlock 즉, 교착 상태가 발생했다. lock을 얻어오는 행위를 따로 하지 않았는데 왜 교착 상태가 발생했을까?</p>\n<h3>교착 상태가 발생한 이유</h3>\n<p>티켓 예매 내역을 의미하는 Reservation 엔티티를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> ticketNumber<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 412px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.21359223300972%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEZElEQVR42m1Va1caSRD112QjM4MgQoB5MO83MLwRjSKuqDFmc5Lsbs7u5/3dd2+NAaMnHy5dU11Vfbu6qjhQVRX1ev0Fjo+PcXR0BK3KvVqNchVH1Sf8yrZGG4kjONA0Db1eD47jwLbtEpZpophMsd7eI4oTpP0Bsv4Qad6H67qwab+zFYi/xCkDVnmqoevotNvodrvQf8jZcITV+hohA06XZ5ifXmA0W8Lq2aWd+AjE3jCM54CqqsDxfAwnMzpn8MIIbhDCdj30HLLhnqw7OH5Q7rteQL8nWfQSTFEUHChKBdFgiu9/bfH5bo7F5hEmDQzH4yrwYdg72YPec+FFKQajCfrFGAlTYZL1nqFE9cIYg6JAnoVwwoQGDiw6Wwxs2swtWckhopPvHtnLTQKmw6XvC4Yqf6Isx923fzA93+D06hYX20esNndYXP6O7efviIeT8vv9zUdc3n7Ccr3FknZBkpHh4DXDCq8QI5/MyS6Gy+uE2QCe5DNO4Sc5onxI3RBOECNh8KhfwE/7sFy/hGH1nhlqFHw6b7/8jcnZGiO+pqxpMUU8GGP+/hrF4hwjYnp+Veaz1dXR1k0+WIAwzWGQoVSLsDyoVCpI8gGWFxv0RzOu11i832C6usBcUnB5g/HynIGp42GSM8t+yq28sPhalJ8ZMmrZFVyrVW1f8RplMWgc1/H4+AldMmq23pVotVmvhoV2R2eX1Ev/faeIkwjCVCDfO8i3tN3idIXBZImUKXBDedmUD5KTYby32/kclGy0Z2a/QqvVROXwEAodNY32cj0JUn6/9N0zPKwoe1QUtYTICvc6bLW9fmfzk+3PtyoZVnlKt6HCbGrQGwreVd9AP64QSonAbKJbr5QodbQxaGucqNBPnhjvGcoJ9aoC32zB4JSRabK5/4g4ZR16HkLWqB+G8IMACXVBFMHzfZiGXtrH5gmO1Mqe6YGqVdGoaYi4YXRaCD0btw8fMBr2sZjPcLVh6SyXJS7XV1itVpiMR3DMNhxLR2Y1SIjstF0dMnJNU9D3OpgUKfLQRuQaCG0dgd1F0OsQ3T1CR0dExC7Z+TYGTvM1Qw019S2K8RR/frvB/fYUs80ndCwHHXZFpyfwKftoWxxhQYKMXZQNxwjyUXlgTeOLq9pzDkUxiS2sxjFmqYnM7yFxuoiJxNV/yB3KT7rcNzGMbKS+hcL9JcNDjIsc26//4uz6A1acJOv7z5wuD8jG83LqnF5tcf3xK9Z3f2DGnnb9kIU+QmK/YqgIQ56Qxx7/NzhF2KsyYWTiBJwoaTFBQFkmjEwaua7sy0DoMWhkt8nw8JmhQoZNKk44ebUv/6G/eeAwuMDs8hajsw28rMDs4gZ2lKHR5n8Ic1keyMPcZMDHe82QQoOKIHagX14jZ9+upgXOV0usFlOcEuerBfLI5avrSAMbozzEmOjzVn2+slTJPuBusjSrh2irb8j2DY61t6jLqv6Gk6NKuTa5vqsraNUUnFQrT6CuWX/Z9/8DdRtjqpaAeLEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"DB ERD\" title=\"\" src=\"/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png\" srcset=\"/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png 412w\" sizes=\"(max-width: 412px) 100vw, 412px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Reservation 엔티티에 Ticket 엔티티와의 연관관계를 설정해 줌으로써, DB의 reservation 테이블에 외래 키 칼럼 ticketId가 추가되었다.</p>\n<br>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html\">MySQL 공식문서</a>에 아래와 같은 내용이 있다.</p>\n<blockquote>\n<p>If a <code class=\"language-text\">FOREIGN KEY</code> constraint is defined on a table, any insert, update, or delete that requires the constraint condition to be checked sets shared record-level locks on the records that it looks at to check the constraint. <code class=\"language-text\">InnoDB</code> also sets these locks in the case where the constraint fails.</p>\n</blockquote>\n<p>즉, 외래 키 제약 조건이 있는 테이블에서 레코드를 삽입, 갱신, 삭제할 때 해당 제약 조건을 위반하는지 확인하기 위해 관련된 레코드들에 공유 잠금(S lock)을 설정한다는 뜻이다.</p>\n<p>공유 잠금이란 다른 트랜잭션의 데이터 변경을 막고 데이터 일관성을 유지하는 잠금 유형이다. 여러 트랜잭션이 동시에 공유 잠금을 얻을 수 있다. 그러나 공유 잠금을 설정한 트랜잭션이 있을 때, 다른 트랜잭션은 해당 데이터에 대해 배타적 잠금(X lock)을 얻지 못한다.</p>\n<p>배타적 잠금은 한 번에 하나의 트랜잭션만이 특정 데이터에 대한 쓰기 작업을 수행할 수 있도록 하는 잠금 유형이다. 다른 트랜잭션들은 쓰기 작업이 끝날 때까지 대기해야 하며, 이를 통해 데이터 충돌 문제를 방지한다.</p>\n<br>\n<p>실제로 innodb의 로그를 확인해보니, 여러 트랜잭션에서 데이터에 잠금을 거는 과정에서 교착 상태가 발생했음을 알 수 있었다. 아래는 로그 내용을 간략화한 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">LATEST DETECTED DEADLOCK\n------------------------\nTransaction 1 (ID 20238):\n- Holding S Lock on data ID 1 in table `ticket`, Waiting for X Lock\nTransaction 2 (ID 20240):\n- Holding S Lock on data ID 1 in table `ticket`, Waiting for X Lock\nTransaction 2 Rolled Back</code></pre></div>\n<p>로그를 토대로 아래와 같이 교착 상태가 걸리는 과정을 알 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1356px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACGklEQVR42nVS246iQBDl/x+Niy8mvvoB64OJ2cwm7oMKg5qZHZlBvCAo4gjqgMilz3a14rCb2U5OF9XU9VRJYRjCtm2sVisBz/Ow2WywXq/Fu+M4d1nYbLdbYUMo3sg+SRJIu90OmvaIfq+Her2OSqUCWZZRrVbRarUwGo2gqiq30QQajQZqtRrkbzJkLpvNJvr9PsbjMaIognQ6nbBcWiIbVWFZFteXQpJOmUknUKWLxQKmaWI2mwmQXlR5uVwgZTlwDj28/e5BUTVejYJ2u42HhweRVTdMhOEHGGMAGIT44uR5jizLICVJijiOcAj2oPZd10UQBHjf7xH4e3yfRng/RcjThDsx4UjBy5JA/KVpCoku+lE2un5fK/LODJuQIYpDzA2VV/0kuOx2u+h0OtB1HdPpFMfjUfiJgIS/g+U3nYPLX06Kn1aEMHA51y7m8/mdb+Le930xENEyXRSQiB4OhyK7oihiugvuaLseVA84XPIrVzcSi+RliIAUjPqn/TMMQ2QvpklvH3wL/HMG65jehsL+G+zOISmsNL6Cw+yGmA/OOcSwnTXmiyX0NwODwUB0RKtDbcdx/FnhvxMjgF05pKrynLIn2O88LE0DxuQZEz6MVw7qiraDuiQ/qdifMlKORy+Dss3ww75Kjev6IYfmMzwd2S3RZyFFl9JXS5px+9kJWIXAcwBMOF44zBPD64HBLAKWVq04fwBd29DiSt+R0gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"교착 상태 과정\" title=\"\" src=\"/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png\" srcset=\"/static/9f5d4bf32d734851fba53c6ad6a4ab35/0eb09/2023-08-16-ash-5.png 500w,\n/static/9f5d4bf32d734851fba53c6ad6a4ab35/1263b/2023-08-16-ash-5.png 1000w,\n/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png 1356w\" sizes=\"(max-width: 1356px) 100vw, 1356px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<ol>\n<li>트랜잭션 1이 id=1인 데이터에 공유 잠금을 얻었다.</li>\n<li>트랜잭션 2가 id=1인 데이터에 공유 잠금을 얻었다.</li>\n<li>트랜잭션 1이 id=1인 데이터에 배타적 잠금을 얻고싶지만, 트랜잭션 2에서 해당 데이터에 공유 잠금을 걸어두었기 때문에 대기한다.</li>\n<li>트랜잭션 2가 id=1인 데이터에 배타적 잠금을 얻고싶지만, 트랜잭션 1에서 해당 데이터에 공유 잠금을 걸어두었기 때문에 대기한다.</li>\n<li>무한 대기상태에 빠진다. 즉, 교착 상태가 발생한다.</li>\n</ol>\n<h2>연관관계 제거</h2>\n<p>실제로 교착 상태의 위험성 때문에 외래 키를 사용할 때는 신중해야 한다.</p>\n<p>교착 상태의 문제를 해결하기 위해 Ticket과 Reservation간의 외래 키 관계를 제거했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> ticketId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> ticketNumber<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> ticketNumber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ticketId <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ticketNumber <span class=\"token operator\">=</span> ticketNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>연관관계 제거 후 다시 동시 예매 테스트를 실행하니, 교착 상태는 발생하지 않았다.</p>\n<p>하지만 총 수량은 10장뿐이지만, 30명의 사용자 모두 예매에 성공하는 결과가 발생했다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 286px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.97202797202797%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVR42k2Q38qCUBDEexrN1CwtNRVE0gtBvNGk8G+C0Pu/wMQsnL7vYjjn7I4/d3bnOA5s28b5fAbvSqfTCbfbDa7rwrIsqQVBIHX6+T4ej0jTVHymaYp227ahbVt0XYdhGPB6vTBNE97vt9TXdcXj8cDz+cSyLIjjGFEUIc9zAX8+H8zz/AfkX33fx+VykQk8z0MYhqLr9So93tnntJxqv9/jcDgIUPV+QJpo4MkYjM63ruswDEMAPAmg6KFXAVTvBxzHEX3fo65rNE2DqqrAGmNyDYxJaFEUMk1ZluLTNE12q/QDMtL9fpfdJEkiyrJMRAD3RSDj8QO1Ak6mIP/1BU0LyC8w8gHFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"연관관계 제거 후 테스트 실행 결과\" title=\"\" src=\"/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png\" srcset=\"/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png 286w\" sizes=\"(max-width: 286px) 100vw, 286px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>어떻게 티켓의 수량보다 많은 사용자가 티켓을 예매할 수 있었을까?</p>\n<br>\n<p>DB의 reservation 테이블을 확인하니 그 이유를 알 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 882px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 156.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42q2WSXPaQBBG+SU5uAKSZrSMAC3BdiLQAiYL5JSY3ZVU5eb/f/vSMygq2cUMSpUPXWJ9vK+7JdGb3N6imiRYpWMclwvs5iU2VYHHMsf+8wN+Tu+xTGOU9PzblwofsxnSNMXdPb3+dYVy/oCiWiAvKnyYTNCbZRn+jDjWvI/vbh9rd4C1Z2FFJY9r38azsBC7DMx1IcIQQgi49NjzPCq/Lg9hOESvIuBmyHHDON5zj8ptqs853nkBfgiGmNmw6DMSFgQBGGPg9H67hAjPwAMBXc7gufxF+WTl+D62EsgdONKQgLIkQFq2qzHcE/DSL8ofGVCcnXAaQ2nn6wwVcDqlyK4RuK2BtgSSnR8IM3BPwEsRZGzLD7ChyImMzM9DCUyRy+yTimwCSsOk7mFQD8XVAeczMhyZDXc10ObyS6GapsEw62DIGkO1NprIsh29RV7gFNEHqMmXgDYBHxWQkSFHFCUIh0M9cJ7nOI39y0D+LzKrI3OMx5H6otHwGJ33Shd5H7aAUax6pTec5TjEgTayMmwBR2R4HWgwtBWQv11kCdwoIGsiC5PhQ1HgKQqMQ2n3MIoTraHawwVN+WgA2q96aIqsgNLwGIvLkTWGuj1sgCddD2vDbXsohrVRwGVZ4inuDozjlAxH1w07D0VN2dRDMjzEofnUaxl27iF/qx4uOgB3LyIn2sVuIl9b7N3rtbkGPMbdI0dJej3y4T97eOVMKXGiM4U7jgK0y5cXBLqN7pt7ynkPh8Y9rCP3ydCiF9tl09XmRt1GHaRd16agi8PvyEPmDJBxm8pSxykdZd15HL8CC2Pm0D8H1kxZ99/mL3y6ytGHTHLpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"동시 실행 DB 결과\" title=\"\" src=\"/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png\" srcset=\"/static/63e80a317763eb47b903c2a81e6c8571/0eb09/2023-08-16-ash-7.png 500w,\n/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png 882w\" sizes=\"(max-width: 882px) 100vw, 882px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>1~10번 티켓이 각각 한 장씩 예매된게 아니라 1번 티켓 10장, 2번 티켓 9장, 3번 티켓 9장, 4번 티켓 2장이 예매되었다. 즉, 하나의 티켓이 여러 사용자에게 발급되는 문제가 발생했다.</p>\n<br>\n<p>순차적으로 예매를 요청할 때는 발생하지 않았던 문제였는데, 동시에 예매를 요청하는 상황에서는 왜 이와 같은 문제가 발생했을까?</p>\n<h3>순차적 예매 실행 흐름</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1186px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC0klEQVR42oWU3U/TYBSHuTImJiYmJvrfEBNjonf6D6BGYzQhMcYrrxEixuCFRuONmIi4iFygcRjGlwjIwjYsMDbpuo7ysY1t7INt3br2sS3b2ATk3LQ97+8873lP33NaDMPAsnQ6zdzcHP6VAD6fj2wuZ/uTqsGADAVtTyeKor0eCATweDzkqroap4WqaZqGsLTM1PQ0Ht8CqlpEzII7buBcB28C4irspFJ4TeC0qQsGg6ZOpdHqwNoOYWXdhlummz7ddIsZ7KdR1eq6jqIoTXFNwIrtMzNRdFq/qPQKaXzuWSZd33m1kOXCCExFjeomUC6XWV1dPQ5YosOd5/xnaBuUmJlwkUvGuDuR50yfwZvAPrBSqRAKhY4G5nZ3Se+kKJtr31a2yJW0uiBrvjo3zRo3xFlASZKOBpbMI6RTSQJKnG6nwLKyzW+fl0Q8hpws0DkqsZlRm4DhcPhw4PquQTAkE1xwc+O1i5MPx7n3bgbBO8/w0CAXOwY59cDFs9G9I1ZMgKZVEKtH5l9gomiwsRVjS4kwL29z84MHz9rOXnBZZT6S5NbnAHKqWA/SzAyD4n9q2Lhg1cb6izXZr8gOV3oFHPNhfk6O4xcWeDsj0vpylqlwdWN9H9piVGHW3bI7wQSWSmVqmu4xiRP3ndx57yaxtc7U+CiXOgc5/WiSrmF/vQzHZlgztaLjCGTJqHrdl8yXccz9QdV0spk0hULhYOsdBUxk8vR89aAkMkghkbAUIhJL0eMYQYklyKS27X4+EmhdBwuoV787+8Y4d/Uxl9u7+eToJ7iyxO0n/Zy91kX78wHEzQRrZrv6/X477gDQ6oDGDBflGNdfOBnzraJre/4fixJtTz/ileNE8xphOYIgCHbtDwBlWW4C2r5c83U7tlNomCJDQ0NNIymvWUPDsANrwRsbm7auFtO4dgBozTgrg/2/DP50UxIUi0Wi0eihGf4FNkw9dGkC8dYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"순차적 예매 실행 흐름\" title=\"\" src=\"/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png\" srcset=\"/static/bd0a1777fe65ab9db8874f20b5ffb230/0eb09/2023-08-16-ash-8.png 500w,\n/static/bd0a1777fe65ab9db8874f20b5ffb230/1263b/2023-08-16-ash-8.png 1000w,\n/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png 1186w\" sizes=\"(max-width: 1186px) 100vw, 1186px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>순차적 예매 시 위 그림과 같이 한 스레드의 작업이 끝난 후 다음 스레드에서의 작업이 시작되기 때문에 충돌이 일어나지 않는다.</p>\n<h3>동시 예매 실행 흐름</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1306px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACv0lEQVR42n2UTU8TURSGXRh/hHEjSxf+ABN/g0tj3PgHXBhjou4Ie2M0MTGaaERjCIoYDQINFQG1LZWPFiilH9S2M/0YoJ3PltKZx9vptJSCnNXcO+e+95z3fc894zgOrahUKgQCAUKLiyQSWzRshwPx60MGlnbaOYVisZ0TChGPx2k0GvTHmc5HvV4nnUqyuR6lWJCxBNqWBut7EKs6FGpgmSbJZJJIJIIkSdi2fTKg4y0qVp1wVnG/dV3DrltEKqDUDg/UajVkWeZ/4QI2PcT7YYcLH+Hp9Cozn94z7F9iYAxuzTvdA5Zlkc/nTwdsF37A86jBtRmbX6kyjqVSEpXd+CEuiB32YRomsmj3VMB2izqqppKVC+7a04qo4HBnX1QmKGi1a1g1VraLpwNWq1VMQbglknN5yavYJqPDpXG4OdsksDCH7+s4DyZTXPwMY5n2jU3nBMCW/KZpYYgqe9tR6nB9AYYiTXdt7Ck8C8hcnYSJtOXSYPcDmg0bQ/BSlLK8mV3h7pdNvgeXCYeCGFqVIf82L4OHIphClL9SQdis5tJ0rOVMtUF4aZl0LMLtsQ3O3pnmtX+V3VyaFyPjnH84xZVHv9lvtonQxeU5rwtd01yqev3Y9qGnQKKk8mo+zkGPX30plbCkH7GNLOU9IQ0XsHP+GGAruSAd9djb5TKTW3vksxnSyQRr+V2Gvm0QTeXQ1Qqd8y1xnF7buPwIYXLS4RTIWp2BwVkuD07xbmSUTHyNe6N/OCdoeezfQqlqrEdWyKRTXeA+QLM7BZ2qh1fKTGzudHNSZZUn/k2yepNwqYEvVmIuteuO6F69D9Dlx5vTDi2tabEOeiZFGFzeTqCJvaDiENyF+bJ4lbahaPVxqCgKPp+vbWtvzy87ZA2nC1gsiYoWfvZ04fQ8L30ctgyuquoRUYRNj5m3N/oh/wHtTv4Y8K8zDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"동시 예매 실행 흐름\" title=\"\" src=\"/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png\" srcset=\"/static/61863fc9cd77a53b821987e4f2698cb3/0eb09/2023-08-16-ash-9.png 500w,\n/static/61863fc9cd77a53b821987e4f2698cb3/1263b/2023-08-16-ash-9.png 1000w,\n/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png 1306w\" sizes=\"(max-width: 1306px) 100vw, 1306px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>순차적 예매와 달리, 동시 예매 시 위 그림과 같이 한 스레드가 데이터를 읽고 이를 갱신하기 전, 다른 스레드에서 데이터를 읽기 때문에 충돌이 발생한다. 이 이유로 여러 개의 트랜잭션에서 동일한 티켓을 예매할 수 있었다.</p>\n<br>\n<p>이제부터 위 문제 상황에 대한 해결책을 알아보자.</p>\n<h2>해결책</h2>\n<h3>synchronized</h3>\n<p>java에서 한 자원에 synchronized 키워드를 붙이면, 멀티 스레드 환경에서 단일 스레드만이 해당 자원에 접근가능하도록 보장한다.</p>\n<p>그렇다면 ticketing 메서드에 synchronized 키워드를 붙임으로써, 동시에 들어오는 요청들을 순차적으로 처리할 수 있지 않을까?</p>\n<p>한 번 실험해보자.</p>\n<br>\n<p>아래와 같이 ticketing 메서드에 synchronized 키워드를 붙여주고, 동시 예매 테스트를 실행하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> ticketId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>ticketId<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Ticket Not Found.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ticket<span class=\"token punctuation\">.</span><span class=\"token function\">increaseReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> ticketNumber <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">,</span> ticketNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.76923076923077%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42l1QyaqEQBCbjxF3VBB0BsSD+4oKetCb//8RGVJQ82beIXSqqiud9MPzPFiWJTBN83MStm0LtObMdV04jgPufXPFg82yLFHXNfq+R9u2GIYBXddhnmeM4yicmKYJcRzj9XohDEOs64pt2+D7/p8gX6iqSi5ziYLkBAVZ8+SsKApEUYQkSUSQvaZpfgWVaESNbxiGQHsaWaPqjvZ+HC7LgvM8se+7RDyOQzhxXReezyfyPJe4dHXftzil8Le7j8MgCJBlmSBNU/kjrRmPy7zDZc7Z/y+kgm9k38N5p+nfGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"synchronized 테스트 실행 결과\" title=\"\" src=\"/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png\" srcset=\"/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png 312w\" sizes=\"(max-width: 312px) 100vw, 312px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>여전히 결과는 옳지 않았다. 요청이 순차적으로 진행되지 않고, 병렬적으로 진행되었다.</p>\n<p>@Transactional 키워드와 synchronized 키워드를 동시에 사용하면 어떤 문제가 발생하는 것일까?</p>\n<br>\n<p>@Transactional이 붙은 메서드가 호출되면, Spring은 프록시 객체를 생성한다.</p>\n<p>해당 프록시 객체는 원본 객체를 감싸며, 메서드 호출 전 후로 transaction begin, commit을 수행한다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1782px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAClklEQVR42p2Uy08TURSHu0BJlOgeMCYmBqOJCx9RkK0LYzQkrsAYV/4JLkxcuHbjY6EChtgGEKggpCImxAJBoUEFBUoLtDxaWlugD+hzOo/P207RqguLJ/nNTObe+eaec3/3GBCxGofJMHwJgTuGHmurYsANniWIhCg2DNlLPAPfBdQVgY24QiYj6RCfB7zLENsuHmhNb2FJhxnMRLCqW3RGfUx5VnKDmqax2zDUBp2U+75xMbjApU0XJYtjtC45c4OKpmapuwOefS9h6EiypzvF3h7xbAxjmvLoQFWHaXkVBawfgpOv4XQv1LyB4wJumvQiobCuyIRVmU2hVHa1xQCr38GpfqgbhqsjcKhVosr6iQthO+cCDqqDDo76Z2hPhPKrzpZBSM1L25GWk6HGomJ4rnDQKFNmUjnwLEXZsI2K7RlqQw6uRRfZH/zM40QgB5T/kbxh1bzAXNMsDqMD+8tFlh5OcL2zl0rHOIed0xyZn2Hf3FeaN4OClkFadqGuB1ADftQVN4p7AcUxi7LoRN1YFz6c8MKQMPDYCqrNB5Zx7t5u4fwdK+WPfFQIld730Ti8BokwadsokuUVUl8X0kAf6c4XSL0dSIP9Aj6PIVvqHcm5IiW5+dZHudioY0In+qDSDEaXnpIii6QlYXxFAXEAtFRSfCjrytYQVS9m9p5ziZygvsfLGQvcGNG49UGjqlvjiZNfVtL+kH4K8sCCyBlDTXLZ7BcbBSVtGqXtotDN8MCuz5HVvyGF5v8NmHutpLjXNU9dS5QGYfIGU5grTWEG7Gn9p1oRzaEwkloGf9tHaJxAa5sC8zQ8tYlW5KMY4k/gTiOIRCOMDgwJWyTJ+OPIWa3FUBOZgjR2AYzFYszO2f+72/wAYgXftqFrHRMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"synchronized 실행 흐름\" title=\"\" src=\"/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png\" srcset=\"/static/3a151c092d7ea2c8921ece68c113e71b/0eb09/2023-08-16-ash-11.png 500w,\n/static/3a151c092d7ea2c8921ece68c113e71b/1263b/2023-08-16-ash-11.png 1000w,\n/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png 1782w\" sizes=\"(max-width: 1782px) 100vw, 1782px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>여기서 프록시 객체에서 수행되는 transaction begin, commit 코드는 synchronized의 영향을 받지 않는다.</p>\n<p>즉, 위 그림과 같이 T1 스레드에서 commit 되기 전 T2 스레드는 메서드를 시작할 수 있다.</p>\n<br>\n<p>이와 별개로 synchronized 키워드에는 몇 가지 단점이 존재한다.</p>\n<p>한 스레드가 메서드 작업을 완료할 때까지 다른 스레드들은 대기해야 한다. 이로 인해 프로그램의 성능이 저하될 수 있다.</p>\n<p>또한 이는 하나의 프로세스 안에서만 보장이 되기 때문에, 서버가 여러 대인 분산 환경에서는 데이터의 정합성을 보장할 수 없다.</p>\n<br>\n<p>따라서, synchronized 키워드는 우리 문제 상황의 해결책으로 적절하지 않다.</p>\n<h3>잠금</h3>\n<p><strong>잠금(Locking)</strong> 은 데이터가 읽힌 후 사용될 때까지 데이터가 변경되는 것을 방지하기 위한 조치이다.</p>\n<p>잠금 전략으로는 여러 트랜잭션 간 충돌이 일어나지 않을 것이라 가정하는 <strong>낙관적 잠금(Optimistic Lock)</strong> , 여러 트랜잭션 간 충돌이 일어날 것이라 가정하는 <strong>비관적 잠금(Pessimistic Lock)</strong> 이 있다.</p>\n<br>\n<p>낙관적 잠금과 비관적 잠금을 통해 문제상황 해결을 시도해 보자.</p>\n<h4>낙관적 잠금</h4>\n<p>우선 우리의 코드에 낙관적 잠금을 적용해 보자.</p>\n<p>낙관적 잠금은 아래와 같이 @Version 어노테이션을 통해 처리할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Ticket</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> totalAmount<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> reservedAmount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Version</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> version<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">/***/</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>DB의 Ticket 테이블에는 아래와 같이 version 칼럼이 추가되었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1174px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 5.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQklEQVR42j2KSQ6AMAzEeFK5JIitZCYV/P9DQ1UhTpYtT2YuZFOwqQYGr073Reu2K+/n78dZRw/k91HWnYSIUCmzXml2Ip+OwzUiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Ticket 테이블 version 칼럼\" title=\"\" src=\"/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png\" srcset=\"/static/1497ddb93d5df5a437de21bc3260aca7/0eb09/2023-08-16-ash-12.png 500w,\n/static/1497ddb93d5df5a437de21bc3260aca7/1263b/2023-08-16-ash-12.png 1000w,\n/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png 1174w\" sizes=\"(max-width: 1174px) 100vw, 1174px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>이제 동시 예매 테스트를 실행해 보자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 290px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.724137931034484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA50lEQVR42mWRRw6EMAxF5y6I3mGB6EUgtvSyAe5/CY++JdCUxcfGdn7ykpeu66QoCsmyzPHOb9m2/dXHPKSqKhmGQa7rPjXohc84jtT3PavrOpqmiYZhoHmeWfhHb993njVNk6qqIt/3ads2Nn4MNU2joiiormvKsozSNKWyLFlN03ANfRggRlHEC2EG4ziO/w2BJYoiNyzL4kFJkkgQBI7AA/Kdw8zzvAf9Cxn3AqTzPB9sYK3ryrjHcTAqNmnbljdfloWu6+Lap9lzQsdxKM9zPn4QBBSGIaMlScI5avcDwOSz9mv4BmeMxVYXq1FIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"낙관적 잠금 테스트 실행 결과\" title=\"\" src=\"/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png\" srcset=\"/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png 290w\" sizes=\"(max-width: 290px) 100vw, 290px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>결과는 여전히 실패이다. 10장이 아닌 5장만 예매되었다.</p>\n<p>reservation 테이블을 조회하니, 잠금을 걸지 않은 코드와 차이점을 발견할 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 810px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABXklEQVR42n2PW2/TQBBG80uQSmMn3ou968tmmyYqSZzEpRcpD23FAyoRVCAq3vj/h7EVIYQQD0czmplv5ptROV/wUmb87NZ8fb/ne9fyslry2m35sm/5ER3H6Lk93NJ1OxaLJTHOuL675/rmnv3NHZvtnna7I4TAKF6t+Fxp5k1D1szQdYOpw0AqrJqKD17jYyA0NReXS7z31DJf1TVlVQ2xqnoqRvPVhmcRhGlCphRGZWjBSp5mGa2zPJiUt1OFNYYmyFHpKempPp5yozVODo3m6w2fSs1MTcmMxYiopxen2rArC55syljyIs8Js/h75k+stfiylJffrTn6jKgmKBFZudSTC1NhVxiexOG5kpqIBodS/5t+qfNl77DlWRwW8uaZyRmLy3MhEd5oy9I7HvMJyclhvLj8v8NqccU3N+GozjjohAc95vHEQY15dSkfbTIcKnqHw8v2nwud8/wCQVHg+JqyJEkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"낙관적 잠금 테이블\" title=\"\" src=\"/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png\" srcset=\"/static/cd219d4ae481d269d8ea1671131368f5/0eb09/2023-08-16-ash-14.png 500w,\n/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png 810w\" sizes=\"(max-width: 810px) 100vw, 810px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>한 티켓이 여러 번 발급된 이전과 달리, 1~5번 티켓이 각각 한 장씩만 발급되었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVR42mVQyaqDUBTzc9Q6teKsKLpxJ85QiwvXgv+/SskBxb63CMcc781Noui6DsIwDDwejwuWZQk0TRNu2zZM0/z57zjOv3vK5/NB27ZomgbDMAimacL7/Ubf9+i6TnbruuL1eqGqKnieh7Isse87wjCEqqqXsJJlGdI0RRzHF7hLkgRBEMh3FEUCXqJjJvJ9H3mei1PyyyFf5UHO5/Mp0c4KXNeVSU4hcgqfVdDZXUwEt23DOI4SeVkWiTfPs+xYB50URSGzrmscxyGuKXbv9Mche+Dr7IZgVHI6ppvz8Jnkb8y74BfJsMVTfzsVCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"낙관적 잠금 100명 테스트 실행 결과\" title=\"\" src=\"/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png\" srcset=\"/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png 308w\" sizes=\"(max-width: 308px) 100vw, 308px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>사용자 수를 100명으로 늘리고 다시 테스트를 실행하니 10장이 다 발급되었다.</p>\n<br>\n<p>위와 같은 상황이 발생한 이유에 대해 알아보자.</p>\n<p>낙관적 잠금을 사용하면 아래와 같이 버전 정보가 update문의 조건으로 포함된다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 382px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4UlEQVR42pVUyW7TUBTtP9DQQaJNaZx4eLYzOYNTZ7Azk5EmoQ1iwwaEBBs2XYJACImEYUERtJvCArHgGw/3PZrIEWlFFkf3DX7nnXfvuV7TNA26riMajSKRSMzBGAPfWxVriqLAtm0MBgOMx2MMh0P0+33E43HwvZUJZwPDMETkyjhUVRWYra1MyA9xRalUCq1WC+12W6jtdruIxWJz8v8i5B/Lsiwiz6dlWUgmkwKr5lPkMJ1Oo9frodFoYHaBH7M0+FPixwIhP8ArfHBwIBTxeSQSmYMrD4fDInJIkrSwzwX5i7fwZA5e3Xq9jnK5jFqthkKhIOau6wo3dDodeJ6HSqUi4DgOcrncnHShKIamImEacPN5VN0SKoQ8kdQ8F6W8Q+sOWpQWTl4sFsVl2WxW4N8qE/ZVDVIsAT1jQ7PSMLI5hIwo5HgSJo1lWmNUpDQ5geedi5g9e4GQk0U0hvtyEJN4CBd1G2dlC+eNHF7GJJxVMvjRc/GrmcNJrQiv0UTpUt1S2+hcHRF+UDbxWN3DXVPBKKpgTBjFGe7RvGuqOGFBvApvYFehvFO+l9nJR6jjUziAh5aB0YDar1bF4Z0mju/28aD3txCPMjG8iGzhNjOgs2uMLZ6sE5EWwjd1ExNlC+/kLUzVbUwIH+UNvJU3cS4HxAtC9Bp2lbG5VfJU1eOjI3SGI3jtLlL5AvYUlQ7q4vA+o0jYu5yz6zqFe5D/GHi/xgkmtR7fUOgi/ix2mRIeDd/Yv760l3nkFrDIEvyHUCVT26Q0QlZS6RKFFMoElc3GDBKpVTS2/G8zI46aJqysDdfU8UXbxjR0g4q1jqkUwERax5vwTbwnTCinF0oAR+q+cIi+jJAb1CLj5mt1PC3Z+EyeLFSq6Hgl0S2tCrWjV0azVEI0lcEzeQfP1R3sUm6vJqQfRJna69Cx8Tt2C9/dBKY5A2eOgVM3ia+OjlNbw2sjiJ/yOp6oQQR9hH8AEAqCToRqbToAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"낙관적 잠금 query version\" title=\"\" src=\"/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png\" srcset=\"/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png 382w\" sizes=\"(max-width: 382px) 100vw, 382px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>일부 요청에서 데이터를 읽어왔을 때의 버전 정보와 현재 DB의 버전 정보가 일치하지 않아 요청에 실패한 것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1732px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLUlEQVR42o2STWsTYRDHV/Doxc/gp5EevAqevKrFmyB4EiFQXw7i2Q8gCGmLHko1tNUIIc0qSds0G7dtdpM02U32Nfu++/eZJ1ntQlv7wD+b4Zn5zcwzI2BxMv6TIUoBdTaXwhSkuNLJMk6AUACy48bAuzbw+gAo/YrxotLDq50eVrZ6eFtV+f+X23OtrO/iTbmK95si4iQtAsMowsFeCyPLw/2Kh7tffNxenUBYXoXwsAzhQRk3n3zC9cdrEB4xe3kN1+6UcGPpGW7dK6HdkYrAiAFFUYRhmuieKOge99Dc20dttwF1eIpDZn+tNSCxO0k+wqEk4Xu1ipOeiv12B/V6vQgsvEeSwPBCqDaT5WMaAkmzgWB7E6hW4AchFCeCanrQwgxp9i9WyB+UlKYpzYUBY3R0D2K3j2+NJsTfY5xufIb8/CmU8gcYfoqNhoTazxZ22n3ExEiTiyuMWfs2q3BgRzjSXXgsSfRjC+b6R6TtFp+8agaQNQdGWIwVgiCAqqpQFAXT6ZRXqWk6dF2D51gYDfuYTnSwCziuO08Yx/zN3YWdrwwHkkEOYRgiSRKcHRL5JWwdInZPiVzH+QukrXDOAxLEsiw4zJlENsENwwBVT2AC+L6PyWTCfS6tkACapmEwGPCWyXk2m/FA+ubyPA8mW6nxeMyTXtoytXN22v87BKcunMUTFIZC2WgosixjOBzyNm3bvlAEodap2tFoxGMLwPMqy+2rKO8uB/4BRJgcXRu8Z8sAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"낙관적 잠금 version 흐름\" title=\"\" src=\"/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png\" srcset=\"/static/610cd73b5014848934fa470368cb463b/0eb09/2023-08-16-ash-17.png 500w,\n/static/610cd73b5014848934fa470368cb463b/1263b/2023-08-16-ash-17.png 1000w,\n/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png 1732w\" sizes=\"(max-width: 1732px) 100vw, 1732px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>위 그림과 같이 트랜잭션 1과 트랜잭션 3은 버전 충돌이 없어 티켓 예매에 성공하였지만, 트랜잭션 2는 트랜잭션 1에서 업데이트한 버전과 충돌이 생겨 update문이 성공적으로 수행되지 못하였다.</p>\n<br>\n<p>낙관적 잠금은 버전 불일치 시 처리를 어플리케이션 레벨에서 담당하게 된다. 이는 티켓 예매 요청이 버전 충돌로 인해 실패할 경우, 직접 예외를 처리하여 재시도하는 로직을 구현해야 함을 뜻한다.</p>\n<p>이러한 재시도 로직을 AOP를 통해 구현해보자.</p>\n<p>먼저 @Retry 어노테이션을 정의한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">METHOD</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Retry</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음은 낙관적 잠금 재시도 로직을 구현한 Aspect이다. 최대 1000번까지 0.1초 간격으로 재시도하도록 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Order</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOWEST_PRECEDENCE</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Aspect</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OptimisticLockRetryAspect</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">MAX_RETRIES</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">RETRY_DELAY_MS</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Pointcut</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@annotation(Retry)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">retry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Around</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"retry()\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">retryOptimisticLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProceedingJoinPoint</span> joinPoint<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Exception</span> exceptionHolder <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> attempt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> attempt <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MAX_RETRIES</span><span class=\"token punctuation\">;</span> attempt<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> joinPoint<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OptimisticLockException</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">ObjectOptimisticLockingFailureException</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">StaleObjectStateException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                exceptionHolder <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RETRY_DELAY_MS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">throw</span> exceptionHolder<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 ticketing 메서드에 @Retry 어노테이션을 적용하면 낙관적 잠금에서 버전이 맞지 않을 때 재시도한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retry</span>\n<span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> ticketId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> memberId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdForUpdate</span><span class=\"token punctuation\">(</span>ticketId<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Ticket Not Found.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ticket<span class=\"token punctuation\">.</span><span class=\"token function\">increaseReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> sequence <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">,</span> sequence<span class=\"token punctuation\">,</span> memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 328px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.04878048780488%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVR42mVRSYqEQBDsz7jv7YYK4i4e3FAEl6v/f0IOkdAO03MIKszMiopIX5IkkSiKDwRBYMiyTJqmMUcdc6qqch2nruvc/8ar6zrq+/7BNE00DAOt60rjODIwsywLhWFIcRyT67pU1zUdx0Ge55GiKL+CWZZR0zSU5zmBV1XF323bUpqmTw/ccRyGaZqUJAmVZckcjh9B27Y5jmEYZFkWn5/4GMTr6AOYDYKAZxD9s4Y/ked5puu6OCLibttG53nSvu/Mi6LgmFEUsaP7vtktBCH8b4co4lXf9+n9fvNOwFGDI7jGDwAQFz3c+Xb2EfwBZn/Dynw10SEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2023 08 16 ash 18\" title=\"\" src=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png\" srcset=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png 328w\" sizes=\"(max-width: 328px) 100vw, 328px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>테스트 실행 결과 성공적으로 10장의 티켓이 예매되었지만, 이때 주의할 점이 있다.</p>\n<p>그것은 요청이 들어온 순서대로 처리되는 것이 아니라, 재시도의 타이밍에 따라 결정된다는 점이다.</p>\n<p>이는 요청의 순서에 따라 티켓 번호를 할당해야하는 상황에서는 적절하지 않다.</p>\n<h4>비관적 잠금</h4>\n<p>그러면 이제 비관적 잠금을 통해 해결해 보자.</p>\n<p>아래와 같은 방법으로 비관적 잠금을 적용해 보았다. 우리는 Ticket의 reservedAmount를 갱신해줘야 하기 때문에 PESSIMISTIC_WRITE 즉, 배타적 잠금을 걸었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TicketRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ticket</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Lock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LockModeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PESSIMISTIC_WRITE</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select t from Ticket t where t.id = :id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ticket</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByIdForUpdate</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ticketing</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> ticketId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Ticket</span> ticket <span class=\"token operator\">=</span> ticketRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdForUpdate</span><span class=\"token punctuation\">(</span>ticketId<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Ticket Not Found.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ticket<span class=\"token punctuation\">.</span><span class=\"token function\">increaseReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> sequence <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getReservedAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">,</span> sequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트 실행 결과 정확히 10장만 발급하는 데 성공했다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 328px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.04878048780488%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVR42mVRSYqEQBDsz7jv7YYK4i4e3FAEl6v/f0IOkdAO03MIKszMiopIX5IkkSiKDwRBYMiyTJqmMUcdc6qqch2nruvc/8ar6zrq+/7BNE00DAOt60rjODIwsywLhWFIcRyT67pU1zUdx0Ge55GiKL+CWZZR0zSU5zmBV1XF323bUpqmTw/ccRyGaZqUJAmVZckcjh9B27Y5jmEYZFkWn5/4GMTr6AOYDYKAZxD9s4Y/ked5puu6OCLibttG53nSvu/Mi6LgmFEUsaP7vtktBCH8b4co4lXf9+n9fvNOwFGDI7jGDwAQFz3c+Xb2EfwBZn/Dynw10SEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"비관적 잠금 테스트 실행 결과\" title=\"\" src=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png\" srcset=\"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png 328w\" sizes=\"(max-width: 328px) 100vw, 328px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 890px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJElEQVR42o2Ta46DMAyEex0IISS8kbY8W0C0vf9tZu0ssLQVpT8sOc5k+OyEU1EUyPMcWZZhvD3QXQdc+gHttccwPXAuK6Rphr5vcZ8u+DnTOklQ1jXG6U76kbQDmq5DHMc4VbTBiecJSCnh+/5TqCCANgbS8+DTvglDW2ftVh+QLtCGDRtEUQTHcSCEeArXdSFZrLXNXapxzkZCuP9a1lFNBXo2JEI+4BHFNljs+8p+mXOusSETvWoXymNCycI/Qq5x/kYoXgmjD4RK2RkuhJxbwnn9Tth8P8N9QjETkmFZ1dZQfD1DczBDIowPLkWbcNNy+KFlmmHdtvaW91peCG3LFPZNUnvLCLaXshomabpLGIYxPeZoPRzTX6NUsBIvIeef4BcieFbPI1s/lgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"비관적 잠금 테스트 실행 테이블\" title=\"\" src=\"/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png\" srcset=\"/static/dc635a507f55f85f17cc2d170ca160dc/0eb09/2023-08-16-ash-19.png 500w,\n/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png 890w\" sizes=\"(max-width: 890px) 100vw, 890px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>또한 출력 쿼리문에서 select for update문을 통해서 DB의 특정 row에 잠금을 거는 것을 확인할 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1klEQVR42p1T207CQBTkN0ATEkPplXu5lNJyvzXCK34H0UQSoz+ARhP93nHnxDWAVaMPhz1dunNmZ6YZ13VRq9XQbDZlrdfr4J7neVLs/1IZ/kynUyRJgtlshuFwCMuy4DiOrP8C1IfJrtPpoN1uo9VqodvtolQqHTE+rVRADer7Pvr9PsIwRBAEGI1GAmiappRt2zKYPVc+81wqIP+kjgQkM1YcxyLD4UpJlsulDGOVy+Uj0COG1WpVmPHKZKtBOYg95SB7PZTvVSqVdEBegS9MJhMB4SH2i8UCURTJ3nq9FgPJjGd49VQNGRdOYtEYsiNbHaNGoyEsuc+e+9+aQrqDwQCr1UomG4bxKbw24XDl+6dGpJqimTIuZKL1Ya+Z/gR0BMjpZMaD1Gw+n0vQec3xeIyRcpYmmAz6L1+PAFJ0xoEOMwYcoL8SW7EyGHwmQYHZqpyPsl0PRdf7CkgNdc7Iklpp5q4C2zp57IpZ7Kwz3Jg5bI0sros53Kr+zj5Pv3KhUBAHCU7GPZW3sRqyiHt49Qu4Ws4xaPpIoh42lwk2iZKmH2Pv5OC7trD9BNT2nwY7DLuoqyH3Xh5vgYOHygX2bQcvURVPgYfHloVnBVhylfMfDN8BTR3cFiDYN00AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"비관적 잠금 select for update\" title=\"\" src=\"/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png\" srcset=\"/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png 470w\" sizes=\"(max-width: 470px) 100vw, 470px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>이렇게 비관적 잠금을 통해 동시 예매에서 발생하는 문제상황을 해결할 수 있었다.</p>\n<br>\n<p>하지만 모든 상황에서 비관적 잠금이 효율적인 해결책인 건 아니다.</p>\n<p>비관적 잠금은 단일 DB 환경에만 적용 가능하다. 분산 DB 환경에서는 동시성 제어의 효력을 잃는다.</p>\n<p>또한, 많은 대기 시간이 발생한다는 단점도 존재한다. 한 트랜잭션이 완료되기 전까지 다른 트랜잭션들은 대기상태에 빠진다. 동시에 많은 요청이 들어왔을 때, 사실상 하나의 요청씩만 작업할 수 있으므로 요청의 수가 많아지면 대기 시간이 길어진다.</p>\n<br>\n<p>우리는 단일 DB 환경이고, 몇만 건의 동시 요청이 예상되는 상황은 아니므로 위의 단점들이 치명적이진 않다고 판단했다. 따라서 간단하게 적용할 수 있고 데이터의 정합성을 보장하는 비관적 잠금을 통한 해결책을 채택했다.</p>\n<h1>마무리</h1>\n<p>티켓 예매 예제를 통해 동시 예매 상황에서 발생할 수 있는 문제 상황과 그에 대한 해결책들을 알아봤다.</p>\n<p>메세지큐 도입이나 분산 잠금 등의 다른 해결책들도 많이 존재하지만, 우선 가장 간단하게 해결할 수 있는 방법인 비관적 잠금을 통해 해결했다.</p>\n<p>서비스가 커지며 분산 DB 환경이 되거나, 현 상황에서 발생할 수 있는 문제가 발견된다면 그때 다른 구조를 도입하도록 하자.</p>\n<hr>\n<h4>참고 자료</h4>\n<ul>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html\">15.7.3 Locks Set by Different SQL Statements in InnoDB | Mysql</a></li>\n<li><a href=\"https://tecoble.techcourse.co.kr/post/2021-07-11-database-transaction/\">데이터베이스 트랜잭션 | 테코블</a></li>\n<li><a href=\"https://www.baeldung.com/jpa-pessimistic-locking\">낙관적 잠금과 비관적 잠금 | Baeldung</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html\">공유 잠금(S lock)과 배타적 잠금(X lock) | Mysql</a></li>\n</ul>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"들어가며"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"대학 축제 티케팅 서비스 "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/woowacourse-teams/2023-festa-go"},"children":[{"type":"text","value":"페스타고"}]},{"type":"text","value":"를 개발하면서 아래와 같은 고민을 하게 되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"티켓 오픈 시간에 많은 사용자가 동시에 티켓 예매를 요청하면 어떠한 문제가 발생할까? 그리고 그 문제를 어떻게 해결할 수 있을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기서 가장 중요한 것은 요청 순서에 따라 티켓을 발급하되, 준비된 수량만큼만 발급하는 것이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이번 글에서는 위와 같이 ‘동시성’에 대한 고민을 한 경험을 공유하고자 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"참고로, 이번 글에서는 개념에 대한 깊은 설명은 따로 하지 않는다. 모르는 개념이 있다면 아래 참고자료에서 개념을 익히도록 하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"예제 코드"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아래는 티켓 예매 상황을 간략하게 구현한 예제 코드이다. (실제로는 더 복잡한 요구사항이 존재하나, 이를 단순화하여 작성하였다.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아래 예제 코드는 MySQL 8.0 innoDB 스토리지 엔진 기반으로 동작한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"먼저 사용자가 “티켓 예매” 요청 시 호출되는 TicketingService의 ticketing 메서드이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findById"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"IllegalArgumentException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Ticket Not Found.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"increaseReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketNumber "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아래는 Ticket 도메인 코드 중 일부이다. increaseReservedAmount 메서드 호출 시 예매 수량과 총수량을 비교해 예매 가능 여부를 판단하고, 불가능할 시 예외가 발생한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"access "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccessLevel"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PROTECTED"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" totalAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" reservedAmount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/***/"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"increaseReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"reservedAmount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">="}]},{"type":"text","value":" totalAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throw"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"IllegalArgumentException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Sold out.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        reservedAmount"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"순차적 예매"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"모든 사용자가 순차적으로 요청한다고 가정하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해당 테스트에서는 10장의 티켓을 30명의 사용자가 예매하는 상황을 가정했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" 티켓_순차적_예매_테스트"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// given"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" memberCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"30"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketAmount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"text","value":" successCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"text","value":" failCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// when"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":" memberCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" i"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"try"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            ticketingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            successCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndGet"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"catch"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Exception"}]},{"type":"text","value":" e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            failCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndGet"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"out"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"successCount = \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" successCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"out"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"failCount = \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" failCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" reservationCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"count"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"assertThat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"reservationCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"isEqualTo"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Math"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"min"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"memberCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" ticketAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"실행 결과"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 334px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 28.74251497005988%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVR42m2QVwqEQBBEPY05B0ygiIg5gR+i3v8avVSDbmA/inHKmpp+I8iyTKIosj6/JUkiwzB4vaWqKgs5XdcfaZr2SKjrmuZ5pnEcqWkamqaJ1nWlbdtoWRb2hmHgfdu2ZJomZVnGlx3HwVlFUd6FeZ5T13WE4rIsWfju+56KouA9SquqojRNeaIwDHlFDuWY+il0HIcNBCzL4glwI7ARgA9cYML3fZ9wBv9u/wsZiNd1MTYQgbDvO+MAE75t2zwhis7zZP2+3VOIt4jjmJIkoSAIGCeKIsbzPI9c1+XDyEF37l8ZCl+pX8U+VCSsoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"순차 예매 테스트 실행 결과","title":"","src":"/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png","srcSet":["/static/cddcd5e72fd1754fc8f512263ba13f61/ce235/2023-08-16-ash-0.png 334w"],"sizes":"(max-width: 334px) 100vw, 334px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해당 테스트는 당연하게도 성공했다. 예상한 수량인 10장만 정확하게 예매되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"티켓 예매 내역을 기록하는 Reservation 테이블을 조회해보니, 1~10번 티켓이 각각 한 장씩 예매된 것을 확인할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 902px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 57.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVR42o1SS08bMRjkt5SkWb/t3c1uNg1leQQUccgpNK+26qVSe2orVXDgvw/jzYISFAKHkeXvG49n7O/oIUvws7C4m1zg/1WNf+Maf88/4Z77P3WF+0zg6vQzptMJ6rNzVMMKZVUhn85wObnB+HqCs8sxRicnMMbgaJkZHIcMflDBFINnWEL0S9ymFnWeYTAs0S8KZHkfIQS44Qh5wVq/QE7EXiP41Qt0hYQWAuoJMq4JhFJYO4FC9NDtCVhrCQcROUkCyTVCkOuc3wiug0JXaRitoXegII3Fgv1KCyTkeB8ID8WLtrlxH0K6EVx5iY4kgUX1AkIbzJ1EqShITnRnnYOUcocX9/Gytx0y4pL9UknG1427ePCgw29BNoL2NUEmGNDh24Ktw2UU3BtZbiJTsGgjO8Z174nceUVQkrBIdSsoG4eOB/cKhm1B1VrfAT+FkVfNG24E42g4ih50+IORP7Jg2TDbYM3wV79z8OMbJqyladbg4Kf8th3MxAfM5TEWRFxXxBfWFqaHXz6B56CL1sU+h/F54khF8UcdJHhNOSAN2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"순차 예매 테스트 DB","title":"","src":"/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png","srcSet":["/static/4b5dab5c9305ad0001a24f1ffd807e7d/0eb09/2023-08-16-ash-1.png 500w","/static/4b5dab5c9305ad0001a24f1ffd807e7d/8d021/2023-08-16-ash-1.png 902w"],"sizes":"(max-width: 902px) 100vw, 902px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아주 성공적이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만, 티케팅 상황에서는 다수의 사용자가 순차적으로 요청하기보다, 동시에 요청을 하는 상황이 더 일반적이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"동시 예매"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"동시에 여러 요청이 발생한 상황을 테스트한 코드는 아래와 같다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"순차 요청 테스트와 같이 10장의 티켓을 30명의 사용자가 예매하는 상황을 가정했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" 티켓_동시_예매_테스트"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"InterruptedException"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// given"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" memberCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"30"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketAmount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ExecutorService"}]},{"type":"text","value":" executorService "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Executors"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"newFixedThreadPool"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"30"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CountDownLatch"}]},{"type":"text","value":" latch "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CountDownLatch"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"memberCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"text","value":" successCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"text","value":" failCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AtomicInteger"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// when"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":" memberCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" i"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        executorService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"submit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"try"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                ticketingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n                successCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndGet"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"catch"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Exception"}]},{"type":"text","value":" e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"out"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n                failCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndGet"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"finally"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                latch"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"countDown"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    latch"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"await"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"out"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"successCount = \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" successCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"out"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"failCount = \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" failCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" reservationCount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"count"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"assertThat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"reservationCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"isEqualTo"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Math"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"min"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"memberCount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" ticketAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"실행 결과"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"정확히 10장의 티켓이 예매되는 것을 기대했으나, 테스트 결과는 그렇지 않았다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 31.16883116883117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVR42l1RSY6DQAzkNSwJhH1TEIk4cQAECBIgBw7h/1+oUVlqNDMHyy53eam2dr1eYds2LMuCiumVua4Lx3HOd8/zBF8ulz88ZZppmmiaBu/3G9M0oW1bDMOA1+uFZVmwbRu6rpMc8bquCMMQVVUhjmPhPx4PGIYhy2iclGUZns8nyrLE/X4XI4m5oiiQ57lgxmmayoZKCblRFJ0KpCEnKbl8DIJAsK7rQrzdbuKphkYOa8gnVs3Ohn3f4/v9ipxxHDHPMz6fD47jEE/ZSZKcMuu6xr7voogNf/+7pgJO5d/4vi8bMmYxYx6GRdyUnodR+f/H+QFGtcVxH36U6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"동시 예매 테스트 실행 결과","title":"","src":"/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png","srcSet":["/static/d566bdefcf309d24f07f8306f72e6d3c/9e38b/2023-08-16-ash-2.png 308w"],"sizes":"(max-width: 308px) 100vw, 308px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"10장보다 적은 6장만 예매되었음을 확인할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"티켓의 수량보다 많은 요청이 있었는데, 왜 더 적게 예매되었을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출력문을 보니 아래와 같이 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Deadlock found when trying to get lock; try restarting transaction"}]},{"type":"text","value":"이라는 문구와 함께 SQL Error가 발생했음을 확인할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1926px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 14.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdUlEQVR42jWO1w0AIQxDWYhD9N72H8onR+LDshWcR1TvHa01lFIw55TM2d5b3Dknznc6VWuVuTFG3FoL7z201lBjDFAsnXMkr7Vw75XMhfcRnTNCCSAohCA5xojv+6BYJCznLOV3IaHMXHpXvS5F0ANSKSUB/vPdYxA3yEwTAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"동시 예매 테스트 데드락","title":"","src":"/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png","srcSet":["/static/cc8410f88d230a4487d366c5b8f39c71/0eb09/2023-08-16-ash-3.png 500w","/static/cc8410f88d230a4487d366c5b8f39c71/1263b/2023-08-16-ash-3.png 1000w","/static/cc8410f88d230a4487d366c5b8f39c71/5dd2a/2023-08-16-ash-3.png 1926w"],"sizes":"(max-width: 1926px) 100vw, 1926px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"lock을 얻어오는 과정에서 Deadlock 즉, 교착 상태가 발생했다. lock을 얻어오는 행위를 따로 하지 않았는데 왜 교착 상태가 발생했을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"교착 상태가 발생한 이유"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"티켓 예매 내역을 의미하는 Reservation 엔티티를 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"access "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccessLevel"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PROTECTED"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ManyToOne"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"fetch "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FetchType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"LAZY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 412px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 126.21359223300972%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEZElEQVR42m1Va1caSRD112QjM4MgQoB5MO83MLwRjSKuqDFmc5Lsbs7u5/3dd2+NAaMnHy5dU11Vfbu6qjhQVRX1ev0Fjo+PcXR0BK3KvVqNchVH1Sf8yrZGG4kjONA0Db1eD47jwLbtEpZpophMsd7eI4oTpP0Bsv4Qad6H67qwab+zFYi/xCkDVnmqoevotNvodrvQf8jZcITV+hohA06XZ5ifXmA0W8Lq2aWd+AjE3jCM54CqqsDxfAwnMzpn8MIIbhDCdj30HLLhnqw7OH5Q7rteQL8nWfQSTFEUHChKBdFgiu9/bfH5bo7F5hEmDQzH4yrwYdg72YPec+FFKQajCfrFGAlTYZL1nqFE9cIYg6JAnoVwwoQGDiw6Wwxs2swtWckhopPvHtnLTQKmw6XvC4Yqf6Isx923fzA93+D06hYX20esNndYXP6O7efviIeT8vv9zUdc3n7Ccr3FknZBkpHh4DXDCq8QI5/MyS6Gy+uE2QCe5DNO4Sc5onxI3RBOECNh8KhfwE/7sFy/hGH1nhlqFHw6b7/8jcnZGiO+pqxpMUU8GGP+/hrF4hwjYnp+Veaz1dXR1k0+WIAwzWGQoVSLsDyoVCpI8gGWFxv0RzOu11i832C6usBcUnB5g/HynIGp42GSM8t+yq28sPhalJ8ZMmrZFVyrVW1f8RplMWgc1/H4+AldMmq23pVotVmvhoV2R2eX1Ev/faeIkwjCVCDfO8i3tN3idIXBZImUKXBDedmUD5KTYby32/kclGy0Z2a/QqvVROXwEAodNY32cj0JUn6/9N0zPKwoe1QUtYTICvc6bLW9fmfzk+3PtyoZVnlKt6HCbGrQGwreVd9AP64QSonAbKJbr5QodbQxaGucqNBPnhjvGcoJ9aoC32zB4JSRabK5/4g4ZR16HkLWqB+G8IMACXVBFMHzfZiGXtrH5gmO1Mqe6YGqVdGoaYi4YXRaCD0btw8fMBr2sZjPcLVh6SyXJS7XV1itVpiMR3DMNhxLR2Y1SIjstF0dMnJNU9D3OpgUKfLQRuQaCG0dgd1F0OsQ3T1CR0dExC7Z+TYGTvM1Qw019S2K8RR/frvB/fYUs80ndCwHHXZFpyfwKftoWxxhQYKMXZQNxwjyUXlgTeOLq9pzDkUxiS2sxjFmqYnM7yFxuoiJxNV/yB3KT7rcNzGMbKS+hcL9JcNDjIsc26//4uz6A1acJOv7z5wuD8jG83LqnF5tcf3xK9Z3f2DGnnb9kIU+QmK/YqgIQ56Qxx7/NzhF2KsyYWTiBJwoaTFBQFkmjEwaua7sy0DoMWhkt8nw8JmhQoZNKk44ebUv/6G/eeAwuMDs8hajsw28rMDs4gZ2lKHR5n8Ic1keyMPcZMDHe82QQoOKIHagX14jZ9+upgXOV0usFlOcEuerBfLI5avrSAMbozzEmOjzVn2+slTJPuBusjSrh2irb8j2DY61t6jLqv6Gk6NKuTa5vqsraNUUnFQrT6CuWX/Z9/8DdRtjqpaAeLEAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"DB ERD","title":"","src":"/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png","srcSet":["/static/01aa95d4ffa12adcada14dede843701a/1f9f1/2023-08-16-ash-4.png 412w"],"sizes":"(max-width: 412px) 100vw, 412px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Reservation 엔티티에 Ticket 엔티티와의 연관관계를 설정해 줌으로써, DB의 reservation 테이블에 외래 키 칼럼 ticketId가 추가되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html"},"children":[{"type":"text","value":"MySQL 공식문서"}]},{"type":"text","value":"에 아래와 같은 내용이 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"FOREIGN KEY"}]},{"type":"text","value":" constraint is defined on a table, any insert, update, or delete that requires the constraint condition to be checked sets shared record-level locks on the records that it looks at to check the constraint. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"InnoDB"}]},{"type":"text","value":" also sets these locks in the case where the constraint fails."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"즉, 외래 키 제약 조건이 있는 테이블에서 레코드를 삽입, 갱신, 삭제할 때 해당 제약 조건을 위반하는지 확인하기 위해 관련된 레코드들에 공유 잠금(S lock)을 설정한다는 뜻이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"공유 잠금이란 다른 트랜잭션의 데이터 변경을 막고 데이터 일관성을 유지하는 잠금 유형이다. 여러 트랜잭션이 동시에 공유 잠금을 얻을 수 있다. 그러나 공유 잠금을 설정한 트랜잭션이 있을 때, 다른 트랜잭션은 해당 데이터에 대해 배타적 잠금(X lock)을 얻지 못한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"배타적 잠금은 한 번에 하나의 트랜잭션만이 특정 데이터에 대한 쓰기 작업을 수행할 수 있도록 하는 잠금 유형이다. 다른 트랜잭션들은 쓰기 작업이 끝날 때까지 대기해야 하며, 이를 통해 데이터 충돌 문제를 방지한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실제로 innodb의 로그를 확인해보니, 여러 트랜잭션에서 데이터에 잠금을 거는 과정에서 교착 상태가 발생했음을 알 수 있었다. 아래는 로그 내용을 간략화한 것이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"LATEST DETECTED DEADLOCK\n------------------------\nTransaction 1 (ID 20238):\n- Holding S Lock on data ID 1 in table `ticket`, Waiting for X Lock\nTransaction 2 (ID 20240):\n- Holding S Lock on data ID 1 in table `ticket`, Waiting for X Lock\nTransaction 2 Rolled Back"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"로그를 토대로 아래와 같이 교착 상태가 걸리는 과정을 알 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1356px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 66.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACGklEQVR42nVS246iQBDl/x+Niy8mvvoB64OJ2cwm7oMKg5qZHZlBvCAo4gjqgMilz3a14rCb2U5OF9XU9VRJYRjCtm2sVisBz/Ow2WywXq/Fu+M4d1nYbLdbYUMo3sg+SRJIu90OmvaIfq+Her2OSqUCWZZRrVbRarUwGo2gqiq30QQajQZqtRrkbzJkLpvNJvr9PsbjMaIognQ6nbBcWiIbVWFZFteXQpJOmUknUKWLxQKmaWI2mwmQXlR5uVwgZTlwDj28/e5BUTVejYJ2u42HhweRVTdMhOEHGGMAGIT44uR5jizLICVJijiOcAj2oPZd10UQBHjf7xH4e3yfRng/RcjThDsx4UjBy5JA/KVpCoku+lE2un5fK/LODJuQIYpDzA2VV/0kuOx2u+h0OtB1HdPpFMfjUfiJgIS/g+U3nYPLX06Kn1aEMHA51y7m8/mdb+Le930xENEyXRSQiB4OhyK7oihiugvuaLseVA84XPIrVzcSi+RliIAUjPqn/TMMQ2QvpklvH3wL/HMG65jehsL+G+zOISmsNL6Cw+yGmA/OOcSwnTXmiyX0NwODwUB0RKtDbcdx/FnhvxMjgF05pKrynLIn2O88LE0DxuQZEz6MVw7qiraDuiQ/qdifMlKORy+Dss3ww75Kjev6IYfmMzwd2S3RZyFFl9JXS5px+9kJWIXAcwBMOF44zBPD64HBLAKWVq04fwBd29DiSt+R0gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"교착 상태 과정","title":"","src":"/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png","srcSet":["/static/9f5d4bf32d734851fba53c6ad6a4ab35/0eb09/2023-08-16-ash-5.png 500w","/static/9f5d4bf32d734851fba53c6ad6a4ab35/1263b/2023-08-16-ash-5.png 1000w","/static/9f5d4bf32d734851fba53c6ad6a4ab35/2637b/2023-08-16-ash-5.png 1356w"],"sizes":"(max-width: 1356px) 100vw, 1356px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트랜잭션 1이 id=1인 데이터에 공유 잠금을 얻었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트랜잭션 2가 id=1인 데이터에 공유 잠금을 얻었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트랜잭션 1이 id=1인 데이터에 배타적 잠금을 얻고싶지만, 트랜잭션 2에서 해당 데이터에 공유 잠금을 걸어두었기 때문에 대기한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트랜잭션 2가 id=1인 데이터에 배타적 잠금을 얻고싶지만, 트랜잭션 1에서 해당 데이터에 공유 잠금을 걸어두었기 때문에 대기한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"무한 대기상태에 빠진다. 즉, 교착 상태가 발생한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"연관관계 제거"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실제로 교착 상태의 위험성 때문에 외래 키를 사용할 때는 신중해야 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"교착 상태의 문제를 해결하기 위해 Ticket과 Reservation간의 외래 키 관계를 제거했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"access "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccessLevel"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PROTECTED"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"ticketId "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"ticketNumber "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"연관관계 제거 후 다시 동시 예매 테스트를 실행하니, 교착 상태는 발생하지 않았다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 총 수량은 10장뿐이지만, 30명의 사용자 모두 예매에 성공하는 결과가 발생했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 286px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 27.97202797202797%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVR42k2Q38qCUBDEexrN1CwtNRVE0gtBvNGk8G+C0Pu/wMQsnL7vYjjn7I4/d3bnOA5s28b5fAbvSqfTCbfbDa7rwrIsqQVBIHX6+T4ej0jTVHymaYp227ahbVt0XYdhGPB6vTBNE97vt9TXdcXj8cDz+cSyLIjjGFEUIc9zAX8+H8zz/AfkX33fx+VykQk8z0MYhqLr9So93tnntJxqv9/jcDgIUPV+QJpo4MkYjM63ruswDEMAPAmg6KFXAVTvBxzHEX3fo65rNE2DqqrAGmNyDYxJaFEUMk1ZluLTNE12q/QDMtL9fpfdJEkiyrJMRAD3RSDj8QO1Ak6mIP/1BU0LyC8w8gHFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"연관관계 제거 후 테스트 실행 결과","title":"","src":"/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png","srcSet":["/static/8386a9547c96ca05ff2650044c725bb4/9e45f/2023-08-16-ash-6.png 286w"],"sizes":"(max-width: 286px) 100vw, 286px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"어떻게 티켓의 수량보다 많은 사용자가 티켓을 예매할 수 있었을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DB의 reservation 테이블을 확인하니 그 이유를 알 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 882px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 156.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42q2WSXPaQBBG+SU5uAKSZrSMAC3BdiLQAiYL5JSY3ZVU5eb/f/vSMygq2cUMSpUPXWJ9vK+7JdGb3N6imiRYpWMclwvs5iU2VYHHMsf+8wN+Tu+xTGOU9PzblwofsxnSNMXdPb3+dYVy/oCiWiAvKnyYTNCbZRn+jDjWvI/vbh9rd4C1Z2FFJY9r38azsBC7DMx1IcIQQgi49NjzPCq/Lg9hOESvIuBmyHHDON5zj8ptqs853nkBfgiGmNmw6DMSFgQBGGPg9H67hAjPwAMBXc7gufxF+WTl+D62EsgdONKQgLIkQFq2qzHcE/DSL8ofGVCcnXAaQ2nn6wwVcDqlyK4RuK2BtgSSnR8IM3BPwEsRZGzLD7ChyImMzM9DCUyRy+yTimwCSsOk7mFQD8XVAeczMhyZDXc10ObyS6GapsEw62DIGkO1NprIsh29RV7gFNEHqMmXgDYBHxWQkSFHFCUIh0M9cJ7nOI39y0D+LzKrI3OMx5H6otHwGJ33Shd5H7aAUax6pTec5TjEgTayMmwBR2R4HWgwtBWQv11kCdwoIGsiC5PhQ1HgKQqMQ2n3MIoTraHawwVN+WgA2q96aIqsgNLwGIvLkTWGuj1sgCddD2vDbXsohrVRwGVZ4inuDozjlAxH1w07D0VN2dRDMjzEofnUaxl27iF/qx4uOgB3LyIn2sVuIl9b7N3rtbkGPMbdI0dJej3y4T97eOVMKXGiM4U7jgK0y5cXBLqN7pt7ynkPh8Y9rCP3ydCiF9tl09XmRt1GHaRd16agi8PvyEPmDJBxm8pSxykdZd15HL8CC2Pm0D8H1kxZ99/mL3y6ytGHTHLpAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"동시 실행 DB 결과","title":"","src":"/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png","srcSet":["/static/63e80a317763eb47b903c2a81e6c8571/0eb09/2023-08-16-ash-7.png 500w","/static/63e80a317763eb47b903c2a81e6c8571/5f5e5/2023-08-16-ash-7.png 882w"],"sizes":"(max-width: 882px) 100vw, 882px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1~10번 티켓이 각각 한 장씩 예매된게 아니라 1번 티켓 10장, 2번 티켓 9장, 3번 티켓 9장, 4번 티켓 2장이 예매되었다. 즉, 하나의 티켓이 여러 사용자에게 발급되는 문제가 발생했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"순차적으로 예매를 요청할 때는 발생하지 않았던 문제였는데, 동시에 예매를 요청하는 상황에서는 왜 이와 같은 문제가 발생했을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"순차적 예매 실행 흐름"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1186px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC0klEQVR42oWU3U/TYBSHuTImJiYmJvrfEBNjonf6D6BGYzQhMcYrrxEixuCFRuONmIi4iFygcRjGlwjIwjYsMDbpuo7ysY1t7INt3br2sS3b2ATk3LQ97+8873lP33NaDMPAsnQ6zdzcHP6VAD6fj2wuZ/uTqsGADAVtTyeKor0eCATweDzkqroap4WqaZqGsLTM1PQ0Ht8CqlpEzII7buBcB28C4irspFJ4TeC0qQsGg6ZOpdHqwNoOYWXdhlummz7ddIsZ7KdR1eq6jqIoTXFNwIrtMzNRdFq/qPQKaXzuWSZd33m1kOXCCExFjeomUC6XWV1dPQ5YosOd5/xnaBuUmJlwkUvGuDuR50yfwZvAPrBSqRAKhY4G5nZ3Se+kKJtr31a2yJW0uiBrvjo3zRo3xFlASZKOBpbMI6RTSQJKnG6nwLKyzW+fl0Q8hpws0DkqsZlRm4DhcPhw4PquQTAkE1xwc+O1i5MPx7n3bgbBO8/w0CAXOwY59cDFs9G9I1ZMgKZVEKtH5l9gomiwsRVjS4kwL29z84MHz9rOXnBZZT6S5NbnAHKqWA/SzAyD4n9q2Lhg1cb6izXZr8gOV3oFHPNhfk6O4xcWeDsj0vpylqlwdWN9H9piVGHW3bI7wQSWSmVqmu4xiRP3ndx57yaxtc7U+CiXOgc5/WiSrmF/vQzHZlgztaLjCGTJqHrdl8yXccz9QdV0spk0hULhYOsdBUxk8vR89aAkMkghkbAUIhJL0eMYQYklyKS27X4+EmhdBwuoV787+8Y4d/Uxl9u7+eToJ7iyxO0n/Zy91kX78wHEzQRrZrv6/X477gDQ6oDGDBflGNdfOBnzraJre/4fixJtTz/ileNE8xphOYIgCHbtDwBlWW4C2r5c83U7tlNomCJDQ0NNIymvWUPDsANrwRsbm7auFtO4dgBozTgrg/2/DP50UxIUi0Wi0eihGf4FNkw9dGkC8dYAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"순차적 예매 실행 흐름","title":"","src":"/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png","srcSet":["/static/bd0a1777fe65ab9db8874f20b5ffb230/0eb09/2023-08-16-ash-8.png 500w","/static/bd0a1777fe65ab9db8874f20b5ffb230/1263b/2023-08-16-ash-8.png 1000w","/static/bd0a1777fe65ab9db8874f20b5ffb230/7e08f/2023-08-16-ash-8.png 1186w"],"sizes":"(max-width: 1186px) 100vw, 1186px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"순차적 예매 시 위 그림과 같이 한 스레드의 작업이 끝난 후 다음 스레드에서의 작업이 시작되기 때문에 충돌이 일어나지 않는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"동시 예매 실행 흐름"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1306px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACv0lEQVR42n2UTU8TURSGXRh/hHEjSxf+ABN/g0tj3PgHXBhjou4Ie2M0MTGaaERjCIoYDQINFQG1LZWPFiilH9S2M/0YoJ3PltKZx9vptJSCnNXcO+e+95z3fc894zgOrahUKgQCAUKLiyQSWzRshwPx60MGlnbaOYVisZ0TChGPx2k0GvTHmc5HvV4nnUqyuR6lWJCxBNqWBut7EKs6FGpgmSbJZJJIJIIkSdi2fTKg4y0qVp1wVnG/dV3DrltEKqDUDg/UajVkWeZ/4QI2PcT7YYcLH+Hp9Cozn94z7F9iYAxuzTvdA5Zlkc/nTwdsF37A86jBtRmbX6kyjqVSEpXd+CEuiB32YRomsmj3VMB2izqqppKVC+7a04qo4HBnX1QmKGi1a1g1VraLpwNWq1VMQbglknN5yavYJqPDpXG4OdsksDCH7+s4DyZTXPwMY5n2jU3nBMCW/KZpYYgqe9tR6nB9AYYiTXdt7Ck8C8hcnYSJtOXSYPcDmg0bQ/BSlLK8mV3h7pdNvgeXCYeCGFqVIf82L4OHIphClL9SQdis5tJ0rOVMtUF4aZl0LMLtsQ3O3pnmtX+V3VyaFyPjnH84xZVHv9lvtonQxeU5rwtd01yqev3Y9qGnQKKk8mo+zkGPX30plbCkH7GNLOU9IQ0XsHP+GGAruSAd9djb5TKTW3vksxnSyQRr+V2Gvm0QTeXQ1Qqd8y1xnF7buPwIYXLS4RTIWp2BwVkuD07xbmSUTHyNe6N/OCdoeezfQqlqrEdWyKRTXeA+QLM7BZ2qh1fKTGzudHNSZZUn/k2yepNwqYEvVmIuteuO6F69D9Dlx5vTDi2tabEOeiZFGFzeTqCJvaDiENyF+bJ4lbahaPVxqCgKPp+vbWtvzy87ZA2nC1gsiYoWfvZ04fQ8L30ctgyuquoRUYRNj5m3N/oh/wHtTv4Y8K8zDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"동시 예매 실행 흐름","title":"","src":"/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png","srcSet":["/static/61863fc9cd77a53b821987e4f2698cb3/0eb09/2023-08-16-ash-9.png 500w","/static/61863fc9cd77a53b821987e4f2698cb3/1263b/2023-08-16-ash-9.png 1000w","/static/61863fc9cd77a53b821987e4f2698cb3/2d324/2023-08-16-ash-9.png 1306w"],"sizes":"(max-width: 1306px) 100vw, 1306px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"순차적 예매와 달리, 동시 예매 시 위 그림과 같이 한 스레드가 데이터를 읽고 이를 갱신하기 전, 다른 스레드에서 데이터를 읽기 때문에 충돌이 발생한다. 이 이유로 여러 개의 트랜잭션에서 동일한 티켓을 예매할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제부터 위 문제 상황에 대한 해결책을 알아보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"해결책"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"synchronized"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"java에서 한 자원에 synchronized 키워드를 붙이면, 멀티 스레드 환경에서 단일 스레드만이 해당 자원에 접근가능하도록 보장한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그렇다면 ticketing 메서드에 synchronized 키워드를 붙임으로써, 동시에 들어오는 요청들을 순차적으로 처리할 수 있지 않을까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"한 번 실험해보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아래와 같이 ticketing 메서드에 synchronized 키워드를 붙여주고, 동시 예매 테스트를 실행하였다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"synchronized"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findById"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"IllegalArgumentException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Ticket Not Found.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"increaseReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" ticketNumber "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" ticketNumber"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 30.76923076923077%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42l1QyaqEQBCbjxF3VBB0BsSD+4oKetCb//8RGVJQ82beIXSqqiud9MPzPFiWJTBN83MStm0LtObMdV04jgPufXPFg82yLFHXNfq+R9u2GIYBXddhnmeM4yicmKYJcRzj9XohDEOs64pt2+D7/p8gX6iqSi5ziYLkBAVZ8+SsKApEUYQkSUSQvaZpfgWVaESNbxiGQHsaWaPqjvZ+HC7LgvM8se+7RDyOQzhxXReezyfyPJe4dHXftzil8Le7j8MgCJBlmSBNU/kjrRmPy7zDZc7Z/y+kgm9k38N5p+nfGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"synchronized 테스트 실행 결과","title":"","src":"/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png","srcSet":["/static/3f77a06fb1689024e2334be7b010f384/f00bc/2023-08-16-ash-10.png 312w"],"sizes":"(max-width: 312px) 100vw, 312px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여전히 결과는 옳지 않았다. 요청이 순차적으로 진행되지 않고, 병렬적으로 진행되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"@Transactional 키워드와 synchronized 키워드를 동시에 사용하면 어떤 문제가 발생하는 것일까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"@Transactional이 붙은 메서드가 호출되면, Spring은 프록시 객체를 생성한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해당 프록시 객체는 원본 객체를 감싸며, 메서드 호출 전 후로 transaction begin, commit을 수행한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1782px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 83.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAClklEQVR42p2Uy08TURSHu0BJlOgeMCYmBqOJCx9RkK0LYzQkrsAYV/4JLkxcuHbjY6EChtgGEKggpCImxAJBoUEFBUoLtDxaWlugD+hzOo/P207RqguLJ/nNTObe+eaec3/3GBCxGofJMHwJgTuGHmurYsANniWIhCg2DNlLPAPfBdQVgY24QiYj6RCfB7zLENsuHmhNb2FJhxnMRLCqW3RGfUx5VnKDmqax2zDUBp2U+75xMbjApU0XJYtjtC45c4OKpmapuwOefS9h6EiypzvF3h7xbAxjmvLoQFWHaXkVBawfgpOv4XQv1LyB4wJumvQiobCuyIRVmU2hVHa1xQCr38GpfqgbhqsjcKhVosr6iQthO+cCDqqDDo76Z2hPhPKrzpZBSM1L25GWk6HGomJ4rnDQKFNmUjnwLEXZsI2K7RlqQw6uRRfZH/zM40QgB5T/kbxh1bzAXNMsDqMD+8tFlh5OcL2zl0rHOIed0xyZn2Hf3FeaN4OClkFadqGuB1ADftQVN4p7AcUxi7LoRN1YFz6c8MKQMPDYCqrNB5Zx7t5u4fwdK+WPfFQIld730Ti8BokwadsokuUVUl8X0kAf6c4XSL0dSIP9Aj6PIVvqHcm5IiW5+dZHudioY0In+qDSDEaXnpIii6QlYXxFAXEAtFRSfCjrytYQVS9m9p5ziZygvsfLGQvcGNG49UGjqlvjiZNfVtL+kH4K8sCCyBlDTXLZ7BcbBSVtGqXtotDN8MCuz5HVvyGF5v8NmHutpLjXNU9dS5QGYfIGU5grTWEG7Gn9p1oRzaEwkloGf9tHaJxAa5sC8zQ8tYlW5KMY4k/gTiOIRCOMDgwJWyTJ+OPIWa3FUBOZgjR2AYzFYszO2f+72/wAYgXftqFrHRMAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"synchronized 실행 흐름","title":"","src":"/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png","srcSet":["/static/3a151c092d7ea2c8921ece68c113e71b/0eb09/2023-08-16-ash-11.png 500w","/static/3a151c092d7ea2c8921ece68c113e71b/1263b/2023-08-16-ash-11.png 1000w","/static/3a151c092d7ea2c8921ece68c113e71b/26cba/2023-08-16-ash-11.png 1782w"],"sizes":"(max-width: 1782px) 100vw, 1782px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기서 프록시 객체에서 수행되는 transaction begin, commit 코드는 synchronized의 영향을 받지 않는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"즉, 위 그림과 같이 T1 스레드에서 commit 되기 전 T2 스레드는 메서드를 시작할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이와 별개로 synchronized 키워드에는 몇 가지 단점이 존재한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"한 스레드가 메서드 작업을 완료할 때까지 다른 스레드들은 대기해야 한다. 이로 인해 프로그램의 성능이 저하될 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"또한 이는 하나의 프로세스 안에서만 보장이 되기 때문에, 서버가 여러 대인 분산 환경에서는 데이터의 정합성을 보장할 수 없다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"따라서, synchronized 키워드는 우리 문제 상황의 해결책으로 적절하지 않다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"잠금"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"잠금(Locking)"}]},{"type":"text","value":" 은 데이터가 읽힌 후 사용될 때까지 데이터가 변경되는 것을 방지하기 위한 조치이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"잠금 전략으로는 여러 트랜잭션 간 충돌이 일어나지 않을 것이라 가정하는 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"낙관적 잠금(Optimistic Lock)"}]},{"type":"text","value":" , 여러 트랜잭션 간 충돌이 일어날 것이라 가정하는 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"비관적 잠금(Pessimistic Lock)"}]},{"type":"text","value":" 이 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"낙관적 잠금과 비관적 잠금을 통해 문제상황 해결을 시도해 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"낙관적 잠금"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우선 우리의 코드에 낙관적 잠금을 적용해 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"낙관적 잠금은 아래와 같이 @Version 어노테이션을 통해 처리할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Entity"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Getter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"access "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccessLevel"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PROTECTED"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Id"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GeneratedValue"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"strategy "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GenerationType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"IDENTITY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" totalAmount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" reservedAmount "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Version"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" version"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/***/"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DB의 Ticket 테이블에는 아래와 같이 version 칼럼이 추가되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1174px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 5.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQklEQVR42j2KSQ6AMAzEeFK5JIitZCYV/P9DQ1UhTpYtT2YuZFOwqQYGr073Reu2K+/n78dZRw/k91HWnYSIUCmzXml2Ip+OwzUiAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Ticket 테이블 version 칼럼","title":"","src":"/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png","srcSet":["/static/1497ddb93d5df5a437de21bc3260aca7/0eb09/2023-08-16-ash-12.png 500w","/static/1497ddb93d5df5a437de21bc3260aca7/1263b/2023-08-16-ash-12.png 1000w","/static/1497ddb93d5df5a437de21bc3260aca7/683d4/2023-08-16-ash-12.png 1174w"],"sizes":"(max-width: 1174px) 100vw, 1174px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제 동시 예매 테스트를 실행해 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 290px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 31.724137931034484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA50lEQVR42mWRRw6EMAxF5y6I3mGB6EUgtvSyAe5/CY++JdCUxcfGdn7ykpeu66QoCsmyzPHOb9m2/dXHPKSqKhmGQa7rPjXohc84jtT3PavrOpqmiYZhoHmeWfhHb993njVNk6qqIt/3ads2Nn4MNU2joiiormvKsozSNKWyLFlN03ANfRggRlHEC2EG4ziO/w2BJYoiNyzL4kFJkkgQBI7AA/Kdw8zzvAf9Cxn3AqTzPB9sYK3ryrjHcTAqNmnbljdfloWu6+Lap9lzQsdxKM9zPn4QBBSGIaMlScI5avcDwOSz9mv4BmeMxVYXq1FIAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"낙관적 잠금 테스트 실행 결과","title":"","src":"/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png","srcSet":["/static/18ca5286a1800b6552bf57f371c5f607/bd800/2023-08-16-ash-13.png 290w"],"sizes":"(max-width: 290px) 100vw, 290px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"결과는 여전히 실패이다. 10장이 아닌 5장만 예매되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"reservation 테이블을 조회하니, 잠금을 걸지 않은 코드와 차이점을 발견할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 810px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 36.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABXklEQVR42n2PW2/TQBBG80uQSmMn3ou968tmmyYqSZzEpRcpD23FAyoRVCAq3vj/h7EVIYQQD0czmplv5ptROV/wUmb87NZ8fb/ne9fyslry2m35sm/5ER3H6Lk93NJ1OxaLJTHOuL675/rmnv3NHZvtnna7I4TAKF6t+Fxp5k1D1szQdYOpw0AqrJqKD17jYyA0NReXS7z31DJf1TVlVQ2xqnoqRvPVhmcRhGlCphRGZWjBSp5mGa2zPJiUt1OFNYYmyFHpKempPp5yozVODo3m6w2fSs1MTcmMxYiopxen2rArC55syljyIs8Js/h75k+stfiylJffrTn6jKgmKBFZudSTC1NhVxiexOG5kpqIBodS/5t+qfNl77DlWRwW8uaZyRmLy3MhEd5oy9I7HvMJyclhvLj8v8NqccU3N+GozjjohAc95vHEQY15dSkfbTIcKnqHw8v2nwud8/wCQVHg+JqyJEkAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"낙관적 잠금 테이블","title":"","src":"/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png","srcSet":["/static/cd219d4ae481d269d8ea1671131368f5/0eb09/2023-08-16-ash-14.png 500w","/static/cd219d4ae481d269d8ea1671131368f5/249e2/2023-08-16-ash-14.png 810w"],"sizes":"(max-width: 810px) 100vw, 810px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"한 티켓이 여러 번 발급된 이전과 달리, 1~5번 티켓이 각각 한 장씩만 발급되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 28.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVR42mVQyaqDUBTzc9Q6teKsKLpxJ85QiwvXgv+/SskBxb63CMcc781Noui6DsIwDDwejwuWZQk0TRNu2zZM0/z57zjOv3vK5/NB27ZomgbDMAimacL7/Ubf9+i6TnbruuL1eqGqKnieh7Isse87wjCEqqqXsJJlGdI0RRzHF7hLkgRBEMh3FEUCXqJjJvJ9H3mei1PyyyFf5UHO5/Mp0c4KXNeVSU4hcgqfVdDZXUwEt23DOI4SeVkWiTfPs+xYB50URSGzrmscxyGuKXbv9Mche+Dr7IZgVHI6ppvz8Jnkb8y74BfJsMVTfzsVCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"낙관적 잠금 100명 테스트 실행 결과","title":"","src":"/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png","srcSet":["/static/d8349964ba560546c4370fe7984eb2d9/9e38b/2023-08-16-ash-15.png 308w"],"sizes":"(max-width: 308px) 100vw, 308px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"사용자 수를 100명으로 늘리고 다시 테스트를 실행하니 10장이 다 발급되었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같은 상황이 발생한 이유에 대해 알아보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"낙관적 잠금을 사용하면 아래와 같이 버전 정보가 update문의 조건으로 포함된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 382px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4UlEQVR42pVUyW7TUBTtP9DQQaJNaZx4eLYzOYNTZ7Azk5EmoQ1iwwaEBBs2XYJACImEYUERtJvCArHgGw/3PZrIEWlFFkf3DX7nnXfvuV7TNA26riMajSKRSMzBGAPfWxVriqLAtm0MBgOMx2MMh0P0+33E43HwvZUJZwPDMETkyjhUVRWYra1MyA9xRalUCq1WC+12W6jtdruIxWJz8v8i5B/Lsiwiz6dlWUgmkwKr5lPkMJ1Oo9frodFoYHaBH7M0+FPixwIhP8ArfHBwIBTxeSQSmYMrD4fDInJIkrSwzwX5i7fwZA5e3Xq9jnK5jFqthkKhIOau6wo3dDodeJ6HSqUi4DgOcrncnHShKIamImEacPN5VN0SKoQ8kdQ8F6W8Q+sOWpQWTl4sFsVl2WxW4N8qE/ZVDVIsAT1jQ7PSMLI5hIwo5HgSJo1lWmNUpDQ5geedi5g9e4GQk0U0hvtyEJN4CBd1G2dlC+eNHF7GJJxVMvjRc/GrmcNJrQiv0UTpUt1S2+hcHRF+UDbxWN3DXVPBKKpgTBjFGe7RvGuqOGFBvApvYFehvFO+l9nJR6jjUziAh5aB0YDar1bF4Z0mju/28aD3txCPMjG8iGzhNjOgs2uMLZ6sE5EWwjd1ExNlC+/kLUzVbUwIH+UNvJU3cS4HxAtC9Bp2lbG5VfJU1eOjI3SGI3jtLlL5AvYUlQ7q4vA+o0jYu5yz6zqFe5D/GHi/xgkmtR7fUOgi/ix2mRIeDd/Yv760l3nkFrDIEvyHUCVT26Q0QlZS6RKFFMoElc3GDBKpVTS2/G8zI46aJqysDdfU8UXbxjR0g4q1jqkUwERax5vwTbwnTCinF0oAR+q+cIi+jJAb1CLj5mt1PC3Z+EyeLFSq6Hgl0S2tCrWjV0azVEI0lcEzeQfP1R3sUm6vJqQfRJna69Cx8Tt2C9/dBKY5A2eOgVM3ia+OjlNbw2sjiJ/yOp6oQQR9hH8AEAqCToRqbToAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"낙관적 잠금 query version","title":"","src":"/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png","srcSet":["/static/f4483cb15aa12d529de117839109ce5d/29984/2023-08-16-ash-16.png 382w"],"sizes":"(max-width: 382px) 100vw, 382px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"일부 요청에서 데이터를 읽어왔을 때의 버전 정보와 현재 DB의 버전 정보가 일치하지 않아 요청에 실패한 것이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1732px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 68.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLUlEQVR42o2STWsTYRDHV/Doxc/gp5EevAqevKrFmyB4EiFQXw7i2Q8gCGmLHko1tNUIIc0qSds0G7dtdpM02U32Nfu++/eZJ1ntQlv7wD+b4Zn5zcwzI2BxMv6TIUoBdTaXwhSkuNLJMk6AUACy48bAuzbw+gAo/YrxotLDq50eVrZ6eFtV+f+X23OtrO/iTbmK95si4iQtAsMowsFeCyPLw/2Kh7tffNxenUBYXoXwsAzhQRk3n3zC9cdrEB4xe3kN1+6UcGPpGW7dK6HdkYrAiAFFUYRhmuieKOge99Dc20dttwF1eIpDZn+tNSCxO0k+wqEk4Xu1ipOeiv12B/V6vQgsvEeSwPBCqDaT5WMaAkmzgWB7E6hW4AchFCeCanrQwgxp9i9WyB+UlKYpzYUBY3R0D2K3j2+NJsTfY5xufIb8/CmU8gcYfoqNhoTazxZ22n3ExEiTiyuMWfs2q3BgRzjSXXgsSfRjC+b6R6TtFp+8agaQNQdGWIwVgiCAqqpQFAXT6ZRXqWk6dF2D51gYDfuYTnSwCziuO08Yx/zN3YWdrwwHkkEOYRgiSRKcHRL5JWwdInZPiVzH+QukrXDOAxLEsiw4zJlENsENwwBVT2AC+L6PyWTCfS6tkACapmEwGPCWyXk2m/FA+ubyPA8mW6nxeMyTXtoytXN22v87BKcunMUTFIZC2WgosixjOBzyNm3bvlAEodap2tFoxGMLwPMqy+2rKO8uB/4BRJgcXRu8Z8sAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"낙관적 잠금 version 흐름","title":"","src":"/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png","srcSet":["/static/610cd73b5014848934fa470368cb463b/0eb09/2023-08-16-ash-17.png 500w","/static/610cd73b5014848934fa470368cb463b/1263b/2023-08-16-ash-17.png 1000w","/static/610cd73b5014848934fa470368cb463b/3553b/2023-08-16-ash-17.png 1732w"],"sizes":"(max-width: 1732px) 100vw, 1732px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 그림과 같이 트랜잭션 1과 트랜잭션 3은 버전 충돌이 없어 티켓 예매에 성공하였지만, 트랜잭션 2는 트랜잭션 1에서 업데이트한 버전과 충돌이 생겨 update문이 성공적으로 수행되지 못하였다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"낙관적 잠금은 버전 불일치 시 처리를 어플리케이션 레벨에서 담당하게 된다. 이는 티켓 예매 요청이 버전 충돌로 인해 실패할 경우, 직접 예외를 처리하여 재시도하는 로직을 구현해야 함을 뜻한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이러한 재시도 로직을 AOP를 통해 구현해보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"먼저 @Retry 어노테이션을 정의한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Retention"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"RetentionPolicy"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"RUNTIME"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Target"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ElementType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"METHOD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@interface"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Retry"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음은 낙관적 잠금 재시도 로직을 구현한 Aspect이다. 최대 1000번까지 0.1초 간격으로 재시도하도록 했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Order"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ordered"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"LOWEST_PRECEDENCE"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Aspect"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Component"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OptimisticLockRetryAspect"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"static"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"MAX_RETRIES"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"static"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"RETRY_DELAY_MS"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"100"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Pointcut"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"@annotation(Retry)\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"retry"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Around"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"retry()\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Object"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"retryOptimisticLock"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ProceedingJoinPoint"}]},{"type":"text","value":" joinPoint"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Throwable"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Exception"}]},{"type":"text","value":" exceptionHolder "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" attempt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" attempt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"MAX_RETRIES"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" attempt"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"try"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" joinPoint"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"proceed"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"catch"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OptimisticLockException"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ObjectOptimisticLockingFailureException"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"StaleObjectStateException"}]},{"type":"text","value":" e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                exceptionHolder "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Thread"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"RETRY_DELAY_MS"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throw"}]},{"type":"text","value":" exceptionHolder"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음과 같이 ticketing 메서드에 @Retry 어노테이션을 적용하면 낙관적 잠금에서 버전이 맞지 않을 때 재시도한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Retry"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" memberId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIdForUpdate"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"IllegalArgumentException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Ticket Not Found.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"increaseReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" sequence "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" sequence"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" memberId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 328px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 28.04878048780488%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVR42mVRSYqEQBDsz7jv7YYK4i4e3FAEl6v/f0IOkdAO03MIKszMiopIX5IkkSiKDwRBYMiyTJqmMUcdc6qqch2nruvc/8ar6zrq+/7BNE00DAOt60rjODIwsywLhWFIcRyT67pU1zUdx0Ge55GiKL+CWZZR0zSU5zmBV1XF323bUpqmTw/ccRyGaZqUJAmVZckcjh9B27Y5jmEYZFkWn5/4GMTr6AOYDYKAZxD9s4Y/ked5puu6OCLibttG53nSvu/Mi6LgmFEUsaP7vtktBCH8b4co4lXf9+n9fvNOwFGDI7jGDwAQFz3c+Xb2EfwBZn/Dynw10SEAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2023 08 16 ash 18","title":"","src":"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png","srcSet":["/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png 328w"],"sizes":"(max-width: 328px) 100vw, 328px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테스트 실행 결과 성공적으로 10장의 티켓이 예매되었지만, 이때 주의할 점이 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그것은 요청이 들어온 순서대로 처리되는 것이 아니라, 재시도의 타이밍에 따라 결정된다는 점이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이는 요청의 순서에 따라 티켓 번호를 할당해야하는 상황에서는 적절하지 않다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"비관적 잠금"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그러면 이제 비관적 잠금을 통해 해결해 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아래와 같은 방법으로 비관적 잠금을 적용해 보았다. 우리는 Ticket의 reservedAmount를 갱신해줘야 하기 때문에 PESSIMISTIC_WRITE 즉, 배타적 잠금을 걸었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"interface"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"TicketRepository"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"extends"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"JpaRepository"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Lock"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"LockModeType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PESSIMISTIC_WRITE"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Query"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"select t from Ticket t where t.id = :id\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Optional"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIdForUpdate"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Param"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"id\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Long"}]},{"type":"text","value":" id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ticketing"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Ticket"}]},{"type":"text","value":" ticket "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticketRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIdForUpdate"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticketId"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"orElseThrow"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"->"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"IllegalArgumentException"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Ticket Not Found.\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"increaseReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" sequence "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getReservedAmount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    reservationRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"save"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Reservation"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ticket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" sequence"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테스트 실행 결과 정확히 10장만 발급하는 데 성공했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 328px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 28.04878048780488%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVR42mVRSYqEQBDsz7jv7YYK4i4e3FAEl6v/f0IOkdAO03MIKszMiopIX5IkkSiKDwRBYMiyTJqmMUcdc6qqch2nruvc/8ar6zrq+/7BNE00DAOt60rjODIwsywLhWFIcRyT67pU1zUdx0Ge55GiKL+CWZZR0zSU5zmBV1XF323bUpqmTw/ccRyGaZqUJAmVZckcjh9B27Y5jmEYZFkWn5/4GMTr6AOYDYKAZxD9s4Y/ked5puu6OCLibttG53nSvu/Mi6LgmFEUsaP7vtktBCH8b4co4lXf9+n9fvNOwFGDI7jGDwAQFz3c+Xb2EfwBZn/Dynw10SEAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"비관적 잠금 테스트 실행 결과","title":"","src":"/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png","srcSet":["/static/ce10ab1adffb731a10bd79002b5477f7/c4cd0/2023-08-16-ash-18.png 328w"],"sizes":"(max-width: 328px) 100vw, 328px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 890px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJElEQVR42o2Ta46DMAyEex0IISS8kbY8W0C0vf9tZu0ssLQVpT8sOc5k+OyEU1EUyPMcWZZhvD3QXQdc+gHttccwPXAuK6Rphr5vcZ8u+DnTOklQ1jXG6U76kbQDmq5DHMc4VbTBiecJSCnh+/5TqCCANgbS8+DTvglDW2ftVh+QLtCGDRtEUQTHcSCEeArXdSFZrLXNXapxzkZCuP9a1lFNBXo2JEI+4BHFNljs+8p+mXOusSETvWoXymNCycI/Qq5x/kYoXgmjD4RK2RkuhJxbwnn9Tth8P8N9QjETkmFZ1dZQfD1DczBDIowPLkWbcNNy+KFlmmHdtvaW91peCG3LFPZNUnvLCLaXshomabpLGIYxPeZoPRzTX6NUsBIvIeef4BcieFbPI1s/lgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"비관적 잠금 테스트 실행 테이블","title":"","src":"/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png","srcSet":["/static/dc635a507f55f85f17cc2d170ca160dc/0eb09/2023-08-16-ash-19.png 500w","/static/dc635a507f55f85f17cc2d170ca160dc/f3cf6/2023-08-16-ash-19.png 890w"],"sizes":"(max-width: 890px) 100vw, 890px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"또한 출력 쿼리문에서 select for update문을 통해서 DB의 특정 row에 잠금을 거는 것을 확인할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 74.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1klEQVR42p1T207CQBTkN0ATEkPplXu5lNJyvzXCK34H0UQSoz+ARhP93nHnxDWAVaMPhz1dunNmZ6YZ13VRq9XQbDZlrdfr4J7neVLs/1IZ/kynUyRJgtlshuFwCMuy4DiOrP8C1IfJrtPpoN1uo9VqodvtolQqHTE+rVRADer7Pvr9PsIwRBAEGI1GAmiappRt2zKYPVc+81wqIP+kjgQkM1YcxyLD4UpJlsulDGOVy+Uj0COG1WpVmPHKZKtBOYg95SB7PZTvVSqVdEBegS9MJhMB4SH2i8UCURTJ3nq9FgPJjGd49VQNGRdOYtEYsiNbHaNGoyEsuc+e+9+aQrqDwQCr1UomG4bxKbw24XDl+6dGpJqimTIuZKL1Ya+Z/gR0BMjpZMaD1Gw+n0vQec3xeIyRcpYmmAz6L1+PAFJ0xoEOMwYcoL8SW7EyGHwmQYHZqpyPsl0PRdf7CkgNdc7Iklpp5q4C2zp57IpZ7Kwz3Jg5bI0sros53Kr+zj5Pv3KhUBAHCU7GPZW3sRqyiHt49Qu4Ws4xaPpIoh42lwk2iZKmH2Pv5OC7trD9BNT2nwY7DLuoqyH3Xh5vgYOHygX2bQcvURVPgYfHloVnBVhylfMfDN8BTR3cFiDYN00AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"비관적 잠금 select for update","title":"","src":"/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png","srcSet":["/static/f9a3c367ab55bed5c7bef89adb942c3a/c52b7/2023-08-16-ash-20.png 470w"],"sizes":"(max-width: 470px) 100vw, 470px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 비관적 잠금을 통해 동시 예매에서 발생하는 문제상황을 해결할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 모든 상황에서 비관적 잠금이 효율적인 해결책인 건 아니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"비관적 잠금은 단일 DB 환경에만 적용 가능하다. 분산 DB 환경에서는 동시성 제어의 효력을 잃는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"또한, 많은 대기 시간이 발생한다는 단점도 존재한다. 한 트랜잭션이 완료되기 전까지 다른 트랜잭션들은 대기상태에 빠진다. 동시에 많은 요청이 들어왔을 때, 사실상 하나의 요청씩만 작업할 수 있으므로 요청의 수가 많아지면 대기 시간이 길어진다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우리는 단일 DB 환경이고, 몇만 건의 동시 요청이 예상되는 상황은 아니므로 위의 단점들이 치명적이진 않다고 판단했다. 따라서 간단하게 적용할 수 있고 데이터의 정합성을 보장하는 비관적 잠금을 통한 해결책을 채택했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"마무리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"티켓 예매 예제를 통해 동시 예매 상황에서 발생할 수 있는 문제 상황과 그에 대한 해결책들을 알아봤다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"메세지큐 도입이나 분산 잠금 등의 다른 해결책들도 많이 존재하지만, 우선 가장 간단하게 해결할 수 있는 방법인 비관적 잠금을 통해 해결했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스가 커지며 분산 DB 환경이 되거나, 현 상황에서 발생할 수 있는 문제가 발견된다면 그때 다른 구조를 도입하도록 하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"참고 자료"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html"},"children":[{"type":"text","value":"15.7.3 Locks Set by Different SQL Statements in InnoDB | Mysql"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://tecoble.techcourse.co.kr/post/2021-07-11-database-transaction/"},"children":[{"type":"text","value":"데이터베이스 트랜잭션 | 테코블"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.baeldung.com/jpa-pessimistic-locking"},"children":[{"type":"text","value":"낙관적 잠금과 비관적 잠금 | Baeldung"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html"},"children":[{"type":"text","value":"공유 잠금(S lock)과 배타적 잠금(X lock) | Mysql"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"…","timeToRead":9,"frontmatter":{"title":"선착순 티켓 예매의 동시성 문제: 잠금으로 안전하게 처리하기","userDate":"18 September 2023","date":"2023-09-18T12:00:00.000Z","tags":["concurrency","lock"],"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACh0lEQVR42j2Ta0yPYRjGn2IWM2059IFymEUJNXSYw3KoCC3HjeaUpFJKJYcohQ7Sgf4t5BDKsTlsjjO0bEbNZviADw4fLFu+GN9/rmdP+XA977P/f+/vvu77ul8zvRJmHoOoaphTCzF1sOgkLG6AZY2Q1ASrzsDas7D+PGxsgS2XILUV0q9A1jXIuQ55N2F3O5hJRyC0HMIFDquASIGjj8M8gReegFjBlwuadApWN8O6cw66+SKkWPBlyBA4W+DcGwIGlsLEwxAkLdDLs+UyVu7iPRAnrWl24AS5XeJxzuOlRBVJluO0Vge1z0yBzfBiGC3oqAPQ+EJV26D0AZTcV1VVbHkFs6pUTNANclbxCNq6oOMzfOyBnt+Q3+7g2wQ1A4tgsBQoh1ffQF0HXHgNzS9VoBPuvoP5gk09CrfewpdeePgBur5JX6H3D1Q/gRWnYZPGYMweHfvARw599GwSKKoeVmpWHgEnyH2kZhqsgjVP4ZcA3YJ9+gnvfwj4FxpkIsHj5mtMPngV6lIAYxRKp6puVas5d+CZ2gpTuza4yQImq+Xu785p/XMovO3CsfO0si6NydWR54CD5NBfLwco8TgbhpK1oY2TgvR7sNoOlUJ0j1EXifo/usbN1wa1tNECs3TsBO9deuoeZVdFsIJ7WhMN2fcgjFRwAYKOlSLUfo5CKFZo5Y+1FTV9+1vv9teYDB07pGwHHqL2hykkP0F8JbNXzosc2L9Ebss0Bn0IkRakXQ3XSCL6dndurQWm6dguZTiH/Y7/j6LQQb33axsUnF8fOOCQCyxEI5im2c+och+FMSk6UiULTpcyHdSrH5rv5tsPHiDwUEFH2P0VdHyZm+8UfW1hlfAP/T2qkzPDup4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/80fa0/ash-concurrency.png","srcSet":"/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/d48f2/ash-concurrency.png 750w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/cf041/ash-concurrency.png 1080w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/7b88f/ash-concurrency.png 1366w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/80fa0/ash-concurrency.png 1566w","sizes":"100vw"},"sources":[{"srcSet":"/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/8213d/ash-concurrency.avif 750w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/9ec89/ash-concurrency.avif 1080w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/8a04f/ash-concurrency.avif 1366w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/f3cd9/ash-concurrency.avif 1566w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/a171b/ash-concurrency.webp 750w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/b36c0/ash-concurrency.webp 1080w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/83e14/ash-concurrency.webp 1366w,\n/static/5b2d6e0cda9f8f90b89f0e9ab9af1d38/85e9e/ash-concurrency.webp 1566w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5836526181353767}}},"author":[{"name":"5기_애쉬","bio":"우아한테크코스 5기 애쉬(정설희)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#080808","images":{"fallback":{"src":"/static/96f35a33c23d4e1240108a07c2620fee/a8b52/ash.png","srcSet":"/static/96f35a33c23d4e1240108a07c2620fee/f31ef/ash.png 40w,\n/static/96f35a33c23d4e1240108a07c2620fee/1f8a1/ash.png 80w,\n/static/96f35a33c23d4e1240108a07c2620fee/a8b52/ash.png 120w","sizes":"100vw"},"sources":[{"srcSet":"/static/96f35a33c23d4e1240108a07c2620fee/e73fe/ash.webp 40w,\n/static/96f35a33c23d4e1240108a07c2620fee/61ca6/ash.webp 80w,\n/static/96f35a33c23d4e1240108a07c2620fee/507b0/ash.webp 120w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}],"source":null}},"relatedPosts":{"totalCount":2,"edges":[{"node":{"id":"f86a6336-fe74-5ddf-b375-b6fcdd2abb6d","timeToRead":6,"excerpt":"안녕하세요. 우아한테크코스 5기 BE…","frontmatter":{"title":"무한스크롤 기능에서 동시성 이슈 해결하기","date":"2023-10-11T12:00:00.000Z"},"fields":{"slug":"/post/2023-08-16-ObjectOptimisticLockingFailureException/"}}},{"node":{"id":"a5f414cd-b97a-5822-8d8b-b3a881cda16e","timeToRead":9,"excerpt":"…","frontmatter":{"title":"선착순 티켓 예매의 동시성 문제: 잠금으로 안전하게 처리하기","date":"2023-09-18T12:00:00.000Z"},"fields":{"slug":"/post/2023-08-16-concurrency-managing/"}}}]}},"pageContext":{"slug":"/post/2023-08-16-concurrency-managing/","prev":{"excerpt":"JDBC란? JDBC(Java Database Connectivity)는 자바 프로그래밍 언어를 사용해 데이터베이스에 접근할 수 있도록 하는 자바 API이다. 이를 통해서 우리는 데이터베이스에 접속하고, SQL…","timeToRead":3,"frontmatter":{"title":"JDBC와 DataSource 이해하기","tags":["JDBC"],"date":"2023-08-07T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVR42q1S20qEUBSdP+8PfPMHBPFV9EEQNAglAoNwNEgZU5R5cCAnvB68rDinFLOZXmrDhn1jrbXPPjv8s+2WaJpW4YRxHJnP8bTqz/m69hNwHICe/MpOgdq2XYCGYUDf9xvAmeXlATg8sZB0LSzLgmEYSNMUiqIgyzLmkiSxPIoiaJqGJEmWrRaFzQicH+/QRc9ovpjy0wmmaSIMQ9i2DVVV4boudF0Hx3EQRRGO4yzKv618fCe40VPcBm9o+gn7vQtZluH7PuI4Bs/zCIIAnudBEAQGTpXRGUp2AbDD/esZ7rFixaqqUBQFeyM6XNf1oiTPczTN5x6EEJRleeUoF2zaXH7bu3plWp/9r//wA9LHsPyKD3wpAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a5222c02c9ff30a42b9fbda04a3a4918/a78c6/jdbc.png","srcSet":"/static/a5222c02c9ff30a42b9fbda04a3a4918/261ea/jdbc.png 750w,\n/static/a5222c02c9ff30a42b9fbda04a3a4918/a4c49/jdbc.png 1080w,\n/static/a5222c02c9ff30a42b9fbda04a3a4918/a78c6/jdbc.png 1184w","sizes":"100vw"},"sources":[{"srcSet":"/static/a5222c02c9ff30a42b9fbda04a3a4918/f41fd/jdbc.webp 750w,\n/static/a5222c02c9ff30a42b9fbda04a3a4918/419d4/jdbc.webp 1080w,\n/static/a5222c02c9ff30a42b9fbda04a3a4918/27a99/jdbc.webp 1184w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.4611486486486487}}},"author":[{"name":"5기_루쿠","bio":"우아한테크코스 5기 루쿠(백경환)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAbABQDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAIGBwgJBf/EABgBAAMBAQAAAAAAAAAAAAAAAAUGBwME/9oADAMBAAIQAxAAAAHWNrUzsDRURjHROnLNpDcnSVP8CEoAgx//xAAbEAADAQEBAQEAAAAAAAAAAAADBAUGAgEVJf/aAAgBAQABBQL8Yi7+flu8XcJVbf8Au3mnANmcRPkCuEheazMljbHW61Muh3RCdde8Celz4OltyZxHv//EACgRAAIBAwMBCAMAAAAAAAAAAAECAwQREgAFITEGExQVIjJBUVJxof/aAAgBAwEBPwGj7RUe6vLDFDKxX25R2yQWNy5FobH8iADbF8iNSUUkkjv5PUHJibjdEUH9L3/A+ho09IZQ/hKcEsjN6L55rxmeLmzdQEF+i8A6TZdvlUSCnAy5tmwt/D8jX//EACURAAIBAwQBBAMAAAAAAAAAAAECEQMSIQQFFDEABhMVIjJBUf/aAAgBAgEBPwHWem9bs6Uq1TVUlu/K2rNrnFoSZrSP0AxYSGS1T5S3NKdOmnzmmFqqIOzu56HbcfJ/p85uuWgyc7VNCsqE1It9t82qBaoJWM3mO2zAbddyU28pjEZlsjBE/buO/P/EACgQAAICAQQBAwQDAQAAAAAAAAECAwQRBRITIQAUIjIGMUFDFiNhUv/aAAgBAQAGPwIVrLScG1cwtL3hcYTPTKgxj29eeooV69aYJLXTUJj/AG6ek2zEtRPuZMxqFxht2O1XcfDJR+qIUrrDFGBcR0k3qDyMMWX3ozkncTkNuTsIGK2rXLzoksap+lYn/WIWjBXbj5EsxIz0fOTUZ49KiBj45RaxPajAwRVhdMK7MQvLImAM7QcZ8Mv8k1Z1ACRtXiimUoOxvZ7XUuWO9U9gPxxnAmrVvrOD001h5oqdyhX1yXkk2AvI0waWsxCnlAsGJQFfcW3+atqEOvajy0NSt1vSxQVK59LWZWEtRIEk9QIeRd0TDm2L7DJg7meH6llkjPx9PYhgCD/iVJqscvOPvIXQNk/55Gy9GRpg5H5EezaP8AzkgdMe2yQPNLj0apDp0eoh71yOsNkc1qxat15peP4IZIoo1ZYwie3dt3Eku7VIizBix7GSJpVycH74A7/P578//8QAGhABAQEBAQEBAAAAAAAAAAAAAREhADFBUf/aAAgBAQABPyG0wJQlGRUPHEH9FpMNJSSeeOLtB8UEaw1QvEkzlWA2cMXNzRIqw11Y8PuyOYm3pu0ACqsHRGyXR0Uwe+pCOQ2NzfZ4FNPoFYCDu7AaM6gNrJXAjxpZoAbHlqcCAmBfKL3k6aGmQHWlXMLEUEYzFipS9//aAAwDAQACAAMAAAAQEzD+/8QAGhEBAQEAAwEAAAAAAAAAAAAAAREhADFRQf/aAAgBAwEBPxAq6dkgBhtlWEHGYCg04mp6vAQMkiOCgX0jHVEgAGFZziBWIAAdG9TCpz//xAAaEQEBAQADAQAAAAAAAAAAAAABESEAMUFh/9oACAECAQE/EAnSAgdgQvjGDdDVe6KpgMbfRVfaKSZ/LM8jCFIsrknXvFUGQQXQYKgpr//EABgQAQEBAQEAAAAAAAAAAAAAAAERACEQ/9oACAEBAAE/EBMh3pJ4nGEaA5TEuxpYTmSnzTNVCCsqL5HSwaOHVcdRMkknh3YQ/MnC9hRWjU2wRxNppMEYLEwnHAonVCIJ2pGEI7d1EGciqs1JuRi8s4dO7khdvBbmnzoGLT1vvKjqkZb1kWi2NVVAf//Z"},"images":{"fallback":{"src":"/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/70fde/lookh.jpg","srcSet":"/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/b0c6e/lookh.jpg 750w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/b3149/lookh.jpg 1080w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/c56d6/lookh.jpg 1366w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/70fde/lookh.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/4c1cf/lookh.webp 750w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/2eb44/lookh.webp 1080w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/120d8/lookh.webp 1366w,\n/static/d32b7f99c44c3bb5f87d2dea9dcf44a0/31d0c/lookh.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1.3333333333333333}}}}]},"fields":{"layout":"post","slug":"/post/2023-06-28-JDBC-DataSource/"}},"next":{"excerpt":"AWS 로그인부터 시작하는 인프라 구축하기 1편 : AWS 로그인 / EC2 / VPC 이해하기 0. 들어가기 AWS를 처음 접한다면, 아래의 사진(인스턴스 생성 설정)에 나온 이야기들은 별나라 이야기 같을 것입니다.\n\n IAM 사용자, EC…","timeToRead":7,"frontmatter":{"title":"AWS 로그인부터 시작하는 인프라 구축하기 1편","tags":["AWS","EC2","VPC"],"date":"2023-10-04T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAzElEQVR42mNgAAJWVlYGWVlZODbX1xaYmOhSf7AhqNvL1kQcWY6Tk5OBJOCoLWN/MFPv44E0rf9fW03+f263/OKlK2nKQC4INJGLOpKh9R9mIAhHmkp4MbGwsfJIak7mFpGP5BKScuYSUyplBAKKDOSWVGsGGhTNKSDpwi2h0cDAzMbEwMjKgILRgY2GhM2BTIM3cAM7bT62Zvgae7jYMxCDwYCNjQ3FUHFBXt4yD53yQ43BLdsWdgjtWDmZYcfKqWB8cNM8OBsTT2YAAIC3X83t/3j1AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a5238a2dfa439bb2c0b0acf3648fea94/dd217/ec2.webp","srcSet":"/static/a5238a2dfa439bb2c0b0acf3648fea94/66ee5/ec2.webp 750w,\n/static/a5238a2dfa439bb2c0b0acf3648fea94/4156f/ec2.webp 1080w,\n/static/a5238a2dfa439bb2c0b0acf3648fea94/7c435/ec2.webp 1366w,\n/static/a5238a2dfa439bb2c0b0acf3648fea94/dd217/ec2.webp 1400w","sizes":"100vw"},"sources":[]},"width":1,"height":0.3}}},"author":[{"name":"5기_이레","bio":"우아한테크코스 5기 이레(이다형)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFo0lEQVR42h2Q208biRnF55+o2j7scyt1q7Zqu49tomql7gIe32DZpJttlkR0N9kLF19m7JnxjO+XsccXaCCEEAHGt/F4xp6LPXgxNmCD7RSwPRgDxtFK/TtKKh0dfefh6NPvADL+UMCneNuUYPtMJPQFXPv/qLu7JYdO8uiKrkk5NF2OTFfe++d7wakyOS14dDwxCQiYvoDoeETNwWAeVjGwhrdpMqYxg+6jqb/++uuJP4ae35PCn+2Gp0qkTvDpZb+2QupLXq3g0AO8WV2A1HlIxZrGOOsEj6hymOrZJ7/DZzQvocdJ5zPG9UR+McOTYJHSlTwa2QPuBbV7Yd2uXwsULRoBHuPNYyIM8hZQxDXR2Y95/1xvyzvKkEPa/18udpkJiN6H5cAD2asquSYqJFiLaaqUGpBhdRFWlRCVaNOKNk3K9Mnqd9pRJqTEPefxUCcZveFiIzbaXIMk79R+SF/2g3ukphIEq5QG2MN1MgYK6ISIqSTbxMt/3SuR87fZyIBdfdcURg36pxNmmKcuU26ZerhPqXd96mrgDhuskCqAWRjnbaCIgiIGctBYhfx+kAxdJcnL3MrtQWJU3nhX2RyyoWvaV4l+WfaPl/2qw8jUwfJkLTwOcPN6EdEKKChYxvOQerBNjrLLV8ngTTJwTUdvCi/eMeFRNjhkgrWlryXXeIXUHkS0taWpanACqOD6IqIWEJDHJiRcd0Qtnr7xDVKRq0RouEMNE+RtmhrR4RFDHkSfys6/10jVcWi8FgAr3kmghGh4WCVhmgKiymOqnFVdcs5e07GLJDVMUjcpcpghbzPUdcIrBmdT/pl40Li2EtqImqrBp8Ce90HBqhUJVdGuKeJgiRhLL35cX4ZGmeggEbnKBAdJ30/ZYG19xb9T9Ug9tzxE2cPVVWMtNg2U3NO7rsmCTb+JPl4lFpYC3tDKVmgtzr2izuPBsw28FjIevn4V2a65pYFd7DlT2dTGYvPNV63XXwKJ+U9F/J9bdrcr1XGwA3v2Gs/d4MwVnuz4NgrhSDhG7bjibbtwg9PNpa3ofvqHc/q7Tm6+y3wL7PsfFd1fbBNPqRDpXs4SWw08fWrLdDG6j2YVOP2WYAYE03PyN1iCqaTnlILpjDN2C4sXvAE4efGktvSoEnsoB/VyZCbpfR7wvyToPpbqonQPZQcE2yfyPZfUd+TKuzm8w0Odwp0We4UF4EffP3KoXnB/znsfyJGvxMjjjXAMTysOWiHeP78iclcEe+ksXNmzhwxN9CTDOW9QRIMimQEefcSh07uhmSL1pLz2TXVzbjXyEkspaLaDZRWEURD20pYbEPm+s3i5nvZ28oZT3qSIJkWGgbME3E7MNxNzRzsLR/EfjraN/15KWFMXKK3cYWPZAZ5VcLbvKd0u7Jzov7ezK98qnKGbN3RECOhLjlMWbqVN9Z2F4+R8eR2KrIuO/DWeUVzstSN/4xBvfaXrZ6t797/wrLlDnbi/HTd1BajLw0BftJ0y0El6vhE3NHYWuRX4wSz12CWZ481vlktPIsWZsHR/9tUv/0xM6oydHaK/6WwlYKWIdAULoBQspzlTO2NsJIz15Jy87b3/qeuDjwJ/UMV+dS/wwZ+CH/4NQyD7etiXXLZU1i2thLuZNnUltMObgQsRO8vB7ay5kTLVk8Zq2mNEX/3i97Gf/5b62W+CH/4lgqKOXhG7I+wKSEParMsrXRa5KDrPWBOgCPYz1tpmzM0M1EiZq0lbfD32dAazzXkp2JNYwluivc7CTQFrMEhZWNs/SP2YRZuM5YwxA0rRel5A2gz8lrEeZ+A6DdczpuOcub61ePxmsZ1FT1hzk0PaAvpWgJs58yHr415DpZXnXc72frBzzvo2hzRp6JiGWrTlJIvUU9BBGj6kkSMabjBwi8Pu+q28tZE2tOiFcwY+yyH/4eD/AdEdfVdV4ws/AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/94d165021200ede18e282c3241998010/7d6d8/irae.jpg","srcSet":"/static/94d165021200ede18e282c3241998010/7d6d8/irae.jpg 238w","sizes":"100vw"},"sources":[{"srcSet":"/static/94d165021200ede18e282c3241998010/38f3c/irae.webp 238w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1.2731092436974791}}}}]},"fields":{"layout":"post","slug":"/post/2023-09-22-AWS-EC2-(1)/"}},"primaryTag":"concurrency"}},"staticQueryHashes":["2337738035"],"slicesMap":{}}