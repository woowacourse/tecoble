{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2020-09-20-entity-lifecycle-2/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVQY003Qvw7BUBTH8YYgLCKExWw1IczEwAtIJCa1GJuyCalI/EmERUgHi5cxeI8uTTt1aHp9r9wmhk/OOfee/HJzNd/3Dc/zutS24zgZIUQpiqIt9YY+vUb9+eur6Kh5GN9LGkEn2DBd1y1zmGfxjjf9AFm1XEQCBe6aVBMVLJHiLBcHTiHwQS0MQ/mSOlYsjPDCAjOMccUFR3Z0NdvYISkDW9jAQi8IAhnYgAyZ4wELEzUfcFZfYmCPJ9ZIfwG9owW1fLgCkwAAAABJRU5ErkJggg==","width":400,"height":88,"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png 1x"}}},"markdownRemark":{"html":"<p>이번 편에서는 전편에서 해결하지 못한 부분이었던 “Spring Boot에서는 기본적으로 OSIV의 설정 값이 true인데도 불구하고 LazyInitializationException이 발생하는가?”에 대한 원인을 알아보고 이에 대한 해결책을 이야기해보고자 한다.</p>\n<h2>1편에서는…</h2>\n<p><a href=\"https://tecoble.techcourse.co.kr/post/2020-08-31-entity-lifecycle-1\">1편 링크</a>\nLazyInitializationException이 예기치 않게 발생하는 상황 속에서 하는 이유와 그 원인에 대한 해결책을 찾아보았다.\n요약하자면 참조하려는 Entity의 연관 Entity를 조회할 때, 영속성 컨텍스트가 존재하지 않는 상황에서 LazyInitializationException가 발생했으며,\n이를 해결하기 위해서는 영속성 컨텍스트가 존재하는 상황 속에서 미리 필요한 연관 Entity를 불러오던가, 준영속화 된 Entity를 다시 영속화시키는 방법으로 해결했다.</p>\n<p>하지만 앞에서 살펴본 바와 같이 Spring Boot에서는 OSIV가 기본적으로 설정되었기 때문에 연관 Entity 조회는 스프링 대부분의 영역에서도 가능해야 할 것 같은데, LazyInitializationException은 계속 발생하고 있다.\n전편에서 찾은 방법으로 일단은 문제를 해결해야만 했지만 이제는 근본적인 원인을 파악해볼 차례이다.</p>\n<h2>원인을 찾아보자</h2>\n<p>원인을 파악하기 위해서는 User를 Controller에서 가지고 오는 로직, 그리고 OSIV가 적용되는 방식 2가지에 대한 이해가 필요하다.\n정확히는 Spring Security가 어떤 방식으로 사용자 정보를 가지고 오는지, 그리고 OSIV가 정확히 언제 열리고 닫히는 지를 알아야 된다는 뜻이다.\n우선 Open Session In View를 알아보도록 하자.</p>\n<h2>Open Session In View 어디서 구현될까?</h2>\n<p>계속해서 이야기했지만 Spring Boot에서는 <a href=\"https://tecoble.techcourse.co.kr/post/2020-09-11-osiv\">OSIV</a>가 기본적으로 설정되어 있다.\n어떤 방식으로 OSIV가 설정되어 있고 어떻게 동작하는지 자세히 살펴보도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span><span class=\"token punctuation\">(</span>proxyBeanMethods <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ConditionalOnWebApplication</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">Type</span><span class=\"token punctuation\">.</span>SERVLET<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ConditionalOnClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebMvcConfigurer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ConditionalOnMissingBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token class-name\">OpenEntityManagerInViewInterceptor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">OpenEntityManagerInViewFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ConditionalOnMissingFilterBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OpenEntityManagerInViewFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ConditionalOnProperty</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"spring.jpa\"</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"open-in-view\"</span><span class=\"token punctuation\">,</span> havingValue <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> matchIfMissing <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaWebConfiguration</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OpenEntityManagerInViewInterceptor</span> <span class=\"token function\">openEntityManagerInViewInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenEntityManagerInViewInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token function\">openEntityManagerInViewInterceptorConfigurer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OpenEntityManagerInViewInterceptor</span> interceptor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebMvcConfigurer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InterceptorRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                registry<span class=\"token punctuation\">.</span><span class=\"token function\">addWebRequestInterceptor</span><span class=\"token punctuation\">(</span>interceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 클래스는 Spring Boot에서 자동으로 Bean을 설정해주는 Configuration 클래스들 중 에서 Open Session In View를 설정해주는 클래스이다.\nSpring의 자동 설정 방식을 이번에 다루지 않을 예정이기에 필요한 부분만 이야기 해보자.</p>\n<p>@ConditionalOnProperty를 보면 알 수 있겠지만 기본적으로 Spring Boot에서는 <code class=\"language-text\">spring.jpa.open-in-view</code>라는 설정을 통해 Open Session In View를 설정하고 있다.\n이 값이 true이면 OpenEntityManagerInViewInterceptor를 인터셉터로 등록하여 Open Session In View를 적용하는 것을 알 수 있다. 이 구현체의 코드를 보면</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OpenEntityManagerInViewInterceptor</span> <span class=\"token keyword\">extends</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">preHandle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">DataAccessException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Opening JPA EntityManager in OpenEntityManagerInViewInterceptor\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">EntityManager</span> em <span class=\"token operator\">=</span> <span class=\"token function\">createEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">EntityManagerHolder</span> emHolder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EntityManagerHolder</span><span class=\"token punctuation\">(</span>em<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">bindResource</span><span class=\"token punctuation\">(</span>emf<span class=\"token punctuation\">,</span> emHolder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterCompletion</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">DataAccessException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Closing JPA EntityManager in OpenEntityManagerInViewInterceptor\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">EntityManagerFactoryUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">closeEntityManager</span><span class=\"token punctuation\">(</span>emHolder<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Interceptor의 preHandle을 보면 언뜻 EntityManager를 Open하고 afterCompletion로 Close한다는 내용이 들어가 있다. 조금 더 자세히 코드를 보아야 정확한 동작 과정을 파악할 수 있겠지만,\n간접적으로 preHandle, afterCompletion을 통해 EntityManager를 열고 닫는다는 사실을 파악할 수 있다. Interceptor의 동작 과정을 살펴보자.</p>\n<blockquote>\n<p>OSIV(Open Session In View)는 하이버네이트에서 사용하는 용어다. JPA에서는 OEIV(Open EntityManager In View)라 한다. 하지만 관례상 모두 OSIV라 부른다.(출처 : 참고 자료 1)</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1820px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAcICf/EABYBAQEBAAAAAAAAAAAAAAAAAAcDBf/aAAwDAQACEAMQAAAB2Qr6GmZOwXqf/8QAGxAAAQQDAAAAAAAAAAAAAAAABQABBhUCAwT/2gAIAQEAAQUCMW1eC5NuRt4/K3X/xAAgEQABAwIHAAAAAAAAAAAAAAADAAEEUWECERQhMkKU/9oACAEDAQE/AZW8gTVxjt2ZaAGfKV7JdqGX/8QAIxEBAAECAwkAAAAAAAAAAAAAAQQABQIGIQMTJDFBUWGVsf/aAAgBAgEBPwHMuJw5ltCdJtqe48Xs+Y6J4RKLtKNN3B9bAfsev//EACcQAAIBAwIDCQAAAAAAAAAAAAECAwQRIRIUABNBBQYVIjEzUWFx/9oACAEBAAY/AqfebbV4t2f7WovbdJpylh8myjmDAy3FOYHpKeeSatEc+zZ5o5HhrRzGZp1LspOo6h5jbUuCCLd8J1wBiipzf7ynqevT84//xAAaEAEBAQADAQAAAAAAAAAAAAABESEAMUGB/9oACAEBAAE/IdpBSIpNl2woRJHmsfqLyE/C8hwOvqwqD2/EStAYf//aAAwDAQACAAMAAAAQ+/8A/8QAGhEBAQADAQEAAAAAAAAAAAAAAREAITFBgf/aAAgBAwEBPxAUFALFUeKRHekaaThiiW1OF75EPhn/xAAZEQEAAgMAAAAAAAAAAAAAAAABETEAIUH/2gAIAQIBAT8QSkHbAgiJm0y46MGDAgKlXLVWi1z/xAAXEAEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEBAAE/EOOyxF2KeSJZhY3jXsb6aVnoq8INSGjcwiBArDX/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 20 entity lifecycle 02\"\n        title=\"2020 09 20 entity lifecycle 02\"\n        src=\"/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg\"\n        srcset=\"/static/2a4aef0cbf7764840e4b7561d2e94d0e/953fe/2020-09-20-entity-lifecycle-02.jpg 500w,\n/static/2a4aef0cbf7764840e4b7561d2e94d0e/0a251/2020-09-20-entity-lifecycle-02.jpg 1000w,\n/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg 1820w\"\n        sizes=\"(max-width: 1820px) 100vw, 1820px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>출처 : <a href=\"https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/\">https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</a></p>\n<p>그림을 통해 preHandle은 Controller에 Request를 보내기 전, afterCompletion은 view에서 결과가 생성되고 난 후 호출되는 메서드임을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 784px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAASABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAMHCAQJ/8QAGAEAAgMAAAAAAAAAAAAAAAAAAwUCBgf/2gAMAwEAAhADEAAAAfaiq7Xy9m4dNIT4EnCWhbdAk/8A/8QAGxAAAgMBAQEAAAAAAAAAAAAAAQIDBAUGABP/2gAIAQEAAQUC6ALCBrss+Z0P0q9KAVrncv3qGJrmCVEaTEhhFz3/xAAkEQACAQQBAgcAAAAAAAAAAAABAgMEBRESAAYTEBQxM0F0tf/aAAgBAwEBPwG7VSQx9P0vmI6V66a5JG7oxUuJaGJS7hCiZmqIIUaVlQyTquckcUVijUnuFSV7hEI31JG2FbGG9Rj4xy9+/YPtz/pWfw//xAAjEQACAgIBAgcAAAAAAAAAAAADBAECBREGABIQFTE0YXO0/9oACAECAQE/AYvma8l5gTGCfYELyCrkJLJOmXrfEMkXIIDrakW1YRbk7SailZmRknt0mXkEqhklWL3mkbu2vj12bfJgAZsEV9etaWmI6xPu+R/VjfwPeH//xAApEAABAwIFAwMFAAAAAAAAAAABAgMRBBIAEyEiMQUjQRAUMhUlRGFx/9oACAEBAAY/AmXElaNbyUuKmfqHT+JVbO9QSCLd0RGA7kUbyls3tN1Hu3KnfLqGrWqXLFS41uvSrJ3GDGuAKijeYW0cq2ZuCUIIX3A2rW6Ig8fI4p5jQaTOn3HpZ8SYlKZgE6cYp6fo4RQt1wJZq65Qsfdp6dThWhFM6+60l1ppSmw8wCkAJdtc5B6tX071ZO5dO127QlIEbGPIUfh55OBclKu65yAfyZ8/sA/0YZhpoZKKjJhCe1y329NmwlG2NpKeD6f/xAAbEAEBAQADAQEAAAAAAAAAAAABESEAMUEQgf/aAAgBAQABPyF9kA99k7+xDWk4Hma/5Urw5LRZwRTe2G7EKUDzTI8oKgRWp1QsECcUyXyWTiCPwjhCY2RN8b0LeL5ZIiGakkh38Aew4emTB7Uz2vd3eR8//9oADAMBAAIAAwAAABBDOMD/xAAXEQEBAQEAAAAAAAAAAAAAAAABETEQ/9oACAEDAQE/EEde8rJ1VgSRyiyXga4IGYWkFQ5L/8QAGBEBAQADAAAAAAAAAAAAAAAAAREAEEH/2gAIAQIBAT8QE1akFmci4ncsogbasdShnLjQ0o//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPxBcIOsRUiBZFOIwiFV9j1B4gJNql8dvQbOZbQNUaRWgODyKfFRq9/tmMqHWtLclwIgxC9eHOCyYInBDgCIgakQNqFEqE7akRvVVdT3/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 20 entity lifecycle 01\"\n        title=\"2020 09 20 entity lifecycle 01\"\n        src=\"/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg\"\n        srcset=\"/static/df829503df7cfeac6cdb14fbea1a9a22/953fe/2020-09-20-entity-lifecycle-01.jpg 500w,\n/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg 784w\"\n        sizes=\"(max-width: 784px) 100vw, 784px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>출처 : <a href=\"https://corp.jobins.jp/blogDetail/blog-201529492\">https://corp.jobins.jp/blogDetail/blog-201529492</a></p>\n<p>Spring에서의 웹 요청 처리 과정을 살펴보았을 때, Filter를 제외한 대부분의 영역에서 @Transactional이 없이도 EntityManager의 도움을 받을 수 있다는 점을 파악할 수 있다.</p>\n<p>그렇다면 User를 가지고 오는 부분이 Filter에 있다는 것인가? 아니면 다른 Interceptor를 통해 가지고 오는 것인가? 이 부분도 파악해보자.</p>\n<h2>Spring Security는 어떤 방식으로 유저 정보를 가지고 올까?</h2>\n<p>다음 그림은 Spring Security의 기본 구조이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 686px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEoUlEQVQ4yyWSC0yTBxDH7wMlc3PC3OYUFUFACAWpttRaXmKV14SpREAeKkhBosxKKbQKForFMYWJbExe/Uqx5ZkgvkCrVcBWHgU6MdNpHCqIgDDxge95++ou+eV/l8vd5ZI/VGfXbFBuJbEmogrlYaUo88/GguB8VEUoPkFukeuaopRwOrqaKAkrhaW2bmC32B6WLHIEWxsnsLd1BmtrZ7BZYEexFKD2RL3PSbHypCqtqrJOrCorTDiiLk0pUdSJVKU1GdWqqt1knPqgAk4erCR8OWvAcxUHfL18wX99EKxmc2CNlw+s5wZAVEQ4BAcFAVjM+XYZANhQLKawRN55wIhEeBodD29ieIA8PuRERJpLQv2o9jeA6E0g2gBqHQj8l0bgA2sCFY4E/uRmht3zAC6IY5c9EXgemhKwZSMpHtJTW2jFA4mMn18KV+dMpbLzh/meSeCLxGa67Wezv1vqBuBiCxaOzmDu5AxmzvbwBc0ZgDELhS6AU3MB9CXZ20Ylwfg0i4vDYi7qdnFwgO+Dk1nrKdbhE7HfVVSyAOz5Zmd2B7n9/SM7WR+/kmdMZCaY9Mo2Os/AY8Q9T+fEG3axfaFRXW3deaaBaWhWM8e6Lrn/npX6fVNJgbeh5RS991wjq50sWixgL7TAPBoMHYnb8/KADw4kM9GQyMAe3spPeRelz8VeOCrgkNAh2c66vHmJpjVkvqY1dMGFpuAFHedDrLVXNi1sbds4v6M7yuEIgilmEpflxxbdlkvZj5RS1qvmY/SK1G1Bt8olq57U5DHvkLks9b5IWzDUntg+3vwb3lEfxbs1hThYfwwH6wrxYWMRjp8rw39qD+sREUICuHOorTO0uUnwsSAcXvMZXveSGSUTKcyYF4UxcDkzlmoTM6HnbGPM5N2beNPQ+fFGlx57de3Yp2/Hfn3Hh8FbN3Ha2NZiWkhzXzHP02OFJQ6mmqOUBc+EnvwpIWeI0nKssAOcyDLjMl1nQz1ZYdNW8YvfH3UVa0Y19V6NMmGYvrIg8N5ZlXePspjblLPPHmAWoVGVmeO0Al7udwWxO4DpiHAtnXZfsGm2P2U6YxJlanC0gG5ZAuuV0EP7XuCundzjqtGEO1z/K8Gl7X0a/eJbAV3/QuBRRI0DKr+G27LYyOn0Vf03drrq+uNdO9pjXXq7d9B0ffGu195msIyP+CwRdJTnhw8d2jI6Jg29/zD7hwe6veuGjelBD0dzNw4+lm6cGMkMrEBMByx2AH2RKHtIEvq6Ly1grHOf/0RvWuB4vzBwois1YGxYsuHVLQE3F5RHpV8Zy6Tu14szVz6uK3BT8KMCL+WlcP6U5y3vO5HN0OYkLZm7wncGOgGIq1u/DOxEq/zHaFn+DC0LH6HV4RG0Kh5HK79etISs4ZnQd1wY+mK/D37Yz343vJf57nqc28eencs/TGew37wRs3FaxLmIhdTTpwIImboFklvvw6+946AYmIQy4wQcN4xDWd8YJGlG4PMDZwEq8zJDrkp2NF87GF2vzYxuOJce2dAq2trQnhVTr5PEnm7Zu0FkMqHJielpqQRJkoRcLidIE+T/aqoVCpIQiTLgP8f3PpS97ZirAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 20 entity lifecycle 03\"\n        title=\"2020 09 20 entity lifecycle 03\"\n        src=\"/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png\"\n        srcset=\"/static/9a755c2e7e2c58640bef281c463b1f4e/0eb09/2020-09-20-entity-lifecycle-03.png 500w,\n/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png 686w\"\n        sizes=\"(max-width: 686px) 100vw, 686px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>출처 : <a href=\"https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications\">https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications</a></p>\n<p>그림에서 알 수 있듯이, Spring Security는 Filter를 기반으로 동작한다. DelegatingFilterProxy에서 사용자의 요청을 가로채 Spring Security의 기능들이 수행되며 모든 요청에 대해 보안이 적용되게끔 한다.\nDelegatingFilterProxy에는 Security 기능들이 구현되어 있는 다양한 Security Filter가 존재해 일종의 FilterChain을 이루어 동작한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 803px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEdElEQVQ4y02UeUzTZxjHX3HKZlxclk2mbMaRLMZtxg2XHc7ARiZTov4jC9mWbRp3xQG6OTkcyN0ihoIuyD0F2lIKCG1pgRZWjozSi54U2kIpl9VeXC29f8/e4v7Yk3zyfd7vH0/yHHnRDoQO5j2ca8zstsCFcn7gYqWQuEAREJfuDBHf3u7zpzfroHDQ31Y0YEe5HAcqGAZUMASoEGu+kMAAIo/jnO9BWR0WFI59pZz5fnLfY8h8IIYbVDlkUZUYBWQ1iSG/awZKBOuCE2d/jslh21MKBN7k/P7NZFwgOa/PvUXxEHE+l7v+5XXGchS63z6KaMKF6i6+HFgC2RpbIHWxRRZXp0DpYvEla939UmgZXPyztF2dktM1D6kNMvi1WQNXm1Rw5b4S0htlcLl2HG6wHkOxMPg5SvmlCDX1TkXd6jYnlfdZT97mWhIpfdbESr49sazHcrKMvXC2sMW4u7xjIvnuyDooZu0+6dSyX6xbCoi0iwHJ9CO/1mT11Iy54Sfq4mn02guRMbkdM5RrTPPCVyT29HflfMM3ZTxMrwG/p9Jbpp4Uj0BJcctYSvXYJtgcK2CanQWDwQh6vQF0U9PgsFnhgdwPPzAcSeEZHiBz5gUlPAtkNsngj1YNXG9WQDZdA9l4jkWcRSAJfTxyLesMhWee7JBYxawJp6hb7gjreJfMLu4QPZJSehc1uTzXEUS6y0D1PH0jvUcMdK4YWrpHoZlvgCaOFNp6xUBli6C6x9hO3YYQeKmRxz+Oe/Hwm8f2v/H2hy8dOnzslXdjP9p76Vp2JFjObz/xfuwe1KUB1PBQcrCSqUqoZCrjKtoU8eVMTXwFUxWP8zjsfVpK10QvObzIrNeGO8Kl0VuYo5hYzPMzc4tIr9Oiw+8c/wBdzLi3rYo1g8htRkRmzmxRzDQhUvssKmmdRhVMNfqaJEHWVe9l54avyO0jcjQmG6lVaLzTLzWXr20Gbq64/Ln2dS8pCHAApZ7aF5Gc3bUr/Z7s1bQq6f4rNYropzoRnUYZiEo49cVO1rhlh8sbNPuCBIQIAsx2P9BEKzBqcEMgREDY9/hDYFvzJKGY6KgjOfWDVVeb1NbUOpE5tV6ygDHjO3Nco+sZ4R4BIGLDS6g8AYBNP/g8QQgaTMvBVXcwiL0AxuvyAWx4IQE9h9Ce29ThrPxWtSyPrhi6SZWP5NEUQ/l0pTy3VUfG9XZPVifvruYoJzNoWsimqULZNPXWJWTRVPgqtEQGVRW8xTZCc6/yPHp9/96jOTX9zVfvK4JpdeK1y1XDG6m1otW0unH4naZn44KRLMr3z3JH1JOMATUwBlTBziEtQeP+Q3T+rSTahZMEna8IcMdnQKxbPoNe3oV2/sXsf6+BIz9Xz5ElNXInkhp65KexnqtgjIa3iGwA20MAOvgv3Lh1geIRmGx++H/4QvAZ+jH1t4jhOUDtekDd5qc8nAXUaQTEsMHW78EaNTyzZHePPV7xuPE27QrTmqNh2OHkTDic1lWPE/s2i3PTP/9k45N/AX26DGdKtjFnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 20 entity lifecycle 04\"\n        title=\"2020 09 20 entity lifecycle 04\"\n        src=\"/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png\"\n        srcset=\"/static/d2433b79aebeb3e12ac3a86b1061b5e6/0eb09/2020-09-20-entity-lifecycle-04.png 500w,\n/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png 803w\"\n        sizes=\"(max-width: 803px) 100vw, 803px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>우리가 기존에 구현한 CustomUserDetailsService도 Spring Security 인증과정에 필요한 UserDetailsService를 구현한 것이다.\n이 Service를 통해 DB에 존재하는 User 정보와 사용자가 입력한 로그인 정보를 대조해 인증/인가를 진행한다.</p>\n<p>Spring Security의 자세한 동작이 궁금하다면 <a href=\"https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications\">위 링크</a>를 참고하면 된다.</p>\n<h2>LazyInitializationException이 발생한 이유는</h2>\n<p>위에서 나온 내용을 간단하게 정리해보면 Spring Security에서 Filter를 통해 User 정보를 가지고 오며, Open Session In View는 Interceptor를 통해 적용되는 것을 확인할 수 있었다.</p>\n<p>그림을 보면 알 수 있듯이, Filter가 Interceptor보다 먼저 실행되며, 따라서 현재 상태로는 FilterChainProxy에서 CustomUserDetailsService는 Service 내에서 @Transactional이 적용되는 부분에서만 영속성 컨텍스트가 유지된다는 뜻이다.</p>\n<p>즉 영속성 컨텍스트가 종료된 상황에서 Controller에서 @CurrnetUser를 통해 가지고 온 User객체는 <strong>준영속화</strong>된 상태이다.\n따라서 다시 영속성 컨텍스트가 OSIV를 통해 Controller에 주입된다 하더라도 이미 준영속화 된 User의 Favorites를 조회할 경우 예외가 발생하는 것이다.</p>\n<h2>해결 방법</h2>\n<p>이를 해결하기 위해서는 기존에 설정되어 있는 OpenEntityManagerInterceptor의 우선 순위를 높이는 것이다. 하지만 Spring Security가 기본적으로 Filter 기반으로 동작하고 있어, Interceptor가 아니라 Filter로 교체해야 한다.\n다행히 OpenEntityManager를 Filter로 동작하게 할 수 있게끔 OpenEntityManagerInView 클래스가 존재하며, 이를 따로 Bean으로 등록하면 해결된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OpenEntityManagerConfig</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OpenEntityManagerInViewFilter</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">openEntityManagerInViewFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OpenEntityManagerInViewFilter</span><span class=\"token punctuation\">></span></span> filterFilterRegistrationBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        filterFilterRegistrationBean<span class=\"token punctuation\">.</span><span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenEntityManagerInViewFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        filterFilterRegistrationBean<span class=\"token punctuation\">.</span><span class=\"token function\">setOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span>MIN_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 예시를 위해 최우선 순위로 Filter 등록</span>\n        <span class=\"token keyword\">return</span> filterFilterRegistrationBean<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>OpenEntityManagerInView가 Spring Security의 DelegatingFilterProxy보다 먼저 적용될 수 있게끔 Order를 설정하는 것을 잊지 말자.</p>\n<p>또한 OpenEntityManagerInView가 사용자에 의해 Bean으로 등록되면 <code class=\"language-text\">@ConditionalOnMissingBean({ OpenEntityManagerInViewInterceptor.class, OpenEntityManagerInViewFilter.class })</code>, <code class=\"language-text\">@ConditionalOnMissingFilterBean(OpenEntityManagerInViewFilter.class)</code>\n를 통해 자동 설정이 되는 Bean들은 무시된다.</p>\n<blockquote>\n<p>@ConditionalOnMissingBean : 어노테이션에 명시된 Bean이 존재 하지 않을때 Bean 등록이 실행될 수 있도록 하는 어노테이션이다.</p>\n</blockquote>\n<p>이 설정을 추가하면 Lazy로 동작하는 연관 Entity를 조회할 때, 정상적으로 동작하는 것을 확인할 수 있다.</p>\n<blockquote>\n<p><strong>OpenEntityManagerInView vs OpenSessionInView</strong></p>\n<ul>\n<li>OpenEntityManagerInView : JPA를 지원하기 위해 사용되며 EntityManager가 thread 전체에서 적용되도록 한다.</li>\n<li>OpenSessionInView : Hibernate를 지원하기 위해 사용되며 Session이 thread 전체에서 적용되도록 한다. Spring Boot에서는 SessionFactory가 Bean으로 등록되어 있지 않으면 사용 불가</li>\n</ul>\n</blockquote>\n<h2>결론</h2>\n<p>LazyInitializationException만 알면 쉽게 해결될 것만 같았던, 비교적 쉬워보이는 문제도 사실은 기본적인 Spring, JPA, Spring Security에 대한 이해없이는 해결할 수 없었다.\n자신이 쓰고 있는 기술에 대한 완벽한 이해는 아니더라도 기술의 기본적인 동작 과정을 파악할 수 있어야 자신에게 닥친 문제 상황을 해결할 수 있다는 점을 이야기하며 글을 마치고자 한다.</p>\n<h3>참고 자료</h3>\n<p><a href=\"http://www.acornpub.co.kr/book/jpa-programmig\">김영한, 자바 ORM 표준 JPA 프로그래밍 [스프링 데이터 예제 프로젝트로 배우는 전자정부 표준 데이터베이스 프레임워크]</a></p>\n<p><a href=\"https://kingbbode.tistory.com/27\">Kingbbode, Spring - Open Session In View</a></p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이번 편에서는 전편에서 해결하지 못한 부분이었던 “Spring Boot에서는 기본적으로 OSIV의 설정 값이 true인데도 불구하고 LazyInitializationException이 발생하는가?”에 대한 원인을 알아보고 이에 대한 해결책을 이야기해보고자 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"1편에서는…"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://tecoble.techcourse.co.kr/post/2020-08-31-entity-lifecycle-1"},"children":[{"type":"text","value":"1편 링크"}]},{"type":"text","value":"\nLazyInitializationException이 예기치 않게 발생하는 상황 속에서 하는 이유와 그 원인에 대한 해결책을 찾아보았다.\n요약하자면 참조하려는 Entity의 연관 Entity를 조회할 때, 영속성 컨텍스트가 존재하지 않는 상황에서 LazyInitializationException가 발생했으며,\n이를 해결하기 위해서는 영속성 컨텍스트가 존재하는 상황 속에서 미리 필요한 연관 Entity를 불러오던가, 준영속화 된 Entity를 다시 영속화시키는 방법으로 해결했다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 앞에서 살펴본 바와 같이 Spring Boot에서는 OSIV가 기본적으로 설정되었기 때문에 연관 Entity 조회는 스프링 대부분의 영역에서도 가능해야 할 것 같은데, LazyInitializationException은 계속 발생하고 있다.\n전편에서 찾은 방법으로 일단은 문제를 해결해야만 했지만 이제는 근본적인 원인을 파악해볼 차례이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"원인을 찾아보자"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"원인을 파악하기 위해서는 User를 Controller에서 가지고 오는 로직, 그리고 OSIV가 적용되는 방식 2가지에 대한 이해가 필요하다.\n정확히는 Spring Security가 어떤 방식으로 사용자 정보를 가지고 오는지, 그리고 OSIV가 정확히 언제 열리고 닫히는 지를 알아야 된다는 뜻이다.\n우선 Open Session In View를 알아보도록 하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Open Session In View 어디서 구현될까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"계속해서 이야기했지만 Spring Boot에서는 "},{"type":"element","tagName":"a","properties":{"href":"https://tecoble.techcourse.co.kr/post/2020-09-11-osiv"},"children":[{"type":"text","value":"OSIV"}]},{"type":"text","value":"가 기본적으로 설정되어 있다.\n어떤 방식으로 OSIV가 설정되어 있고 어떻게 동작하는지 자세히 살펴보도록 하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Configuration"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"proxyBeanMethods "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ConditionalOnWebApplication"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"type "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"SERVLET"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ConditionalOnClass"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebMvcConfigurer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ConditionalOnMissingBean"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewInterceptor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ConditionalOnMissingFilterBean"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ConditionalOnProperty"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"prefix "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"spring.jpa\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" name "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"open-in-view\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" havingValue "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"true\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" matchIfMissing "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"protected"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"static"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"JpaWebConfiguration"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Bean"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewInterceptor"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"openEntityManagerInViewInterceptor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewInterceptor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Bean"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebMvcConfigurer"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"openEntityManagerInViewInterceptorConfigurer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewInterceptor"}]},{"type":"text","value":" interceptor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebMvcConfigurer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Override"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"addInterceptors"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"InterceptorRegistry"}]},{"type":"text","value":" registry"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n                registry"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"addWebRequestInterceptor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"interceptor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 클래스는 Spring Boot에서 자동으로 Bean을 설정해주는 Configuration 클래스들 중 에서 Open Session In View를 설정해주는 클래스이다.\nSpring의 자동 설정 방식을 이번에 다루지 않을 예정이기에 필요한 부분만 이야기 해보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"@ConditionalOnProperty를 보면 알 수 있겠지만 기본적으로 Spring Boot에서는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"spring.jpa.open-in-view"}]},{"type":"text","value":"라는 설정을 통해 Open Session In View를 설정하고 있다.\n이 값이 true이면 OpenEntityManagerInViewInterceptor를 인터셉터로 등록하여 Open Session In View를 적용하는 것을 알 수 있다. 이 구현체의 코드를 보면"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewInterceptor"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"extends"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Override"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"preHandle"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebRequest"}]},{"type":"text","value":" request"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"DataAccessException"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n        logger"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"debug"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Opening JPA EntityManager in OpenEntityManagerInViewInterceptor\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"try"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"EntityManager"}]},{"type":"text","value":" em "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"createEntityManager"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"EntityManagerHolder"}]},{"type":"text","value":" emHolder "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"EntityManagerHolder"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"em"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"TransactionSynchronizationManager"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"bindResource"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"emf"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" emHolder"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Override"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"afterCompletion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebRequest"}]},{"type":"text","value":" request"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Nullable"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Exception"}]},{"type":"text","value":" ex"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"throws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"DataAccessException"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n        logger"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"debug"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Closing JPA EntityManager in OpenEntityManagerInViewInterceptor\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"EntityManagerFactoryUtils"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"closeEntityManager"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"emHolder"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getEntityManager"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Interceptor의 preHandle을 보면 언뜻 EntityManager를 Open하고 afterCompletion로 Close한다는 내용이 들어가 있다. 조금 더 자세히 코드를 보아야 정확한 동작 과정을 파악할 수 있겠지만,\n간접적으로 preHandle, afterCompletion을 통해 EntityManager를 열고 닫는다는 사실을 파악할 수 있다. Interceptor의 동작 과정을 살펴보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"OSIV(Open Session In View)는 하이버네이트에서 사용하는 용어다. JPA에서는 OEIV(Open EntityManager In View)라 한다. 하지만 관례상 모두 OSIV라 부른다.(출처 : 참고 자료 1)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1820px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 41.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAcICf/EABYBAQEBAAAAAAAAAAAAAAAAAAcDBf/aAAwDAQACEAMQAAAB2Qr6GmZOwXqf/8QAGxAAAQQDAAAAAAAAAAAAAAAABQABBhUCAwT/2gAIAQEAAQUCMW1eC5NuRt4/K3X/xAAgEQABAwIHAAAAAAAAAAAAAAADAAEEUWECERQhMkKU/9oACAEDAQE/AZW8gTVxjt2ZaAGfKV7JdqGX/8QAIxEBAAECAwkAAAAAAAAAAAAAAQQABQIGIQMTJDFBUWGVsf/aAAgBAgEBPwHMuJw5ltCdJtqe48Xs+Y6J4RKLtKNN3B9bAfsev//EACcQAAIBAwIDCQAAAAAAAAAAAAECAwQRIRIUABNBBQYVIjEzUWFx/9oACAEBAAY/AqfebbV4t2f7WovbdJpylh8myjmDAy3FOYHpKeeSatEc+zZ5o5HhrRzGZp1LspOo6h5jbUuCCLd8J1wBiipzf7ynqevT84//xAAaEAEBAQADAQAAAAAAAAAAAAABESEAMUGB/9oACAEBAAE/IdpBSIpNl2woRJHmsfqLyE/C8hwOvqwqD2/EStAYf//aAAwDAQACAAMAAAAQ+/8A/8QAGhEBAQADAQEAAAAAAAAAAAAAAREAITFBgf/aAAgBAwEBPxAUFALFUeKRHekaaThiiW1OF75EPhn/xAAZEQEAAgMAAAAAAAAAAAAAAAABETEAIUH/2gAIAQIBAT8QSkHbAgiJm0y46MGDAgKlXLVWi1z/xAAXEAEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEBAAE/EOOyxF2KeSJZhY3jXsb6aVnoq8INSGjcwiBArDX/2Q=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 09 20 entity lifecycle 02","title":"2020 09 20 entity lifecycle 02","src":"/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg","srcSet":["/static/2a4aef0cbf7764840e4b7561d2e94d0e/953fe/2020-09-20-entity-lifecycle-02.jpg 500w","/static/2a4aef0cbf7764840e4b7561d2e94d0e/0a251/2020-09-20-entity-lifecycle-02.jpg 1000w","/static/2a4aef0cbf7764840e4b7561d2e94d0e/ec679/2020-09-20-entity-lifecycle-02.jpg 1820w"],"sizes":["(max-width:","1820px)","100vw,","1820px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처 : "},{"type":"element","tagName":"a","properties":{"href":"https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/"},"children":[{"type":"text","value":"https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그림을 통해 preHandle은 Controller에 Request를 보내기 전, afterCompletion은 view에서 결과가 생성되고 난 후 호출되는 메서드임을 알 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 784px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 88.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAASABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAMHCAQJ/8QAGAEAAgMAAAAAAAAAAAAAAAAAAwUCBgf/2gAMAwEAAhADEAAAAfaiq7Xy9m4dNIT4EnCWhbdAk/8A/8QAGxAAAgMBAQEAAAAAAAAAAAAAAQIDBAUGABP/2gAIAQEAAQUC6ALCBrss+Z0P0q9KAVrncv3qGJrmCVEaTEhhFz3/xAAkEQACAQQBAgcAAAAAAAAAAAABAgMEBRESAAYTEBQxM0F0tf/aAAgBAwEBPwG7VSQx9P0vmI6V66a5JG7oxUuJaGJS7hCiZmqIIUaVlQyTquckcUVijUnuFSV7hEI31JG2FbGG9Rj4xy9+/YPtz/pWfw//xAAjEQACAgIBAgcAAAAAAAAAAAADBAECBREGABIQFTE0YXO0/9oACAECAQE/AYvma8l5gTGCfYELyCrkJLJOmXrfEMkXIIDrakW1YRbk7SailZmRknt0mXkEqhklWL3mkbu2vj12bfJgAZsEV9etaWmI6xPu+R/VjfwPeH//xAApEAABAwIFAwMFAAAAAAAAAAABAgMRBBIAEyEiMQUjQRAUMhUlRGFx/9oACAEBAAY/AmXElaNbyUuKmfqHT+JVbO9QSCLd0RGA7kUbyls3tN1Hu3KnfLqGrWqXLFS41uvSrJ3GDGuAKijeYW0cq2ZuCUIIX3A2rW6Ig8fI4p5jQaTOn3HpZ8SYlKZgE6cYp6fo4RQt1wJZq65Qsfdp6dThWhFM6+60l1ppSmw8wCkAJdtc5B6tX071ZO5dO127QlIEbGPIUfh55OBclKu65yAfyZ8/sA/0YZhpoZKKjJhCe1y329NmwlG2NpKeD6f/xAAbEAEBAQADAQEAAAAAAAAAAAABESEAMUEQgf/aAAgBAQABPyF9kA99k7+xDWk4Hma/5Urw5LRZwRTe2G7EKUDzTI8oKgRWp1QsECcUyXyWTiCPwjhCY2RN8b0LeL5ZIiGakkh38Aew4emTB7Uz2vd3eR8//9oADAMBAAIAAwAAABBDOMD/xAAXEQEBAQEAAAAAAAAAAAAAAAABETEQ/9oACAEDAQE/EEde8rJ1VgSRyiyXga4IGYWkFQ5L/8QAGBEBAQADAAAAAAAAAAAAAAAAAREAEEH/2gAIAQIBAT8QE1akFmci4ncsogbasdShnLjQ0o//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPxBcIOsRUiBZFOIwiFV9j1B4gJNql8dvQbOZbQNUaRWgODyKfFRq9/tmMqHWtLclwIgxC9eHOCyYInBDgCIgakQNqFEqE7akRvVVdT3/2Q=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 09 20 entity lifecycle 01","title":"2020 09 20 entity lifecycle 01","src":"/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg","srcSet":["/static/df829503df7cfeac6cdb14fbea1a9a22/953fe/2020-09-20-entity-lifecycle-01.jpg 500w","/static/df829503df7cfeac6cdb14fbea1a9a22/09704/2020-09-20-entity-lifecycle-01.jpg 784w"],"sizes":["(max-width:","784px)","100vw,","784px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처 : "},{"type":"element","tagName":"a","properties":{"href":"https://corp.jobins.jp/blogDetail/blog-201529492"},"children":[{"type":"text","value":"https://corp.jobins.jp/blogDetail/blog-201529492"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spring에서의 웹 요청 처리 과정을 살펴보았을 때, Filter를 제외한 대부분의 영역에서 @Transactional이 없이도 EntityManager의 도움을 받을 수 있다는 점을 파악할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그렇다면 User를 가지고 오는 부분이 Filter에 있다는 것인가? 아니면 다른 Interceptor를 통해 가지고 오는 것인가? 이 부분도 파악해보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Spring Security는 어떤 방식으로 유저 정보를 가지고 올까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음 그림은 Spring Security의 기본 구조이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 686px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEoUlEQVQ4yyWSC0yTBxDH7wMlc3PC3OYUFUFACAWpttRaXmKV14SpREAeKkhBosxKKbQKForFMYWJbExe/Uqx5ZkgvkCrVcBWHgU6MdNpHCqIgDDxge95++ou+eV/l8vd5ZI/VGfXbFBuJbEmogrlYaUo88/GguB8VEUoPkFukeuaopRwOrqaKAkrhaW2bmC32B6WLHIEWxsnsLd1BmtrZ7BZYEexFKD2RL3PSbHypCqtqrJOrCorTDiiLk0pUdSJVKU1GdWqqt1knPqgAk4erCR8OWvAcxUHfL18wX99EKxmc2CNlw+s5wZAVEQ4BAcFAVjM+XYZANhQLKawRN55wIhEeBodD29ieIA8PuRERJpLQv2o9jeA6E0g2gBqHQj8l0bgA2sCFY4E/uRmht3zAC6IY5c9EXgemhKwZSMpHtJTW2jFA4mMn18KV+dMpbLzh/meSeCLxGa67Wezv1vqBuBiCxaOzmDu5AxmzvbwBc0ZgDELhS6AU3MB9CXZ20Ylwfg0i4vDYi7qdnFwgO+Dk1nrKdbhE7HfVVSyAOz5Zmd2B7n9/SM7WR+/kmdMZCaY9Mo2Os/AY8Q9T+fEG3axfaFRXW3deaaBaWhWM8e6Lrn/npX6fVNJgbeh5RS991wjq50sWixgL7TAPBoMHYnb8/KADw4kM9GQyMAe3spPeRelz8VeOCrgkNAh2c66vHmJpjVkvqY1dMGFpuAFHedDrLVXNi1sbds4v6M7yuEIgilmEpflxxbdlkvZj5RS1qvmY/SK1G1Bt8olq57U5DHvkLks9b5IWzDUntg+3vwb3lEfxbs1hThYfwwH6wrxYWMRjp8rw39qD+sREUICuHOorTO0uUnwsSAcXvMZXveSGSUTKcyYF4UxcDkzlmoTM6HnbGPM5N2beNPQ+fFGlx57de3Yp2/Hfn3Hh8FbN3Ha2NZiWkhzXzHP02OFJQ6mmqOUBc+EnvwpIWeI0nKssAOcyDLjMl1nQz1ZYdNW8YvfH3UVa0Y19V6NMmGYvrIg8N5ZlXePspjblLPPHmAWoVGVmeO0Al7udwWxO4DpiHAtnXZfsGm2P2U6YxJlanC0gG5ZAuuV0EP7XuCundzjqtGEO1z/K8Gl7X0a/eJbAV3/QuBRRI0DKr+G27LYyOn0Vf03drrq+uNdO9pjXXq7d9B0ffGu195msIyP+CwRdJTnhw8d2jI6Jg29/zD7hwe6veuGjelBD0dzNw4+lm6cGMkMrEBMByx2AH2RKHtIEvq6Ly1grHOf/0RvWuB4vzBwois1YGxYsuHVLQE3F5RHpV8Zy6Tu14szVz6uK3BT8KMCL+WlcP6U5y3vO5HN0OYkLZm7wncGOgGIq1u/DOxEq/zHaFn+DC0LH6HV4RG0Kh5HK79etISs4ZnQd1wY+mK/D37Yz343vJf57nqc28eencs/TGew37wRs3FaxLmIhdTTpwIImboFklvvw6+946AYmIQy4wQcN4xDWd8YJGlG4PMDZwEq8zJDrkp2NF87GF2vzYxuOJce2dAq2trQnhVTr5PEnm7Zu0FkMqHJielpqQRJkoRcLidIE+T/aqoVCpIQiTLgP8f3PpS97ZirAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 09 20 entity lifecycle 03","title":"2020 09 20 entity lifecycle 03","src":"/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png","srcSet":["/static/9a755c2e7e2c58640bef281c463b1f4e/0eb09/2020-09-20-entity-lifecycle-03.png 500w","/static/9a755c2e7e2c58640bef281c463b1f4e/3a6ec/2020-09-20-entity-lifecycle-03.png 686w"],"sizes":["(max-width:","686px)","100vw,","686px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처 : "},{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications"},"children":[{"type":"text","value":"https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그림에서 알 수 있듯이, Spring Security는 Filter를 기반으로 동작한다. DelegatingFilterProxy에서 사용자의 요청을 가로채 Spring Security의 기능들이 수행되며 모든 요청에 대해 보안이 적용되게끔 한다.\nDelegatingFilterProxy에는 Security 기능들이 구현되어 있는 다양한 Security Filter가 존재해 일종의 FilterChain을 이루어 동작한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 803px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 72.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEdElEQVQ4y02UeUzTZxjHX3HKZlxclk2mbMaRLMZtxg2XHc7ARiZTov4jC9mWbRp3xQG6OTkcyN0ihoIuyD0F2lIKCG1pgRZWjozSi54U2kIpl9VeXC29f8/e4v7Yk3zyfd7vH0/yHHnRDoQO5j2ca8zstsCFcn7gYqWQuEAREJfuDBHf3u7zpzfroHDQ31Y0YEe5HAcqGAZUMASoEGu+kMAAIo/jnO9BWR0WFI59pZz5fnLfY8h8IIYbVDlkUZUYBWQ1iSG/awZKBOuCE2d/jslh21MKBN7k/P7NZFwgOa/PvUXxEHE+l7v+5XXGchS63z6KaMKF6i6+HFgC2RpbIHWxRRZXp0DpYvEla939UmgZXPyztF2dktM1D6kNMvi1WQNXm1Rw5b4S0htlcLl2HG6wHkOxMPg5SvmlCDX1TkXd6jYnlfdZT97mWhIpfdbESr49sazHcrKMvXC2sMW4u7xjIvnuyDooZu0+6dSyX6xbCoi0iwHJ9CO/1mT11Iy54Sfq4mn02guRMbkdM5RrTPPCVyT29HflfMM3ZTxMrwG/p9Jbpp4Uj0BJcctYSvXYJtgcK2CanQWDwQh6vQF0U9PgsFnhgdwPPzAcSeEZHiBz5gUlPAtkNsngj1YNXG9WQDZdA9l4jkWcRSAJfTxyLesMhWee7JBYxawJp6hb7gjreJfMLu4QPZJSehc1uTzXEUS6y0D1PH0jvUcMdK4YWrpHoZlvgCaOFNp6xUBli6C6x9hO3YYQeKmRxz+Oe/Hwm8f2v/H2hy8dOnzslXdjP9p76Vp2JFjObz/xfuwe1KUB1PBQcrCSqUqoZCrjKtoU8eVMTXwFUxWP8zjsfVpK10QvObzIrNeGO8Kl0VuYo5hYzPMzc4tIr9Oiw+8c/wBdzLi3rYo1g8htRkRmzmxRzDQhUvssKmmdRhVMNfqaJEHWVe9l54avyO0jcjQmG6lVaLzTLzWXr20Gbq64/Ln2dS8pCHAApZ7aF5Gc3bUr/Z7s1bQq6f4rNYropzoRnUYZiEo49cVO1rhlh8sbNPuCBIQIAsx2P9BEKzBqcEMgREDY9/hDYFvzJKGY6KgjOfWDVVeb1NbUOpE5tV6ygDHjO3Nco+sZ4R4BIGLDS6g8AYBNP/g8QQgaTMvBVXcwiL0AxuvyAWx4IQE9h9Ce29ThrPxWtSyPrhi6SZWP5NEUQ/l0pTy3VUfG9XZPVifvruYoJzNoWsimqULZNPXWJWTRVPgqtEQGVRW8xTZCc6/yPHp9/96jOTX9zVfvK4JpdeK1y1XDG6m1otW0unH4naZn44KRLMr3z3JH1JOMATUwBlTBziEtQeP+Q3T+rSTahZMEna8IcMdnQKxbPoNe3oV2/sXsf6+BIz9Xz5ElNXInkhp65KexnqtgjIa3iGwA20MAOvgv3Lh1geIRmGx++H/4QvAZ+jH1t4jhOUDtekDd5qc8nAXUaQTEsMHW78EaNTyzZHePPV7xuPE27QrTmqNh2OHkTDic1lWPE/s2i3PTP/9k45N/AX26DGdKtjFnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"2020 09 20 entity lifecycle 04","title":"2020 09 20 entity lifecycle 04","src":"/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png","srcSet":["/static/d2433b79aebeb3e12ac3a86b1061b5e6/0eb09/2020-09-20-entity-lifecycle-04.png 500w","/static/d2433b79aebeb3e12ac3a86b1061b5e6/476b8/2020-09-20-entity-lifecycle-04.png 803w"],"sizes":["(max-width:","803px)","100vw,","803px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우리가 기존에 구현한 CustomUserDetailsService도 Spring Security 인증과정에 필요한 UserDetailsService를 구현한 것이다.\n이 Service를 통해 DB에 존재하는 User 정보와 사용자가 입력한 로그인 정보를 대조해 인증/인가를 진행한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spring Security의 자세한 동작이 궁금하다면 "},{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-applications"},"children":[{"type":"text","value":"위 링크"}]},{"type":"text","value":"를 참고하면 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"LazyInitializationException이 발생한 이유는"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위에서 나온 내용을 간단하게 정리해보면 Spring Security에서 Filter를 통해 User 정보를 가지고 오며, Open Session In View는 Interceptor를 통해 적용되는 것을 확인할 수 있었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그림을 보면 알 수 있듯이, Filter가 Interceptor보다 먼저 실행되며, 따라서 현재 상태로는 FilterChainProxy에서 CustomUserDetailsService는 Service 내에서 @Transactional이 적용되는 부분에서만 영속성 컨텍스트가 유지된다는 뜻이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"즉 영속성 컨텍스트가 종료된 상황에서 Controller에서 @CurrnetUser를 통해 가지고 온 User객체는 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"준영속화"}]},{"type":"text","value":"된 상태이다.\n따라서 다시 영속성 컨텍스트가 OSIV를 통해 Controller에 주입된다 하더라도 이미 준영속화 된 User의 Favorites를 조회할 경우 예외가 발생하는 것이다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"해결 방법"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이를 해결하기 위해서는 기존에 설정되어 있는 OpenEntityManagerInterceptor의 우선 순위를 높이는 것이다. 하지만 Spring Security가 기본적으로 Filter 기반으로 동작하고 있어, Interceptor가 아니라 Filter로 교체해야 한다.\n다행히 OpenEntityManager를 Filter로 동작하게 할 수 있게끔 OpenEntityManagerInView 클래스가 존재하며, 이를 따로 Bean으로 등록하면 해결된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Component"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerConfig"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Bean"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FilterRegistrationBean"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"openEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FilterRegistrationBean"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" filterFilterRegistrationBean "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"FilterRegistrationBean"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        filterFilterRegistrationBean"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"OpenEntityManagerInViewFilter"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        filterFilterRegistrationBean"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setOrder"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"MIN_VALUE"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 예시를 위해 최우선 순위로 Filter 등록"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" filterFilterRegistrationBean"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"OpenEntityManagerInView가 Spring Security의 DelegatingFilterProxy보다 먼저 적용될 수 있게끔 Order를 설정하는 것을 잊지 말자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"또한 OpenEntityManagerInView가 사용자에 의해 Bean으로 등록되면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@ConditionalOnMissingBean({ OpenEntityManagerInViewInterceptor.class, OpenEntityManagerInViewFilter.class })"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@ConditionalOnMissingFilterBean(OpenEntityManagerInViewFilter.class)"}]},{"type":"text","value":"\n를 통해 자동 설정이 되는 Bean들은 무시된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"@ConditionalOnMissingBean : 어노테이션에 명시된 Bean이 존재 하지 않을때 Bean 등록이 실행될 수 있도록 하는 어노테이션이다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이 설정을 추가하면 Lazy로 동작하는 연관 Entity를 조회할 때, 정상적으로 동작하는 것을 확인할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"OpenEntityManagerInView vs OpenSessionInView"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"OpenEntityManagerInView : JPA를 지원하기 위해 사용되며 EntityManager가 thread 전체에서 적용되도록 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"OpenSessionInView : Hibernate를 지원하기 위해 사용되며 Session이 thread 전체에서 적용되도록 한다. Spring Boot에서는 SessionFactory가 Bean으로 등록되어 있지 않으면 사용 불가"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"결론"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LazyInitializationException만 알면 쉽게 해결될 것만 같았던, 비교적 쉬워보이는 문제도 사실은 기본적인 Spring, JPA, Spring Security에 대한 이해없이는 해결할 수 없었다.\n자신이 쓰고 있는 기술에 대한 완벽한 이해는 아니더라도 기술의 기본적인 동작 과정을 파악할 수 있어야 자신에게 닥친 문제 상황을 해결할 수 있다는 점을 이야기하며 글을 마치고자 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"참고 자료"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.acornpub.co.kr/book/jpa-programmig"},"children":[{"type":"text","value":"김영한, 자바 ORM 표준 JPA 프로그래밍 [스프링 데이터 예제 프로젝트로 배우는 전자정부 표준 데이터베이스 프레임워크]"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kingbbode.tistory.com/27"},"children":[{"type":"text","value":"Kingbbode, Spring - Open Session In View"}]}]}],"data":{"quirksMode":false}},"excerpt":"이번 편에서는 전편에서 해결하지 못한 부분이었던 “Spring Boot에서는 기본적으로 OSIV의 설정 값이 true인데도 불구하고 LazyInitializationException…","timeToRead":6,"frontmatter":{"title":"Entity Lifecycle을 고려해 코드를 작성하자 2편","userDate":"20 September 2020","date":"2020-09-20T12:00:00.000Z","tags":["jpa","entity","transaction","security"],"excerpt":null,"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYklEQVQ4y5WT7U/TYBTF+duMQ0B0imAAIYONsTcYe4Np1JD40fhFCQoZilMCbrCuXdun7fqytuvGYiJR3P9zvNkivgHqh5s0TZ5fzj33nIFs20TK05G0NSxZCuK6gqjGsKgwhGSGgCDjXkXG1JGEu6UaxvcF3N7jcbNYxY03VYzsVHFtm4Nv8whXNsoYOAM6GhIETBgKlk0VCU1DTFURJugMJ2PysA+cIODY5UCDgAaWSeGKrSLTsBCTm4jLLuYrLQRpYrKOWU7CREnAHQL63xGsyF2scKWpI+XWseo4CHGdHjBrGUjWTURF+lfxEOZNTJHK6RLZcChi7L2A668vAa55FpJam6ANZEnlbKmDmdIxEqyBJWZicu8Yq4qGp04N63UJKZG83a9hqHDOypmWjozlISLSI8fG2O4nXH3e7Y2/cIK4ZGH+yEaOacirDJGqggeKiHVNwPCO8Csw0zKQOzaworeRNjykTReDG18xtHmK4Zen9N1FuOogLtLKBy6yTEGhU0GgrOKJTp4WBfi2/lBokLImco0mAR2Mbn+G70W3Bxt59QWLgo1wxcFDVkeO4rTGJMR5hkxNgn9XwODW7x5SbPKeTRf9iHzTIt9c3No5gZ8mxHlI1XXMlV3cVzU81mU80iQ8swUEy+J5HvaPkiVo2miRj21SavWunDZ1LCkWAqUWrd2g6DAscJRTUjZ9IFJs+IuC3c9h2qGVbFqPb9MR2gR3ezlc4CiTtOL4h+855DH6lvtLUwiYMPstSRo6EqqJmGIgSpedExg1RfzP6v3U5Yja73JQYpjlf3R54h+A3wDIBs6lNbuYgwAAAABJRU5ErkJggg==","aspectRatio":1.584327086882453,"src":"/static/b9f10070e67a05a13265cb154b3a8858/7bcbe/cycle.png","srcSet":"/static/b9f10070e67a05a13265cb154b3a8858/3a443/cycle.png 930w,\n/static/b9f10070e67a05a13265cb154b3a8858/4d929/cycle.png 1860w,\n/static/b9f10070e67a05a13265cb154b3a8858/7bcbe/cycle.png 2454w","sizes":"(max-width: 2454px) 100vw, 2454px"}}},"author":[{"id":"2기_라테","bio":"우아한테크코스 2기 라테(임민우)입니다 :)","avatar":{"children":[{"__typename":"ImageSharp","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADiklEQVQ4y62UXUybVRjHudm9F8YrE2925YXemWgmMwwKFOjHQhQXtyVOjUQNE7NsAmk32OychIZWrDI3s7nAJGuYMaILLmyATtgktJQWtsHcLIENqHyubz9/nveUti/djDdePDnvyXnP7/yf8/zPkxeNRtFGJBKRkf5W1FAihJXUmLueuz/v32DqZhWWTESBmIg4JGPEY1EJ10K14DwtLP2tblA3qzEzv85QIES/dwHfnWVW1hQJl4c+Bpr3OGWqolvBVZo671B53E9p47gIP2VN4+xzTHK+f1Yemoin/tcKytNOwhuwQV8I8zEfOyw+yq2jGD4awFh7BWPdELo6Dy/VjnLw9G2WVsMpqEZpJmVlI83AvRVMR31SlbnmMkbDSczlX1JR4KB0Wwt763o4PDiNye7DenZaAtMZZoDpibrYcGaKQquAfdCLobAVc5kL3fMWqiodOD0B3MkZLsTusdsxRsHHXq54F+WdhhVNyqpkVd3t4ArGo+NUWEYwVnwlYflPvclrr7xHa38fNQeaORe6ScvAdcp3uSk64qexYxoSMcnIKEzdXZzeP+YpPjKO6cM+ygucFD5bj+m5PXRFgzivDbBtSxGfX7/G27XnKSttR2/18JZzUlQ+LO30CPD73+6jU6u5r4eaY920jdzg7P1J3DygKyZSZZb9DS5KXrBh3nkaff0Ib7RMEFoOZ+5yE/Cq8JquwcPuz27whd9PV2JWQOb4TihUx9r6FvKfqMJU0oap8gwlFi/VbTdZW1eIaRXKFyFOmFkIY7Dd5dVWP9U1Lk4Fb3GRebpZxHqykxe3mESh7BiLHJire9ghitfs/lNaLf0sN/kwGl6l74Idjyuf0C8HuTTwLbbLwwI6x/5P3OhftmMqdmKs6sDQOIb+8BijU0sZYPbpRRQi4qlG533Q+SSMN4uJj0uf7uJdx680dQ9iMrRjNJ3C/M4PGBu9bBcG//rn4CZ1WWNHwkQSYml2iPi5p4n1vg7urdhO2Cg88Rf6A79TdmgYvWVUerTYOkb7T0FZWW2GWaDyEFmWwDckO54h8aOOZN9eLl6d5n3XFFXNAXYeD7DHPiF9Nzzxt/RtLkyTspAbFR1kbYHo0l3xnTpZOFYWbG5xneCDNRaXH6a6EFkj53aqVFHS0FhC3mUk08YUOaoOSIrXEN9oBLn98NEGKxWmRrVAqTF70cpG5Hbr/+zY/0f8AwerZodanHrxAAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/9b8401f8fe2bd979f155bd3fde782a94/bc8e0/latte.png","srcSet":"/static/9b8401f8fe2bd979f155bd3fde782a94/22f7f/latte.png 40w,\n/static/9b8401f8fe2bd979f155bd3fde782a94/587c9/latte.png 80w,\n/static/9b8401f8fe2bd979f155bd3fde782a94/d966b/latte.png 120w,\n/static/9b8401f8fe2bd979f155bd3fde782a94/bc8e0/latte.png 800w,\n/static/9b8401f8fe2bd979f155bd3fde782a94/a1946/latte.png 944w","sizes":"(max-width: 800px) 100vw, 800px"}}]}}],"source":null}},"relatedPosts":{"totalCount":9,"edges":[{"node":{"id":"5ca7006a-db24-5be4-ab7b-c266396039b5","timeToRead":6,"excerpt":"JPA를 공부하다 보면 바로 이해하기 쉽지 않은 개념들을 몇 개 마주친다.\n필자는 연관관계 매핑, 영속성 전이, 고아 객체 등이 특히 어려웠다.\n이때 와 가 유독 헷갈렸는데, 직접 학습 테스트를 작성하며 이해했다. 이번 글에서는 영속성 전이(REMOVE)와 고아 객체를 학습 테스트를 통해 비교하여 살펴본다.\n최종적으로 독자들이 둘의 차이를 이해하는 것을 목표로 한다.","frontmatter":{"title":"JPA CascadeType.REMOVE vs orphanRemoval = true","date":"2021-08-15T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-15-jpa-cascadetype-remove-vs-orphanremoval-true/"}}},{"node":{"id":"e9c89353-6bd4-5c77-ae9d-f4985eedec42","timeToRead":6,"excerpt":"Spring Data JPA에서 Pageable 를 활용한 Pagination 의 개념과 방법을 알아본다.","frontmatter":{"title":"Pageable을 이용한 Pagination을 처리하는 다양한 방법","date":"2021-08-15T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-15-pageable/"}}},{"node":{"id":"f5ad1928-7bd1-5ffd-8236-456b90bfaa40","timeToRead":7,"excerpt":"1. QueryDSL PostRepository.java Spring Data JPA가 기본적으로 제공해주는 CRUD 메서드 및 쿼리 메서드 기능을 사용하더라도, 원하는 조건의 데이터를 수집하기 위해서는 필연적으로 JPQL…","frontmatter":{"title":"Spring Boot에 QueryDSL을 사용해보자","date":"2021-08-08T12:00:00.000Z"},"fields":{"slug":"/post/2021-08-08-basic-querydsl/"}}},{"node":{"id":"b36ac8ed-2f7a-5c86-922e-8cfced80305e","timeToRead":9,"excerpt":"1. Pagination 게시판 기능을 제공하는 웹 어플리케이션에 접속하여 게시물 목록을 요청하는 경우를 상상해봅시다. DB…","frontmatter":{"title":"JPA Pagination, 그리고 N + 1 문제","date":"2021-07-26T12:00:00.000Z"},"fields":{"slug":"/post/2021-07-26-jpa-pageable/"}}},{"node":{"id":"4c39987f-6043-59b5-b2b4-dce7f791bfbc","timeToRead":3,"excerpt":"이번 포스팅은 OSIV(Open Session In View)와 관련해서 개발 중 발생한 예외에 관해서 이야기 하고자 한다. 제목에서 있듯 OSIV와 HandlerInterceptor…","frontmatter":{"title":"OSIV와 Custom Interceptor를 같이 사용하기!","date":"2020-11-03T12:00:00.000Z"},"fields":{"slug":"/post/2020-11-03-osiv_with_interceptor/"}}}]}},"pageContext":{"slug":"/post/2020-09-20-entity-lifecycle-2/","prev":{"excerpt":"테스트 더블(Test Double)이란? xUnit Test Patterns의 저자인 제라드 메스자로스(Gerard Meszaros…","timeToRead":6,"frontmatter":{"title":"Test Double을 알아보자","tags":["test-double","test"],"date":"2020-09-19T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.3319415448851775,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQGBQn/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAwT/2gAMAwEAAhADEAAAAeMepOsaYIEyH//EABkQAAMBAQEAAAAAAAAAAAAAAAIDBAUBEf/aAAgBAQABBQLMxMqpJ5i0McICclfFg/U8Gm8nt//EABoRAAICAwAAAAAAAAAAAAAAAAABERIhQVH/2gAIAQMBAT8BnbyVfD//xAAbEQACAQUAAAAAAAAAAAAAAAAAAQIREiExUf/aAAgBAgEBPwGjWFovj0//xAAlEAACAQMDBAIDAAAAAAAAAAABAgMREiEABBMFIjJBI1FTYaH/2gAIAQEABj8Cglm6zPt5HHyxL0Pd7sQyBluTlh3AWWqNejKBUixgla6kWIybiFHKxznbSbflQeLmB7mhLfjZiV+zoilKetILE7DdW3J8cN9js/rZzhhxx9zh8ofV3aM+BuIK+xTONcnFDHgCkKWLj3Qs2f3X0Ma//8QAGhABAQEBAQEBAAAAAAAAAAAAAREhADFRcf/aAAgBAQABPyGIGRMrED1gwgGFEufYkwK6MMLy1phREfiOj1r1ykq/ZMUAE908UNRGiLX6KVQMNK5JtYutsWQYCYJ3/9oADAMBAAIAAwAAABAn/wD/xAAeEQEAAQQCAwAAAAAAAAAAAAABEQAhMVFBYXGRof/aAAgBAwEBPxCCsicGD2M24IjdC4V/Brb38a//xAAcEQEBAAICAwAAAAAAAAAAAAABESFBAIFhcfD/2gAIAQIBAT8QIsIM3GjZ3c9PDBTQBqann6er/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFB/9oACAEBAAE/EG7OHw4j0eYJNR6TrGlrh4WTG/TqrzRvg4gycw+9IRHQkLyMoZ3FqwD/ACziLOcy2gLTZCiYMBCi/wD/2Q==","sizes":"(max-width: 638px) 100vw, 638px","src":"/static/c48642ebdf32cd7ac9ccca6b541da689/dadfe/test-double.jpg","srcSet":"/static/c48642ebdf32cd7ac9ccca6b541da689/dadfe/test-double.jpg 638w"}}},"author":[{"id":"2기_스티치","bio":"우아한테크코스 2기 스티치(이준영)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAgGBwn/xAAWAQEBAQAAAAAAAAAAAAAAAAAEBQP/2gAMAwEAAhADEAAAAe77WR55Mv1WYdqeU4xCsoMUZv8A/8QAHBAAAgIDAQEAAAAAAAAAAAAABAUCAwEGBxIU/9oACAEBAAEFAjjTQ4K8C30U5x76K7isTc32SYJy5rG+O5U/Zrw7BhbLV3zLKz//xAAkEQABAgQFBQAAAAAAAAAAAAABAgMABBEhBTFRcfAyQXKBsv/aAAgBAwEBPwGbbbln1ttqzTXxyomu19/UBdhzSMQJE60ASAptCVAHqSV3CtQe4NjHPmP/xAAgEQABAgYDAQAAAAAAAAAAAAABAhEAAwQSITFBUfDh/9oACAECAQE/AaWYuokpmzN3Wv22y3GfbgoLn5FCAaNZIBtmLUnGlBKWI6I4IzDnv2I//8QAJRAAAwABBAICAQUAAAAAAAAAAQIDBBESEyEAMSIkQRQyYWKx/9oACAEBAAY/Ao42bls9jjYdKY/Igxg5kGY5FJnblLiDHAQknkaRdhNUYMM6N1zRklaDKR0rJtF2axZNyfj2O/x168y9AT9p+9f6TH8+c6QpbIyqHDSyozzx5lS7VtVBpNkPeJvb5VZhoV3gslMzNlHj+vhl6Lg5VK0UVaiEcfJCOtYFCpLEsd23TzJpqoDZdCPlr1xyPvr/ADzN30tP9IZ3UQoZCjJQBVuB1VB+8KfTgMNCPMbArn5VcOt2+u7gpGj725sf46workuOMhdSQysjMp+VQx53BZgdzbUmoJ796Aef/8QAGxABAQEBAQEBAQAAAAAAAAAAAREhADFBUWH/2gAIAQEAAT8hKYUBDPGLJx/lMGok1TE+pO49JsToWv8AN+DzPnDKmy8a1QML09EOOqon23RdoHCuBizQJGW2ePN94I9p1NSLQPX+DVDtXJjen10hVItYqWQiqkAX4d//2gAMAwEAAgADAAAAEN8Xwf/EABoRAQEBAQEBAQAAAAAAAAAAAAERIQBBMWH/2gAIAQMBAT8QdIkpGhVgCQsMQUqOMCphm+19ju/Rdfw56IqAhiGGAoDEeAzDzw5//8QAHREBAQACAgMBAAAAAAAAAAAAARExUQAhQZGh0f/aAAgBAgEBPxAMAAtAYInC4wcLeqsus3C1vvwfeLIECFbLSqVgCqJXjTLO3f7ffP/EABgQAQEBAQEAAAAAAAAAAAAAAAERACEx/9oACAEBAAE/EMOqznyqmgTy+v2bm5UFg7iS1j4uDF3vkFEAIOKwIs5FzfewRsNMFFTzY3smZ4m+JPVCoHYFrUCJaAZd+5zIPIpXh4Z5t2bbbgjOEqiM7LTClpv/2Q==","sizes":"(max-width: 400px) 100vw, 400px","src":"/static/956289f603f566be6276e5a77ff3ca9a/25252/stitch.jpg","srcSet":"/static/956289f603f566be6276e5a77ff3ca9a/fd013/stitch.jpg 200w,\n/static/956289f603f566be6276e5a77ff3ca9a/25252/stitch.jpg 400w"}}]}}]},"fields":{"layout":"post","slug":"/post/2020-09-19-what-is-test-double/"}},"next":{"excerpt":"…","timeToRead":3,"frontmatter":{"title":"제네릭을 사용하여 테스트 중복 제거하기!","tags":["refactoring","test"],"date":"2020-09-20T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.8525896414342629,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUCBAYJ/8QAFwEAAwEAAAAAAAAAAAAAAAAAAwUGCP/aAAwDAQACEAMQAAAB6PMqbrJshmyAuH//xAAbEAACAgMBAAAAAAAAAAAAAAABAgADBBEiEv/aAAgBAQABBQKu3wbb20epjkxmOnPX/8QAHREAAgIBBQAAAAAAAAAAAAAAASEAAhIRI1GBsf/aAAgBAwEBPwHOi2hqAHldnlEBzr2f/8QAHREAAgIDAQEBAAAAAAAAAAAAAQIREgMEIQAFQf/aAAgBAgEBPwFNvRVMYPysTuqIHyNt7k5HUC+QquVUW7AmgWqg17E+YgsxVaKWJVJJqCeLLSTUck9P733/xAAkEAACAQEHBQEAAAAAAAAAAAABERIhAgMQIjEyQQAEE1Fh8f/aAAgBAQAGPwIgXfkUWAa5jyImizOuV0ouhHtyNrtWpJHdEC7ZIXMdQfhcU+PVT+4a4f/EABoQAQADAQEBAAAAAAAAAAAAAAEAESExUZH/2gAIAQEAAT8h3DbHXIpcuuLUQlQs7oadprwCB8PJYbYVfaB4dqmFiMyb5KvXI1tn/9oADAMBAAIAAwAAABBj7//EABgRAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEDAQE/EAQXAVYAsAULAgM1LyiqAFUKoXCrWeV17//EABcRAQADAAAAAAAAAAAAAAAAAAEAEUH/2gAIAQIBAT8QCNvIV4NosQgy6AQFxBhoFUi0pZ//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMUFR8P/aAAgBAQABPxBkQNQKDB4dkIuOhUNMBE97xYMJKk0FqEXYJXgzYYYhxZjV8s2taPLfrHkvet7vs7d+Wf/Z","sizes":"(max-width: 1178px) 100vw, 1178px","src":"/static/6314bdf62893ab3be8f5499dda9e0a95/03254/generic.jpg","srcSet":"/static/6314bdf62893ab3be8f5499dda9e0a95/0079a/generic.jpg 930w,\n/static/6314bdf62893ab3be8f5499dda9e0a95/03254/generic.jpg 1178w"}}},"author":[{"id":"2기_카일","bio":"우아한테크코스 2기 카일(김시영)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAgHBAb/xAAYAQADAQEAAAAAAAAAAAAAAAADBQYABP/aAAwDAQACEAMQAAAB2uP818HMPbIdTvDWsbmFhYsk/wD/xAAaEAACAwEBAAAAAAAAAAAAAAAEBgECBQMH/9oACAEBAAEFAltqvv8AaX10znDd9JXdU0bM1LqnPNbyFoUsO4jwsrayBaIt3YYtXS//xAAkEQACAQIFBAMAAAAAAAAAAAABAgMREgAEITFBBRVRYTJy8P/aAAgBAwEBPwGSUZZnjlmZ3iuYSLaIJrTVQCK1EkdHVQd7UuZjU9xyfMvTT9p5w3HyAnUV86DGZ2/esMBcdBv49jH/xAAlEQABAwMDAwUAAAAAAAAAAAABAgMSBBEhADFBBRQiBhMVNFH/2gAIAQIBAT8BoumNViJpZEX0gIbd+zTrVafhFNi2u7c4ysmRSBoemqs5+P6gb89myq+3PbZH5qgyoE5OMnffTSle2jyOw5Ov/8QAKBAAAgICAQMCBgMAAAAAAAAAAgMBBAUSEQAGExQiFSExMkJRFjNB/9oACAEBAAY/AsL3Rjn4V9LN0jp2p3JRUM2mv530yZZIQgSlTahbVpEoFZyYKeHWUr90Y6lj+1KN23V9PiaC2KiarS+HlXmgtto1sUv1D3WfMLA2L2s8YdDZ/k5JMatVDvBhrhg1qlRy7g/T+KWRIzKdT0/I4OSWu/Z7HtNHKZC6ldmw3IDXrU6id9nUKhhK0XLSoCsx6x8pJ35IZ4josfcyjMf3LhrkWMLkkX7G2UqWtl38dlbaw33r+12PsPmVSPkqt4iROKhZGr2+2/NSt6wzF0TNmEAL/wCpigKPLB8FARBfWPlxHVEu3cDisJ6m3aRYHG1YrA9akAxUMAJ1nxkRyH043L99czEcaT7OI152+/6bbf592vH48/PooW1ih8KfaGnHMjtM+4C/f76//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIUExUf/aAAgBAQABPyG6Y6Q+UBUhENlv5B/ZmIDoJgT0dBfI8nggsSqwLe26MlIAnZOuvS5GqBQjEvTUnUVBw0aBhsNDjvYDwH0Y8ZY+PuuKYDz9Lx2gLWnFBl2v/9oADAMBAAIAAwAAABDjKP3/xAAcEQEBAQEAAgMAAAAAAAAAAAABIREAMUFRYbH/2gAIAQMBAT8QJo9nuhUgOoO0Jak1mIAwhgC08F6EEBQCYAAM9BD4ITvtp9Px7//EABsRAQEAAwEBAQAAAAAAAAAAAAERACExQWGR/9oACAECAQE/END0LWSbGNHRCDQhdbSUqlqbqpEDWeyA3Ylaqu1XbevcEAIS8pz34fhn/8QAGhABAQADAQEAAAAAAAAAAAAAAREAECExQf/aAAgBAQABPxB6fTiOqZiWO8Pni4YB+r1i5hIcx8fn32U6TnepTQ886pSUtfWU9bdqHxcHoICdCqzD4X/ITQw1UvTPxuQbSSVKjLk494xmway4y21BHIYP/9k=","sizes":"(max-width: 460px) 100vw, 460px","src":"/static/dc1205e552d7c336ea0de85eaada889a/f86e8/kyle.jpg","srcSet":"/static/dc1205e552d7c336ea0de85eaada889a/fd013/kyle.jpg 200w,\n/static/dc1205e552d7c336ea0de85eaada889a/25252/kyle.jpg 400w,\n/static/dc1205e552d7c336ea0de85eaada889a/f86e8/kyle.jpg 460w"}}]}}]},"fields":{"layout":"post","slug":"/post/2020-09-20-test-refactor-generic/"}},"primaryTag":"jpa"}},"staticQueryHashes":["2130001345","4041952199"]}