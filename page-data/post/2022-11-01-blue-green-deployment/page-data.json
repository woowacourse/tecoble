{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2022-11-01-blue-green-deployment/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVQY003Qvw7BUBTH8YYgLCKExWw1IczEwAtIJCa1GJuyCalI/EmERUgHi5cxeI8uTTt1aHp9r9wmhk/OOfee/HJzNd/3Dc/zutS24zgZIUQpiqIt9YY+vUb9+eur6Kh5GN9LGkEn2DBd1y1zmGfxjjf9AFm1XEQCBe6aVBMVLJHiLBcHTiHwQS0MQ/mSOlYsjPDCAjOMccUFR3Z0NdvYISkDW9jAQi8IAhnYgAyZ4wELEzUfcFZfYmCPJ9ZIfwG9owW1fLgCkwAAAABJRU5ErkJggg==","width":400,"height":88,"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png 1x"}}},"markdownRemark":{"html":"<h2>무중단 배포를 도입하게 된 계기</h2>\n<p>프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 20초 이상의 다운타임이 발생한다는 것이었습니다.  </p>\n<p>운영 서버는 사용자의 경험과 직결되는데, 배포할때마다 서버가 20초 이상 다운되는 것은 큰 문제라고 생각했습니다.\n기능이 점점 많아짐에 따라 다운타임도 비례해 증가할 것이라고 판단했고, 따라서 운영 서버의 다운타임을 개선하고자 <strong>무중단 배포</strong>를 프로젝트에 도입하기로 결정했습니다.   </p>\n<h2>무중단 배포란</h2>\n<p>서비스가 운영 중일 때 새로운 버전을 배포하기 위해서는 1)기존 서비스를 종료하고 2)새로운 서비스를 시작해야 합니다.\n1번과 2번 사이의 과정에서 다운타임이 필연적으로 발생하며, 다운타임 동안 사용자들은 서비스를 이용할 수 없게 됩니다.\n이 다운타임을 해결해주는 방법이 바로 무중단 배포입니다.\n즉, 말그대로 중단이 없는 배포를 무중단 배포라고 합니다.  </p>\n<h2>무중단 배포 구현 방식</h2>\n<p>무중단 배포를 구현하는 방식에는 여러가지가 있습니다.</p>\n<ul>\n<li>AWS에서 Blue-Greem 무중단 배포</li>\n<li>도커를 이용한 무중단 배포</li>\n<li>L4, L7 스위치를 이용한 무중단 배포</li>\n<li>Nginx를 이용한 무중단 배포</li>\n</ul>\n<p>대표적으로 위와 같은 방법들이 있는데 저희 프로젝트에서는 제일 마지막에 있는 Nginx를 이용한 무중단 배포 방식을 선택했습니다.</p>\n<h3>무중단 배포 구현 방식으로 Nginx 방식을 선택한 이유</h3>\n<p>Nginx를 이용하여 무중단 배포를 구현하면 저희 프로젝트에서 다음 2가지 장점이 존재했습니다.  </p>\n<ol>\n<li>Nginx 서버를 이미 이용하고 있어 환경 구축을 따로 안해줘도 된다.  </li>\n<li>쉽고 저렴하다.</li>\n</ol>\n<p>위와 같은 이유로 Nginx를 이용한 무중단 배포를 적용해 보기로 결정했습니다.</p>\n<h2>무중단 배포 전략</h2>\n<p>구현 방식을 정했으니 이제 배포 전략을 정해야 합니다.\n배포 전략에는 대표적으로 3가지가 존재합니다.</p>\n<ol>\n<li>Rolling 배포</li>\n<li>Canary 배포</li>\n<li>Blue/Green 배포</li>\n</ol>\n<p>각 배포 전략에 대한 자세한 설명은 이 글에선 생략하겠습니다.\n위 세 가지 전략중 저희 프로젝트에서 선택한 전략은 <strong>Blue/Green 배포</strong>이었습니다.</p>\n<h3>Blue/Green 배포를 선택한 이유</h3>\n<p>우선 롤링 배포와 비교해 봤을 때, 좀 더 신속하게 롤백이 가능하다고 생각했습니다.\n또한 롤링 배포는 두 대 이상의 WAS 서버를 이용해 로드 벨런싱을 이용했을 때 큰 이점이 있다고 판단했는데, 저희는 추가 서버 증설에 제약이 있는 상황이었습니다.\n마지막으로 롤링 배포에서는 구버전과 신버전의 공존으로 인한 호환성 문제도 발생할 수 있다는 단점도 존재했습니다.    </p>\n<p>카나리 배포와 비교해 봤을 때는 카나리 방식의 최대 이점인 A/B 테스트가 현재 서비스에선 필요가 없었기 때문에 선택하지 않습니다.  </p>\n<p>Blue/Green 배포 전략을 취함으로써 신속하게 롤백이 가능하다는 점과 배포하는 속도가 다른 배포법들에 비해 빠르다는 이점을 얻을 수 있었습니다.    </p>\n<h2>Blue/Green 배포 적용</h2>\n<p>우선 무중단 배포 적용 전의 인프라 구조와 배포 스크립트를 살펴 봅시다.</p>\n<h3>무중단 배포 전, 인프라 구조와 배포 스크립트</h3>\n<p><strong>인프라 구조</strong>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQ4y6VT227TQBD1R/ITfAUvSHwAEo9IvPDCC0XqQyWowkVqoTeK2kiExBCaOvFt7b16nbQ5zG5rN02xQGBpNGuP58w5M7OB1hrrppTzCpJ8qStwQ6YNtFJQbfz3FnQCUrIgkIm9xIFcorRzCPqm/xdwbJc41CDAxb8BqmtZDlCST5XBtBQk21JMtoDqGvyvGDa9MsZACQGWZrBVBU29VLobzAN6RmvmWUgFLjnSIsV5HKHgDDyb3cRXc/y79OegCQpislpZKJJpOeqFRY0lxCxE9OKhn/4dlnQ28wtSYBFIKWHrGu6pSFbzo5PbZ31snW3h9fkbvI/eImM/Kfk2OymJCLUiH+xDJRPH0ODwYAdPHj9CGI5atk5upCIM+RAhDzHWZ2DLOYx2vbwq6NgynSDSE8TbTyHCIwIk9O1Xz/Hg/j3s730kMIk0SZCzHEVdoLAM5UIiSQaY9p6B5TmyLENOPklijIuv+JJ/QGZTvxUBYwzHn4+xu7OL4Shs5UotMdMzxCZGbDNM0wHivZeQVNAp8CoExyg7wadvPXzP+zdr40BjYlWWZTtB50/ZKTZ+bGBzvIne7B3yi4okmzurwrlo84KGkRvIKpigZhdVAbMw3uRcgqnsaih6dWWU72mT172HbjgEWsoShSj8kNxG3NpDvZarVddd7r4Jf4r/AubqdRStkiqLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"before infra structure\"\n        title=\"before infra structure\"\n        src=\"/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png\"\n        srcset=\"/static/ba69a59706c73c38650c763a313cd6e0/0eb09/before-infra-structure.png 500w,\n/static/ba69a59706c73c38650c763a313cd6e0/1263b/before-infra-structure.png 1000w,\n/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png 2000w,\n/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>배포 스크립트</strong>  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">PID</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>pgrep -f teatime<span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -n <span class=\"token variable\">$PID</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token function\">kill</span> -9 <span class=\"token variable\">$PID</span>\n\t<span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">nohup</span> java -jar -Dspring.profiles.active<span class=\"token operator\">=</span>dev teatime-0.0.1-SNAPSHOT.jar <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>stdout.txt <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span>err.txt <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>적용 전 인프라 구조와 배포 스크립트에 대해 간략하게 알아보자면 다음 순서로 동작합니다.</p>\n<ol>\n<li>젠킨스에서 WAS 서버로 jar 파일이 전송되고 배포 스크립트가 실행된다.</li>\n<li>배포 스크립트에 의해 현재 구동 중인 8080포트의 서버가 kill된다.</li>\n<li>새로운 jar파일로 8080포트에 새로운 서버를 띄운다.</li>\n</ol>\n<p>여기서 한가지 문제점이 발생합니다❗️<br>\n앞서 언급했듯이 기존 서버가 죽고 새로운 서버가 띄워지는 사이에 다운타임이 발생하는 것입니다.  </p>\n<p>다음으로 무중단 배포 적용 후의 인프라 구조와 배포 스크립트를 살펴 봅시다.</p>\n<h2>무중단 배포 후, 인프라 구조와 배포 스크립트</h2>\n<p><strong>인프라 구조</strong>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQ4y5VT22oUQRCd3/Qb/AH/wRdffRN8FyUQJC9JIEIQzItggllMzO7OZfuS6Z6+zezlWN2zk8y6CehDUU1X1elTVaczay3GZgxZPBsDRV45T97RvXmI/10ztuwpwOgbArgPHS7MBrlf9XG6M/Y/ACOLMaAIywRYhNVjfCfXPNQM532Go4LY7qLWkNuCgeHQ/j8y3M6q6QHYYgGtFGy32QGLvmmakfX52S71UbJp4L1HTWCN1hDfT2FqSfG4oKbPdRbOGvg1wC6OIM8/9AydcwhUPIA648ANx9ROUfgCM32H4vQdtKjgfEiAIQSssUJpf+O+42itgGE5skiXcY6iLBP1+GpwAcwwnOQnOLg9wFn5BeWGJBSZUU5VVahrhbC2+EY5P9hXOnv4doksvvj+7Wu8evkCs/kcUgpwxmkREqpTUG1vvLjEoirAGIMQnFqlrtYBN9U1btgEYUWA1GkmpMT58RGODz9iOp0lllrRZq2EDBFUU/sL5IdvoFgBF9rEMs63o9ldCWDWAKSwHlDTwH/d3uHq5wScizRPb/1uy8UZCltCaZWWFmva4Ej4wKfLJT5fL1HTOfitbELwaNuQwIalCBry3M2R2xylK0nkMgG6LWDw1PIGmFSGzKJdR4b2UTax1bFsEjAVxdbSQySPpM1RfCDSkcUH9n7KnhZ3hNs83A9eb+8j44FQ9tT3ee5rjcGe+3p/AJBNd4yxLfDJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"after infra structure\"\n        title=\"after infra structure\"\n        src=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png\"\n        srcset=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/0eb09/after-infra-structure.png 500w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/1263b/after-infra-structure.png 1000w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png 2000w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>배포 스크립트</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 현재 profile 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_current_profile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token assign-left variable\">RESPONSE_CODE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> -o /dev/null -w <span class=\"token string\">\"%{http_code}\"</span> http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:8080<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${RESPONSE_CODE}</span> <span class=\"token operator\">!=</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">]</span> <span class=\"token comment\"># 404가 아니면</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span>prod2\n    <span class=\"token keyword\">else</span>\n        <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span>prod1\n    <span class=\"token keyword\">fi</span>\n\n\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${CURRENT_PROFILE}</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 현재 port 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_current_port</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${CURRENT_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8080\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8081\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 쉬고 있는 profile 찾기: dev1이 사용중이면 dev2가 쉬고 있고, 반대면 dev1이 쉬고 있음</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_idle_profile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${CURRENT_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span>prod2\n    <span class=\"token keyword\">else</span>\n      <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span>prod1\n    <span class=\"token keyword\">fi</span>\n\t\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${IDLE_PROFILE}</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 쉬고 있는 profile의 port 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_idle_port</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${IDLE_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8080\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8081\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># idle profile로 jar 파일 실행</span>\n\n<span class=\"token assign-left variable\">REPOSITORY</span><span class=\"token operator\">=</span>/home/ubuntu/jar\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Build 파일 복사\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> cp <span class=\"token variable\">$REPOSITORY</span>/*.jar <span class=\"token variable\">$REPOSITORY</span>/\"</span>\n\n<span class=\"token function\">cp</span> <span class=\"token variable\">$REPOSITORY</span>/*.jar <span class=\"token variable\">$REPOSITORY</span>/\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 새 어플리케이션 배포\"</span>\n<span class=\"token assign-left variable\">JAR_NAME</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ls</span> -tr $REPOSITORY/*.jar <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n <span class=\"token number\">1</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> JAR Name: <span class=\"token variable\">$JAR_NAME</span>\"</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 에 실행권한 추가\"</span>\n\n<span class=\"token function\">chmod</span> +x <span class=\"token variable\">$JAR_NAME</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 실행\"</span>\n\n<span class=\"token assign-left variable\">CURRENT_PORT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_port<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_profile<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">IDLE_PORT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_port<span class=\"token variable\">)</span></span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 를 profile=<span class=\"token variable\">$IDLE_PROFILE</span> 로 실행합니다.\"</span>\n<span class=\"token function\">nohup</span> java -jar -Dspring.profiles.active<span class=\"token operator\">=</span><span class=\"token variable\">$IDLE_PROFILE</span> <span class=\"token variable\">$JAR_NAME</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>stdout.txt <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span>err.txt <span class=\"token operator\">&amp;</span>\n\n<span class=\"token comment\"># health check</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health Check Start!\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> IDLE_PORT: <span class=\"token variable\">$IDLE_PORT</span>\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> curl -s http://{WAS ip주소}:<span class=\"token variable\">$IDLE_PORT</span> \"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">RETRY_COUNT</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">do</span>\n  <span class=\"token assign-left variable\">RESPONSE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> -s http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:$<span class=\"token punctuation\">{</span>IDLE_PORT<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span>\n  <span class=\"token assign-left variable\">UP_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $<span class=\"token punctuation\">{</span>RESPONSE<span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"timestamp\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l<span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${UP_COUNT}</span> -ge <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span> <span class=\"token comment\"># $up_count >= 1 </span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 성공\"</span>\n\n      <span class=\"token comment\"># 기존 포트에서 idle port로 switch</span>\n\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 전환할 Port: <span class=\"token variable\">$IDLE_PORT</span>\"</span>\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Port 전환\"</span>\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"set \\<span class=\"token variable\">$service_url</span> http://{WAS ip주소}:<span class=\"token variable\">${IDLE_PORT}</span>;\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> -i key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix1 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/nginx/conf.d/service-prod-url.inc\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"set \\<span class=\"token variable\">$service_url</span> http://{WAS ip주소}:<span class=\"token variable\">${IDLE_PORT}</span>;\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> -i key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix2 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/nginx/conf.d/service-prod-url.inc\n\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 엔진엑스 Reload\"</span>\n\t\t\t<span class=\"token function\">ssh</span> -i key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix1 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx reload\n\t\t\t<span class=\"token function\">ssh</span> -i key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix2 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx reload\n      <span class=\"token builtin class-name\">break</span>\n\n  <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check의 응답을 알 수 없거나 혹은 실행 상태가 아닙니다.\"</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check: <span class=\"token variable\">${RESPONSE}</span>\"</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${RETRY_COUNT}</span> -eq <span class=\"token number\">10</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 실패. \"</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 엔진엑스에 연결하지 않고 배포를 종료합니다.\"</span>\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 연결 실패. 재시도...\"</span>\n  <span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n<span class=\"token keyword\">done</span>\n\n<span class=\"token comment\"># 기존 포트 stop</span>\n\n<span class=\"token assign-left variable\">CURRENT_PID</span><span class=\"token operator\">=</span><span class=\"token punctuation\">$(</span>lsof -ti tcp:<span class=\"token variable\">${CURRENT_PORT}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -z <span class=\"token variable\">${CURRENT_PID}</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 현재 구동중인 애플리케이션이 없으므로 종료하지 않습니다.\"</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> kill -15 <span class=\"token variable\">$CURRENT_PID</span>\"</span>\n  <span class=\"token function\">kill</span> -15 <span class=\"token variable\">${CURRENT_PID}</span>\n  <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>Blue/Green 무중단 배포 적용 후 변경된 인프라 구조와 배포 스크립트입니다.\n배포 스크립트가 약간 길어 보기 불편할 수 있어 간단하게 정리하면 다음과 같습니다.  </p>\n<p>현재 8080포트로 서버가 구동 중인 상황에서의 배포 동작 순서입니다.  </p>\n<ol>\n<li>idle port를 찾는다. 즉 8081포트에 새롭게 배포될 서버가 띄워져야 한다는 사실을 인지한다.    </li>\n<li>idle port(8081포트)로 jar 파일 실행한다.  </li>\n<li>health check를 통해 8081포트에 서버가 띄워 질 때까지 current port(8080포트)의 서버를 kill 하지 않는다.  </li>\n<li>8081포트에 서버가 잘 띄워졌으면 Nginx에서 가리키고 있는 WAS 포트를 current port(8080) -> idle port(8081)로 스위칭해준다.    </li>\n<li>current port(8080포트)를 kill한다.    </li>\n</ol>\n<h3>8081포트에 서버가 띄워진 후의 인프라 구조</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQ4y5VT224TMRDNn/ILfAGv/AHvqOKRJx4qtQqIVC1ECCmiVVUBiUKa28Z78fqy9m6yOYztNrsimwceRmN77DNnZo57Wmu0Talnr5DrAnlhvHf7dvyU9Y4AdQPI7BZDuff+AKj/A9A9agNuCOhW7xGTly1Af69trbNjwCdz+5TKW6cc3JUsBZ01j4/YFUVg+G+2wCKspRBIGENBgHqL0L9DLykupTe/5qlP2mszazMVSoArjlRwZMkKbPiBwOQhHlhZ8sS+AqL+W+Q/vwWGBdG1tmyYSoXMZBiLMSZqigm7x3r4HsVTvxyrsiw96zsGbApgaw1Uzh2gxmTyGz9uRxBCenBXItMM/Xkfl4+XuIpuwFDDekYBsCotHgXwblTiZrZHvUcYiqLHZ29e49XLF1iu1siyDJtog9zkKOsSO+wpCUd09xFpklBS4R9uqxKJ2WE0XWKSKOwIUVGiXkyXvn+5xtfBJyyWyyBonvuSF2qByMZYxL+wHpzROSWjIUVR5JmWtcEfOYaoUtT1LjB09JerCLP5ApxzarSmXhWIixgX8wucz87xeTUAqySMK5nirgrXltgkuJpe4549UMl1o0NjDA3FNFqkoXBDE7YpuA0+VTFNuZGUG4pryTqhNumMGNa+t906dLoiiTjpCNKW8896a2vQsbTGEnPT/VP0qV9wIt5Fptd1+eivdlTQldid/QXBa3fYgl+IFgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8081 infra structure\"\n        title=\"8081 infra structure\"\n        src=\"/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png\"\n        srcset=\"/static/d4af184cb317fd03bb58bd12d16e841c/0eb09/8081-infra-structure.png 500w,\n/static/d4af184cb317fd03bb58bd12d16e841c/1263b/8081-infra-structure.png 1000w,\n/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png 2000w,\n/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>위와 같은 flow로 Blue/Green 배포를 적용하여 결론적으로 평균 20초이상의 다운 타임을 0.2초로 줄였습니다.\n여기서 0.2초의 다운 타임이 존재하는 이유는 proxy switching을 하고 nginx를 reload하는 과정이 0.1초인데, 저희 프로젝트에선 nginx를 두 대 이용하기 때문에 0.2초의 다운타임이 발생했습니다.  </p>\n<h2>추후 고민해 볼 점</h2>\n<p>무중단 배포를 구현한 뒤 추가로 고민해보면 좋을 점들입니다.</p>\n<h3>1. Health check</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  <span class=\"token assign-left variable\">RESPONSE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> -s http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:$<span class=\"token punctuation\">{</span>IDLE_PORT<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span>\n  <span class=\"token assign-left variable\">UP_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $<span class=\"token punctuation\">{</span>RESPONSE<span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"timestamp\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l<span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${UP_COUNT}</span> -ge <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span> <span class=\"token comment\"># $up_count >= 1 </span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 성공\"</span>\n      <span class=\"token punctuation\">..</span>.\n  <span class=\"token keyword\">else</span>\n\t   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 실패\"</span>\n       <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>현재 Health check를 위와 같이 진행하고 있습니다.\n신버전이 배포된 포트의 {WAS ip주소}:{IDLE_PORT}로 요청을 보내 응답에 timestamp라는 문자열이 존재하면 새로운 서버가 띄워졌다고 판단하고 있습니다.  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1430px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAw0lEQVQoz+1QywqEMAzs/3+U4MmTN0G86MEXVXw/QFodSUDpLqsedo8bGGaSppO0wrIsmHBdF47jwPM82LbN+im2bTu1GIYBdV2jbVvGOI7MTdOgKArGPM+YponP+r5nppz6lFKnKUFkWYY4jpGmKUgTJ0mCsizPAV3XsRHlVKcFqCalxLIsr4ZhGCKKIhD7vo8gCFjnec6Xq6piPrZ9fPLVv6zrCq01s4ljExOmqfjUYE582ug9Lg3vcGcq8OP4G34fO0rLq14kmqi5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"white page\"\n        title=\"white page\"\n        src=\"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png\"\n        srcset=\"/static/81e55d859d7f6cecc079a217d1926005/0eb09/white-page.png 500w,\n/static/81e55d859d7f6cecc079a217d1926005/1263b/white-page.png 1000w,\n/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png 1430w\"\n        sizes=\"(max-width: 1430px) 100vw, 1430px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>위와 같이 ubuntu os로 띄워진 ec2 서버의 해당 포트가 띄워졌을 때, 보이는 화면에 너무 종속적인 health check가 될 수도 있다는 생각이 들었습니다.\n추후에 팀원들과 논의 끝에 더 좋은 방법으로 개선해야 될 것 같습니다.  </p>\n<h3>2. WAS 서버 증설</h3>\n<p>현재 무중단 배포를 통해 운영 서버의 다운 타임 문제는 해결 됐으나, WAS ec2 자체가 다운되면 서비스가 무한정 중단될 수 있는 상황입니다.\n이렇게 시스템 구성 요소 중에서 장애가 발생하면 전체 시스템이 다운되는 지점을 SPOF(single point of failure, 단일 장애 지점)이라고 합니다.\n따라서 WAS 서버를 한 대 더 증설하는 것이 안전하다고 판단됩니다.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포를 도입하게 된 계기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 20초 이상의 다운타임이 발생한다는 것이었습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"운영 서버는 사용자의 경험과 직결되는데, 배포할때마다 서버가 20초 이상 다운되는 것은 큰 문제라고 생각했습니다.\n기능이 점점 많아짐에 따라 다운타임도 비례해 증가할 것이라고 판단했고, 따라서 운영 서버의 다운타임을 개선하고자 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"무중단 배포"}]},{"type":"text","value":"를 프로젝트에 도입하기로 결정했습니다.   "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포란"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스가 운영 중일 때 새로운 버전을 배포하기 위해서는 1)기존 서비스를 종료하고 2)새로운 서비스를 시작해야 합니다.\n1번과 2번 사이의 과정에서 다운타임이 필연적으로 발생하며, 다운타임 동안 사용자들은 서비스를 이용할 수 없게 됩니다.\n이 다운타임을 해결해주는 방법이 바로 무중단 배포입니다.\n즉, 말그대로 중단이 없는 배포를 무중단 배포라고 합니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 구현 방식"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"무중단 배포를 구현하는 방식에는 여러가지가 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"AWS에서 Blue-Greem 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"도커를 이용한 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"L4, L7 스위치를 이용한 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nginx를 이용한 무중단 배포"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"대표적으로 위와 같은 방법들이 있는데 저희 프로젝트에서는 제일 마지막에 있는 Nginx를 이용한 무중단 배포 방식을 선택했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"무중단 배포 구현 방식으로 Nginx 방식을 선택한 이유"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx를 이용하여 무중단 배포를 구현하면 저희 프로젝트에서 다음 2가지 장점이 존재했습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nginx 서버를 이미 이용하고 있어 환경 구축을 따로 안해줘도 된다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"쉽고 저렴하다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같은 이유로 Nginx를 이용한 무중단 배포를 적용해 보기로 결정했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 전략"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"구현 방식을 정했으니 이제 배포 전략을 정해야 합니다.\n배포 전략에는 대표적으로 3가지가 존재합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Rolling 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Canary 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Blue/Green 배포"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"각 배포 전략에 대한 자세한 설명은 이 글에선 생략하겠습니다.\n위 세 가지 전략중 저희 프로젝트에서 선택한 전략은 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Blue/Green 배포"}]},{"type":"text","value":"이었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Blue/Green 배포를 선택한 이유"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우선 롤링 배포와 비교해 봤을 때, 좀 더 신속하게 롤백이 가능하다고 생각했습니다.\n또한 롤링 배포는 두 대 이상의 WAS 서버를 이용해 로드 벨런싱을 이용했을 때 큰 이점이 있다고 판단했는데, 저희는 추가 서버 증설에 제약이 있는 상황이었습니다.\n마지막으로 롤링 배포에서는 구버전과 신버전의 공존으로 인한 호환성 문제도 발생할 수 있다는 단점도 존재했습니다.    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"카나리 배포와 비교해 봤을 때는 카나리 방식의 최대 이점인 A/B 테스트가 현재 서비스에선 필요가 없었기 때문에 선택하지 않습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Blue/Green 배포 전략을 취함으로써 신속하게 롤백이 가능하다는 점과 배포하는 속도가 다른 배포법들에 비해 빠르다는 이점을 얻을 수 있었습니다.    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Blue/Green 배포 적용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우선 무중단 배포 적용 전의 인프라 구조와 배포 스크립트를 살펴 봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"무중단 배포 전, 인프라 구조와 배포 스크립트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"인프라 구조"}]},{"type":"text","value":"  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQ4y6VT227TQBD1R/ITfAUvSHwAEo9IvPDCC0XqQyWowkVqoTeK2kiExBCaOvFt7b16nbQ5zG5rN02xQGBpNGuP58w5M7OB1hrrppTzCpJ8qStwQ6YNtFJQbfz3FnQCUrIgkIm9xIFcorRzCPqm/xdwbJc41CDAxb8BqmtZDlCST5XBtBQk21JMtoDqGvyvGDa9MsZACQGWZrBVBU29VLobzAN6RmvmWUgFLjnSIsV5HKHgDDyb3cRXc/y79OegCQpislpZKJJpOeqFRY0lxCxE9OKhn/4dlnQ28wtSYBFIKWHrGu6pSFbzo5PbZ31snW3h9fkbvI/eImM/Kfk2OymJCLUiH+xDJRPH0ODwYAdPHj9CGI5atk5upCIM+RAhDzHWZ2DLOYx2vbwq6NgynSDSE8TbTyHCIwIk9O1Xz/Hg/j3s730kMIk0SZCzHEVdoLAM5UIiSQaY9p6B5TmyLENOPklijIuv+JJ/QGZTvxUBYwzHn4+xu7OL4Shs5UotMdMzxCZGbDNM0wHivZeQVNAp8CoExyg7wadvPXzP+zdr40BjYlWWZTtB50/ZKTZ+bGBzvIne7B3yi4okmzurwrlo84KGkRvIKpigZhdVAbMw3uRcgqnsaih6dWWU72mT172HbjgEWsoShSj8kNxG3NpDvZarVddd7r4Jf4r/AubqdRStkiqLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"before infra structure","title":"before infra structure","src":"/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png","srcSet":["/static/ba69a59706c73c38650c763a313cd6e0/0eb09/before-infra-structure.png 500w","/static/ba69a59706c73c38650c763a313cd6e0/1263b/before-infra-structure.png 1000w","/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png 2000w","/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png 2560w"],"sizes":["(max-width:","2000px)","100vw,","2000px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"배포 스크립트"}]},{"type":"text","value":"  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"PID"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"pgrep -f teatime"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" -n "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$PID"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" -9 "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$PID"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nohup"}]},{"type":"text","value":" java -jar -Dspring.profiles.active"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"dev teatime-0.0.1-SNAPSHOT.jar "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":">"}]},{"type":"text","value":"stdout.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":">"}]},{"type":"text","value":"err.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"&"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"적용 전 인프라 구조와 배포 스크립트에 대해 간략하게 알아보자면 다음 순서로 동작합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"젠킨스에서 WAS 서버로 jar 파일이 전송되고 배포 스크립트가 실행된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"배포 스크립트에 의해 현재 구동 중인 8080포트의 서버가 kill된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"새로운 jar파일로 8080포트에 새로운 서버를 띄운다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기서 한가지 문제점이 발생합니다❗️"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n앞서 언급했듯이 기존 서버가 죽고 새로운 서버가 띄워지는 사이에 다운타임이 발생하는 것입니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음으로 무중단 배포 적용 후의 인프라 구조와 배포 스크립트를 살펴 봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 후, 인프라 구조와 배포 스크립트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"인프라 구조"}]},{"type":"text","value":"  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQ4y5VT22oUQRCd3/Qb/AH/wRdffRN8FyUQJC9JIEIQzItggllMzO7OZfuS6Z6+zezlWN2zk8y6CehDUU1X1elTVaczay3GZgxZPBsDRV45T97RvXmI/10ztuwpwOgbArgPHS7MBrlf9XG6M/Y/ACOLMaAIywRYhNVjfCfXPNQM532Go4LY7qLWkNuCgeHQ/j8y3M6q6QHYYgGtFGy32QGLvmmakfX52S71UbJp4L1HTWCN1hDfT2FqSfG4oKbPdRbOGvg1wC6OIM8/9AydcwhUPIA648ANx9ROUfgCM32H4vQdtKjgfEiAIQSssUJpf+O+42itgGE5skiXcY6iLBP1+GpwAcwwnOQnOLg9wFn5BeWGJBSZUU5VVahrhbC2+EY5P9hXOnv4doksvvj+7Wu8evkCs/kcUgpwxmkREqpTUG1vvLjEoirAGIMQnFqlrtYBN9U1btgEYUWA1GkmpMT58RGODz9iOp0lllrRZq2EDBFUU/sL5IdvoFgBF9rEMs63o9ldCWDWAKSwHlDTwH/d3uHq5wScizRPb/1uy8UZCltCaZWWFmva4Ej4wKfLJT5fL1HTOfitbELwaNuQwIalCBry3M2R2xylK0nkMgG6LWDw1PIGmFSGzKJdR4b2UTax1bFsEjAVxdbSQySPpM1RfCDSkcUH9n7KnhZ3hNs83A9eb+8j44FQ9tT3ee5rjcGe+3p/AJBNd4yxLfDJAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"after infra structure","title":"after infra structure","src":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png","srcSet":["/static/2f584bd5b14ca2a9732f1798c9d9e0e2/0eb09/after-infra-structure.png 500w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/1263b/after-infra-structure.png 1000w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png 2000w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png 2560w"],"sizes":["(max-width:","2000px)","100vw,","2000px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"배포 스크립트"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 현재 profile 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_current_profile"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE_CODE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" -o /dev/null -w "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"%{http_code}\""}]},{"type":"text","value":" http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":8080"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RESPONSE_CODE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"404"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 404가 아니면"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod2\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod1\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 현재 port 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_current_port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8080\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8081\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 쉬고 있는 profile 찾기: dev1이 사용중이면 dev2가 쉬고 있고, 반대면 dev1이 쉬고 있음"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_idle_profile"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod2\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod1\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\t\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PROFILE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 쉬고 있는 profile의 port 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_idle_port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8080\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8081\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# idle profile로 jar 파일 실행"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"REPOSITORY"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"/home/ubuntu/jar\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Build 파일 복사\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> cp "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"cp"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 새 어플리케이션 배포\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"JAR_NAME"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ls"}]},{"type":"text","value":" -tr $REPOSITORY/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tail"}]},{"type":"text","value":" -n "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> JAR Name: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 에 실행권한 추가\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"chmod"}]},{"type":"text","value":" +x "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 실행\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_port"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_port"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 를 profile="},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PROFILE"}]},{"type":"text","value":" 로 실행합니다.\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nohup"}]},{"type":"text","value":" java -jar -Dspring.profiles.active"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PROFILE"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":">"}]},{"type":"text","value":"stdout.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":">"}]},{"type":"text","value":"err.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"&"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# health check"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health Check Start!\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> IDLE_PORT: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> curl -s http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":" \""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","for-or-select","variable"]},"children":[{"type":"text","value":"RETRY_COUNT"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"do"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" -s http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":$"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"IDLE_PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"UP_COUNT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"RESPONSE"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"grep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"timestamp\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wc"}]},{"type":"text","value":" -l"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${UP_COUNT}"}]},{"type":"text","value":" -ge "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# $up_count >= 1 "}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 성공\""}]},{"type":"text","value":"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 기존 포트에서 idle port로 switch"}]},{"type":"text","value":"\n\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 전환할 Port: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Port 전환\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"set \\"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$service_url"}]},{"type":"text","value":" http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PORT}"}]},{"type":"text","value":";\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" -i key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix1 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tee"}]},{"type":"text","value":" /etc/nginx/conf.d/service-prod-url.inc\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"set \\"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$service_url"}]},{"type":"text","value":" http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PORT}"}]},{"type":"text","value":";\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" -i key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix2 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tee"}]},{"type":"text","value":" /etc/nginx/conf.d/service-prod-url.inc\n\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 엔진엑스 Reload\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" -i key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix1 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" nginx reload\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" -i key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix2 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" nginx reload\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"break"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check의 응답을 알 수 없거나 혹은 실행 상태가 아닙니다.\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RESPONSE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RETRY_COUNT}"}]},{"type":"text","value":" -eq "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 실패. \""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 엔진엑스에 연결하지 않고 배포를 종료합니다.\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"exit"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 연결 실패. 재시도...\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 기존 포트 stop"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PID"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"lsof -ti tcp:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PORT}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" -z "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PID}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 현재 구동중인 애플리케이션이 없으므로 종료하지 않습니다.\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> kill -15 "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$CURRENT_PID"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" -15 "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PID}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Blue/Green 무중단 배포 적용 후 변경된 인프라 구조와 배포 스크립트입니다.\n배포 스크립트가 약간 길어 보기 불편할 수 있어 간단하게 정리하면 다음과 같습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 8080포트로 서버가 구동 중인 상황에서의 배포 동작 순서입니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"idle port를 찾는다. 즉 8081포트에 새롭게 배포될 서버가 띄워져야 한다는 사실을 인지한다.    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"idle port(8081포트)로 jar 파일 실행한다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"health check를 통해 8081포트에 서버가 띄워 질 때까지 current port(8080포트)의 서버를 kill 하지 않는다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"8081포트에 서버가 잘 띄워졌으면 Nginx에서 가리키고 있는 WAS 포트를 current port(8080) -> idle port(8081)로 스위칭해준다.    "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"current port(8080포트)를 kill한다.    "}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"8081포트에 서버가 띄워진 후의 인프라 구조"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQ4y5VT224TMRDNn/ILfAGv/AHvqOKRJx4qtQqIVC1ECCmiVVUBiUKa28Z78fqy9m6yOYztNrsimwceRmN77DNnZo57Wmu0Talnr5DrAnlhvHf7dvyU9Y4AdQPI7BZDuff+AKj/A9A9agNuCOhW7xGTly1Af69trbNjwCdz+5TKW6cc3JUsBZ01j4/YFUVg+G+2wCKspRBIGENBgHqL0L9DLykupTe/5qlP2mszazMVSoArjlRwZMkKbPiBwOQhHlhZ8sS+AqL+W+Q/vwWGBdG1tmyYSoXMZBiLMSZqigm7x3r4HsVTvxyrsiw96zsGbApgaw1Uzh2gxmTyGz9uRxBCenBXItMM/Xkfl4+XuIpuwFDDekYBsCotHgXwblTiZrZHvUcYiqLHZ29e49XLF1iu1siyDJtog9zkKOsSO+wpCUd09xFpklBS4R9uqxKJ2WE0XWKSKOwIUVGiXkyXvn+5xtfBJyyWyyBonvuSF2qByMZYxL+wHpzROSWjIUVR5JmWtcEfOYaoUtT1LjB09JerCLP5ApxzarSmXhWIixgX8wucz87xeTUAqySMK5nirgrXltgkuJpe4549UMl1o0NjDA3FNFqkoXBDE7YpuA0+VTFNuZGUG4pryTqhNumMGNa+t906dLoiiTjpCNKW8896a2vQsbTGEnPT/VP0qV9wIt5Fptd1+eivdlTQldid/QXBa3fYgl+IFgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"8081 infra structure","title":"8081 infra structure","src":"/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png","srcSet":["/static/d4af184cb317fd03bb58bd12d16e841c/0eb09/8081-infra-structure.png 500w","/static/d4af184cb317fd03bb58bd12d16e841c/1263b/8081-infra-structure.png 1000w","/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png 2000w","/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png 2560w"],"sizes":["(max-width:","2000px)","100vw,","2000px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같은 flow로 Blue/Green 배포를 적용하여 결론적으로 평균 20초이상의 다운 타임을 0.2초로 줄였습니다.\n여기서 0.2초의 다운 타임이 존재하는 이유는 proxy switching을 하고 nginx를 reload하는 과정이 0.1초인데, 저희 프로젝트에선 nginx를 두 대 이용하기 때문에 0.2초의 다운타임이 발생했습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"추후 고민해 볼 점"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"무중단 배포를 구현한 뒤 추가로 고민해보면 좋을 점들입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"1. Health check"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" -s http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":$"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"IDLE_PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"UP_COUNT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"RESPONSE"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"grep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"timestamp\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wc"}]},{"type":"text","value":" -l"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${UP_COUNT}"}]},{"type":"text","value":" -ge "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# $up_count >= 1 "}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 성공\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n\t   "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 실패\""}]},{"type":"text","value":"\n       "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":"."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 Health check를 위와 같이 진행하고 있습니다.\n신버전이 배포된 포트의 {WAS ip주소}:{IDLE_PORT}로 요청을 보내 응답에 timestamp라는 문자열이 존재하면 새로운 서버가 띄워졌다고 판단하고 있습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1430px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 58.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAw0lEQVQoz+1QywqEMAzs/3+U4MmTN0G86MEXVXw/QFodSUDpLqsedo8bGGaSppO0wrIsmHBdF47jwPM82LbN+im2bTu1GIYBdV2jbVvGOI7MTdOgKArGPM+YponP+r5nppz6lFKnKUFkWYY4jpGmKUgTJ0mCsizPAV3XsRHlVKcFqCalxLIsr4ZhGCKKIhD7vo8gCFjnec6Xq6piPrZ9fPLVv6zrCq01s4ljExOmqfjUYE582ug9Lg3vcGcq8OP4G34fO0rLq14kmqi5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"white page","title":"white page","src":"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png","srcSet":["/static/81e55d859d7f6cecc079a217d1926005/0eb09/white-page.png 500w","/static/81e55d859d7f6cecc079a217d1926005/1263b/white-page.png 1000w","/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png 1430w"],"sizes":["(max-width:","1430px)","100vw,","1430px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같이 ubuntu os로 띄워진 ec2 서버의 해당 포트가 띄워졌을 때, 보이는 화면에 너무 종속적인 health check가 될 수도 있다는 생각이 들었습니다.\n추후에 팀원들과 논의 끝에 더 좋은 방법으로 개선해야 될 것 같습니다.  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"2. WAS 서버 증설"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 무중단 배포를 통해 운영 서버의 다운 타임 문제는 해결 됐으나, WAS ec2 자체가 다운되면 서비스가 무한정 중단될 수 있는 상황입니다.\n이렇게 시스템 구성 요소 중에서 장애가 발생하면 전체 시스템이 다운되는 지점을 SPOF(single point of failure, 단일 장애 지점)이라고 합니다.\n따라서 WAS 서버를 한 대 더 증설하는 것이 안전하다고 판단됩니다."}]}],"data":{"quirksMode":false}},"excerpt":"무중단 배포를 도입하게 된 계기 프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다. \n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 2…","timeToRead":6,"frontmatter":{"title":"무중단 배포","userDate":"1 November 2022","date":"2022-11-01T12:00:00.000Z","tags":["무중단배포"],"excerpt":null,"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQ4y5VT22oUQRCd3/Qb/AH/wRdffRN8FyUQJC9JIEIQzItggllMzO7OZfuS6Z6+zezlWN2zk8y6CehDUU1X1elTVaczay3GZgxZPBsDRV45T97RvXmI/10ztuwpwOgbArgPHS7MBrlf9XG6M/Y/ACOLMaAIywRYhNVjfCfXPNQM532Go4LY7qLWkNuCgeHQ/j8y3M6q6QHYYgGtFGy32QGLvmmakfX52S71UbJp4L1HTWCN1hDfT2FqSfG4oKbPdRbOGvg1wC6OIM8/9AydcwhUPIA648ANx9ROUfgCM32H4vQdtKjgfEiAIQSssUJpf+O+42itgGE5skiXcY6iLBP1+GpwAcwwnOQnOLg9wFn5BeWGJBSZUU5VVahrhbC2+EY5P9hXOnv4doksvvj+7Wu8evkCs/kcUgpwxmkREqpTUG1vvLjEoirAGIMQnFqlrtYBN9U1btgEYUWA1GkmpMT58RGODz9iOp0lllrRZq2EDBFUU/sL5IdvoFgBF9rEMs63o9ldCWDWAKSwHlDTwH/d3uHq5wScizRPb/1uy8UZCltCaZWWFmva4Ej4wKfLJT5fL1HTOfitbELwaNuQwIalCBry3M2R2xylK0nkMgG6LWDw1PIGmFSGzKJdR4b2UTax1bFsEjAVxdbSQySPpM1RfCDSkcUH9n7KnhZ3hNs83A9eb+8j44FQ9tT3ee5rjcGe+3p/AJBNd4yxLfDJAAAAAElFTkSuQmCC","aspectRatio":1.332378223495702,"src":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/a76e0/after-infra-structure.png","srcSet":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/3a443/after-infra-structure.png 930w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/4d929/after-infra-structure.png 1860w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/a76e0/after-infra-structure.png 2560w","sizes":"(max-width: 2560px) 100vw, 2560px"}}},"author":[{"id":"4기_잉","bio":"우아한테크코스 4기 잉(유영우)입니다 :)","avatar":{"children":[{"__typename":"ImageSharp","fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAgHBQn/xAAYAQACAwAAAAAAAAAAAAAAAAACBQMEBv/aAAwDAQACEAMQAAAB7ekRXQ+cbX0wkJ+N9DiqDQQ0v//EABkQAAMBAQEAAAAAAAAAAAAAAAMEBQIGAf/aAAgBAQABBQK1XQk45Dp4t4AHs+j6mmvTjQm1MRl6g9C545TAhiwqoSs8Pf8A/8QAIxEAAgIBAwMFAAAAAAAAAAAAAQIDBBEAEiEFFFEVIzFB8P/aAAgBAwEBPwGt02xWq2+7kSG3SmjD0so822RkTe5jkKoqFlBHLbjtZVyM5Pg66gT6rcP2b1jJ8++3zpScDn9xr//EACQRAAIBAwIGAwAAAAAAAAAAAAECEQMEIQASBRMiQVJxkdHw/9oACAECAQE/AavELa4q0BbHnUq6sBcCVpgqpcIFZQzFgGM4G0SN2YgeX741b9ItgMCbYQMCNq49aIEnHf61/8QAKBAAAgIBBAECBgMAAAAAAAAAAQIDBBEABRIhEyMxBhQiMjNBQmFx/9oACAEBAAY/Am3DcrC1qkA9SVgzYaV4441AUFizuQAAP9wM6NjabsdpYJPHOmHjnryfpZoJQsicsEo2ODgZRj3od41uCvRO7VMxRy+D8cZRknM8f85XrAB8JjBI7OCuvh/fq6V4K2+UzHWgjWNLgh2pvlAbIjqwZVOo43d53JB5PyzpTk6vFpG9G1DAgB+nx2GAfKnIJH3Kf03vnrQEOR45rUQ7PtBZQKeOeCs3lbnwVQcDoaKJNhV9uv61/8QAHRABAQACAgMBAAAAAAAAAAAAAREAITFhQVFxgf/aAAgBAQABPyEIvAY5EHosVQIEGS+isZ5A1ASEj8H4esI7XaX5FY3rkLguQKloWbtpuiSofT8OsP0rsQpZjheSYAYquXupIBReow18kgDoa725/9oADAMBAAIAAwAAABDMP0L/xAAgEQEAAQMDBQAAAAAAAAAAAAABABEhMUFRYXGBkbHw/9oACAEDAQE/EHm4g7UwpnTJFYEBb1HPTjj3uRCFaiKu5N3vMzYNX7l8s//EAB8RAQABBAIDAQAAAAAAAAAAAAERACExQVFxgZGh0f/aAAgBAgEBPxBPDjQNEjgZ0gKMrIztTZosx35ivl9kNhBYtoi7y0iYPQ5/b7r/xAAcEAEBAAMAAwEAAAAAAAAAAAABEQAhMUFRcdH/2gAIAQEAAT8QfVfGQfdEtsRspckgCtudJU1gYOELrYUwtlV18xt+FA9j/wAzrDw9qxERdNgoTeCCzakR4RSd9/rujfEUzD7ixLK96Ef9WgrOdQWY6ik8oToVr8PGf//Z","aspectRatio":1,"src":"/static/321f2fb3f306933bfd7ee26a44327f82/2f1b1/ing.jpg","srcSet":"/static/321f2fb3f306933bfd7ee26a44327f82/b3d27/ing.jpg 40w,\n/static/321f2fb3f306933bfd7ee26a44327f82/5a735/ing.jpg 80w,\n/static/321f2fb3f306933bfd7ee26a44327f82/6e81a/ing.jpg 120w,\n/static/321f2fb3f306933bfd7ee26a44327f82/2f1b1/ing.jpg 800w,\n/static/321f2fb3f306933bfd7ee26a44327f82/7403c/ing.jpg 2316w","sizes":"(max-width: 800px) 100vw, 800px"}}]}}],"source":null}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"id":"79146ac1-cd88-5fca-a901-eb79ca4d373d","timeToRead":6,"excerpt":"무중단 배포를 도입하게 된 계기 프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다. \n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 2…","frontmatter":{"title":"무중단 배포","date":"2022-11-01T12:00:00.000Z"},"fields":{"slug":"/post/2022-11-01-blue-green-deployment/"}}}]}},"pageContext":{"slug":"/post/2022-11-01-blue-green-deployment/","prev":{"excerpt":"들어가며 코드를 수정하면, 검토 요청(PR…","timeToRead":6,"frontmatter":{"title":"테스트코드 성능 개선기","tags":["Test","Spring Boot"],"date":"2022-10-27T13:10:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":2.743362831858407,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUH/8QAFgEBAQEAAAAAAAAAAAAAAAAABAYH/9oADAMBAAIQAxAAAAHLYBIYnZDAf//EABgQAQADAQAAAAAAAAAAAAAAAAQDBQYC/9oACAEBAAEFApU5roUS62Swv2ZpLf/EACERAAIBAwMFAAAAAAAAAAAAAAEDAgQFEwAREhQhIlFh/9oACAEDAQE/Aa+7Tu7szKK3UW8VrwW2l6OnGJCqXIEwmY5WRpwxszvkexrSOUhxAxALj3jDxHICUth7kQST9Ov/xAAgEQACAgIABwAAAAAAAAAAAAACAwEEEiEAERMVIkFR/9oACAECAQE/AaNftqhUD7FqFsJ+d5kWmHJtN+DDMYklgTJWsdYpEVc8Y26wVtp2TBSycXUIELhSRmfS1j4gPwY1HH//xAAfEAADAQADAAIDAAAAAAAAAAABAgMEERITBSEAFCL/2gAIAQEABj8CyxhGctS5XbXe2fXVjrlJHnKXXQs+Ntw+dnZDOCN6EfQ4w6d2YPlRsv7ufFBYhpR6SpPyNUSlaRn60oKS9rUbsV+2/Ep8J8ffLkGdFebyXMToFKl3E13bRwUMh29uSVP8Djk//8QAGBABAQADAAAAAAAAAAAAAAAAAQARMXH/2gAIAQEAAT8hBEFtOR3bHjDOtIGbQVBUlWFWnsQBVqABET//2gAMAwEAAgADAAAAEIfP/8QAFxEBAQEBAAAAAAAAAAAAAAAAASEAQf/aAAgBAwEBPxAoALEvnYm7ePw4gCtoC03UVau//8QAGBEBAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQIBAT8QUfkCKpEaJEk5jG7Qiqtg5w9Ge7//xAAWEAEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQEAAT8QtWGgSeQW8865+9A7YJUHriW0Jq9DHsa/BH//2Q==","sizes":"(max-width: 1918px) 100vw, 1918px","src":"/static/6d609ab1d3bd75c286e135674c2d0001/e1744/testing-server.jpg","srcSet":"/static/6d609ab1d3bd75c286e135674c2d0001/0079a/testing-server.jpg 930w,\n/static/6d609ab1d3bd75c286e135674c2d0001/8dba1/testing-server.jpg 1860w,\n/static/6d609ab1d3bd75c286e135674c2d0001/e1744/testing-server.jpg 1918w"}}},"author":[{"id":"4기_수달","bio":"우아한테크코스 4기 수달(허수진)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1.3333333333333333,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAcIBQb/xAAWAQEBAQAAAAAAAAAAAAAAAAAGBAX/2gAMAwEAAhADEAAAAeuS7YkQulq01yjM/8QAGhABAQEAAwEAAAAAAAAAAAAABQMEAQIGFP/aAAgBAQABBQIWCOw3eTfoHzQBCX1sknOlL4/H5kiKw//EACARAAIBAwQDAAAAAAAAAAAAAAECAwQREgAFEyEiMXH/2gAIAQMBAT8B3rd6ehqBRS1UrOkasQSUXI8QiJsSDeMHFSwYJ6OOWitHMeVd2QLJ5qHhqWYBuwGYMbkDq9z9Ov/EAB0RAAMAAgMBAQAAAAAAAAAAAAECAwQRBSExACL/2gAIAQIBAT8B4DhbZuPfLGFBZ3Yzg4CNRQBU3OyobqpBLLvdO/QNjG5KAEW4mrtP8F0vihGK+soJUhWPYBUaB1off//EACMQAAICAQQBBQEAAAAAAAAAAAIDAQQFERITIRQABiMxQiL/2gAIAQEABj8CGyDUin27Qdl66zm5Ir4gNxrTChmZcUr/AF8eumhesL7uzeaVmPPu429mavO5oX6ecmDRXoIjRPPUkp+JQhvWlkan2M1vGxdKfCT4bBFBbUlDm2FJgnRvPZUs1u+4jXZ+JiLi8bcjnt1HIGw0EvZDTApARG0k0qQBdxECRaa/fXr2Zhq1mH2cBlX27jJKUjssWPifWAiYvdV5TgY3AfH9d/z6V50WpeAAuWLa6OaBGNHGIyAiw9Zk4jWNe40ido//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPyF9GclII/ka0n3Jqi+e86qponAIFj3DZYhKtFHA82l5VzhgMHSjdG16a67Q1gAMYkB0pVoZwf1gNf/aAAwDAQACAAMAAAAQF9//xAAWEQEBAQAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QsAcVklNSpBoAocikOBjYEby4K//EABYRAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAgEBPxBMvchjQkAB3NIQVBEwFUCk0JQ//8QAFxABAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAQABPxBrToxJroHRPANwwLOqz1/tRzQMDqRUsGi+anMgpbPf9Eq+iyU+Sa1HEac8Eo5rMJkTDuB//9k=","sizes":"(max-width: 800px) 100vw, 800px","src":"/static/797f4d4bfca1c3af6567b42e32555753/2f1b1/sudal.jpg","srcSet":"/static/797f4d4bfca1c3af6567b42e32555753/fd013/sudal.jpg 200w,\n/static/797f4d4bfca1c3af6567b42e32555753/25252/sudal.jpg 400w,\n/static/797f4d4bfca1c3af6567b42e32555753/2f1b1/sudal.jpg 800w,\n/static/797f4d4bfca1c3af6567b42e32555753/0ff54/sudal.jpg 1200w,\n/static/797f4d4bfca1c3af6567b42e32555753/06655/sudal.jpg 1600w,\n/static/797f4d4bfca1c3af6567b42e32555753/ada83/sudal.jpg 2880w"}}]}}]},"fields":{"layout":"post","slug":"/post/2022-10-15-test-code-optimization/"}},"next":{"excerpt":"Transaction Isolation Level 애플리케이션을 개발 중 데이터베이스를 도입하면 격리 수준에 대한 이해가 자연스럽게 요구됩니다. 격리 수준은 데이터베이스의 ACID 성질 중 Isolation…","timeToRead":11,"frontmatter":{"title":"트랜잭션 격리 수준","tags":["Transaction","Isolation-Level"],"date":"2022-11-07T13:10:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.9334719334719335,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5UlEQVQoz5WSTW9SURCG76/wN7jxH/gHjIkLdWWiiYvGdKNrFxp3ujR+RS0Nih8tmrRoqzaljVQLFmKhVJQWqFQLQvko9MLlQnvPfTwcbtEmLuokJ/Nm5p33zGRG4wBm2zZCvq6tlWoE0znmUzl80RSVRkvF9/IaBzTbKdixLD6sbii83WrjDSfZFaLP0f5HzBI9H/n+C93sKPw5W2Ahk1d41xJoXXXRL5DYKdoT6XpbWNJbMm+pWCC5jisQk7EuX+CNJCnrxv6RLadt9ZODu2T7704dn60LXsZylI0er26YPAkl+JavoD0NfeVnVVeJ6USWT077/Q+EifljFnNtks7mIp2ifGkv5P2YpWU61RVFc3+ME0pvoB26dIdrvqAKHrniZuDRFIvrRdmOIF5oEQ970SdO0Fx9QacQpvL6pBSOoS8PURk7RiN+X9W2O23y+g7amQcTXB2fZ8A9pfzFZzOcHXqjSDf9UR7PReRMUiA5Qm1mkOq7c1itMsbKCOXx4zRit51J5JL0LNrDwJLa2qBnmlRxC08wwag8BdfcEqfuTTL6fhYyHmoL1zGSz2l+cbHlv0Bp9KjEwzSit9AjNzDSYxiZV/8+m/PDbzl82cXpuz42t5tqHcLezxHtuuq0dwl/FvobiV/eMJXRQZ8AAAAASUVORK5CYII=","sizes":"(max-width: 2000px) 100vw, 2000px","src":"/static/64c8b860c2aa4433524a1d980618bc06/3ba25/mysql_isolation.png","srcSet":"/static/64c8b860c2aa4433524a1d980618bc06/3a443/mysql_isolation.png 930w,\n/static/64c8b860c2aa4433524a1d980618bc06/4d929/mysql_isolation.png 1860w,\n/static/64c8b860c2aa4433524a1d980618bc06/3ba25/mysql_isolation.png 2000w"}}},"author":[{"id":"4기_쿼리치","bio":"우아한테크코스 4기 쿼리치(정석윤)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAQFBgn/xAAXAQEBAQEAAAAAAAAAAAAAAAAABAID/9oADAMBAAIQAxAAAAHgJXVm7uunCHYAH//EABoQAAMAAwEAAAAAAAAAAAAAAAEDBAIFECD/2gAIAQEAAQUCAJLJ3J5BRjJbsNnlSrx//8QAHREBAQACAQUAAAAAAAAAAAAAAQIDERIEECEiUf/aAAgBAwEBPwGVc9Rcs4jp25yGnnn5kmLjs0B7VXx8Cmnv/8QAHREAAgICAwEAAAAAAAAAAAAAAQMCEQQSFCAhIv/aAAgBAgEBPwFCcSeJlNdklb168dEY7FpsA3ZFR+vTdxEZHWXg6f/EACYQAAIBAwIEBwAAAAAAAAAAAAECEQMEIQASEyIxURAgIzIzQVL/2gAIAQEABj8CAAknAA+ydHfTYBW2FoOzdnl3e2eU464PbwtLp04i21xRrlP1wnDxnGY0aCQtGrdveugJ+U71piOnppUeInLnt5f/xAAdEAEBAAEEAwAAAAAAAAAAAAABETEAECFRIEFx/9oACAEBAAE/IUTIAKogAZVYHt0xd3FnFNd10uW3P1kQn68HPGsHrLJIwEoYIaeP/9oADAMBAAIAAwAAABD0AAD/xAAXEQEBAQEAAAAAAAAAAAAAAAARASAh/9oACAEDAQE/EHkWf0RqXWvbAT//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QjGsClUhsUYERTf/EABkQAQEAAwEAAAAAAAAAAAAAAAERACExIP/aAAgBAQABPxB0H6DA8UYAVABXLDxF7ghNHHQuscR8a6iwodG1rjBo4Ca9YTjeYOaHx//Z","sizes":"(max-width: 460px) 100vw, 460px","src":"/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/f86e8/quaritch.jpg","srcSet":"/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/fd013/quaritch.jpg 200w,\n/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/25252/quaritch.jpg 400w,\n/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/f86e8/quaritch.jpg 460w"}}]}}]},"fields":{"layout":"post","slug":"/post/2022-11-07-mysql-isolation/"}},"primaryTag":"무중단배포"}},"staticQueryHashes":["2130001345","4041952199"]}