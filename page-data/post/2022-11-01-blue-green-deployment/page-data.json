{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2022-11-01-blue-green-deployment/","result":{"data":{"logo":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/a9770/tecoble.png 400w","sizes":"400px"},"sources":[{"srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/65935/tecoble.webp 400w","type":"image/webp","sizes":"400px"}]},"width":500,"height":110}}},"markdownRemark":{"html":"<h2>무중단 배포를 도입하게 된 계기</h2>\n<p>프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 20초 이상의 다운타임이 발생한다는 것이었습니다.</p>\n<p>운영 서버는 사용자의 경험과 직결되는데, 배포할때마다 서버가 20초 이상 다운되는 것은 큰 문제라고 생각했습니다.\n기능이 점점 많아짐에 따라 다운타임도 비례해 증가할 것이라고 판단했고, 따라서 운영 서버의 다운타임을 개선하고자 <strong>무중단 배포</strong>를 프로젝트에 도입하기로 결정했습니다.</p>\n<h2>무중단 배포란</h2>\n<p>서비스가 운영 중일 때 새로운 버전을 배포하기 위해서는 1)기존 서비스를 종료하고 2)새로운 서비스를 시작해야 합니다.\n1번과 2번 사이의 과정에서 다운타임이 필연적으로 발생하며, 다운타임 동안 사용자들은 서비스를 이용할 수 없게 됩니다.\n이 다운타임을 해결해주는 방법이 바로 무중단 배포입니다.\n즉, 말그대로 중단이 없는 배포를 무중단 배포라고 합니다.</p>\n<h2>무중단 배포 구현 방식</h2>\n<p>무중단 배포를 구현하는 방식에는 여러가지가 있습니다.</p>\n<ul>\n<li>AWS에서 Blue-Greem 무중단 배포</li>\n<li>도커를 이용한 무중단 배포</li>\n<li>L4, L7 스위치를 이용한 무중단 배포</li>\n<li>Nginx를 이용한 무중단 배포</li>\n</ul>\n<p>대표적으로 위와 같은 방법들이 있는데 저희 프로젝트에서는 제일 마지막에 있는 Nginx를 이용한 무중단 배포 방식을 선택했습니다.</p>\n<h3>무중단 배포 구현 방식으로 Nginx 방식을 선택한 이유</h3>\n<p>Nginx를 이용하여 무중단 배포를 구현하면 저희 프로젝트에서 다음 2가지 장점이 존재했습니다.</p>\n<ol>\n<li>Nginx 서버를 이미 이용하고 있어 환경 구축을 따로 안해줘도 된다.</li>\n<li>쉽고 저렴하다.</li>\n</ol>\n<p>위와 같은 이유로 Nginx를 이용한 무중단 배포를 적용해 보기로 결정했습니다.</p>\n<h2>무중단 배포 전략</h2>\n<p>구현 방식을 정했으니 이제 배포 전략을 정해야 합니다.\n배포 전략에는 대표적으로 3가지가 존재합니다.</p>\n<ol>\n<li>Rolling 배포</li>\n<li>Canary 배포</li>\n<li>Blue/Green 배포</li>\n</ol>\n<p>각 배포 전략에 대한 자세한 설명은 이 글에선 생략하겠습니다.\n위 세 가지 전략중 저희 프로젝트에서 선택한 전략은 <strong>Blue/Green 배포</strong>이었습니다.</p>\n<h3>Blue/Green 배포를 선택한 이유</h3>\n<p>우선 롤링 배포와 비교해 봤을 때, 좀 더 신속하게 롤백이 가능하다고 생각했습니다.\n또한 롤링 배포는 두 대 이상의 WAS 서버를 이용해 로드 벨런싱을 이용했을 때 큰 이점이 있다고 판단했는데, 저희는 추가 서버 증설에 제약이 있는 상황이었습니다.\n마지막으로 롤링 배포에서는 구버전과 신버전의 공존으로 인한 호환성 문제도 발생할 수 있다는 단점도 존재했습니다.</p>\n<p>카나리 배포와 비교해 봤을 때는 카나리 방식의 최대 이점인 A/B 테스트가 현재 서비스에선 필요가 없었기 때문에 선택하지 않습니다.</p>\n<p>Blue/Green 배포 전략을 취함으로써 신속하게 롤백이 가능하다는 점과 배포하는 속도가 다른 배포법들에 비해 빠르다는 이점을 얻을 수 있었습니다.</p>\n<h2>Blue/Green 배포 적용</h2>\n<p>우선 무중단 배포 적용 전의 인프라 구조와 배포 스크립트를 살펴 봅시다.</p>\n<h3>무중단 배포 전, 인프라 구조와 배포 스크립트</h3>\n<p><strong>인프라 구조</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVR42qVUS24TQRScU3IITpFVxAGQ2EbKIisWeAOKRJARCAP5ClkWwZ7EkTP22N09/e9pjFy8nsRWEiUhwiPVpj/1XlW9nsw5h4dgCdIFaB+gnMdjZ5fIHtvURDKqFzi0C6h6DmPt+oTDuMCRA2S8IvTrEFoiZCR5LA1UiLB2TcnBk29aQzCGOgR48vK/CS3JU0ZhVs1wWRaQWkCxydMI02VjzGrRk1RjSWatEOc1IhbQZY7i9Sbt3R+Mj3/gQo0skcUYkb5Asux1kp7k9qoedke7eF/s4dP4I5i4aIrdVqKJKECc7sPOLpElXw4POnj18gXyfNDMntEG2mgUrkBf9XGmzzC0Q4ggEYgwFUtw3kG4KZ0bofywBZ0fk2RfY6+1g43nz3Cw/5WIDBiFIISgUZGo6gpybjGd/sKkvU3rHIxzCC5obYpz+RM/+GcwXzbNZFVV4eT4BJ0vHQwG+bVckk5eTdwEpSdEhmJ2ivL7m6vuKfkEpRUGvItv/TbORa+xowmFUzclVZNS3vKnK7poDVt4d/EW7XGbuuA0SmEluZGdHoDSK2+zZQApkLspJ7l+7huY3wbCcrh7hntJ/M851JSgtBLSSCirmiJrvZTU6U085W/zF3VEdkMP+Nb2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"before infra structure\"\n        title=\"\"\n        src=\"/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png\"\n        srcset=\"/static/ba69a59706c73c38650c763a313cd6e0/0eb09/before-infra-structure.png 500w,\n/static/ba69a59706c73c38650c763a313cd6e0/1263b/before-infra-structure.png 1000w,\n/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png 2000w,\n/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>배포 스크립트</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">PID</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>pgrep <span class=\"token parameter variable\">-f</span> teatime<span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">$PID</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> <span class=\"token variable\">$PID</span>\n\t<span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">nohup</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dspring.profiles.active</span><span class=\"token operator\">=</span>dev teatime-0.0.1-SNAPSHOT.jar <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>stdout.txt <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span>err.txt <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>적용 전 인프라 구조와 배포 스크립트에 대해 간략하게 알아보자면 다음 순서로 동작합니다.</p>\n<ol>\n<li>젠킨스에서 WAS 서버로 jar 파일이 전송되고 배포 스크립트가 실행된다.</li>\n<li>배포 스크립트에 의해 현재 구동 중인 8080포트의 서버가 kill된다.</li>\n<li>새로운 jar파일로 8080포트에 새로운 서버를 띄운다.</li>\n</ol>\n<p>여기서 한가지 문제점이 발생합니다❗️<br>\n앞서 언급했듯이 기존 서버가 죽고 새로운 서버가 띄워지는 사이에 다운타임이 발생하는 것입니다.</p>\n<p>다음으로 무중단 배포 적용 후의 인프라 구조와 배포 스크립트를 살펴 봅시다.</p>\n<h2>무중단 배포 후, 인프라 구조와 배포 스크립트</h2>\n<p><strong>인프라 구조</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVR42q1Ty2oUQRTtD/UX/AG/wZVLlwHXijCIEgijEBTBLARNdMLopJ/TXd1dz67qzOR4bzUjOpgRjIvT1dQ9nPs4txJrLW6Dsg7KDZDO4RDvVyS3BbQx6P01zgxQ+A3cXQWNsRAsaFlwe/cKGXLwqKVGZ/5Dy4Za5jabdQ0tJdzIVbrf4lobGK0J02mtOSBIwWEgQ0hMa4X242sY2cGSSSwWEw6OkhJvC9Rnx+jePZ0EByJ573+KOaqksQ1Se4ViKJGqFco3R9DtGoMPUczTOLbYoLIr9KNAMAKmyZFwsG5q5GURidZZeEezMzXm+Ryz7zOclqcoXAlFlTKnWleQvUK4cfhQzPGpeQ+/sTFJ4ujz5PFDPLh/D1mWoes6iEaQER3kKNGHHjJINMVn1FVJyRsIIaaubjyW1Vcsm0v4rY93Sdt2eHvyEiezZ7hK01iBkjQz26LzLbVDYqZC/uIRVF3A7Vr2A8gnXAgg1QBtGM3cIVFKYflthfMviykzGfHHlk0eW3b0ahQ5GkiwD8Dz82u8WmwgPRBYkAmBDBnHEMnsLpsirEDmMuQ2R0nGtF6AkzNHk6DnxFThZWWwqGz8HyiW7HZqh/21YbAIm7WLRy6dXGUIASOBE/D9wcXex36cK9VGx3Na7L88vX/BD5CUeNGIz+m+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"after infra structure\"\n        title=\"\"\n        src=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png\"\n        srcset=\"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/0eb09/after-infra-structure.png 500w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/1263b/after-infra-structure.png 1000w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png 2000w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>배포 스크립트</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 현재 profile 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_current_profile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token assign-left variable\">RESPONSE_CODE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-o</span> /dev/null <span class=\"token parameter variable\">-w</span> <span class=\"token string\">\"%{http_code}\"</span> http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:8080<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${RESPONSE_CODE}</span> <span class=\"token operator\">!=</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">]</span> <span class=\"token comment\"># 404가 아니면</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span>prod2\n    <span class=\"token keyword\">else</span>\n        <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span>prod1\n    <span class=\"token keyword\">fi</span>\n\n\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${CURRENT_PROFILE}</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 현재 port 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_current_port</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${CURRENT_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8080\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8081\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 쉬고 있는 profile 찾기: dev1이 사용중이면 dev2가 쉬고 있고, 반대면 dev1이 쉬고 있음</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_idle_profile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">CURRENT_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${CURRENT_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span>prod2\n    <span class=\"token keyword\">else</span>\n      <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span>prod1\n    <span class=\"token keyword\">fi</span>\n\t\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${IDLE_PROFILE}</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 쉬고 있는 profile의 port 찾기</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">find_idle_port</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_profile<span class=\"token variable\">)</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${IDLE_PROFILE}</span> <span class=\"token operator\">==</span> prod1 <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8080\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"8081\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># idle profile로 jar 파일 실행</span>\n\n<span class=\"token assign-left variable\">REPOSITORY</span><span class=\"token operator\">=</span>/home/ubuntu/jar\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Build 파일 복사\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> cp <span class=\"token variable\">$REPOSITORY</span>/*.jar <span class=\"token variable\">$REPOSITORY</span>/\"</span>\n\n<span class=\"token function\">cp</span> <span class=\"token variable\">$REPOSITORY</span>/*.jar <span class=\"token variable\">$REPOSITORY</span>/\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 새 어플리케이션 배포\"</span>\n<span class=\"token assign-left variable\">JAR_NAME</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ls</span> <span class=\"token parameter variable\">-tr</span> $REPOSITORY/*.jar <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> JAR Name: <span class=\"token variable\">$JAR_NAME</span>\"</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 에 실행권한 추가\"</span>\n\n<span class=\"token function\">chmod</span> +x <span class=\"token variable\">$JAR_NAME</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 실행\"</span>\n\n<span class=\"token assign-left variable\">CURRENT_PORT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_current_port<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">IDLE_PROFILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_profile<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">IDLE_PORT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>find_idle_port<span class=\"token variable\">)</span></span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> <span class=\"token variable\">$JAR_NAME</span> 를 profile=<span class=\"token variable\">$IDLE_PROFILE</span> 로 실행합니다.\"</span>\n<span class=\"token function\">nohup</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dspring.profiles.active</span><span class=\"token operator\">=</span><span class=\"token variable\">$IDLE_PROFILE</span> <span class=\"token variable\">$JAR_NAME</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>stdout.txt <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span>err.txt <span class=\"token operator\">&amp;</span>\n\n<span class=\"token comment\"># health check</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health Check Start!\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> IDLE_PORT: <span class=\"token variable\">$IDLE_PORT</span>\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> curl -s http://{WAS ip주소}:<span class=\"token variable\">$IDLE_PORT</span> \"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">RETRY_COUNT</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">do</span>\n  <span class=\"token assign-left variable\">RESPONSE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:$<span class=\"token punctuation\">{</span>IDLE_PORT<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span>\n  <span class=\"token assign-left variable\">UP_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $<span class=\"token punctuation\">{</span>RESPONSE<span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"timestamp\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${UP_COUNT}</span> <span class=\"token parameter variable\">-ge</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span> <span class=\"token comment\"># $up_count >= 1 </span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 성공\"</span>\n\n      <span class=\"token comment\"># 기존 포트에서 idle port로 switch</span>\n\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 전환할 Port: <span class=\"token variable\">$IDLE_PORT</span>\"</span>\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Port 전환\"</span>\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"set \\<span class=\"token variable\">$service_url</span> http://{WAS ip주소}:<span class=\"token variable\">${IDLE_PORT}</span>;\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix1 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/nginx/conf.d/service-prod-url.inc\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"set \\<span class=\"token variable\">$service_url</span> http://{WAS ip주소}:<span class=\"token variable\">${IDLE_PORT}</span>;\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix2 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/nginx/conf.d/service-prod-url.inc\n\n\t\t\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 엔진엑스 Reload\"</span>\n\t\t\t<span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix1 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx reload\n\t\t\t<span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> key-teatime.cer ubuntu@<span class=\"token punctuation\">{</span>ngnix2 ip주소<span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx reload\n      <span class=\"token builtin class-name\">break</span>\n\n  <span class=\"token keyword\">else</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check의 응답을 알 수 없거나 혹은 실행 상태가 아닙니다.\"</span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check: <span class=\"token variable\">${RESPONSE}</span>\"</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${RETRY_COUNT}</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 실패. \"</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 엔진엑스에 연결하지 않고 배포를 종료합니다.\"</span>\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 연결 실패. 재시도...\"</span>\n  <span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n<span class=\"token keyword\">done</span>\n\n<span class=\"token comment\"># 기존 포트 stop</span>\n\n<span class=\"token assign-left variable\">CURRENT_PID</span><span class=\"token operator\">=</span><span class=\"token punctuation\">$(</span>lsof <span class=\"token parameter variable\">-ti</span> tcp:<span class=\"token variable\">${CURRENT_PORT}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token variable\">${CURRENT_PID}</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> 현재 구동중인 애플리케이션이 없으므로 종료하지 않습니다.\"</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> kill -15 <span class=\"token variable\">$CURRENT_PID</span>\"</span>\n  <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-15</span> <span class=\"token variable\">${CURRENT_PID}</span>\n  <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>Blue/Green 무중단 배포 적용 후 변경된 인프라 구조와 배포 스크립트입니다.\n배포 스크립트가 약간 길어 보기 불편할 수 있어 간단하게 정리하면 다음과 같습니다.</p>\n<p>현재 8080포트로 서버가 구동 중인 상황에서의 배포 동작 순서입니다.</p>\n<ol>\n<li>idle port를 찾는다. 즉 8081포트에 새롭게 배포될 서버가 띄워져야 한다는 사실을 인지한다.</li>\n<li>idle port(8081포트)로 jar 파일 실행한다.</li>\n<li>health check를 통해 8081포트에 서버가 띄워 질 때까지 current port(8080포트)의 서버를 kill 하지 않는다.</li>\n<li>8081포트에 서버가 잘 띄워졌으면 Nginx에서 가리키고 있는 WAS 포트를 current port(8080) -> idle port(8081)로 스위칭해준다.</li>\n<li>current port(8080포트)를 kill한다.</li>\n</ol>\n<h3>8081포트에 서버가 띄워진 후의 인프라 구조</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVR42q2T224TMRCG86y8Ai/AJW/AA0CvueGmqtpIoSVSBFIEESBFWbU0abLrPXjXp3FOP2NvQgkoEQIuZq21x5//sf/pGGNwLBrjUFuK46m8n6NzbEFzCFpjoIHcr+P/PwMzBo7M9v8AQ1TaIq1qSGNhtDoNs5zDeceBmlU2CmWew3GyXa0PK9D6IJQsYFRzBKjDgzSotUSpJKpyATF4A2t0VBEANuQ5isr0Csi6L9GM37dAy5NEFEERqLhcqjBpJkj0LZL8M9LB6xayU0fkoZfASDDMAiticCNb4CQZ4+OnIZRSEe7YJsIKXM2ucDm9xHV6w5sKEFsorCsGLr3HVAFnQ4/+/Rab7TYe1NFcwqsXz/Hs6RPM5wtIKSEygZpq0IawAt+drZCNuiiLIh4aNq6XS5RujeHtHEmhH4EFJ33o36Df6+JhPm8NLRtIJzHTM6SUY5aPkb49Qy0rCCGQZWm8O79xuFMJ6mXFwM1OIX8eFim+TWeo6xrWtSXnNsfF9ALn9+foLXrIjIglG2tiFZYrK6jA9d07fMm/PgKDInIOntr72b9yUFhSCUntWOoiQvZO8HyHfuOxKFJIKw+Bv3VJ8BUbudHBOm2oX4wdrRPKdp4F0Y+5k50SFO3jaIvujP1Hrfc38R26fHknz9DnowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8081 infra structure\"\n        title=\"\"\n        src=\"/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png\"\n        srcset=\"/static/d4af184cb317fd03bb58bd12d16e841c/0eb09/8081-infra-structure.png 500w,\n/static/d4af184cb317fd03bb58bd12d16e841c/1263b/8081-infra-structure.png 1000w,\n/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png 2000w,\n/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png 2560w\"\n        sizes=\"(max-width: 2000px) 100vw, 2000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위와 같은 flow로 Blue/Green 배포를 적용하여 결론적으로 평균 20초이상의 다운 타임을 0.2초로 줄였습니다.\n여기서 0.2초의 다운 타임이 존재하는 이유는 proxy switching을 하고 nginx를 reload하는 과정이 0.1초인데, 저희 프로젝트에선 nginx를 두 대 이용하기 때문에 0.2초의 다운타임이 발생했습니다.</p>\n<h2>추후 고민해 볼 점</h2>\n<p>무중단 배포를 구현한 뒤 추가로 고민해보면 좋을 점들입니다.</p>\n<h3>1. Health check</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  <span class=\"token assign-left variable\">RESPONSE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> http://<span class=\"token punctuation\">{</span>WAS ip주소<span class=\"token punctuation\">}</span>:$<span class=\"token punctuation\">{</span>IDLE_PORT<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span>\n  <span class=\"token assign-left variable\">UP_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $<span class=\"token punctuation\">{</span>RESPONSE<span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"timestamp\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">${UP_COUNT}</span> <span class=\"token parameter variable\">-ge</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span> <span class=\"token comment\"># $up_count >= 1 </span>\n      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 성공\"</span>\n      <span class=\"token punctuation\">..</span>.\n  <span class=\"token keyword\">else</span>\n\t   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"> Health check 실패\"</span>\n       <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>현재 Health check를 위와 같이 진행하고 있습니다.\n신버전이 배포된 포트의 {WAS ip주소}:{IDLE_PORT}로 요청을 보내 응답에 timestamp라는 문자열이 존재하면 새로운 서버가 띄워졌다고 판단하고 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1430px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVR42u2QuQqEQBBE/f9PEkMTjYxMRBQDRccT1PEuqQZlwWA32Gy3oehr5nXPGKZpwrZtWJYF13XhOA48zxOxV5YlaMdx4BMzlFKg8jxH0zSo61pyguI4Rtd1mOcZWmuM44hhGDBNk3jWHsAsy0AVRSFK0xTXkL7v0batQOlZ4xnGXIDDH8AoihCGIYIggO/74pMkkctVVd0igFu9ffK2bdj3HZe/4mVZsK7rLebs8S9f9QDiy/YH/gLwBOXNrDawoowOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"white page\"\n        title=\"\"\n        src=\"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png\"\n        srcset=\"/static/81e55d859d7f6cecc079a217d1926005/0eb09/white-page.png 500w,\n/static/81e55d859d7f6cecc079a217d1926005/1263b/white-page.png 1000w,\n/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png 1430w\"\n        sizes=\"(max-width: 1430px) 100vw, 1430px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위와 같이 ubuntu os로 띄워진 ec2 서버의 해당 포트가 띄워졌을 때, 보이는 화면에 너무 종속적인 health check가 될 수도 있다는 생각이 들었습니다.\n추후에 팀원들과 논의 끝에 더 좋은 방법으로 개선해야 될 것 같습니다.</p>\n<h3>2. WAS 서버 증설</h3>\n<p>현재 무중단 배포를 통해 운영 서버의 다운 타임 문제는 해결 됐으나, WAS ec2 자체가 다운되면 서비스가 무한정 중단될 수 있는 상황입니다.\n이렇게 시스템 구성 요소 중에서 장애가 발생하면 전체 시스템이 다운되는 지점을 SPOF(single point of failure, 단일 장애 지점)이라고 합니다.\n따라서 WAS 서버를 한 대 더 증설하는 것이 안전하다고 판단됩니다.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포를 도입하게 된 계기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 20초 이상의 다운타임이 발생한다는 것이었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"운영 서버는 사용자의 경험과 직결되는데, 배포할때마다 서버가 20초 이상 다운되는 것은 큰 문제라고 생각했습니다.\n기능이 점점 많아짐에 따라 다운타임도 비례해 증가할 것이라고 판단했고, 따라서 운영 서버의 다운타임을 개선하고자 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"무중단 배포"}]},{"type":"text","value":"를 프로젝트에 도입하기로 결정했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포란"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스가 운영 중일 때 새로운 버전을 배포하기 위해서는 1)기존 서비스를 종료하고 2)새로운 서비스를 시작해야 합니다.\n1번과 2번 사이의 과정에서 다운타임이 필연적으로 발생하며, 다운타임 동안 사용자들은 서비스를 이용할 수 없게 됩니다.\n이 다운타임을 해결해주는 방법이 바로 무중단 배포입니다.\n즉, 말그대로 중단이 없는 배포를 무중단 배포라고 합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 구현 방식"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"무중단 배포를 구현하는 방식에는 여러가지가 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"AWS에서 Blue-Greem 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"도커를 이용한 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"L4, L7 스위치를 이용한 무중단 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nginx를 이용한 무중단 배포"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"대표적으로 위와 같은 방법들이 있는데 저희 프로젝트에서는 제일 마지막에 있는 Nginx를 이용한 무중단 배포 방식을 선택했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"무중단 배포 구현 방식으로 Nginx 방식을 선택한 이유"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx를 이용하여 무중단 배포를 구현하면 저희 프로젝트에서 다음 2가지 장점이 존재했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nginx 서버를 이미 이용하고 있어 환경 구축을 따로 안해줘도 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"쉽고 저렴하다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같은 이유로 Nginx를 이용한 무중단 배포를 적용해 보기로 결정했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 전략"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"구현 방식을 정했으니 이제 배포 전략을 정해야 합니다.\n배포 전략에는 대표적으로 3가지가 존재합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Rolling 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Canary 배포"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Blue/Green 배포"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"각 배포 전략에 대한 자세한 설명은 이 글에선 생략하겠습니다.\n위 세 가지 전략중 저희 프로젝트에서 선택한 전략은 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Blue/Green 배포"}]},{"type":"text","value":"이었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Blue/Green 배포를 선택한 이유"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우선 롤링 배포와 비교해 봤을 때, 좀 더 신속하게 롤백이 가능하다고 생각했습니다.\n또한 롤링 배포는 두 대 이상의 WAS 서버를 이용해 로드 벨런싱을 이용했을 때 큰 이점이 있다고 판단했는데, 저희는 추가 서버 증설에 제약이 있는 상황이었습니다.\n마지막으로 롤링 배포에서는 구버전과 신버전의 공존으로 인한 호환성 문제도 발생할 수 있다는 단점도 존재했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"카나리 배포와 비교해 봤을 때는 카나리 방식의 최대 이점인 A/B 테스트가 현재 서비스에선 필요가 없었기 때문에 선택하지 않습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Blue/Green 배포 전략을 취함으로써 신속하게 롤백이 가능하다는 점과 배포하는 속도가 다른 배포법들에 비해 빠르다는 이점을 얻을 수 있었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Blue/Green 배포 적용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우선 무중단 배포 적용 전의 인프라 구조와 배포 스크립트를 살펴 봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"무중단 배포 전, 인프라 구조와 배포 스크립트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"인프라 구조"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVR42qVUS24TQRScU3IITpFVxAGQ2EbKIisWeAOKRJARCAP5ClkWwZ7EkTP22N09/e9pjFy8nsRWEiUhwiPVpj/1XlW9nsw5h4dgCdIFaB+gnMdjZ5fIHtvURDKqFzi0C6h6DmPt+oTDuMCRA2S8IvTrEFoiZCR5LA1UiLB2TcnBk29aQzCGOgR48vK/CS3JU0ZhVs1wWRaQWkCxydMI02VjzGrRk1RjSWatEOc1IhbQZY7i9Sbt3R+Mj3/gQo0skcUYkb5Asux1kp7k9qoedke7eF/s4dP4I5i4aIrdVqKJKECc7sPOLpElXw4POnj18gXyfNDMntEG2mgUrkBf9XGmzzC0Q4ggEYgwFUtw3kG4KZ0bofywBZ0fk2RfY6+1g43nz3Cw/5WIDBiFIISgUZGo6gpybjGd/sKkvU3rHIxzCC5obYpz+RM/+GcwXzbNZFVV4eT4BJ0vHQwG+bVckk5eTdwEpSdEhmJ2ivL7m6vuKfkEpRUGvItv/TbORa+xowmFUzclVZNS3vKnK7poDVt4d/EW7XGbuuA0SmEluZGdHoDSK2+zZQApkLspJ7l+7huY3wbCcrh7hntJ/M851JSgtBLSSCirmiJrvZTU6U085W/zF3VEdkMP+Nb2AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"before infra structure","title":"","src":"/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png","srcSet":["/static/ba69a59706c73c38650c763a313cd6e0/0eb09/before-infra-structure.png 500w","/static/ba69a59706c73c38650c763a313cd6e0/1263b/before-infra-structure.png 1000w","/static/ba69a59706c73c38650c763a313cd6e0/f97d7/before-infra-structure.png 2000w","/static/ba69a59706c73c38650c763a313cd6e0/c7a69/before-infra-structure.png 2560w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"배포 스크립트"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"PID"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"pgrep "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-f"}]},{"type":"text","value":" teatime"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-n"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$PID"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-9"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$PID"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nohup"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"java"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-jar"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-Dspring.profiles.active"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"dev teatime-0.0.1-SNAPSHOT.jar "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":">"}]},{"type":"text","value":"stdout.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":">"}]},{"type":"text","value":"err.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"&"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"적용 전 인프라 구조와 배포 스크립트에 대해 간략하게 알아보자면 다음 순서로 동작합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"젠킨스에서 WAS 서버로 jar 파일이 전송되고 배포 스크립트가 실행된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"배포 스크립트에 의해 현재 구동 중인 8080포트의 서버가 kill된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"새로운 jar파일로 8080포트에 새로운 서버를 띄운다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기서 한가지 문제점이 발생합니다❗️"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n앞서 언급했듯이 기존 서버가 죽고 새로운 서버가 띄워지는 사이에 다운타임이 발생하는 것입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음으로 무중단 배포 적용 후의 인프라 구조와 배포 스크립트를 살펴 봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"무중단 배포 후, 인프라 구조와 배포 스크립트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"인프라 구조"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVR42q1Ty2oUQRTtD/UX/AG/wZVLlwHXijCIEgijEBTBLARNdMLopJ/TXd1dz67qzOR4bzUjOpgRjIvT1dQ9nPs4txJrLW6Dsg7KDZDO4RDvVyS3BbQx6P01zgxQ+A3cXQWNsRAsaFlwe/cKGXLwqKVGZ/5Dy4Za5jabdQ0tJdzIVbrf4lobGK0J02mtOSBIwWEgQ0hMa4X242sY2cGSSSwWEw6OkhJvC9Rnx+jePZ0EByJ573+KOaqksQ1Se4ViKJGqFco3R9DtGoMPUczTOLbYoLIr9KNAMAKmyZFwsG5q5GURidZZeEezMzXm+Ryz7zOclqcoXAlFlTKnWleQvUK4cfhQzPGpeQ+/sTFJ4ujz5PFDPLh/D1mWoes6iEaQER3kKNGHHjJINMVn1FVJyRsIIaaubjyW1Vcsm0v4rY93Sdt2eHvyEiezZ7hK01iBkjQz26LzLbVDYqZC/uIRVF3A7Vr2A8gnXAgg1QBtGM3cIVFKYflthfMviykzGfHHlk0eW3b0ahQ5GkiwD8Dz82u8WmwgPRBYkAmBDBnHEMnsLpsirEDmMuQ2R0nGtF6AkzNHk6DnxFThZWWwqGz8HyiW7HZqh/21YbAIm7WLRy6dXGUIASOBE/D9wcXex36cK9VGx3Na7L88vX/BD5CUeNGIz+m+AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"after infra structure","title":"","src":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png","srcSet":["/static/2f584bd5b14ca2a9732f1798c9d9e0e2/0eb09/after-infra-structure.png 500w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/1263b/after-infra-structure.png 1000w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/f97d7/after-infra-structure.png 2000w","/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c7a69/after-infra-structure.png 2560w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"배포 스크립트"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 현재 profile 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_current_profile"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE_CODE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-o"}]},{"type":"text","value":" /dev/null "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-w"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"%{http_code}\""}]},{"type":"text","value":" http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":8080"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RESPONSE_CODE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"404"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 404가 아니면"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod2\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod1\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 현재 port 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_current_port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8080\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8081\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 쉬고 있는 profile 찾기: dev1이 사용중이면 dev2가 쉬고 있고, 반대면 dev1이 쉬고 있음"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_idle_profile"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod2\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"prod1\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\t\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PROFILE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 쉬고 있는 profile의 port 찾기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-name","function"]},"children":[{"type":"text","value":"find_idle_port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PROFILE}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=="}]},{"type":"text","value":" prod1 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8080\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"8081\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# idle profile로 jar 파일 실행"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"REPOSITORY"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"/home/ubuntu/jar\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Build 파일 복사\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> cp "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"cp"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$REPOSITORY"}]},{"type":"text","value":"/\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 새 어플리케이션 배포\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"JAR_NAME"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ls"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-tr"}]},{"type":"text","value":" $REPOSITORY/*.jar "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tail"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-n"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> JAR Name: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 에 실행권한 추가\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"chmod"}]},{"type":"text","value":" +x "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 실행\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_current_port"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PROFILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_profile"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"IDLE_PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"find_idle_port"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" 를 profile="},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PROFILE"}]},{"type":"text","value":" 로 실행합니다.\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nohup"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"java"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-jar"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-Dspring.profiles.active"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PROFILE"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$JAR_NAME"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":">"}]},{"type":"text","value":"stdout.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","file-descriptor","important"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":">"}]},{"type":"text","value":"err.txt "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"&"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# health check"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health Check Start!\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> IDLE_PORT: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> curl -s http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":" \""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","for-or-select","variable"]},"children":[{"type":"text","value":"RETRY_COUNT"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"do"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-s"}]},{"type":"text","value":" http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":$"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"IDLE_PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"UP_COUNT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"RESPONSE"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"grep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"timestamp\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wc"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-l"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${UP_COUNT}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-ge"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# $up_count >= 1 "}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 성공\""}]},{"type":"text","value":"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 기존 포트에서 idle port로 switch"}]},{"type":"text","value":"\n\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 전환할 Port: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$IDLE_PORT"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Port 전환\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"set \\"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$service_url"}]},{"type":"text","value":" http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PORT}"}]},{"type":"text","value":";\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-i"}]},{"type":"text","value":" key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix1 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tee"}]},{"type":"text","value":" /etc/nginx/conf.d/service-prod-url.inc\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"set \\"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$service_url"}]},{"type":"text","value":" http://{WAS ip주소}:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${IDLE_PORT}"}]},{"type":"text","value":";\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-i"}]},{"type":"text","value":" key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix2 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tee"}]},{"type":"text","value":" /etc/nginx/conf.d/service-prod-url.inc\n\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 엔진엑스 Reload\""}]},{"type":"text","value":"\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-i"}]},{"type":"text","value":" key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix1 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" nginx reload\n\t\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-i"}]},{"type":"text","value":" key-teatime.cer ubuntu@"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"ngnix2 ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" nginx reload\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"break"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check의 응답을 알 수 없거나 혹은 실행 상태가 아닙니다.\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check: "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RESPONSE}"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${RETRY_COUNT}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-eq"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 실패. \""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 엔진엑스에 연결하지 않고 배포를 종료합니다.\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"exit"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 연결 실패. 재시도...\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 기존 포트 stop"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"CURRENT_PID"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"lsof "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-ti"}]},{"type":"text","value":" tcp:"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PORT}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-z"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PID}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> 현재 구동중인 애플리케이션이 없으므로 종료하지 않습니다.\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> kill -15 "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$CURRENT_PID"}]},{"type":"text","value":"\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-15"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CURRENT_PID}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sleep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Blue/Green 무중단 배포 적용 후 변경된 인프라 구조와 배포 스크립트입니다.\n배포 스크립트가 약간 길어 보기 불편할 수 있어 간단하게 정리하면 다음과 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 8080포트로 서버가 구동 중인 상황에서의 배포 동작 순서입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"idle port를 찾는다. 즉 8081포트에 새롭게 배포될 서버가 띄워져야 한다는 사실을 인지한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"idle port(8081포트)로 jar 파일 실행한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"health check를 통해 8081포트에 서버가 띄워 질 때까지 current port(8080포트)의 서버를 kill 하지 않는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"8081포트에 서버가 잘 띄워졌으면 Nginx에서 가리키고 있는 WAS 포트를 current port(8080) -> idle port(8081)로 스위칭해준다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"current port(8080포트)를 kill한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"8081포트에 서버가 띄워진 후의 인프라 구조"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVR42q2T224TMRCG86y8Ai/AJW/AA0CvueGmqtpIoSVSBFIEESBFWbU0abLrPXjXp3FOP2NvQgkoEQIuZq21x5//sf/pGGNwLBrjUFuK46m8n6NzbEFzCFpjoIHcr+P/PwMzBo7M9v8AQ1TaIq1qSGNhtDoNs5zDeceBmlU2CmWew3GyXa0PK9D6IJQsYFRzBKjDgzSotUSpJKpyATF4A2t0VBEANuQ5isr0Csi6L9GM37dAy5NEFEERqLhcqjBpJkj0LZL8M9LB6xayU0fkoZfASDDMAiticCNb4CQZ4+OnIZRSEe7YJsIKXM2ucDm9xHV6w5sKEFsorCsGLr3HVAFnQ4/+/Rab7TYe1NFcwqsXz/Hs6RPM5wtIKSEygZpq0IawAt+drZCNuiiLIh4aNq6XS5RujeHtHEmhH4EFJ33o36Df6+JhPm8NLRtIJzHTM6SUY5aPkb49Qy0rCCGQZWm8O79xuFMJ6mXFwM1OIX8eFim+TWeo6xrWtSXnNsfF9ALn9+foLXrIjIglG2tiFZYrK6jA9d07fMm/PgKDInIOntr72b9yUFhSCUntWOoiQvZO8HyHfuOxKFJIKw+Bv3VJ8BUbudHBOm2oX4wdrRPKdp4F0Y+5k50SFO3jaIvujP1Hrfc38R26fHknz9DnowAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"8081 infra structure","title":"","src":"/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png","srcSet":["/static/d4af184cb317fd03bb58bd12d16e841c/0eb09/8081-infra-structure.png 500w","/static/d4af184cb317fd03bb58bd12d16e841c/1263b/8081-infra-structure.png 1000w","/static/d4af184cb317fd03bb58bd12d16e841c/f97d7/8081-infra-structure.png 2000w","/static/d4af184cb317fd03bb58bd12d16e841c/c7a69/8081-infra-structure.png 2560w"],"sizes":"(max-width: 2000px) 100vw, 2000px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같은 flow로 Blue/Green 배포를 적용하여 결론적으로 평균 20초이상의 다운 타임을 0.2초로 줄였습니다.\n여기서 0.2초의 다운 타임이 존재하는 이유는 proxy switching을 하고 nginx를 reload하는 과정이 0.1초인데, 저희 프로젝트에선 nginx를 두 대 이용하기 때문에 0.2초의 다운타임이 발생했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"추후 고민해 볼 점"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"무중단 배포를 구현한 뒤 추가로 고민해보면 좋을 점들입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"1. Health check"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"RESPONSE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-s"}]},{"type":"text","value":" http://"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"WAS ip주소"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":":$"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"IDLE_PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"UP_COUNT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"RESPONSE"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"grep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"timestamp\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wc"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-l"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${UP_COUNT}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-ge"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# $up_count >= 1 "}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 성공\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n\t   "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"> Health check 실패\""}]},{"type":"text","value":"\n       "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":"."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 Health check를 위와 같이 진행하고 있습니다.\n신버전이 배포된 포트의 {WAS ip주소}:{IDLE_PORT}로 요청을 보내 응답에 timestamp라는 문자열이 존재하면 새로운 서버가 띄워졌다고 판단하고 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1430px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 58.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVR42u2QuQqEQBBE/f9PEkMTjYxMRBQDRccT1PEuqQZlwWA32Gy3oehr5nXPGKZpwrZtWJYF13XhOA48zxOxV5YlaMdx4BMzlFKg8jxH0zSo61pyguI4Rtd1mOcZWmuM44hhGDBNk3jWHsAsy0AVRSFK0xTXkL7v0batQOlZ4xnGXIDDH8AoihCGIYIggO/74pMkkctVVd0igFu9ffK2bdj3HZe/4mVZsK7rLebs8S9f9QDiy/YH/gLwBOXNrDawoowOAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"white page","title":"","src":"/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png","srcSet":["/static/81e55d859d7f6cecc079a217d1926005/0eb09/white-page.png 500w","/static/81e55d859d7f6cecc079a217d1926005/1263b/white-page.png 1000w","/static/81e55d859d7f6cecc079a217d1926005/1d7f3/white-page.png 1430w"],"sizes":"(max-width: 1430px) 100vw, 1430px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위와 같이 ubuntu os로 띄워진 ec2 서버의 해당 포트가 띄워졌을 때, 보이는 화면에 너무 종속적인 health check가 될 수도 있다는 생각이 들었습니다.\n추후에 팀원들과 논의 끝에 더 좋은 방법으로 개선해야 될 것 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"2. WAS 서버 증설"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"현재 무중단 배포를 통해 운영 서버의 다운 타임 문제는 해결 됐으나, WAS ec2 자체가 다운되면 서비스가 무한정 중단될 수 있는 상황입니다.\n이렇게 시스템 구성 요소 중에서 장애가 발생하면 전체 시스템이 다운되는 지점을 SPOF(single point of failure, 단일 장애 지점)이라고 합니다.\n따라서 WAS 서버를 한 대 더 증설하는 것이 안전하다고 판단됩니다."}]}],"data":{"quirksMode":false}},"excerpt":"무중단 배포를 도입하게 된 계기 프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 2…","timeToRead":5,"frontmatter":{"title":"무중단 배포","userDate":"1 November 2022","date":"2022-11-01T12:00:00.000Z","tags":["무중단배포"],"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVR42q1Ty2oUQRTtD/UX/AG/wZVLlwHXijCIEgijEBTBLARNdMLopJ/TXd1dz67qzOR4bzUjOpgRjIvT1dQ9nPs4txJrLW6Dsg7KDZDO4RDvVyS3BbQx6P01zgxQ+A3cXQWNsRAsaFlwe/cKGXLwqKVGZ/5Dy4Za5jabdQ0tJdzIVbrf4lobGK0J02mtOSBIwWEgQ0hMa4X242sY2cGSSSwWEw6OkhJvC9Rnx+jePZ0EByJ573+KOaqksQ1Se4ViKJGqFco3R9DtGoMPUczTOLbYoLIr9KNAMAKmyZFwsG5q5GURidZZeEezMzXm+Ryz7zOclqcoXAlFlTKnWleQvUK4cfhQzPGpeQ+/sTFJ4ujz5PFDPLh/D1mWoes6iEaQER3kKNGHHjJINMVn1FVJyRsIIaaubjyW1Vcsm0v4rY93Sdt2eHvyEiezZ7hK01iBkjQz26LzLbVDYqZC/uIRVF3A7Vr2A8gnXAgg1QBtGM3cIVFKYflthfMviykzGfHHlk0eW3b0ahQ5GkiwD8Dz82u8WmwgPRBYkAmBDBnHEMnsLpsirEDmMuQ2R0nGtF6AkzNHk6DnxFThZWWwqGz8HyiW7HZqh/21YbAIm7WLRy6dXGUIASOBE/D9wcXex36cK9VGx3Na7L88vX/BD5CUeNGIz+m+AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c1b5a/after-infra-structure.png","srcSet":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/76a4f/after-infra-structure.png 750w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/a902f/after-infra-structure.png 1080w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/61156/after-infra-structure.png 1366w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/c1b5a/after-infra-structure.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/2b382/after-infra-structure.avif 750w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/5688c/after-infra-structure.avif 1080w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/1c725/after-infra-structure.avif 1366w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/9641c/after-infra-structure.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/2f584bd5b14ca2a9732f1798c9d9e0e2/66907/after-infra-structure.webp 750w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/27610/after-infra-structure.webp 1080w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/90004/after-infra-structure.webp 1366w,\n/static/2f584bd5b14ca2a9732f1798c9d9e0e2/e4c47/after-infra-structure.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.75}}},"author":[{"name":"4기_잉","bio":"우아한테크코스 4기 잉(유영우)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#a8a898","images":{"fallback":{"src":"/static/321f2fb3f306933bfd7ee26a44327f82/73bb6/ing.jpg","srcSet":"/static/321f2fb3f306933bfd7ee26a44327f82/2f28c/ing.jpg 40w,\n/static/321f2fb3f306933bfd7ee26a44327f82/499f6/ing.jpg 80w,\n/static/321f2fb3f306933bfd7ee26a44327f82/73bb6/ing.jpg 120w","sizes":"100vw"},"sources":[{"srcSet":"/static/321f2fb3f306933bfd7ee26a44327f82/e73fe/ing.webp 40w,\n/static/321f2fb3f306933bfd7ee26a44327f82/61ca6/ing.webp 80w,\n/static/321f2fb3f306933bfd7ee26a44327f82/507b0/ing.webp 120w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}],"source":null}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"id":"79146ac1-cd88-5fca-a901-eb79ca4d373d","timeToRead":5,"excerpt":"무중단 배포를 도입하게 된 계기 프로젝트를 론칭한 이후, 사용자의 피드백을 반영하다보니 운영 환경으로의 배포가 점차 잦아졌습니다.\n문제는 배포를 할 때마다 기존 서버를 내리고 새롭게 띄우는 과정에서 평균 2…","frontmatter":{"title":"무중단 배포","date":"2022-11-01T12:00:00.000Z"},"fields":{"slug":"/post/2022-11-01-blue-green-deployment/"}}}]}},"pageContext":{"slug":"/post/2022-11-01-blue-green-deployment/","prev":{"excerpt":"들어가며 코드를 수정하면, 검토 요청(PR…","timeToRead":4,"frontmatter":{"title":"테스트코드 성능 개선기","tags":["Test","Spring Boot"],"date":"2022-10-27T13:10:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAUGB//EABcBAAMBAAAAAAAAAAAAAAAAAAQFBgf/2gAMAwEAAhADEAAAAcxrhH4tPgtf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAwQFBgL/2gAIAQEAAQUCIbNdIiamEoX28sw5/8QAIBEAAgICAgIDAAAAAAAAAAAAAQIDEQQFEhMAFCFRYf/aAAgBAwEBPwHY7VttMJnwddhApFH0a3G9PHHVjw4vYIlkYdsq44lmY3znkllq2HFUEYEaiwgocqdvj7ZrYn9Jvz//xAAfEQACAgEEAwAAAAAAAAAAAAACAwEEEgAFEyERQVH/2gAIAQIBAT8BoonbUioLFi1xtJ+d9kWmnJuN/GZkETKlyyVrHrFIgrzjHb7R22nZNaVk4syBC4SkZn0tYziA/BjX/8QAHxAAAwEAAgMAAwAAAAAAAAAAAQIDBBITBREUISIk/9oACAEBAAY/Asss6STWMj02W0R30I1QklElIJUSP23DZeTKZRV+x+IUMMOjfAfKhyfbHDDrBjDrlRTI1kKWpGfdV52mLVqf2Q8iEfweK8Mgzorq0Dk/o7KlmEz5LyH46zIcu8eyCOsevbf/xAAXEAEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEBAAE/Ic0yqGatbbT0Kr6GbxA88YIskp4p4hUhWtgDv//aAAwDAQACAAMAAAAQi+//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEDAQE/EL4tLXasoDL4GwPAjFACJuEVSnXf/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAQf/aAAgBAgEBPxAUmESGDKbiuLmK68XFLLGcJv/EABYQAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAQABPxBLuzRPS2ZxqNrq6qus3oljDNjH++yelrKIn//Z"},"images":{"fallback":{"src":"/static/6d609ab1d3bd75c286e135674c2d0001/c87cb/testing-server.jpg","srcSet":"/static/6d609ab1d3bd75c286e135674c2d0001/42e0c/testing-server.jpg 750w,\n/static/6d609ab1d3bd75c286e135674c2d0001/93e5c/testing-server.jpg 1080w,\n/static/6d609ab1d3bd75c286e135674c2d0001/92bf2/testing-server.jpg 1366w,\n/static/6d609ab1d3bd75c286e135674c2d0001/c87cb/testing-server.jpg 1918w","sizes":"100vw"},"sources":[{"srcSet":"/static/6d609ab1d3bd75c286e135674c2d0001/0c378/testing-server.webp 750w,\n/static/6d609ab1d3bd75c286e135674c2d0001/384c0/testing-server.webp 1080w,\n/static/6d609ab1d3bd75c286e135674c2d0001/4096f/testing-server.webp 1366w,\n/static/6d609ab1d3bd75c286e135674c2d0001/fbb62/testing-server.webp 1918w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.36496350364963503}}},"author":[{"name":"4기_수달","bio":"우아한테크코스 4기 수달(허수진)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAcIBQb/xAAWAQEBAQAAAAAAAAAAAAAAAAAGAwX/2gAMAwEAAhADEAAAAeuS7YkQumq01y+X/8QAGRABAAMBAQAAAAAAAAAAAAAABQEDBAYC/9oACAEBAAEFAhaEdhu8m/wHNnPoVTsZJOdKXx8fmSIto//EACERAQEAAQMDBQAAAAAAAAAAAAECAwQFEgARIRMUIjFx/9oACAEDAQE/Ad63fBodR7LLqst3GOaRXHPKnEYlBR7wPGWpoh8PHkdMaTM+rO6wTk+cl4dVVE15BopFDx37v799f//EABwRAAMAAwEBAQAAAAAAAAAAAAECAwQFESEAMf/aAAgBAgEBPwHQaa2bj3yxhQWd2M4OAjUUAVN/SobypBJHe09/QOjG2UORbU1dp8Qul8UI5HAWUEqQrH0AqOA84Pv/xAAkEAACAgEEAQQDAAAAAAAAAAACAwEEBRESEyEUAAYjQiIxUf/aAAgBAQAGPwIbINSCfbtB2XrrObkiviAnGtMKGZlxSv7fH/C9YX3dm80rMefdxt7M1edzQv085MGivQRGieepJT8SRDetLI1PsZreNi6U+Enw2CKC2pIXNsKTBOjee2pZrd9xEzs+kxFxeNuRz26jkC9oJeyGmByAANpJpUgC7iIEi01/fXr2Zha1mH2cBlX27jJKUjssWPifWCTYvdV5TgR3AfHHXf4+lebFqXgALli2ujmgRjRxiMgIsPWZOI1jXuJiJ2j/AP/EABgQAQEBAQEAAAAAAAAAAAAAAAERACEx/9oACAEBAAE/IXkTyEIj/wAa1Ls3Joi/U8xTY0TgACx7hMoYlWlHBC0vqsEMgQdKNRleutv1DEABRiYXSirCuD+MDX//2gAMAwEAAgADAAAAEBM//8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAwEBPxAoAxUBJYwQBVhY9lIYLmigbLXW/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREA/9oACAECAQE/EHy9yGJjoRjqM0AHQoMCoFBQoIf/xAAXEAADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEBAAE/EFeCAq7XQvnziwPYoPrrAzUo4Bi8wVbgVHNQ2YcNRu2mq5K4Wod48dCw5tLj29IakXDMT//Z"},"images":{"fallback":{"src":"/static/797f4d4bfca1c3af6567b42e32555753/3832f/sudal.jpg","srcSet":"/static/797f4d4bfca1c3af6567b42e32555753/6c918/sudal.jpg 750w,\n/static/797f4d4bfca1c3af6567b42e32555753/49438/sudal.jpg 1080w,\n/static/797f4d4bfca1c3af6567b42e32555753/f4534/sudal.jpg 1366w,\n/static/797f4d4bfca1c3af6567b42e32555753/3832f/sudal.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/797f4d4bfca1c3af6567b42e32555753/66907/sudal.webp 750w,\n/static/797f4d4bfca1c3af6567b42e32555753/27610/sudal.webp 1080w,\n/static/797f4d4bfca1c3af6567b42e32555753/90004/sudal.webp 1366w,\n/static/797f4d4bfca1c3af6567b42e32555753/e4c47/sudal.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.75}}}}]},"fields":{"layout":"post","slug":"/post/2022-10-15-test-code-optimization/"}},"next":{"excerpt":"Transaction Isolation Level 애플리케이션을 개발 중 데이터베이스를 도입하면 격리 수준에 대한 이해가 자연스럽게 요구됩니다. 격리 수준은 데이터베이스의 ACID 성질 중 Isolation…","timeToRead":7,"frontmatter":{"title":"트랜잭션 격리 수준","tags":["Transaction","Isolation-Level"],"date":"2022-11-07T13:10:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVR42pWQS08TYRSG54fp0qg/whg3RJdEY+ICYmJiMFGMl60LSZRCvVC8kRYLbVIpLUxDQgrTDimFVkuZTmGYzqXTmcfhK3iJLspZfOd8ec95zkViQPODQPjFzR2mc5vE5DLFuvZPnjQoMDjxmmmTKddpdxy+Fqtk1FpfD84I/NOOpzyyXRG/XVHYbRm/oGcCnq6dVeuoe7qIK9oBM3LpBBggBQMtG/wFTJfqjLzP0HH6UybD1eXthtCl4ycIfhf8r0HQs/EtDb9rir951KLaaqM7p3XwNLEibitdehRltlAWwvWJOA/nciL2eh5+6N39dYxvo1jKFO5uCiM3RqfwDKfwOPRPsNSYyE9tVMSU0vm7L7k5mQzpNS48mGQ4hI59WhZJkdVtYvNv8JfvYCpR7K2PtD5cE5pTTdKMXMZce9HfwvewvR7SjYkEz+dlzt1/xetskVtTCwyHDZTw6KPRNJF0HlpLHOTH0T9foZ0Ywgwn1L9cpR0f4jAzQreRx20WcKtzSOs1jaZhsbCxw6HlovzQBfj29CIXx9+RkFehkaJTiYd3bOLpCrY6i5G9h/t9ie7+GtbWDO6eHGolfgKKqN/fkaGTvwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/64c8b860c2aa4433524a1d980618bc06/37b34/mysql_isolation.png","srcSet":"/static/64c8b860c2aa4433524a1d980618bc06/37b55/mysql_isolation.png 750w,\n/static/64c8b860c2aa4433524a1d980618bc06/f5738/mysql_isolation.png 1080w,\n/static/64c8b860c2aa4433524a1d980618bc06/f46bd/mysql_isolation.png 1366w,\n/static/64c8b860c2aa4433524a1d980618bc06/37b34/mysql_isolation.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/64c8b860c2aa4433524a1d980618bc06/0b2ce/mysql_isolation.webp 750w,\n/static/64c8b860c2aa4433524a1d980618bc06/74a67/mysql_isolation.webp 1080w,\n/static/64c8b860c2aa4433524a1d980618bc06/70ac8/mysql_isolation.webp 1366w,\n/static/64c8b860c2aa4433524a1d980618bc06/2dc08/mysql_isolation.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5177083333333333}}},"author":[{"name":"4기_쿼리치","bio":"우아한테크코스 4기 쿼리치(정석윤)입니다 :)","avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQGCf/EABcBAQEBAQAAAAAAAAAAAAAAAAAEAgP/2gAMAwEAAhADEAAAAeAlNWju64gQ7AA//8QAGxAAAgEFAAAAAAAAAAAAAAAAAwQFAAECECD/2gAIAQEAAQUCogCi0kbBZyRlLsi4/8QAHBEAAgICAwAAAAAAAAAAAAAAAQIDEQQSECJB/9oACAEDAQE/AVYmco6lYRjvIJRTbT7BUh1sUK7M3i2QCRR5/8QAHhEAAgMAAgMBAAAAAAAAAAAAAQIDBBESIRQgIjH/2gAIAQIBAT8BrwVXq2pZ7JimiC+PCqcjMx6w9jF0rrb8gMeLfnp//8QAIxAAAQMDAwUBAAAAAAAAAAAAAQIDIQQREgAiMRATIFFhYv/aAAgBAQAGPwLRzQoYnEmxxy9ZcXgx8PSlqHEdxDFQy8pEb0tOJWUzE2tMadZa2M1NYqtcQDwsZhpBHG0PLMXk/nx//8QAHBABAQEAAgMBAAAAAAAAAAAAAREhADEQIEFR/9oACAEBAAE/IQVAFXANVegOIndRJr5ZINW4Y+HeD/8AgVuPUdaJyOi8qwUwl3BnRR6//9oADAMBAAIAAwAAABBQAAD/xAAWEQEBAQAAAAAAAAAAAAAAAAABESD/2gAIAQMBAT8QI5kqBdHRK1tgL//EABcRAQEBAQAAAAAAAAAAAAAAABEBICH/2gAIAQIBAT8QDaAncEeMJ+yYf//EABkQAQADAQEAAAAAAAAAAAAAAAEAESFBIP/aAAgBAQABPxBEzACgAAVVQAFVA1hXu3gCVDlOYOKOMHUNBS+0OCGEhxUFgCI3FKvVPH//2Q=="},"images":{"fallback":{"src":"/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/37851/quaritch.jpg","srcSet":"/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/37851/quaritch.jpg 460w","sizes":"100vw"},"sources":[{"srcSet":"/static/bcd27cc7f4bf48fc5d0ac68e8c974a5e/b5c5b/quaritch.webp 460w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}]},"fields":{"layout":"post","slug":"/post/2022-11-07-mysql-isolation/"}},"primaryTag":"무중단배포"}},"staticQueryHashes":["2337738035"],"slicesMap":{}}