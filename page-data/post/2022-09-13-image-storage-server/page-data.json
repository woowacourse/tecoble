{"componentChunkName":"component---src-templates-post-tsx","path":"/post/2022-09-13-image-storage-server/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVQY003Qvw7BUBTH8YYgLCKExWw1IczEwAtIJCa1GJuyCalI/EmERUgHi5cxeI8uTTt1aHp9r9wmhk/OOfee/HJzNd/3Dc/zutS24zgZIUQpiqIt9YY+vUb9+eur6Kh5GN9LGkEn2DBd1y1zmGfxjjf9AFm1XEQCBe6aVBMVLJHiLBcHTiHwQS0MQ/mSOlYsjPDCAjOMccUFR3Z0NdvYISkDW9jAQi8IAhnYgAyZ4wELEzUfcFZfYmCPJ9ZIfwG9owW1fLgCkwAAAABJRU5ErkJggg==","width":400,"height":88,"src":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png","srcSet":"/static/0b18bd94a62a12fdc81ea720c28722f6/3891b/tecoble.png 1x"}}},"markdownRemark":{"html":"<p>레벨 3 프로젝트 과정 중 이미지 서버를 개발하고 개선해나가는 과정을 이야기하려 합니다.</p>\n<h2>왜 이미지 서버를 만들어야 하는가?</h2>\n<p>레벨 3 프로젝트인 <a href=\"https://github.com/woowacourse-teams/2022-gong-check\">공책</a>에서는 특정 공간에 관해서 설명하는 이미지를 올려 보여주어야 합니다. 글보다는 이미지를 제공함으로써 처음 보는 공간에 대해서도 가시적으로 확인하기 쉽게 하기 위함이죠.</p>\n<p align=\"center\">\n<img width=\"196\" alt=\"1\" src=\"https://user-images.githubusercontent.com/63030569/189906326-0c10be7b-aad2-460e-af18-24581f93317a.png\">\n</p>\n<p>이에 따라 공간의 관리자가 특정 공간을 추가할 때 본인이 원하는 이미지를 올려야 하기 때문에 서버 측에서 이미지를 저장할 수 있도록 하는 기능이 필요했습니다.</p>\n<p>기존에 이미 RDB를 사용하고 있었기 때문에 이미지 데이터를 단순히 binary로 전환하여 RDB에 저장하는 방법을 고려했었습니다. 다만 아래의 문제점이 거론되었어요.</p>\n<ul>\n<li>binary 로 관리하게 되는 경우 너무 큰 데이터 파일로 인하여 관리가 힘들다.</li>\n<li>binary의 크기가 크기 때문에 입출력 시 database에 병목현상이 발생하여 다른 데이터에 영향을 준다.</li>\n</ul>\n<p>저희 팀에서는 이런 문제점을 고려하여 이미지 스토리지 서버를 따로 두어 관리하는 방향으로 결정하였습니다.</p>\n<h2>이미지 스토리지 서버</h2>\n<p>이미지 스토리지 서버는 <em>MVP</em>로 개발했기 때문에 아래의 두 가지 기능만을 제공하고 있었습니다.</p>\n<ul>\n<li>이미지를 업로드한다.</li>\n<li>이미지를 제공한다.</li>\n</ul>\n<p>따라서 업로드할 수 있는 웹 애플리케이션 서버(WAS)와 업로드된 이미지를 제공할 수 있는 웹 서버(WS)를 구축하였습니다.</p>\n<blockquote>\n<p>MVP(Minimum Viable Product): 고객의 피드백을 받아 최소한의 기능(features)을 구현한 제품</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189909124-76ed1d7c-bab4-4f24-9bfe-526f70502f7c.png\" alt=\"이미지 서버 구조\"></p>\n<p>인증된 사용자만 사용할 수 있게끔 다른 처리는 해두었지만, 대체적인 구조는 위와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// image upload api</span>\n<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/image-upload\"</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">uploadImage</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestPart</span> <span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  \n    <span class=\"token class-name\">ImageSaveResponse</span> imageSaveResponse <span class=\"token operator\">=</span> imageService<span class=\"token punctuation\">.</span><span class=\"token function\">storeImage</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>imageSaveResponse<span class=\"token punctuation\">.</span><span class=\"token function\">getImagePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이미지 파일을 HTTP 메시지 바디에 담아 이미지를 업로드하는 API를 호출하면, 서버에서는 <code class=\"language-text\">MultipartFile</code> 타입으로 이미지를 받아 저장하고, 이미지의 경로를 반환합니다. 이후에는 해당 경로를 통해 이미지를 요청하게 됩니다.</p>\n<br>\n<blockquote>\n<p>Nginx 설정은 nginx.conf 혹은 include한 서버 설정 파일을 통해 설정할 수 있습니다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token directive\"><span class=\"token keyword\">server_name</span> image.gongcheck.shop</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token directive\"><span class=\"token keyword\">location</span> /images</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">alias</span> /home/ubuntu/images/</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\"># ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>WS(nginx)에서는 요청받은 이미지 경로를 통해 이미지를 반환합니다.</p>\n<h2>단순 이미지 업로드 서버로서의 문제점</h2>\n<p>위의 이미지 서버는 단순히 <code class=\"language-text\">이미지 업로드</code>와 <code class=\"language-text\">이미지 제공</code>만을 담당하고 있습니다. 잘 운영되고 있다는 생각 중에 운영상황에서 문제를 발견합니다.</p>\n<blockquote>\n<p>원본 이미지를 저장하다보니 이미지의 크기가 너무 커서 이미지 로딩 시간이 너무 길다.</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189908680-be9385ce-e346-4dcc-8caa-dabe313beb47.png\"></p>\n<p>위 스크린샷은 저희 서비스에서 여러 이미지 파일을 요청하는 페이지를 요청할 때 걸리는 시간들을 나타내고 있습니다.</p>\n<p>위처럼 로딩하는데 최대 <code class=\"language-text\">8.59 초</code>까지 걸리는 이미지도 존재합니다. 이 문제가 단순히 네트워크 환경의 문제인지 이미지 크기의 문제인지 객관적으로 판단하기 위해 웹 페이지 성능 분석 도구인 <code class=\"language-text\">lighthouse</code>를 통해 확실한 지표를 확인해보았습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189908706-708a42d8-05c0-49f0-bd6e-c33dff1b7305.png\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189909707-54e3d097-b0c8-4b74-b58b-dd58a03f964f.png\"></p>\n<p>여러 지표 중 이미지와 관련된 지표를 보면 다음과 같습니다.</p>\n<ul>\n<li>이미지의 크기를 사용하는만큼 줄여서 사용하여야 한다.</li>\n<li>이미지 파일 형식을 <em>webp</em>로 전환하여야 한다.</li>\n</ul>\n<blockquote>\n<p>WebP: 웹사이트의 트래픽 감소 및 시간 단축을 겨냥해 만들어진 이미지 포맷으로, 2010년 9월 구글이 공개하였다.</p>\n</blockquote>\n<p>화면에 필요한 만큼의 크기가 아니라 원본 이미지의 크기를 그대로 사용하기 때문에 이미지를 최적화하여 전달받아야 조금 더 빠르다는 것입니다. 또한 기존의 이미지를 webp 확장자로 변환하여 더 좋은 이미지 압축률을 가진 파일 형식을 제공하도록 하자라는 것이죠.</p>\n<br>\n<p>정확한 리포트를 전달받았으니 이제는 서버를 고칠 차례입니다. 클라이언트에게 하나의 이미지 파일에 대해 여러가지 크기의 이미지를 제공할 수 있도록 서버 내부에는 원본 이미지 파일을 저장한 후, 클라이언트가 요청한 크기에 맞게 이미지를 변환하여 webp 확장자로 반환하도록 설계했습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189910301-c77ad999-3aa5-4091-a258-781778389142.png\"></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/resize/{imageUrl}\"</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token function\">getResizeImage</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> imageUrl<span class=\"token punctuation\">,</span>  \n                                             <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token operator\">=</span> DEFAULT_RESIZE_WIDTH<span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> width<span class=\"token punctuation\">,</span>  \n                                             <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token operator\">=</span> DEFAULT_WEBP<span class=\"token punctuation\">)</span> <span class=\"token keyword\">boolean</span> webp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token class-name\">ImageResponse</span> response <span class=\"token operator\">=</span> imageService<span class=\"token punctuation\">.</span><span class=\"token function\">resizeImage</span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> webp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getContentType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>변경하고자 하는 크기의 가로 길이를 입력받고, webp로 변환할지 말지 여부를 입력받습니다. 여기에서 webp에 대한 반환 여부를 넣은 이유는 브라우저마다 <a href=\"https://caniuse.com/webp\">호환 여부</a>가 다른데요. 프론트 페이지에서 이를 판단하여 호환되는 곳에서만 webp를 반환하게 하기 위해 이렇게 API를 설계했습니다.</p>\n<p>webp와 관련된 변환 로직은 대표적으로는 2가지가 있습니다. <a href=\"https://chromium.googlesource.com/webm/libwebp\">C로 작성된 코덱 파일</a>을 이용하여 활용하는 방법과 이를 래핑한 바이너리 파일을 실행하는 방법인데요. 해당 api 내에서는 바이너리 파일을 실행하는 방법을 사용하였으며 본 포스팅에서는 다루지 않습니다.</p>\n<br>\n<p>이제 이미지 크기로 인한 문제를 해결했습니다. 이미지도 잘 업로드하고 있고, 이미지 크기에 맞게 최적화된 이미지를 전달해주고 있기 때문입니다. 그러나 클라이언트가 이미지를 요청할 때마다 크기를 변환하는 로직을 수행해야한다는 새로운 문제가 발생하였습니다.</p>\n<h2>이미지 서버 최적화</h2>\n<p>이러한 문제를 해결하고자 캐싱과 etag를 적용하였습니다.</p>\n<h3>nginx를 이용한 캐싱</h3>\n<p>저희 팀은 Nginx의 reverse proxy cache 기능을 활용하기로 결정했습니다.</p>\n<p>Nginx에서는 특정 요청에 대해서 중간에 처리를 해줄 수 있는 reverse proxy 서버와 처리된 요청을 캐싱할 수 있는 기능을 제공합니다. 이를 이용하여 저희는 WAS에서 반환된 자원을 Nginx에 캐싱하도록 만들었습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189910905-1be63822-2caf-4a80-9950-2299db7ede55.png\"></p>\n<p>(4)에서 캐싱된 이미지는 이후 같은 요청이 들어올 때, WAS까지 가지 않고 바로 Nginx에서 처리해줄 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">proxy_cache_path</span> /home/ubuntu/cache levels=1:2 keys_zone=my_zone:20m inactive=60m</span><span class=\"token punctuation\">;</span>\n<span class=\"token directive\"><span class=\"token keyword\">proxy_cache_key</span> <span class=\"token string\">\"<span class=\"token variable\">$scheme</span><span class=\"token variable\">$request_method</span><span class=\"token variable\">$host</span><span class=\"token variable\">$request_uri</span>\"</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token directive\"><span class=\"token keyword\">server_name</span> image.gongcheck.day</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token directive\"><span class=\"token keyword\">location</span> ~* ^/images/(.*)\\.(?:png|gif|jpg|jpeg)$</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">rewrite</span> ^/images/(.*)$ /api/resize/<span class=\"token variable\">$1</span> break</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token directive\"><span class=\"token keyword\">proxy_cache</span> my_zone</span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">add_header</span> X-Proxy-Cache <span class=\"token variable\">$upstream_cache_status</span></span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">expires</span> <span class=\"token number\">1M</span></span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token directive\"><span class=\"token keyword\">include</span> /etc/nginx/proxy_params</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://localhost:8080</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">#...</span></code></pre></div>\n<p>간단하게 저희팀에서 사용하는 nginx의 conf를 살펴보겠습니다.</p>\n<ul>\n<li>proxy<em>cache</em>path : 캐싱할 데이터를 저장할 경로를 설정합니다. 데이터를 저장할 크기, 캐시 레벨 등을 설정할 수 있습니다.</li>\n<li>proxy<em>cache</em>key : 캐싱할 요청의 key입니다. 동일한 key라면 동일한 값을 반환합니다.</li>\n<li>location : 유저가 요청한 URI를 원하는 경로로 매핑하기 위한 설정을 정의합니다.</li>\n<li>rewrite : WAS로 전달하기 위해 요청을 api 스펙에 맞게 수정하여 reverse proxy 요청합니다.</li>\n<li>add_header X-Proxy-Cache : header에 cache 상태를 반환합니다.</li>\n<li>proxy_pass : reverse proxy 전달할 서버 url입니다.</li>\n</ul>\n<p>이렇게 Nginx의 reverse proxy cache를 활용하여 불필요한 요청이 WAS로 넘어가지 않도록 만들었습니다.</p>\n<h3>Http Header를 이용한 캐싱 적용</h3>\n<p>이미지는 브라우저단에서 캐싱되어 사용될 수도 있습니다. 현재 정적 파일에 대해 필요한 범위에 따라 <code class=\"language-text\">Cache-Control</code>을 조절하여 브라우저에서 어떻게 캐싱하여 사용할 것인지를 판별할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Cache-control: must-revalidate\nCache-control: no-cache\nCache-control: no-store\nCache-control: no-transform\nCache-control: public\nCache-control: private\nCache-control: proxy-revalidate\nCache-Control: max-age=&lt;seconds>\nCache-control: s-maxage=&lt;seconds></code></pre></div>\n<p>(출처 : <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control\">https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control</a>)</p>\n<p>저희 서비스의 경우 이미지 파일이 수정될 일이 거의 없기 때문에 <code class=\"language-text\">no-cache</code> 값을 사용하지 않고 <code class=\"language-text\">max-age</code>로 최소한의 갱신 기간만 설정하였습니다.</p>\n<p>만료 기간이 다 되었을 경우 WAS로 다시 리소스를 요청하게 됩니다. 하지만 만료 기간이 다 되었음에도 리소스에 변경 사항이 없다면 어떨까요? 굳이 WAS로 다시 요청할 필요 없이 브라우저에 캐시된 값을 사용하도록 만들면 됩니다. <code class=\"language-text\">etag</code>를 사용하면 이를 구현할 수 있습니다.</p>\n<p>이미지마다 <code class=\"language-text\">etag</code>를 만들어서 반환한다면 이미지에 대한 특정 식별자가 생깁니다. HTTP 통신 시 해당 식별자의 컨텐츠가 변경되었는지 아닌지를 판단할 수 있습니다. 이렇게 WAS에서 이미지에 대한 반환 값으로 <code class=\"language-text\">etag</code>를 달아주면, <code class=\"language-text\">max-age</code>가 지난 후에 다시 요청이 올 때, 만약 해당 컨텐츠가 수정되지 않았다면 WS가 304 응답을 통해 브라우저의 캐시를 사용하도록 만들 수 있습니다.</p>\n<h2>개선된 결과물</h2>\n<p><img src=\"https://user-images.githubusercontent.com/63030569/189909738-c70f77f1-46de-4eda-ae19-b2155f8d7dbb.png\"></p>\n<p>글 초반부에서 이미지가 최악의 상황에는 8초가 걸렸던 것을 기억하시나요?</p>\n<p>이미지 스토리지 서버 최적화를 통해 평균적으로 초 단위가 걸리던 응답을 10ms대로 줄일 수 있었습니다.</p>\n<h2>마무리</h2>\n<p>많은 개선이 이루어졌지만, 아직도 풀어나가야 할 과제들이 많습니다. 하나의 인스턴스 내에 WS와 WAS가 공존하고 있어서 이를 분리해야 하고, 이미지 스토리지를 확장하게 된다면 어떻게 경로 설정을 하고 캐싱을 할 것 인지 등을 고민해야할 것 같습니다.</p>\n<p>아직 많이 부족한 글이지만 새롭게 이미지 서버를 개발하는 분들에게 도움이 되었으면 좋겠습니다. 감사합니다 🙇‍♂️</p>\n<h2>참고 자료</h2>\n<ul>\n<li><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control\">MDN - Cache-Control Header</a></li>\n<li><a href=\"https://www.nginx.com/resources/wiki/start/topics/examples/reverseproxycachingexample/\">Nginx - Reverse Proxy with Caching</a></li>\n<li><a href=\"https://jojoldu.tistory.com/60\">이동욱님 블로그 - Nginx Cache 문제 해결 시리즈</a></li>\n<li><a href=\"https://aws.amazon.com/ko/caching/\">AWS - Caching</a></li>\n</ul>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"레벨 3 프로젝트 과정 중 이미지 서버를 개발하고 개선해나가는 과정을 이야기하려 합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"왜 이미지 서버를 만들어야 하는가?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"레벨 3 프로젝트인 "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/woowacourse-teams/2022-gong-check"},"children":[{"type":"text","value":"공책"}]},{"type":"text","value":"에서는 특정 공간에 관해서 설명하는 이미지를 올려 보여주어야 합니다. 글보다는 이미지를 제공함으로써 처음 보는 공간에 대해서도 가시적으로 확인하기 쉽게 하기 위함이죠."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{"align":"center"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"img","properties":{"width":196,"alt":"1","src":"https://user-images.githubusercontent.com/63030569/189906326-0c10be7b-aad2-460e-af18-24581f93317a.png"},"children":[]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이에 따라 공간의 관리자가 특정 공간을 추가할 때 본인이 원하는 이미지를 올려야 하기 때문에 서버 측에서 이미지를 저장할 수 있도록 하는 기능이 필요했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"기존에 이미 RDB를 사용하고 있었기 때문에 이미지 데이터를 단순히 binary로 전환하여 RDB에 저장하는 방법을 고려했었습니다. 다만 아래의 문제점이 거론되었어요."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"binary 로 관리하게 되는 경우 너무 큰 데이터 파일로 인하여 관리가 힘들다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"binary의 크기가 크기 때문에 입출력 시 database에 병목현상이 발생하여 다른 데이터에 영향을 준다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저희 팀에서는 이런 문제점을 고려하여 이미지 스토리지 서버를 따로 두어 관리하는 방향으로 결정하였습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"이미지 스토리지 서버"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이미지 스토리지 서버는 "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"MVP"}]},{"type":"text","value":"로 개발했기 때문에 아래의 두 가지 기능만을 제공하고 있었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"이미지를 업로드한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"이미지를 제공한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"따라서 업로드할 수 있는 웹 애플리케이션 서버(WAS)와 업로드된 이미지를 제공할 수 있는 웹 서버(WS)를 구축하였습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"MVP(Minimum Viable Product): 고객의 피드백을 받아 최소한의 기능(features)을 구현한 제품"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189909124-76ed1d7c-bab4-4f24-9bfe-526f70502f7c.png","alt":"이미지 서버 구조"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"인증된 사용자만 사용할 수 있게끔 다른 처리는 해두었지만, 대체적인 구조는 위와 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// image upload api"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@PostMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/api/image-upload\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"  \n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ResponseEntity"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"uploadImage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestPart"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"MultipartFile"}]},{"type":"text","value":" file"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"  \n  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ImageSaveResponse"}]},{"type":"text","value":" imageSaveResponse "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" imageService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"storeImage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"file"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ResponseEntity"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ok"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"imageSaveResponse"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getImagePath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"  \n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이미지 파일을 HTTP 메시지 바디에 담아 이미지를 업로드하는 API를 호출하면, 서버에서는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"MultipartFile"}]},{"type":"text","value":" 타입으로 이미지를 받아 저장하고, 이미지의 경로를 반환합니다. 이후에는 해당 경로를 통해 이미지를 요청하게 됩니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx 설정은 nginx.conf 혹은 include한 서버 설정 파일을 통해 설정할 수 있습니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"nginx"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-nginx"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nginx"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"server"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"server_name"}]},{"type":"text","value":" image.gongcheck.shop"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"location"}]},{"type":"text","value":" /images"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"alias"}]},{"type":"text","value":" /home/ubuntu/images/"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"WS(nginx)에서는 요청받은 이미지 경로를 통해 이미지를 반환합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"단순 이미지 업로드 서버로서의 문제점"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위의 이미지 서버는 단순히 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"이미지 업로드"}]},{"type":"text","value":"와 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"이미지 제공"}]},{"type":"text","value":"만을 담당하고 있습니다. 잘 운영되고 있다는 생각 중에 운영상황에서 문제를 발견합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"원본 이미지를 저장하다보니 이미지의 크기가 너무 커서 이미지 로딩 시간이 너무 길다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189908680-be9385ce-e346-4dcc-8caa-dabe313beb47.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 스크린샷은 저희 서비스에서 여러 이미지 파일을 요청하는 페이지를 요청할 때 걸리는 시간들을 나타내고 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위처럼 로딩하는데 최대 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"8.59 초"}]},{"type":"text","value":"까지 걸리는 이미지도 존재합니다. 이 문제가 단순히 네트워크 환경의 문제인지 이미지 크기의 문제인지 객관적으로 판단하기 위해 웹 페이지 성능 분석 도구인 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"lighthouse"}]},{"type":"text","value":"를 통해 확실한 지표를 확인해보았습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189908706-708a42d8-05c0-49f0-bd6e-c33dff1b7305.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189909707-54e3d097-b0c8-4b74-b58b-dd58a03f964f.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여러 지표 중 이미지와 관련된 지표를 보면 다음과 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"이미지의 크기를 사용하는만큼 줄여서 사용하여야 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"이미지 파일 형식을 "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"webp"}]},{"type":"text","value":"로 전환하여야 한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"WebP: 웹사이트의 트래픽 감소 및 시간 단축을 겨냥해 만들어진 이미지 포맷으로, 2010년 9월 구글이 공개하였다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"화면에 필요한 만큼의 크기가 아니라 원본 이미지의 크기를 그대로 사용하기 때문에 이미지를 최적화하여 전달받아야 조금 더 빠르다는 것입니다. 또한 기존의 이미지를 webp 확장자로 변환하여 더 좋은 이미지 압축률을 가진 파일 형식을 제공하도록 하자라는 것이죠."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"정확한 리포트를 전달받았으니 이제는 서버를 고칠 차례입니다. 클라이언트에게 하나의 이미지 파일에 대해 여러가지 크기의 이미지를 제공할 수 있도록 서버 내부에는 원본 이미지 파일을 저장한 후, 클라이언트가 요청한 크기에 맞게 이미지를 변환하여 webp 확장자로 반환하도록 설계했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189910301-c77ad999-3aa5-4091-a258-781778389142.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/api/resize/{imageUrl}\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"  \n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ResponseEntity"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"byte"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getResizeImage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@PathVariable"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" imageUrl"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"  \n                                             "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"required "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" defaultValue "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" DEFAULT_RESIZE_WIDTH"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" width"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"  \n                                             "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"required "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" defaultValue "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" DEFAULT_WEBP"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"boolean"}]},{"type":"text","value":" webp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ImageResponse"}]},{"type":"text","value":" response "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" imageService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"resizeImage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"imageUrl"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" width"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" webp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ResponseEntity"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ok"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"  \n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"contentType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"response"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getContentType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"  \n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"body"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"response"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBytes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"  \n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"변경하고자 하는 크기의 가로 길이를 입력받고, webp로 변환할지 말지 여부를 입력받습니다. 여기에서 webp에 대한 반환 여부를 넣은 이유는 브라우저마다 "},{"type":"element","tagName":"a","properties":{"href":"https://caniuse.com/webp"},"children":[{"type":"text","value":"호환 여부"}]},{"type":"text","value":"가 다른데요. 프론트 페이지에서 이를 판단하여 호환되는 곳에서만 webp를 반환하게 하기 위해 이렇게 API를 설계했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"webp와 관련된 변환 로직은 대표적으로는 2가지가 있습니다. "},{"type":"element","tagName":"a","properties":{"href":"https://chromium.googlesource.com/webm/libwebp"},"children":[{"type":"text","value":"C로 작성된 코덱 파일"}]},{"type":"text","value":"을 이용하여 활용하는 방법과 이를 래핑한 바이너리 파일을 실행하는 방법인데요. 해당 api 내에서는 바이너리 파일을 실행하는 방법을 사용하였으며 본 포스팅에서는 다루지 않습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제 이미지 크기로 인한 문제를 해결했습니다. 이미지도 잘 업로드하고 있고, 이미지 크기에 맞게 최적화된 이미지를 전달해주고 있기 때문입니다. 그러나 클라이언트가 이미지를 요청할 때마다 크기를 변환하는 로직을 수행해야한다는 새로운 문제가 발생하였습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"이미지 서버 최적화"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이러한 문제를 해결하고자 캐싱과 etag를 적용하였습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"nginx를 이용한 캐싱"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저희 팀은 Nginx의 reverse proxy cache 기능을 활용하기로 결정했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx에서는 특정 요청에 대해서 중간에 처리를 해줄 수 있는 reverse proxy 서버와 처리된 요청을 캐싱할 수 있는 기능을 제공합니다. 이를 이용하여 저희는 WAS에서 반환된 자원을 Nginx에 캐싱하도록 만들었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189910905-1be63822-2caf-4a80-9950-2299db7ede55.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"(4)에서 캐싱된 이미지는 이후 같은 요청이 들어올 때, WAS까지 가지 않고 바로 Nginx에서 처리해줄 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"nginx"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-nginx"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nginx"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"proxy_cache_path"}]},{"type":"text","value":" /home/ubuntu/cache levels=1:2 keys_zone=my_zone:20m inactive=60m"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"proxy_cache_key"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$scheme"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$request_method"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$host"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$request_uri"}]},{"type":"text","value":"\""}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"server"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"server_name"}]},{"type":"text","value":" image.gongcheck.day"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"location"}]},{"type":"text","value":" ~* ^/images/(.*)\\.(?:png|gif|jpg|jpeg)$"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"rewrite"}]},{"type":"text","value":" ^/images/(.*)$ /api/resize/"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$1"}]},{"type":"text","value":" break"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"proxy_cache"}]},{"type":"text","value":" my_zone"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"add_header"}]},{"type":"text","value":" X-Proxy-Cache "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$upstream_cache_status"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"expires"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1M"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"include"}]},{"type":"text","value":" /etc/nginx/proxy_params"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\t\t"},{"type":"element","tagName":"span","properties":{"className":["token","directive"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"proxy_pass"}]},{"type":"text","value":" http://localhost:8080"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\t\n\t"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#..."}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"간단하게 저희팀에서 사용하는 nginx의 conf를 살펴보겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"proxy"},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"cache"}]},{"type":"text","value":"path : 캐싱할 데이터를 저장할 경로를 설정합니다. 데이터를 저장할 크기, 캐시 레벨 등을 설정할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"proxy"},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"cache"}]},{"type":"text","value":"key : 캐싱할 요청의 key입니다. 동일한 key라면 동일한 값을 반환합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"location : 유저가 요청한 URI를 원하는 경로로 매핑하기 위한 설정을 정의합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"rewrite : WAS로 전달하기 위해 요청을 api 스펙에 맞게 수정하여 reverse proxy 요청합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"add_header X-Proxy-Cache : header에 cache 상태를 반환합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"proxy_pass : reverse proxy 전달할 서버 url입니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 Nginx의 reverse proxy cache를 활용하여 불필요한 요청이 WAS로 넘어가지 않도록 만들었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Http Header를 이용한 캐싱 적용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이미지는 브라우저단에서 캐싱되어 사용될 수도 있습니다. 현재 정적 파일에 대해 필요한 범위에 따라 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Cache-Control"}]},{"type":"text","value":"을 조절하여 브라우저에서 어떻게 캐싱하여 사용할 것인지를 판별할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Cache-control: must-revalidate\nCache-control: no-cache\nCache-control: no-store\nCache-control: no-transform\nCache-control: public\nCache-control: private\nCache-control: proxy-revalidate\nCache-Control: max-age=<seconds>\nCache-control: s-maxage=<seconds>"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"(출처 : "},{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control"},"children":[{"type":"text","value":"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control"}]},{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저희 서비스의 경우 이미지 파일이 수정될 일이 거의 없기 때문에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"no-cache"}]},{"type":"text","value":" 값을 사용하지 않고 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"max-age"}]},{"type":"text","value":"로 최소한의 갱신 기간만 설정하였습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"만료 기간이 다 되었을 경우 WAS로 다시 리소스를 요청하게 됩니다. 하지만 만료 기간이 다 되었음에도 리소스에 변경 사항이 없다면 어떨까요? 굳이 WAS로 다시 요청할 필요 없이 브라우저에 캐시된 값을 사용하도록 만들면 됩니다. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"etag"}]},{"type":"text","value":"를 사용하면 이를 구현할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이미지마다 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"etag"}]},{"type":"text","value":"를 만들어서 반환한다면 이미지에 대한 특정 식별자가 생깁니다. HTTP 통신 시 해당 식별자의 컨텐츠가 변경되었는지 아닌지를 판단할 수 있습니다. 이렇게 WAS에서 이미지에 대한 반환 값으로 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"etag"}]},{"type":"text","value":"를 달아주면, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"max-age"}]},{"type":"text","value":"가 지난 후에 다시 요청이 올 때, 만약 해당 컨텐츠가 수정되지 않았다면 WS가 304 응답을 통해 브라우저의 캐시를 사용하도록 만들 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"개선된 결과물"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://user-images.githubusercontent.com/63030569/189909738-c70f77f1-46de-4eda-ae19-b2155f8d7dbb.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"글 초반부에서 이미지가 최악의 상황에는 8초가 걸렸던 것을 기억하시나요?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이미지 스토리지 서버 최적화를 통해 평균적으로 초 단위가 걸리던 응답을 10ms대로 줄일 수 있었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"마무리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"많은 개선이 이루어졌지만, 아직도 풀어나가야 할 과제들이 많습니다. 하나의 인스턴스 내에 WS와 WAS가 공존하고 있어서 이를 분리해야 하고, 이미지 스토리지를 확장하게 된다면 어떻게 경로 설정을 하고 캐싱을 할 것 인지 등을 고민해야할 것 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"아직 많이 부족한 글이지만 새롭게 이미지 서버를 개발하는 분들에게 도움이 되었으면 좋겠습니다. 감사합니다 🙇‍♂️"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"참고 자료"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control"},"children":[{"type":"text","value":"MDN - Cache-Control Header"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.nginx.com/resources/wiki/start/topics/examples/reverseproxycachingexample/"},"children":[{"type":"text","value":"Nginx - Reverse Proxy with Caching"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://jojoldu.tistory.com/60"},"children":[{"type":"text","value":"이동욱님 블로그 - Nginx Cache 문제 해결 시리즈"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://aws.amazon.com/ko/caching/"},"children":[{"type":"text","value":"AWS - Caching"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"레벨 3 프로젝트 과정 중 이미지 서버를 개발하고 개선해나가는 과정을 이야기하려 합니다. 왜 이미지 서버를 만들어야 하는가? 레벨…","timeToRead":6,"frontmatter":{"title":"이미지 스토리지 서버 구축 및 최적화","userDate":"13 September 2022","date":"2022-09-13T12:00:00.000Z","tags":["nginx","image","cache"],"excerpt":null,"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVQoz22S7yuDURTHn5f+I14oWtlbpaTJ7xRpkfJCZorJTBliihcUVpLNrCXWrGYI61nb2JYfLWQNbcpE2u59vuw+e7aZnbq32znnfu75nns4ZI0KFMUm+SilEASBrVImZPMycS6zSRcD8TvIdpWoNHfBFfUyHyFETIYIS9MUNsJ6LPrVMPhUeEze/nmck161RFyotvRAbu1D2VIVKkydmPdvsVjs9RlpkmJn+8MW+l21WLnSYvSsAzPegVx1rEKpbC2/hvoDFYKJCGb9m2hzaNB9NAV8ECiaGmHe3sEnTWLktAWrV5NY8A3BGJ6B+rQZx9E9UY1A8kCddx011l4o7COw3Z+g7VCDduc4i03P6cHzPBM+cd6N5cDYr+RhBhx0N+D6zZeTzdGs5Mh7FK2/EM5Qzlbd/iA8L6F/HxCMe9DlkEHnUaLHKWdQEUbyPSz8YePNAQyXJhAq+ggluf5I/Q4leLifbLiIOfFNvkr3MAMtHgsJWggrNTqFsR/VtTYkAa584wAAAABJRU5ErkJggg==","aspectRatio":2.3604060913705585,"src":"/static/30e739e21332622c2eb01b602c2e97e4/71829/image-storage-server.png","srcSet":"/static/30e739e21332622c2eb01b602c2e97e4/3a443/image-storage-server.png 930w,\n/static/30e739e21332622c2eb01b602c2e97e4/71829/image-storage-server.png 1618w","sizes":"(max-width: 1618px) 100vw, 1618px"}}},"author":[{"id":"4기_오리","bio":"우아한테크코스 4기 오리(최진영)입니다 :)","avatar":{"children":[{"__typename":"ImageSharp","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADz0lEQVQ4y42U60+bZRjG+zfwdX4w8ZPRxGwfjAxj1OgGajZYlUOxdbBxZhuH0lI6NlrYWFmhlEHKKQwop8I4DMYQWIcD6rDNNgQM0oriwIlGXLKhYePw86VQRCiLd/LkSZ73fq73uq77vh8RL4i1tTX3Wo/V1VX38pazfRf9XzBPfNnbT4GhiMXFxa1zT55XwJ1/XFlZce9O5xRpChWBRz7E781XCAj4mL7e3q0crwx3SdwEW1paIiQkmLf9/Dgp2U9izFHe8n0Hu92+N+B2sO0S1iM9XYlUKiUxIYZD7x8gWHyYqOhYJicnd1ki2inVI/Hb0Qd0NJm4fCmb4BAJ5zLPkpoqJykpldBjBwXpAQJDx4sk/8tw4fFTaisL+PuBBntzHDJJIMdPxCKXywUf0zke9i6fBh5k4c8n3ovikev50GxpYHbEADOF8KiEeVsmeapQImQSPguRIhO/THX5uU2wVe9V9vgwMeniq9YL8DCfhW+0TPak84ewPxvP5a4lkeq8COSRvnR3tWzIXV72ztDjnbW/h5kBNfxk4FdbFpZCKdaaGO42xWFvTYb5ElYncmivzeP5yn+t2iF5g2Ffl5nfhlWCXCNjHacx6rWMOEYxXdFhbzkNU/nwg472KjWPnyzt7aGn5/q6rzF3Ww6/m5i7o6ZSn0BXrQbDxTSs1ScFK4w8H9Nw3azj2fIeDLd7OD09TUVeNH1X41kczRUO9HzfkyqwzsBSrmLmjpYZq5JbvTc27m22zFbbeIZ+fXl8NBiLhVY5xtgNJU8dZ+HnAly9aTQ0X6fepCJXIWZ65pE7d1koyvo9D8auWXa5nCiSIgXAIOSJUjqbTZTnJdB+RcpFRTBnYkOZHZDTc63E66MiGhoawuFwuCfDcW+MptJ0/nJkUG7UMPadk4ezv9DTP0hL5XluVkRSl/8F819rORXhj6GwCHNtLRaLxT2GTqcLkUajITs7m4b6OmrMTegywhkRqllTc5WpqSmMxkLM5hoh5xKxIe8xZ9Og112gsqqWpsZGVCoVxcXFwpwnoJCJEbW1tdHd3c3w8DDm+gYU8VGoZZ9QVV7Gvfv3GRocxDX9I1UlRWTJAshKklDXYKGjo52J8XH3va7OTjQaLeFHP0JkNpuprKigvKwMfYGB+LAgilKiSI6LorHJgs1m47I+n/TkM5hyMjkVJuaEVIJOp0MvnCuVSnx8fHhp3z7e2H8AkdFoJDYuns+PHCb8A1+0mWpuDwzQ0trqTo6OjiY1JYXzWRq3gltWK7ocLQlBh4iTiHn1tdfx9/dHrVZTVlrKPz2FHH5YjcpeAAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/eb0d39b517ea32a18b9b6239fa2da091/37d5a/ori.png","srcSet":"/static/eb0d39b517ea32a18b9b6239fa2da091/22f7f/ori.png 40w,\n/static/eb0d39b517ea32a18b9b6239fa2da091/587c9/ori.png 80w,\n/static/eb0d39b517ea32a18b9b6239fa2da091/d966b/ori.png 120w,\n/static/eb0d39b517ea32a18b9b6239fa2da091/37d5a/ori.png 300w","sizes":"(max-width: 300px) 100vw, 300px"}}]}}],"source":null}},"relatedPosts":{"totalCount":3,"edges":[{"node":{"id":"1cda66ad-a935-5ed7-931f-4c662ed90eb2","timeToRead":6,"excerpt":"레벨 3 프로젝트 과정 중 이미지 서버를 개발하고 개선해나가는 과정을 이야기하려 합니다. 왜 이미지 서버를 만들어야 하는가? 레벨…","frontmatter":{"title":"이미지 스토리지 서버 구축 및 최적화","date":"2022-09-13T12:00:00.000Z"},"fields":{"slug":"/post/2022-09-13-image-storage-server/"}}},{"node":{"id":"55ef5182-13a5-5046-9b7f-bd6623135382","timeToRead":4,"excerpt":"HTTP/2 프로토콜의 특징과 NGINX에서의 간단한 설정 방법에 대해 알아본다.","frontmatter":{"title":"HTTP/2 프로토콜 NGINX 적용하기","date":"2021-09-20T12:00:00.000Z"},"fields":{"slug":"/post/2021-09-20-http2/"}}},{"node":{"id":"a197854b-c046-5a28-8491-ac398fea909e","timeToRead":3,"excerpt":"…","frontmatter":{"title":"웹 서버와 NginX","date":"2021-07-30T12:00:00.000Z"},"fields":{"slug":"/post/2021-07-30-web-server-and-nginx/"}}}]}},"pageContext":{"slug":"/post/2022-09-13-image-storage-server/","prev":{"excerpt":"이미지 출처: Top 35 Data Structure & Algorithms Interview Questions and Answers in 2021 각 자료구조는 필요에 따라 선택되고 활용된다.\n 인터페이스의 구현체로는 , ,  등이 있다.\nMap 인터페이스를 구현하면,  형태를 띈다.\n그렇다면 이 셋은 무슨 특징을 가지고, 서로 어떤 차이가 있을까?\n이번 글에서 해당 구현체를 비교하며 확인해보자.","timeToRead":4,"frontmatter":{"title":"HashMap vs HashTable vs ConcurrentHashMap","tags":["hashmap","hashtable","concurrenthashmap"],"date":"2021-11-26T12:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7777777777777777,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAYHCAn/xAAWAQEBAQAAAAAAAAAAAAAAAAAEBQb/2gAMAwEAAhADEAAAAcmVflhUresVxPBg/8QAGxAAAwEAAwEAAAAAAAAAAAAAAwQFBgABAgf/2gAIAQEAAQUC+VbtbOD323wwal+3OfqxnWxnp0nicYJ67L//xAAgEQACAgICAgMAAAAAAAAAAAABAgMEERIABSEiMUFR/9oACAEDAQE/AaXexUkrzL1tWaeuAqGfd4vUjUtFG8KlhnIbGwb5ZgdeWe9sWbE1hoKqtNK8jKkKqoLNkhR9D888/8QAHxEAAgEDBQEAAAAAAAAAAAAAAQMCBBESAAYhMkFh/9oACAECAQE/AYu3G1T2R3JVoSxYpylVOi5XIZmObg7Dr3WIz5IFrk6jT1MYiJrGSxFspdpW9P0+6//EACcQAAIBAwIGAQUAAAAAAAAAAAECAwQREgAhBRMiMUFRMgYUFUJx/9oACAEBAAY/Aqf8j9KVHFoqmR05kZp3SZVkxcRx1O10ti5Up1jc99UM1HwKvgTL7megrOHqkY5gLmHOKolzEmRJGdgHJj2K2qqqkpTT08shaOHA9ALE4/Lxe3v+99R41Mw5SO8YzJRG+V1Q3QXbqItYncjXLepkdEQOqtZgGkijZ23HdixJPnRvbx+q+Rf171//xAAdEAEAAwABBQAAAAAAAAAAAAABESExAEFRYYGR/9oACAEBAAE/ITQ2rGqFMUJeelLpTSbRyXBEBuAGi5Q6pQqDgJVZbIf77aeBW+G+ZCBe5Q/fqTeENKTDvpi+y++f/9oADAMBAAIAAwAAABAkD//EABcRAQEBAQAAAAAAAAAAAAAAAAERITH/2gAIAQMBAT8QPaa6Z9UY0RXw72iI3oxaCkJr0//EABcRAQEBAQAAAAAAAAAAAAAAAAERQVH/2gAIAQIBAT8QV9JigLAqqMolyqMGFgColhVqryf/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhMUH/2gAIAQEAAT8QcjITAITYFSJjK1hxcKMSQ+4g/lGM2P0NDnnb6h2ARKqJVK7UgqaEWjE7fW05LYzlDfX8DGOCgAhv/9k=","sizes":"(max-width: 848px) 100vw, 848px","src":"/static/aef79f091ab1bf6d881faca54bbb2c74/46206/data-structures.jpg","srcSet":"/static/aef79f091ab1bf6d881faca54bbb2c74/46206/data-structures.jpg 848w"}}},"author":[{"id":"3기_다니","bio":"우아한테크코스 3기 다니(이다은)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAYHCAX/xAAYAQACAwAAAAAAAAAAAAAAAAADBQQGCP/aAAwDAQACEAMQAAABzdK5rXmabBWSOmhNDVaAUdIQ13//xAAaEAACAwEBAAAAAAAAAAAAAAADBAECBQYA/9oACAEBAAEFAhEVdC6sOysPBr7n+Xh+Ovxr4umfRsImQwcjuj0ekTzRJkv/xAAlEQACAQMDAgcAAAAAAAAAAAABAgMEERIAEyEFcRQxMkJRYWL/2gAIAQMBAT8BkqISYoN7eq5XQnGOVokkIGEpAaKIwxMwLR33vecXbIyHGRga9lORuoo5nAPFwGBYHuGPfUQHja/j09Puv5O9FyPg9tRO5RSWYm3mSfrX/8QAIxEAAgIABQQDAAAAAAAAAAAAAQIDEQAEBRIhFCJBcRMxQv/aAAgBAgEBPwGCWLMTgZaX48vCzN3vvYoUVGjFuyo7w9OUkjOz8VIiyIvQq/d0Ucm6jvfvZvrkvsG73Q8cYhiiOj6VcaGtRjq0U1UWdArjigqj0APGJXdZHCswAPADEAegMf/EACUQAAICAgICAQQDAAAAAAAAAAECAwQREhMhAAUUIiMxcUJRUv/aAAgBAQAGPwK4nxZ7L+xDmR7NlY4O8gms6PyJG2urZdTJGzjYBjhZxWSrWarZvWn9csUFZLCyRwcd6VJZLU1q3EokMfHr8ZMhtgfCKjy8WT26a7MOtl1jfKMAupfD/wChnssa8kNCKk6RFLQezDiyiomFRpn2iDM6SHXKNsYtk18jqSXI/YLJUp2IpIFTVZzyzGu65x9hdcPqz6PHtxsxHmjCQEAdCNuv3qhUfpesY8sffmQj1bWto5GjPNEYtGOpAbHIw7B6x5Xru0TJBbt2U2Qs24mWPU5YjRo/pYYyR/LPmdY1+hc4jTsnvJ2DHPf9/gDz/8QAGxABAQADAQEBAAAAAAAAAAAAAREAITFBcYH/2gAIAQEAAT8hKfEE73delMkcGf5DZboljiAPsAUSztUQ5oxgL4j5NX3TDNoYjAIDpP2m2Zt/srD1OJ1plIF6DTKQBCrzbDB+QrTpn2hc4QOTb2KaFy1oLZjh4gnr/9oADAMBAAIAAwAAABCsHzz/xAAZEQEBAAMBAAAAAAAAAAAAAAABEQAhcTH/2gAIAQMBAT8QMd7KEdLeDQR2ETjQhKBaKkHyIKMJCECEodZWw3eIZAVJW7qqr3P/xAAYEQEBAQEBAAAAAAAAAAAAAAABESEAMf/aAAgBAgEBPxAdOQD89ElgoLi2MkABPAGBJ4ARwFORn2NhqkqhKSDYAYr0GAkEABCAAQ7/xAAXEAEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEBAAE/EOUCuAJOl5pCKRAnsLoTyzAcFCAU91ZI3UVvHNeRaZFYRa7TA5ZJiSoQa04oYBJEACIMwN5F7ib1niAhkARWJP7rD4YIwu0ZOpxlHVbj1gAUOP/Z","sizes":"(max-width: 800px) 100vw, 800px","src":"/static/007d7f099331bf55b217ef476036172f/2f1b1/danyee.jpg","srcSet":"/static/007d7f099331bf55b217ef476036172f/fd013/danyee.jpg 200w,\n/static/007d7f099331bf55b217ef476036172f/25252/danyee.jpg 400w,\n/static/007d7f099331bf55b217ef476036172f/2f1b1/danyee.jpg 800w,\n/static/007d7f099331bf55b217ef476036172f/1920d/danyee.jpg 1080w"}}]}}]},"fields":{"layout":"post","slug":"/post/2021-11-26-hashmap-hashtable-concurrenthashmap/"}},"next":{"excerpt":"…","timeToRead":3,"frontmatter":{"title":"트랜잭션 내에 외부 리소스 요청이 담기게 되면 어떤 문제가 발생할까?","tags":["transactional"],"date":"2022-09-20T00:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7782026768642447,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFklEQVQoz5WSMcqDQBCFFS0sLbVKIYgnEM8QcgQLmxTiAQx4ANHOxgNYWFjkQGIhChZimjSiUV9wwfCHX8U8GHbYeXw7ww6FFU3T9O+uqiq0bfupr3lmUVuwx+OBIAgQhiHu9zvO5zNOpxPiON6FbgKbpkEURTAMAxzHged5yLKMJEl+A84ahoGcZVlCFEWwLAuapiEIAvI8//Ic6rDve5Lbtg2KomBZFkzTJPntdiO12XN45AXoeR6BXC4X6LpOctd1fwPOGsfx87OKohDQHKqq4vl8fnkOdbi87DgOGIaBJEnQNI10er1eURTFJnQXWNc1gfq+T3YwyzKkaYqu6zb3dXXkLfOR+m6H80iv14ucf2Opr0Hf/wQTGxn1ORwAAAAASUVORK5CYII=","sizes":"(max-width: 2560px) 100vw, 2560px","src":"/static/78909983daa4e23be69f5f64d315c228/a76e0/external-in-transaction.png","srcSet":"/static/78909983daa4e23be69f5f64d315c228/3a443/external-in-transaction.png 930w,\n/static/78909983daa4e23be69f5f64d315c228/4d929/external-in-transaction.png 1860w,\n/static/78909983daa4e23be69f5f64d315c228/a76e0/external-in-transaction.png 2560w"}}},"author":[{"id":"4기_매트","bio":"우아한테크코스 4기 매트(최기현)입니다 :)","avatar":{"children":[{"fluid":{"aspectRatio":1.098901098901099,"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAASABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAcGBQj/xAAXAQADAQAAAAAAAAAAAAAAAAAFBgcE/9oADAMBAAIQAxAAAAHwNWuRc1wzpGTYmGD5MAVi4gtPv//EAB0QAAICAgMBAAAAAAAAAAAAAAIEBQYDEQABFBX/2gAIAQEAAQUCPEOwpjHyISM1FVuQGOsNrtyckSFzVXWREfOBn1ysL4MqX//EACcRAAIBAwEGBwAAAAAAAAAAAAECAwQFEQAGEhQhIjETNTZ0hLK0/9oACAEDAQE/AbHY6yvoJrrLxJpo5nplcKFgEqxpIxkm7dIkHThQMZLEctPspe4naPgWk3TgSRyRNG45YZG8Vd5SMEHAyD21sL6V2Z+T+qp1fvOrl7yX7DX/xAApEQABAgQEBAcAAAAAAAAAAAABAgMABAUhESIxMhITIzQ1QXJzgbGz/9oACAECAQE/AaxMy8o43KssM8xbYdJKlKcSCpSQEpxtdO4k67fOG6jJ8COrhlFii40schv8mK74pUvU1+bUSnbMe2n6j//EACgQAAIBAwMEAQQDAAAAAAAAAAECAwQREgATIRQiUWEjBTEzQUKBkf/aAAgBAQAGPwIgDhTbxc+z/fIGmr6nKnqyFngoJSkbvQ4ktJtPHuPLIcHhRZFXbDZjJlGqLe5Z4FlW3Hxy/KgxGOOIbHG3FuDa2qSraMTRwyzNIGQSHZaFo3dVbt3QGvG38XsQb6po6Gvmxjmill+nbNnYxi13c96xMLqydwOV8h9tLBWQkNF8cOEnHTKAIR3G/YLx+wgPrVUbD8h/XhAR/h5HjUjBmDZsL3N7dPObX8X5tqoaWCKRutcZPGjm3TUvF2BNvWv/xAAaEAEBAQEBAQEAAAAAAAAAAAABESExAEFR/9oACAEBAAE/IddaBoGLSOxB2Ak8545GqhnWEXSFa6FkzqgVbDBKeFhabUJlwhigPX/J1iRQ6jOnAXcR5lLAKKr0kVDFOpqhUIrNEQ+mm+5EhymKTYAKl3vgkYoyUBCFUqCv77//2gAMAwEAAgADAAAAEAMPwv/EABkRAQACAwAAAAAAAAAAAAAAAAEQESFBof/aAAgBAwEBPxBrHcNKwSLKAoBAQO4LSnWsjzimuaFX/8QAHBEBAQACAgMAAAAAAAAAAAAAAREAIRAxQVHw/9oACAECAQE/EDLJfO4KkENiABjdm4tzAHwBETs1W3hX9v0z/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFB/9oACAEBAAE/EDsvsUWrJMgKUzhLr51KiN7NjU/QeQqGAyJL2MNIFn+UIqE1KS1BKeuLyYCL4XsDFGESzkKJbl3Z3bkyUgKKAS40uEPo0vmASEAOL5WKkagMBEAq/wD/2Q==","sizes":"(max-width: 592px) 100vw, 592px","src":"/static/d0383ede10aebc9055f7d5902f2ac4ea/a14e5/mat.jpg","srcSet":"/static/d0383ede10aebc9055f7d5902f2ac4ea/fd013/mat.jpg 200w,\n/static/d0383ede10aebc9055f7d5902f2ac4ea/25252/mat.jpg 400w,\n/static/d0383ede10aebc9055f7d5902f2ac4ea/a14e5/mat.jpg 592w"}}]}}]},"fields":{"layout":"post","slug":"/post/2022-09-20-external-in-transaction/"}},"primaryTag":"nginx"}},"staticQueryHashes":["2130001345","4041952199"]}